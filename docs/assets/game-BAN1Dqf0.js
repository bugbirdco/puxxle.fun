import{c as commonjsGlobal,r as ref,a as computed,w as watchEffect,o as onMounted,b as openBlock,d as createElementBlock,F as Fragment,e as renderList,f as createBaseVNode,n as normalizeStyle,g as createCommentVNode,h as defineComponent,u as useAppStore,i as watch,j as onBeforeMount,k as withDirectives,v as vModelText,l as withKeys,t as toDisplayString,m as withModifiers,p as createTextVNode,q as createBlock,s as unref,x as nextTick,y as normalizeClass,z as pushScopeId,A as popScopeId,B as createStaticVNode}from"./index-B-MES4NM.js";class LuxonError extends Error{}class InvalidDateTimeError extends LuxonError{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class InvalidIntervalError extends LuxonError{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class InvalidDurationError extends LuxonError{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class ConflictingSpecificationError extends LuxonError{}class InvalidUnitError extends LuxonError{constructor(e){super(`Invalid unit ${e}`)}}class InvalidArgumentError extends LuxonError{}class ZoneIsAbstractError extends LuxonError{constructor(){super("Zone is an abstract class")}}const n="numeric",s="short",l="long",DATE_SHORT={year:n,month:n,day:n},DATE_MED={year:n,month:s,day:n},DATE_MED_WITH_WEEKDAY={year:n,month:s,day:n,weekday:s},DATE_FULL={year:n,month:l,day:n},DATE_HUGE={year:n,month:l,day:n,weekday:l},TIME_SIMPLE={hour:n,minute:n},TIME_WITH_SECONDS={hour:n,minute:n,second:n},TIME_WITH_SHORT_OFFSET={hour:n,minute:n,second:n,timeZoneName:s},TIME_WITH_LONG_OFFSET={hour:n,minute:n,second:n,timeZoneName:l},TIME_24_SIMPLE={hour:n,minute:n,hourCycle:"h23"},TIME_24_WITH_SECONDS={hour:n,minute:n,second:n,hourCycle:"h23"},TIME_24_WITH_SHORT_OFFSET={hour:n,minute:n,second:n,hourCycle:"h23",timeZoneName:s},TIME_24_WITH_LONG_OFFSET={hour:n,minute:n,second:n,hourCycle:"h23",timeZoneName:l},DATETIME_SHORT={year:n,month:n,day:n,hour:n,minute:n},DATETIME_SHORT_WITH_SECONDS={year:n,month:n,day:n,hour:n,minute:n,second:n},DATETIME_MED={year:n,month:s,day:n,hour:n,minute:n},DATETIME_MED_WITH_SECONDS={year:n,month:s,day:n,hour:n,minute:n,second:n},DATETIME_MED_WITH_WEEKDAY={year:n,month:s,day:n,weekday:s,hour:n,minute:n},DATETIME_FULL={year:n,month:l,day:n,hour:n,minute:n,timeZoneName:s},DATETIME_FULL_WITH_SECONDS={year:n,month:l,day:n,hour:n,minute:n,second:n,timeZoneName:s},DATETIME_HUGE={year:n,month:l,day:n,weekday:l,hour:n,minute:n,timeZoneName:l},DATETIME_HUGE_WITH_SECONDS={year:n,month:l,day:n,weekday:l,hour:n,minute:n,second:n,timeZoneName:l};class Zone{get type(){throw new ZoneIsAbstractError}get name(){throw new ZoneIsAbstractError}get ianaName(){return this.name}get isUniversal(){throw new ZoneIsAbstractError}offsetName(e,t){throw new ZoneIsAbstractError}formatOffset(e,t){throw new ZoneIsAbstractError}offset(e){throw new ZoneIsAbstractError}equals(e){throw new ZoneIsAbstractError}get isValid(){throw new ZoneIsAbstractError}}let singleton$1=null;class SystemZone extends Zone{static get instance(){return singleton$1===null&&(singleton$1=new SystemZone),singleton$1}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:r}){return parseZoneInfo(e,t,r)}formatOffset(e,t){return formatOffset(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let dtfCache={};function makeDTF(i){return dtfCache[i]||(dtfCache[i]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:i,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),dtfCache[i]}const typeToPos={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function hackyOffset(i,e){const t=i.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(t),[,a,o,u,c,h,d,p]=r;return[u,a,o,c,h,d,p]}function partsOffset(i,e){const t=i.formatToParts(e),r=[];for(let a=0;a<t.length;a++){const{type:o,value:u}=t[a],c=typeToPos[o];o==="era"?r[c]=u:isUndefined$1(c)||(r[c]=parseInt(u,10))}return r}let ianaZoneCache={};class IANAZone extends Zone{static create(e){return ianaZoneCache[e]||(ianaZoneCache[e]=new IANAZone(e)),ianaZoneCache[e]}static resetCache(){ianaZoneCache={},dtfCache={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=IANAZone.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:r}){return parseZoneInfo(e,t,r,this.name)}formatOffset(e,t){return formatOffset(this.offset(e),t)}offset(e){const t=new Date(e);if(isNaN(t))return NaN;const r=makeDTF(this.name);let[a,o,u,c,h,d,p]=r.formatToParts?partsOffset(r,t):hackyOffset(r,t);c==="BC"&&(a=-Math.abs(a)+1);const f=objToLocalTS({year:a,month:o,day:u,hour:h===24?0:h,minute:d,second:p,millisecond:0});let g=+t;const y=g%1e3;return g-=y>=0?y:1e3+y,(f-g)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let intlLFCache={};function getCachedLF(i,e={}){const t=JSON.stringify([i,e]);let r=intlLFCache[t];return r||(r=new Intl.ListFormat(i,e),intlLFCache[t]=r),r}let intlDTCache={};function getCachedDTF(i,e={}){const t=JSON.stringify([i,e]);let r=intlDTCache[t];return r||(r=new Intl.DateTimeFormat(i,e),intlDTCache[t]=r),r}let intlNumCache={};function getCachedINF(i,e={}){const t=JSON.stringify([i,e]);let r=intlNumCache[t];return r||(r=new Intl.NumberFormat(i,e),intlNumCache[t]=r),r}let intlRelCache={};function getCachedRTF(i,e={}){const{base:t,...r}=e,a=JSON.stringify([i,r]);let o=intlRelCache[a];return o||(o=new Intl.RelativeTimeFormat(i,e),intlRelCache[a]=o),o}let sysLocaleCache=null;function systemLocale(){return sysLocaleCache||(sysLocaleCache=new Intl.DateTimeFormat().resolvedOptions().locale,sysLocaleCache)}let weekInfoCache={};function getCachedWeekInfo(i){let e=weekInfoCache[i];if(!e){const t=new Intl.Locale(i);e="getWeekInfo"in t?t.getWeekInfo():t.weekInfo,weekInfoCache[i]=e}return e}function parseLocaleString(i){const e=i.indexOf("-x-");e!==-1&&(i=i.substring(0,e));const t=i.indexOf("-u-");if(t===-1)return[i];{let r,a;try{r=getCachedDTF(i).resolvedOptions(),a=i}catch{const h=i.substring(0,t);r=getCachedDTF(h).resolvedOptions(),a=h}const{numberingSystem:o,calendar:u}=r;return[a,o,u]}}function intlConfigString(i,e,t){return(t||e)&&(i.includes("-u-")||(i+="-u"),t&&(i+=`-ca-${t}`),e&&(i+=`-nu-${e}`)),i}function mapMonths(i){const e=[];for(let t=1;t<=12;t++){const r=DateTime.utc(2009,t,1);e.push(i(r))}return e}function mapWeekdays(i){const e=[];for(let t=1;t<=7;t++){const r=DateTime.utc(2016,11,13+t);e.push(i(r))}return e}function listStuff(i,e,t,r){const a=i.listingMode();return a==="error"?null:a==="en"?t(e):r(e)}function supportsFastNumbers(i){return i.numberingSystem&&i.numberingSystem!=="latn"?!1:i.numberingSystem==="latn"||!i.locale||i.locale.startsWith("en")||new Intl.DateTimeFormat(i.intl).resolvedOptions().numberingSystem==="latn"}class PolyNumberFormatter{constructor(e,t,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:a,floor:o,...u}=r;if(!t||Object.keys(u).length>0){const c={useGrouping:!1,...r};r.padTo>0&&(c.minimumIntegerDigits=r.padTo),this.inf=getCachedINF(e,c)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}else{const t=this.floor?Math.floor(e):roundTo(e,3);return padStart(t,this.padTo)}}}class PolyDateFormatter{constructor(e,t,r){this.opts=r,this.originalZone=void 0;let a;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const u=-1*(e.offset/60),c=u>=0?`Etc/GMT+${u}`:`Etc/GMT${u}`;e.offset!==0&&IANAZone.create(c).valid?(a=c,this.dt=e):(a="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,a=e.zone.name):(a="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const o={...this.opts};o.timeZone=o.timeZone||a,this.dtf=getCachedDTF(t,o)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(t=>{if(t.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...t,value:r}}else return t}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class PolyRelFormatter{constructor(e,t,r){this.opts={style:"long",...r},!t&&hasRelative()&&(this.rtf=getCachedRTF(e,r))}format(e,t){return this.rtf?this.rtf.format(e,t):formatRelativeTime(t,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}const fallbackWeekSettings={firstDay:1,minimalDays:4,weekend:[6,7]};class Locale{static fromOpts(e){return Locale.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,t,r,a,o=!1){const u=e||Settings.defaultLocale,c=u||(o?"en-US":systemLocale()),h=t||Settings.defaultNumberingSystem,d=r||Settings.defaultOutputCalendar,p=validateWeekSettings(a)||Settings.defaultWeekSettings;return new Locale(c,h,d,p,u)}static resetCache(){sysLocaleCache=null,intlDTCache={},intlNumCache={},intlRelCache={}}static fromObject({locale:e,numberingSystem:t,outputCalendar:r,weekSettings:a}={}){return Locale.create(e,t,r,a)}constructor(e,t,r,a,o){const[u,c,h]=parseLocaleString(e);this.locale=u,this.numberingSystem=t||c||null,this.outputCalendar=r||h||null,this.weekSettings=a,this.intl=intlConfigString(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=o,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=supportsFastNumbers(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&t?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Locale.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,validateWeekSettings(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,t=!1){return listStuff(this,e,months,()=>{const r=t?{month:e,day:"numeric"}:{month:e},a=t?"format":"standalone";return this.monthsCache[a][e]||(this.monthsCache[a][e]=mapMonths(o=>this.extract(o,r,"month"))),this.monthsCache[a][e]})}weekdays(e,t=!1){return listStuff(this,e,weekdays,()=>{const r=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},a=t?"format":"standalone";return this.weekdaysCache[a][e]||(this.weekdaysCache[a][e]=mapWeekdays(o=>this.extract(o,r,"weekday"))),this.weekdaysCache[a][e]})}meridiems(){return listStuff(this,void 0,()=>meridiems,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[DateTime.utc(2016,11,13,9),DateTime.utc(2016,11,13,19)].map(t=>this.extract(t,e,"dayperiod"))}return this.meridiemCache})}eras(e){return listStuff(this,e,eras,()=>{const t={era:e};return this.eraCache[e]||(this.eraCache[e]=[DateTime.utc(-40,1,1),DateTime.utc(2017,1,1)].map(r=>this.extract(r,t,"era"))),this.eraCache[e]})}extract(e,t,r){const a=this.dtFormatter(e,t),o=a.formatToParts(),u=o.find(c=>c.type.toLowerCase()===r);return u?u.value:null}numberFormatter(e={}){return new PolyNumberFormatter(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new PolyDateFormatter(e,this.intl,t)}relFormatter(e={}){return new PolyRelFormatter(this.intl,this.isEnglish(),e)}listFormatter(e={}){return getCachedLF(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:hasLocaleWeekInfo()?getCachedWeekInfo(this.locale):fallbackWeekSettings}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let singleton=null;class FixedOffsetZone extends Zone{static get utcInstance(){return singleton===null&&(singleton=new FixedOffsetZone(0)),singleton}static instance(e){return e===0?FixedOffsetZone.utcInstance:new FixedOffsetZone(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new FixedOffsetZone(signedOffset(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${formatOffset(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${formatOffset(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return formatOffset(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class InvalidZone extends Zone{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function normalizeZone(i,e){if(isUndefined$1(i)||i===null)return e;if(i instanceof Zone)return i;if(isString$1(i)){const t=i.toLowerCase();return t==="default"?e:t==="local"||t==="system"?SystemZone.instance:t==="utc"||t==="gmt"?FixedOffsetZone.utcInstance:FixedOffsetZone.parseSpecifier(t)||IANAZone.create(i)}else return isNumber(i)?FixedOffsetZone.instance(i):typeof i=="object"&&"offset"in i&&typeof i.offset=="function"?i:new InvalidZone(i)}let now=()=>Date.now(),defaultZone="system",defaultLocale=null,defaultNumberingSystem=null,defaultOutputCalendar=null,twoDigitCutoffYear=60,throwOnInvalid,defaultWeekSettings=null;class Settings{static get now(){return now}static set now(e){now=e}static set defaultZone(e){defaultZone=e}static get defaultZone(){return normalizeZone(defaultZone,SystemZone.instance)}static get defaultLocale(){return defaultLocale}static set defaultLocale(e){defaultLocale=e}static get defaultNumberingSystem(){return defaultNumberingSystem}static set defaultNumberingSystem(e){defaultNumberingSystem=e}static get defaultOutputCalendar(){return defaultOutputCalendar}static set defaultOutputCalendar(e){defaultOutputCalendar=e}static get defaultWeekSettings(){return defaultWeekSettings}static set defaultWeekSettings(e){defaultWeekSettings=validateWeekSettings(e)}static get twoDigitCutoffYear(){return twoDigitCutoffYear}static set twoDigitCutoffYear(e){twoDigitCutoffYear=e%100}static get throwOnInvalid(){return throwOnInvalid}static set throwOnInvalid(e){throwOnInvalid=e}static resetCaches(){Locale.resetCache(),IANAZone.resetCache()}}class Invalid{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const nonLeapLadder=[0,31,59,90,120,151,181,212,243,273,304,334],leapLadder=[0,31,60,91,121,152,182,213,244,274,305,335];function unitOutOfRange(i,e){return new Invalid("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${i}, which is invalid`)}function dayOfWeek(i,e,t){const r=new Date(Date.UTC(i,e-1,t));i<100&&i>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const a=r.getUTCDay();return a===0?7:a}function computeOrdinal(i,e,t){return t+(isLeapYear(i)?leapLadder:nonLeapLadder)[e-1]}function uncomputeOrdinal(i,e){const t=isLeapYear(i)?leapLadder:nonLeapLadder,r=t.findIndex(o=>o<e),a=e-t[r];return{month:r+1,day:a}}function isoWeekdayToLocal(i,e){return(i-e+7)%7+1}function gregorianToWeek(i,e=4,t=1){const{year:r,month:a,day:o}=i,u=computeOrdinal(r,a,o),c=isoWeekdayToLocal(dayOfWeek(r,a,o),t);let h=Math.floor((u-c+14-e)/7),d;return h<1?(d=r-1,h=weeksInWeekYear(d,e,t)):h>weeksInWeekYear(r,e,t)?(d=r+1,h=1):d=r,{weekYear:d,weekNumber:h,weekday:c,...timeObject(i)}}function weekToGregorian(i,e=4,t=1){const{weekYear:r,weekNumber:a,weekday:o}=i,u=isoWeekdayToLocal(dayOfWeek(r,1,e),t),c=daysInYear(r);let h=a*7+o-u-7+e,d;h<1?(d=r-1,h+=daysInYear(d)):h>c?(d=r+1,h-=daysInYear(r)):d=r;const{month:p,day:m}=uncomputeOrdinal(d,h);return{year:d,month:p,day:m,...timeObject(i)}}function gregorianToOrdinal(i){const{year:e,month:t,day:r}=i,a=computeOrdinal(e,t,r);return{year:e,ordinal:a,...timeObject(i)}}function ordinalToGregorian(i){const{year:e,ordinal:t}=i,{month:r,day:a}=uncomputeOrdinal(e,t);return{year:e,month:r,day:a,...timeObject(i)}}function usesLocalWeekValues(i,e){if(!isUndefined$1(i.localWeekday)||!isUndefined$1(i.localWeekNumber)||!isUndefined$1(i.localWeekYear)){if(!isUndefined$1(i.weekday)||!isUndefined$1(i.weekNumber)||!isUndefined$1(i.weekYear))throw new ConflictingSpecificationError("Cannot mix locale-based week fields with ISO-based week fields");return isUndefined$1(i.localWeekday)||(i.weekday=i.localWeekday),isUndefined$1(i.localWeekNumber)||(i.weekNumber=i.localWeekNumber),isUndefined$1(i.localWeekYear)||(i.weekYear=i.localWeekYear),delete i.localWeekday,delete i.localWeekNumber,delete i.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function hasInvalidWeekData(i,e=4,t=1){const r=isInteger(i.weekYear),a=integerBetween(i.weekNumber,1,weeksInWeekYear(i.weekYear,e,t)),o=integerBetween(i.weekday,1,7);return r?a?o?!1:unitOutOfRange("weekday",i.weekday):unitOutOfRange("week",i.weekNumber):unitOutOfRange("weekYear",i.weekYear)}function hasInvalidOrdinalData(i){const e=isInteger(i.year),t=integerBetween(i.ordinal,1,daysInYear(i.year));return e?t?!1:unitOutOfRange("ordinal",i.ordinal):unitOutOfRange("year",i.year)}function hasInvalidGregorianData(i){const e=isInteger(i.year),t=integerBetween(i.month,1,12),r=integerBetween(i.day,1,daysInMonth(i.year,i.month));return e?t?r?!1:unitOutOfRange("day",i.day):unitOutOfRange("month",i.month):unitOutOfRange("year",i.year)}function hasInvalidTimeData(i){const{hour:e,minute:t,second:r,millisecond:a}=i,o=integerBetween(e,0,23)||e===24&&t===0&&r===0&&a===0,u=integerBetween(t,0,59),c=integerBetween(r,0,59),h=integerBetween(a,0,999);return o?u?c?h?!1:unitOutOfRange("millisecond",a):unitOutOfRange("second",r):unitOutOfRange("minute",t):unitOutOfRange("hour",e)}function isUndefined$1(i){return typeof i>"u"}function isNumber(i){return typeof i=="number"}function isInteger(i){return typeof i=="number"&&i%1===0}function isString$1(i){return typeof i=="string"}function isDate(i){return Object.prototype.toString.call(i)==="[object Date]"}function hasRelative(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function hasLocaleWeekInfo(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function maybeArray(i){return Array.isArray(i)?i:[i]}function bestBy(i,e,t){if(i.length!==0)return i.reduce((r,a)=>{const o=[e(a),a];return r&&t(r[0],o[0])===r[0]?r:o},null)[1]}function pick$1(i,e){return e.reduce((t,r)=>(t[r]=i[r],t),{})}function hasOwnProperty(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function validateWeekSettings(i){if(i==null)return null;if(typeof i!="object")throw new InvalidArgumentError("Week settings must be an object");if(!integerBetween(i.firstDay,1,7)||!integerBetween(i.minimalDays,1,7)||!Array.isArray(i.weekend)||i.weekend.some(e=>!integerBetween(e,1,7)))throw new InvalidArgumentError("Invalid week settings");return{firstDay:i.firstDay,minimalDays:i.minimalDays,weekend:Array.from(i.weekend)}}function integerBetween(i,e,t){return isInteger(i)&&i>=e&&i<=t}function floorMod(i,e){return i-e*Math.floor(i/e)}function padStart(i,e=2){const t=i<0;let r;return t?r="-"+(""+-i).padStart(e,"0"):r=(""+i).padStart(e,"0"),r}function parseInteger(i){if(!(isUndefined$1(i)||i===null||i===""))return parseInt(i,10)}function parseFloating(i){if(!(isUndefined$1(i)||i===null||i===""))return parseFloat(i)}function parseMillis(i){if(!(isUndefined$1(i)||i===null||i==="")){const e=parseFloat("0."+i)*1e3;return Math.floor(e)}}function roundTo(i,e,t=!1){const r=10**e;return(t?Math.trunc:Math.round)(i*r)/r}function isLeapYear(i){return i%4===0&&(i%100!==0||i%400===0)}function daysInYear(i){return isLeapYear(i)?366:365}function daysInMonth(i,e){const t=floorMod(e-1,12)+1,r=i+(e-t)/12;return t===2?isLeapYear(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][t-1]}function objToLocalTS(i){let e=Date.UTC(i.year,i.month-1,i.day,i.hour,i.minute,i.second,i.millisecond);return i.year<100&&i.year>=0&&(e=new Date(e),e.setUTCFullYear(i.year,i.month-1,i.day)),+e}function firstWeekOffset(i,e,t){return-isoWeekdayToLocal(dayOfWeek(i,1,e),t)+e-1}function weeksInWeekYear(i,e=4,t=1){const r=firstWeekOffset(i,e,t),a=firstWeekOffset(i+1,e,t);return(daysInYear(i)-r+a)/7}function untruncateYear(i){return i>99?i:i>Settings.twoDigitCutoffYear?1900+i:2e3+i}function parseZoneInfo(i,e,t,r=null){const a=new Date(i),o={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(o.timeZone=r);const u={timeZoneName:e,...o},c=new Intl.DateTimeFormat(t,u).formatToParts(a).find(h=>h.type.toLowerCase()==="timezonename");return c?c.value:null}function signedOffset(i,e){let t=parseInt(i,10);Number.isNaN(t)&&(t=0);const r=parseInt(e,10)||0,a=t<0||Object.is(t,-0)?-r:r;return t*60+a}function asNumber(i){const e=Number(i);if(typeof i=="boolean"||i===""||Number.isNaN(e))throw new InvalidArgumentError(`Invalid unit value ${i}`);return e}function normalizeObject(i,e){const t={};for(const r in i)if(hasOwnProperty(i,r)){const a=i[r];if(a==null)continue;t[e(r)]=asNumber(a)}return t}function formatOffset(i,e){const t=Math.trunc(Math.abs(i/60)),r=Math.trunc(Math.abs(i%60)),a=i>=0?"+":"-";switch(e){case"short":return`${a}${padStart(t,2)}:${padStart(r,2)}`;case"narrow":return`${a}${t}${r>0?`:${r}`:""}`;case"techie":return`${a}${padStart(t,2)}${padStart(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function timeObject(i){return pick$1(i,["hour","minute","second","millisecond"])}const monthsLong=["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthsNarrow=["J","F","M","A","M","J","J","A","S","O","N","D"];function months(i){switch(i){case"narrow":return[...monthsNarrow];case"short":return[...monthsShort];case"long":return[...monthsLong];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const weekdaysLong=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekdaysShort=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],weekdaysNarrow=["M","T","W","T","F","S","S"];function weekdays(i){switch(i){case"narrow":return[...weekdaysNarrow];case"short":return[...weekdaysShort];case"long":return[...weekdaysLong];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const meridiems=["AM","PM"],erasLong=["Before Christ","Anno Domini"],erasShort=["BC","AD"],erasNarrow=["B","A"];function eras(i){switch(i){case"narrow":return[...erasNarrow];case"short":return[...erasShort];case"long":return[...erasLong];default:return null}}function meridiemForDateTime(i){return meridiems[i.hour<12?0:1]}function weekdayForDateTime(i,e){return weekdays(e)[i.weekday-1]}function monthForDateTime(i,e){return months(e)[i.month-1]}function eraForDateTime(i,e){return eras(e)[i.year<0?0:1]}function formatRelativeTime(i,e,t="always",r=!1){const a={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},o=["hours","minutes","seconds"].indexOf(i)===-1;if(t==="auto"&&o){const m=i==="days";switch(e){case 1:return m?"tomorrow":`next ${a[i][0]}`;case-1:return m?"yesterday":`last ${a[i][0]}`;case 0:return m?"today":`this ${a[i][0]}`}}const u=Object.is(e,-0)||e<0,c=Math.abs(e),h=c===1,d=a[i],p=r?h?d[1]:d[2]||d[1]:h?a[i][0]:i;return u?`${c} ${p} ago`:`in ${c} ${p}`}function stringifyTokens(i,e){let t="";for(const r of i)r.literal?t+=r.val:t+=e(r.val);return t}const macroTokenToFormatOpts={D:DATE_SHORT,DD:DATE_MED,DDD:DATE_FULL,DDDD:DATE_HUGE,t:TIME_SIMPLE,tt:TIME_WITH_SECONDS,ttt:TIME_WITH_SHORT_OFFSET,tttt:TIME_WITH_LONG_OFFSET,T:TIME_24_SIMPLE,TT:TIME_24_WITH_SECONDS,TTT:TIME_24_WITH_SHORT_OFFSET,TTTT:TIME_24_WITH_LONG_OFFSET,f:DATETIME_SHORT,ff:DATETIME_MED,fff:DATETIME_FULL,ffff:DATETIME_HUGE,F:DATETIME_SHORT_WITH_SECONDS,FF:DATETIME_MED_WITH_SECONDS,FFF:DATETIME_FULL_WITH_SECONDS,FFFF:DATETIME_HUGE_WITH_SECONDS};class Formatter{static create(e,t={}){return new Formatter(e,t)}static parseFormat(e){let t=null,r="",a=!1;const o=[];for(let u=0;u<e.length;u++){const c=e.charAt(u);c==="'"?(r.length>0&&o.push({literal:a||/^\s+$/.test(r),val:r}),t=null,r="",a=!a):a||c===t?r+=c:(r.length>0&&o.push({literal:/^\s+$/.test(r),val:r}),r=c,t=c)}return r.length>0&&o.push({literal:a||/^\s+$/.test(r),val:r}),o}static macroTokenToFormatOpts(e){return macroTokenToFormatOpts[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...t}).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t})}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return padStart(e,t);const r={...this.opts};return t>0&&(r.padTo=t),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,t){const r=this.loc.listingMode()==="en",a=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",o=(g,y)=>this.loc.extract(e,g,y),u=g=>e.isOffsetFixed&&e.offset===0&&g.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,g.format):"",c=()=>r?meridiemForDateTime(e):o({hour:"numeric",hourCycle:"h12"},"dayperiod"),h=(g,y)=>r?monthForDateTime(e,g):o(y?{month:g}:{month:g,day:"numeric"},"month"),d=(g,y)=>r?weekdayForDateTime(e,g):o(y?{weekday:g}:{weekday:g,month:"long",day:"numeric"},"weekday"),p=g=>{const y=Formatter.macroTokenToFormatOpts(g);return y?this.formatWithSystemDefault(e,y):g},m=g=>r?eraForDateTime(e,g):o({era:g},"era"),f=g=>{switch(g){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return u({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return u({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return u({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return c();case"d":return a?o({day:"numeric"},"day"):this.num(e.day);case"dd":return a?o({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return d("short",!0);case"cccc":return d("long",!0);case"ccccc":return d("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return d("short",!1);case"EEEE":return d("long",!1);case"EEEEE":return d("narrow",!1);case"L":return a?o({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return a?o({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return h("short",!0);case"LLLL":return h("long",!0);case"LLLLL":return h("narrow",!0);case"M":return a?o({month:"numeric"},"month"):this.num(e.month);case"MM":return a?o({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return h("short",!1);case"MMMM":return h("long",!1);case"MMMMM":return h("narrow",!1);case"y":return a?o({year:"numeric"},"year"):this.num(e.year);case"yy":return a?o({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return a?o({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return a?o({year:"numeric"},"year"):this.num(e.year,6);case"G":return m("short");case"GG":return m("long");case"GGGGG":return m("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return p(g)}};return stringifyTokens(Formatter.parseFormat(t),f)}formatDurationFromString(e,t){const r=h=>{switch(h[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},a=h=>d=>{const p=r(d);return p?this.num(h.get(p),d.length):d},o=Formatter.parseFormat(t),u=o.reduce((h,{literal:d,val:p})=>d?h:h.concat(p),[]),c=e.shiftTo(...u.map(r).filter(h=>h));return stringifyTokens(o,a(c))}}const ianaRegex=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function combineRegexes(...i){const e=i.reduce((t,r)=>t+r.source,"");return RegExp(`^${e}$`)}function combineExtractors(...i){return e=>i.reduce(([t,r,a],o)=>{const[u,c,h]=o(e,a);return[{...t,...u},c||r,h]},[{},null,1]).slice(0,2)}function parse(i,...e){if(i==null)return[null,null];for(const[t,r]of e){const a=t.exec(i);if(a)return r(a)}return[null,null]}function simpleParse(...i){return(e,t)=>{const r={};let a;for(a=0;a<i.length;a++)r[i[a]]=parseInteger(e[t+a]);return[r,null,t+a]}}const offsetRegex=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,isoExtendedZone=`(?:${offsetRegex.source}?(?:\\[(${ianaRegex.source})\\])?)?`,isoTimeBaseRegex=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,isoTimeRegex=RegExp(`${isoTimeBaseRegex.source}${isoExtendedZone}`),isoTimeExtensionRegex=RegExp(`(?:T${isoTimeRegex.source})?`),isoYmdRegex=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,isoWeekRegex=/(\d{4})-?W(\d\d)(?:-?(\d))?/,isoOrdinalRegex=/(\d{4})-?(\d{3})/,extractISOWeekData=simpleParse("weekYear","weekNumber","weekDay"),extractISOOrdinalData=simpleParse("year","ordinal"),sqlYmdRegex=/(\d{4})-(\d\d)-(\d\d)/,sqlTimeRegex=RegExp(`${isoTimeBaseRegex.source} ?(?:${offsetRegex.source}|(${ianaRegex.source}))?`),sqlTimeExtensionRegex=RegExp(`(?: ${sqlTimeRegex.source})?`);function int(i,e,t){const r=i[e];return isUndefined$1(r)?t:parseInteger(r)}function extractISOYmd(i,e){return[{year:int(i,e),month:int(i,e+1,1),day:int(i,e+2,1)},null,e+3]}function extractISOTime(i,e){return[{hours:int(i,e,0),minutes:int(i,e+1,0),seconds:int(i,e+2,0),milliseconds:parseMillis(i[e+3])},null,e+4]}function extractISOOffset(i,e){const t=!i[e]&&!i[e+1],r=signedOffset(i[e+1],i[e+2]),a=t?null:FixedOffsetZone.instance(r);return[{},a,e+3]}function extractIANAZone(i,e){const t=i[e]?IANAZone.create(i[e]):null;return[{},t,e+1]}const isoTimeOnly=RegExp(`^T?${isoTimeBaseRegex.source}$`),isoDuration=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function extractISODuration(i){const[e,t,r,a,o,u,c,h,d]=i,p=e[0]==="-",m=h&&h[0]==="-",f=(g,y=!1)=>g!==void 0&&(y||g&&p)?-g:g;return[{years:f(parseFloating(t)),months:f(parseFloating(r)),weeks:f(parseFloating(a)),days:f(parseFloating(o)),hours:f(parseFloating(u)),minutes:f(parseFloating(c)),seconds:f(parseFloating(h),h==="-0"),milliseconds:f(parseMillis(d),m)}]}const obsOffsets={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function fromStrings(i,e,t,r,a,o,u){const c={year:e.length===2?untruncateYear(parseInteger(e)):parseInteger(e),month:monthsShort.indexOf(t)+1,day:parseInteger(r),hour:parseInteger(a),minute:parseInteger(o)};return u&&(c.second=parseInteger(u)),i&&(c.weekday=i.length>3?weekdaysLong.indexOf(i)+1:weekdaysShort.indexOf(i)+1),c}const rfc2822=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function extractRFC2822(i){const[,e,t,r,a,o,u,c,h,d,p,m]=i,f=fromStrings(e,a,r,t,o,u,c);let g;return h?g=obsOffsets[h]:d?g=0:g=signedOffset(p,m),[f,new FixedOffsetZone(g)]}function preprocessRFC2822(i){return i.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const rfc1123=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,rfc850=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,ascii=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function extractRFC1123Or850(i){const[,e,t,r,a,o,u,c]=i;return[fromStrings(e,a,r,t,o,u,c),FixedOffsetZone.utcInstance]}function extractASCII(i){const[,e,t,r,a,o,u,c]=i;return[fromStrings(e,c,t,r,a,o,u),FixedOffsetZone.utcInstance]}const isoYmdWithTimeExtensionRegex=combineRegexes(isoYmdRegex,isoTimeExtensionRegex),isoWeekWithTimeExtensionRegex=combineRegexes(isoWeekRegex,isoTimeExtensionRegex),isoOrdinalWithTimeExtensionRegex=combineRegexes(isoOrdinalRegex,isoTimeExtensionRegex),isoTimeCombinedRegex=combineRegexes(isoTimeRegex),extractISOYmdTimeAndOffset=combineExtractors(extractISOYmd,extractISOTime,extractISOOffset,extractIANAZone),extractISOWeekTimeAndOffset=combineExtractors(extractISOWeekData,extractISOTime,extractISOOffset,extractIANAZone),extractISOOrdinalDateAndTime=combineExtractors(extractISOOrdinalData,extractISOTime,extractISOOffset,extractIANAZone),extractISOTimeAndOffset=combineExtractors(extractISOTime,extractISOOffset,extractIANAZone);function parseISODate(i){return parse(i,[isoYmdWithTimeExtensionRegex,extractISOYmdTimeAndOffset],[isoWeekWithTimeExtensionRegex,extractISOWeekTimeAndOffset],[isoOrdinalWithTimeExtensionRegex,extractISOOrdinalDateAndTime],[isoTimeCombinedRegex,extractISOTimeAndOffset])}function parseRFC2822Date(i){return parse(preprocessRFC2822(i),[rfc2822,extractRFC2822])}function parseHTTPDate(i){return parse(i,[rfc1123,extractRFC1123Or850],[rfc850,extractRFC1123Or850],[ascii,extractASCII])}function parseISODuration(i){return parse(i,[isoDuration,extractISODuration])}const extractISOTimeOnly=combineExtractors(extractISOTime);function parseISOTimeOnly(i){return parse(i,[isoTimeOnly,extractISOTimeOnly])}const sqlYmdWithTimeExtensionRegex=combineRegexes(sqlYmdRegex,sqlTimeExtensionRegex),sqlTimeCombinedRegex=combineRegexes(sqlTimeRegex),extractISOTimeOffsetAndIANAZone=combineExtractors(extractISOTime,extractISOOffset,extractIANAZone);function parseSQL(i){return parse(i,[sqlYmdWithTimeExtensionRegex,extractISOYmdTimeAndOffset],[sqlTimeCombinedRegex,extractISOTimeOffsetAndIANAZone])}const INVALID$2="Invalid Duration",lowOrderMatrix={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},casualMatrix={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...lowOrderMatrix},daysInYearAccurate=146097/400,daysInMonthAccurate=146097/4800,accurateMatrix={years:{quarters:4,months:12,weeks:daysInYearAccurate/7,days:daysInYearAccurate,hours:daysInYearAccurate*24,minutes:daysInYearAccurate*24*60,seconds:daysInYearAccurate*24*60*60,milliseconds:daysInYearAccurate*24*60*60*1e3},quarters:{months:3,weeks:daysInYearAccurate/28,days:daysInYearAccurate/4,hours:daysInYearAccurate*24/4,minutes:daysInYearAccurate*24*60/4,seconds:daysInYearAccurate*24*60*60/4,milliseconds:daysInYearAccurate*24*60*60*1e3/4},months:{weeks:daysInMonthAccurate/7,days:daysInMonthAccurate,hours:daysInMonthAccurate*24,minutes:daysInMonthAccurate*24*60,seconds:daysInMonthAccurate*24*60*60,milliseconds:daysInMonthAccurate*24*60*60*1e3},...lowOrderMatrix},orderedUnits$1=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],reverseUnits=orderedUnits$1.slice(0).reverse();function clone$1(i,e,t=!1){const r={values:t?e.values:{...i.values,...e.values||{}},loc:i.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||i.conversionAccuracy,matrix:e.matrix||i.matrix};return new Duration(r)}function durationToMillis(i,e){let t=e.milliseconds??0;for(const r of reverseUnits.slice(1))e[r]&&(t+=e[r]*i[r].milliseconds);return t}function normalizeValues(i,e){const t=durationToMillis(i,e)<0?-1:1;orderedUnits$1.reduceRight((r,a)=>{if(isUndefined$1(e[a]))return r;if(r){const o=e[r]*t,u=i[a][r],c=Math.floor(o/u);e[a]+=c*t,e[r]-=c*u*t}return a},null),orderedUnits$1.reduce((r,a)=>{if(isUndefined$1(e[a]))return r;if(r){const o=e[r]%1;e[r]-=o,e[a]+=o*i[r][a]}return a},null)}function removeZeroes(i){const e={};for(const[t,r]of Object.entries(i))r!==0&&(e[t]=r);return e}class Duration{constructor(e){const t=e.conversionAccuracy==="longterm"||!1;let r=t?accurateMatrix:casualMatrix;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||Locale.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,t){return Duration.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(e==null||typeof e!="object")throw new InvalidArgumentError(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Duration({values:normalizeObject(e,Duration.normalizeUnit),loc:Locale.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(isNumber(e))return Duration.fromMillis(e);if(Duration.isDuration(e))return e;if(typeof e=="object")return Duration.fromObject(e);throw new InvalidArgumentError(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){const[r]=parseISODuration(e);return r?Duration.fromObject(r,t):Duration.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){const[r]=parseISOTimeOnly(e);return r?Duration.fromObject(r,t):Duration.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new InvalidArgumentError("need to specify a reason the Duration is invalid");const r=e instanceof Invalid?e:new Invalid(e,t);if(Settings.throwOnInvalid)throw new InvalidDurationError(r);return new Duration({invalid:r})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!t)throw new InvalidUnitError(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){const r={...t,floor:t.round!==!1&&t.floor!==!1};return this.isValid?Formatter.create(this.loc,r).formatDurationFromString(this,e):INVALID$2}toHuman(e={}){if(!this.isValid)return INVALID$2;const t=orderedUnits$1.map(r=>{const a=this.values[r];return isUndefined$1(a)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(a)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(t)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=roundTo(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const t=this.toMillis();return t<0||t>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},DateTime.fromMillis(t,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?durationToMillis(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=Duration.fromDurationLike(e),r={};for(const a of orderedUnits$1)(hasOwnProperty(t.values,a)||hasOwnProperty(this.values,a))&&(r[a]=t.get(a)+this.get(a));return clone$1(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const t=Duration.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const r of Object.keys(this.values))t[r]=asNumber(e(this.values[r],r));return clone$1(this,{values:t},!0)}get(e){return this[Duration.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const t={...this.values,...normalizeObject(e,Duration.normalizeUnit)};return clone$1(this,{values:t})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:r,matrix:a}={}){const u={loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:a,conversionAccuracy:r};return clone$1(this,u)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return normalizeValues(this.matrix,e),clone$1(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=removeZeroes(this.normalize().shiftToAll().toObject());return clone$1(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(u=>Duration.normalizeUnit(u));const t={},r={},a=this.toObject();let o;for(const u of orderedUnits$1)if(e.indexOf(u)>=0){o=u;let c=0;for(const d in r)c+=this.matrix[d][u]*r[d],r[d]=0;isNumber(a[u])&&(c+=a[u]);const h=Math.trunc(c);t[u]=h,r[u]=(c*1e3-h*1e3)/1e3}else isNumber(a[u])&&(r[u]=a[u]);for(const u in r)r[u]!==0&&(t[o]+=u===o?r[u]:r[u]/this.matrix[o][u]);return normalizeValues(this.matrix,t),clone$1(this,{values:t},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=this.values[t]===0?0:-this.values[t];return clone$1(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function t(r,a){return r===void 0||r===0?a===void 0||a===0:r===a}for(const r of orderedUnits$1)if(!t(this.values[r],e.values[r]))return!1;return!0}}const INVALID$1="Invalid Interval";function validateStartEnd(i,e){return!i||!i.isValid?Interval.invalid("missing or invalid start"):!e||!e.isValid?Interval.invalid("missing or invalid end"):e<i?Interval.invalid("end before start",`The end of an interval must be after its start, but you had start=${i.toISO()} and end=${e.toISO()}`):null}class Interval{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new InvalidArgumentError("need to specify a reason the Interval is invalid");const r=e instanceof Invalid?e:new Invalid(e,t);if(Settings.throwOnInvalid)throw new InvalidIntervalError(r);return new Interval({invalid:r})}static fromDateTimes(e,t){const r=friendlyDateTime(e),a=friendlyDateTime(t),o=validateStartEnd(r,a);return o??new Interval({start:r,end:a})}static after(e,t){const r=Duration.fromDurationLike(t),a=friendlyDateTime(e);return Interval.fromDateTimes(a,a.plus(r))}static before(e,t){const r=Duration.fromDurationLike(t),a=friendlyDateTime(e);return Interval.fromDateTimes(a.minus(r),a)}static fromISO(e,t){const[r,a]=(e||"").split("/",2);if(r&&a){let o,u;try{o=DateTime.fromISO(r,t),u=o.isValid}catch{u=!1}let c,h;try{c=DateTime.fromISO(a,t),h=c.isValid}catch{h=!1}if(u&&h)return Interval.fromDateTimes(o,c);if(u){const d=Duration.fromISO(a,t);if(d.isValid)return Interval.after(o,d)}else if(h){const d=Duration.fromISO(r,t);if(d.isValid)return Interval.before(c,d)}}return Interval.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",t){if(!this.isValid)return NaN;const r=this.start.startOf(e,t);let a;return t!=null&&t.useLocaleWeeks?a=this.end.reconfigure({locale:r.locale}):a=this.end,a=a.startOf(e,t),Math.floor(a.diff(r,e).get(e))+(a.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:t}={}){return this.isValid?Interval.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];const t=e.map(friendlyDateTime).filter(u=>this.contains(u)).sort((u,c)=>u.toMillis()-c.toMillis()),r=[];let{s:a}=this,o=0;for(;a<this.e;){const u=t[o]||this.e,c=+u>+this.e?this.e:u;r.push(Interval.fromDateTimes(a,c)),a=c,o+=1}return r}splitBy(e){const t=Duration.fromDurationLike(e);if(!this.isValid||!t.isValid||t.as("milliseconds")===0)return[];let{s:r}=this,a=1,o;const u=[];for(;r<this.e;){const c=this.start.plus(t.mapUnits(h=>h*a));o=+c>+this.e?this.e:c,u.push(Interval.fromDateTimes(r,o)),r=o,a+=1}return u}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return t>=r?null:Interval.fromDateTimes(t,r)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return Interval.fromDateTimes(t,r)}static merge(e){const[t,r]=e.sort((a,o)=>a.s-o.s).reduce(([a,o],u)=>o?o.overlaps(u)||o.abutsStart(u)?[a,o.union(u)]:[a.concat([o]),u]:[a,u],[[],null]);return r&&t.push(r),t}static xor(e){let t=null,r=0;const a=[],o=e.map(h=>[{time:h.s,type:"s"},{time:h.e,type:"e"}]),u=Array.prototype.concat(...o),c=u.sort((h,d)=>h.time-d.time);for(const h of c)r+=h.type==="s"?1:-1,r===1?t=h.time:(t&&+t!=+h.time&&a.push(Interval.fromDateTimes(t,h.time)),t=null);return Interval.merge(a)}difference(...e){return Interval.xor([this].concat(e)).map(t=>this.intersection(t)).filter(t=>t&&!t.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:INVALID$1}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=DATE_SHORT,t={}){return this.isValid?Formatter.create(this.s.loc.clone(t),e).formatInterval(this):INVALID$1}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:INVALID$1}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:INVALID$1}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:INVALID$1}toFormat(e,{separator:t="  "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:INVALID$1}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):Duration.invalid(this.invalidReason)}mapEndpoints(e){return Interval.fromDateTimes(e(this.s),e(this.e))}}class Info{static hasDST(e=Settings.defaultZone){const t=DateTime.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return IANAZone.isValidZone(e)}static normalizeZone(e){return normalizeZone(e,Settings.defaultZone)}static getStartOfWeek({locale:e=null,locObj:t=null}={}){return(t||Locale.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:t=null}={}){return(t||Locale.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:t=null}={}){return(t||Locale.create(e)).getWeekendDays().slice()}static months(e="long",{locale:t=null,numberingSystem:r=null,locObj:a=null,outputCalendar:o="gregory"}={}){return(a||Locale.create(t,r,o)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:r=null,locObj:a=null,outputCalendar:o="gregory"}={}){return(a||Locale.create(t,r,o)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:r=null,locObj:a=null}={}){return(a||Locale.create(t,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:r=null,locObj:a=null}={}){return(a||Locale.create(t,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Locale.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return Locale.create(t,null,"gregory").eras(e)}static features(){return{relative:hasRelative(),localeWeek:hasLocaleWeekInfo()}}}function dayDiff(i,e){const t=a=>a.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=t(e)-t(i);return Math.floor(Duration.fromMillis(r).as("days"))}function highOrderDiffs(i,e,t){const r=[["years",(h,d)=>d.year-h.year],["quarters",(h,d)=>d.quarter-h.quarter+(d.year-h.year)*4],["months",(h,d)=>d.month-h.month+(d.year-h.year)*12],["weeks",(h,d)=>{const p=dayDiff(h,d);return(p-p%7)/7}],["days",dayDiff]],a={},o=i;let u,c;for(const[h,d]of r)t.indexOf(h)>=0&&(u=h,a[h]=d(i,e),c=o.plus(a),c>e?(a[h]--,i=o.plus(a),i>e&&(c=i,a[h]--,i=o.plus(a))):i=c);return[i,a,c,u]}function diff(i,e,t,r){let[a,o,u,c]=highOrderDiffs(i,e,t);const h=e-a,d=t.filter(m=>["hours","minutes","seconds","milliseconds"].indexOf(m)>=0);d.length===0&&(u<e&&(u=a.plus({[c]:1})),u!==a&&(o[c]=(o[c]||0)+h/(u-a)));const p=Duration.fromObject(o,r);return d.length>0?Duration.fromMillis(h,r).shiftTo(...d).plus(p):p}const numberingSystems={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},numberingSystemsUTF16={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},hanidecChars=numberingSystems.hanidec.replace(/[\[|\]]/g,"").split("");function parseDigits(i){let e=parseInt(i,10);if(isNaN(e)){e="";for(let t=0;t<i.length;t++){const r=i.charCodeAt(t);if(i[t].search(numberingSystems.hanidec)!==-1)e+=hanidecChars.indexOf(i[t]);else for(const a in numberingSystemsUTF16){const[o,u]=numberingSystemsUTF16[a];r>=o&&r<=u&&(e+=r-o)}}return parseInt(e,10)}else return e}function digitRegex({numberingSystem:i},e=""){return new RegExp(`${numberingSystems[i||"latn"]}${e}`)}const MISSING_FTP="missing Intl.DateTimeFormat.formatToParts support";function intUnit(i,e=t=>t){return{regex:i,deser:([t])=>e(parseDigits(t))}}const NBSP="",spaceOrNBSP=`[ ${NBSP}]`,spaceOrNBSPRegExp=new RegExp(spaceOrNBSP,"g");function fixListRegex(i){return i.replace(/\./g,"\\.?").replace(spaceOrNBSPRegExp,spaceOrNBSP)}function stripInsensitivities(i){return i.replace(/\./g,"").replace(spaceOrNBSPRegExp," ").toLowerCase()}function oneOf(i,e){return i===null?null:{regex:RegExp(i.map(fixListRegex).join("|")),deser:([t])=>i.findIndex(r=>stripInsensitivities(t)===stripInsensitivities(r))+e}}function offset$2(i,e){return{regex:i,deser:([,t,r])=>signedOffset(t,r),groups:e}}function simple(i){return{regex:i,deser:([e])=>e}}function escapeToken(i){return i.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function unitForToken(i,e){const t=digitRegex(e),r=digitRegex(e,"{2}"),a=digitRegex(e,"{3}"),o=digitRegex(e,"{4}"),u=digitRegex(e,"{6}"),c=digitRegex(e,"{1,2}"),h=digitRegex(e,"{1,3}"),d=digitRegex(e,"{1,6}"),p=digitRegex(e,"{1,9}"),m=digitRegex(e,"{2,4}"),f=digitRegex(e,"{4,6}"),g=A=>({regex:RegExp(escapeToken(A.val)),deser:([R])=>R,literal:!0}),T=(A=>{if(i.literal)return g(A);switch(A.val){case"G":return oneOf(e.eras("short"),0);case"GG":return oneOf(e.eras("long"),0);case"y":return intUnit(d);case"yy":return intUnit(m,untruncateYear);case"yyyy":return intUnit(o);case"yyyyy":return intUnit(f);case"yyyyyy":return intUnit(u);case"M":return intUnit(c);case"MM":return intUnit(r);case"MMM":return oneOf(e.months("short",!0),1);case"MMMM":return oneOf(e.months("long",!0),1);case"L":return intUnit(c);case"LL":return intUnit(r);case"LLL":return oneOf(e.months("short",!1),1);case"LLLL":return oneOf(e.months("long",!1),1);case"d":return intUnit(c);case"dd":return intUnit(r);case"o":return intUnit(h);case"ooo":return intUnit(a);case"HH":return intUnit(r);case"H":return intUnit(c);case"hh":return intUnit(r);case"h":return intUnit(c);case"mm":return intUnit(r);case"m":return intUnit(c);case"q":return intUnit(c);case"qq":return intUnit(r);case"s":return intUnit(c);case"ss":return intUnit(r);case"S":return intUnit(h);case"SSS":return intUnit(a);case"u":return simple(p);case"uu":return simple(c);case"uuu":return intUnit(t);case"a":return oneOf(e.meridiems(),0);case"kkkk":return intUnit(o);case"kk":return intUnit(m,untruncateYear);case"W":return intUnit(c);case"WW":return intUnit(r);case"E":case"c":return intUnit(t);case"EEE":return oneOf(e.weekdays("short",!1),1);case"EEEE":return oneOf(e.weekdays("long",!1),1);case"ccc":return oneOf(e.weekdays("short",!0),1);case"cccc":return oneOf(e.weekdays("long",!0),1);case"Z":case"ZZ":return offset$2(new RegExp(`([+-]${c.source})(?::(${r.source}))?`),2);case"ZZZ":return offset$2(new RegExp(`([+-]${c.source})(${r.source})?`),2);case"z":return simple(/[a-z_+-/]{1,256}?/i);case" ":return simple(/[^\S\n\r]/);default:return g(A)}})(i)||{invalidReason:MISSING_FTP};return T.token=i,T}const partTypeStyleToTokenVal={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function tokenForPart(i,e,t){const{type:r,value:a}=i;if(r==="literal"){const h=/^\s+$/.test(a);return{literal:!h,val:h?" ":a}}const o=e[r];let u=r;r==="hour"&&(e.hour12!=null?u=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?u="hour12":u="hour24":u=t.hour12?"hour12":"hour24");let c=partTypeStyleToTokenVal[u];if(typeof c=="object"&&(c=c[o]),c)return{literal:!1,val:c}}function buildRegex(i){return[`^${i.map(t=>t.regex).reduce((t,r)=>`${t}(${r.source})`,"")}$`,i]}function match(i,e,t){const r=i.match(e);if(r){const a={};let o=1;for(const u in t)if(hasOwnProperty(t,u)){const c=t[u],h=c.groups?c.groups+1:1;!c.literal&&c.token&&(a[c.token.val[0]]=c.deser(r.slice(o,o+h))),o+=h}return[r,a]}else return[r,{}]}function dateTimeFromMatches(i){const e=o=>{switch(o){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let t=null,r;return isUndefined$1(i.z)||(t=IANAZone.create(i.z)),isUndefined$1(i.Z)||(t||(t=new FixedOffsetZone(i.Z)),r=i.Z),isUndefined$1(i.q)||(i.M=(i.q-1)*3+1),isUndefined$1(i.h)||(i.h<12&&i.a===1?i.h+=12:i.h===12&&i.a===0&&(i.h=0)),i.G===0&&i.y&&(i.y=-i.y),isUndefined$1(i.u)||(i.S=parseMillis(i.u)),[Object.keys(i).reduce((o,u)=>{const c=e(u);return c&&(o[c]=i[u]),o},{}),t,r]}let dummyDateTimeCache=null;function getDummyDateTime(){return dummyDateTimeCache||(dummyDateTimeCache=DateTime.fromMillis(1555555555555)),dummyDateTimeCache}function maybeExpandMacroToken(i,e){if(i.literal)return i;const t=Formatter.macroTokenToFormatOpts(i.val),r=formatOptsToTokens(t,e);return r==null||r.includes(void 0)?i:r}function expandMacroTokens(i,e){return Array.prototype.concat(...i.map(t=>maybeExpandMacroToken(t,e)))}function explainFromTokens(i,e,t){const r=expandMacroTokens(Formatter.parseFormat(t),i),a=r.map(u=>unitForToken(u,i)),o=a.find(u=>u.invalidReason);if(o)return{input:e,tokens:r,invalidReason:o.invalidReason};{const[u,c]=buildRegex(a),h=RegExp(u,"i"),[d,p]=match(e,h,c),[m,f,g]=p?dateTimeFromMatches(p):[null,null,void 0];if(hasOwnProperty(p,"a")&&hasOwnProperty(p,"H"))throw new ConflictingSpecificationError("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:h,rawMatches:d,matches:p,result:m,zone:f,specificOffset:g}}}function parseFromTokens(i,e,t){const{result:r,zone:a,specificOffset:o,invalidReason:u}=explainFromTokens(i,e,t);return[r,a,o,u]}function formatOptsToTokens(i,e){if(!i)return null;const r=Formatter.create(e,i).dtFormatter(getDummyDateTime()),a=r.formatToParts(),o=r.resolvedOptions();return a.map(u=>tokenForPart(u,i,o))}const INVALID="Invalid DateTime",MAX_DATE=864e13;function unsupportedZone(i){return new Invalid("unsupported zone",`the zone "${i.name}" is not supported`)}function possiblyCachedWeekData(i){return i.weekData===null&&(i.weekData=gregorianToWeek(i.c)),i.weekData}function possiblyCachedLocalWeekData(i){return i.localWeekData===null&&(i.localWeekData=gregorianToWeek(i.c,i.loc.getMinDaysInFirstWeek(),i.loc.getStartOfWeek())),i.localWeekData}function clone(i,e){const t={ts:i.ts,zone:i.zone,c:i.c,o:i.o,loc:i.loc,invalid:i.invalid};return new DateTime({...t,...e,old:t})}function fixOffset(i,e,t){let r=i-e*60*1e3;const a=t.offset(r);if(e===a)return[r,e];r-=(a-e)*60*1e3;const o=t.offset(r);return a===o?[r,a]:[i-Math.min(a,o)*60*1e3,Math.max(a,o)]}function tsToObj(i,e){i+=e*60*1e3;const t=new Date(i);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisecond:t.getUTCMilliseconds()}}function objToTS(i,e,t){return fixOffset(objToLocalTS(i),e,t)}function adjustTime(i,e){const t=i.o,r=i.c.year+Math.trunc(e.years),a=i.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,o={...i.c,year:r,month:a,day:Math.min(i.c.day,daysInMonth(r,a))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},u=Duration.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),c=objToLocalTS(o);let[h,d]=fixOffset(c,t,i.zone);return u!==0&&(h+=u,d=i.zone.offset(h)),{ts:h,o:d}}function parseDataToDateTime(i,e,t,r,a,o){const{setZone:u,zone:c}=t;if(i&&Object.keys(i).length!==0||e){const h=e||c,d=DateTime.fromObject(i,{...t,zone:h,specificOffset:o});return u?d:d.setZone(c)}else return DateTime.invalid(new Invalid("unparsable",`the input "${a}" can't be parsed as ${r}`))}function toTechFormat(i,e,t=!0){return i.isValid?Formatter.create(Locale.create("en-US"),{allowZ:t,forceSimple:!0}).formatDateTimeFromString(i,e):null}function toISODate(i,e){const t=i.c.year>9999||i.c.year<0;let r="";return t&&i.c.year>=0&&(r+="+"),r+=padStart(i.c.year,t?6:4),e?(r+="-",r+=padStart(i.c.month),r+="-",r+=padStart(i.c.day)):(r+=padStart(i.c.month),r+=padStart(i.c.day)),r}function toISOTime(i,e,t,r,a,o){let u=padStart(i.c.hour);return e?(u+=":",u+=padStart(i.c.minute),(i.c.millisecond!==0||i.c.second!==0||!t)&&(u+=":")):u+=padStart(i.c.minute),(i.c.millisecond!==0||i.c.second!==0||!t)&&(u+=padStart(i.c.second),(i.c.millisecond!==0||!r)&&(u+=".",u+=padStart(i.c.millisecond,3))),a&&(i.isOffsetFixed&&i.offset===0&&!o?u+="Z":i.o<0?(u+="-",u+=padStart(Math.trunc(-i.o/60)),u+=":",u+=padStart(Math.trunc(-i.o%60))):(u+="+",u+=padStart(Math.trunc(i.o/60)),u+=":",u+=padStart(Math.trunc(i.o%60)))),o&&(u+="["+i.zone.ianaName+"]"),u}const defaultUnitValues={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},defaultWeekUnitValues={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},defaultOrdinalUnitValues={ordinal:1,hour:0,minute:0,second:0,millisecond:0},orderedUnits=["year","month","day","hour","minute","second","millisecond"],orderedWeekUnits=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],orderedOrdinalUnits=["year","ordinal","hour","minute","second","millisecond"];function normalizeUnit(i){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[i.toLowerCase()];if(!e)throw new InvalidUnitError(i);return e}function normalizeUnitWithLocalWeeks(i){switch(i.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return normalizeUnit(i)}}function quickDT(i,e){const t=normalizeZone(e.zone,Settings.defaultZone),r=Locale.fromObject(e),a=Settings.now();let o,u;if(isUndefined$1(i.year))o=a;else{for(const d of orderedUnits)isUndefined$1(i[d])&&(i[d]=defaultUnitValues[d]);const c=hasInvalidGregorianData(i)||hasInvalidTimeData(i);if(c)return DateTime.invalid(c);const h=t.offset(a);[o,u]=objToTS(i,h,t)}return new DateTime({ts:o,zone:t,loc:r,o:u})}function diffRelative(i,e,t){const r=isUndefined$1(t.round)?!0:t.round,a=(u,c)=>(u=roundTo(u,r||t.calendary?0:2,!0),e.loc.clone(t).relFormatter(t).format(u,c)),o=u=>t.calendary?e.hasSame(i,u)?0:e.startOf(u).diff(i.startOf(u),u).get(u):e.diff(i,u).get(u);if(t.unit)return a(o(t.unit),t.unit);for(const u of t.units){const c=o(u);if(Math.abs(c)>=1)return a(c,u)}return a(i>e?-0:0,t.units[t.units.length-1])}function lastOpts(i){let e={},t;return i.length>0&&typeof i[i.length-1]=="object"?(e=i[i.length-1],t=Array.from(i).slice(0,i.length-1)):t=Array.from(i),[e,t]}class DateTime{constructor(e){const t=e.zone||Settings.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new Invalid("invalid input"):null)||(t.isValid?null:unsupportedZone(t));this.ts=isUndefined$1(e.ts)?Settings.now():e.ts;let a=null,o=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[a,o]=[e.old.c,e.old.o];else{const c=t.offset(this.ts);a=tsToObj(this.ts,c),r=Number.isNaN(a.year)?new Invalid("invalid input"):null,a=r?null:a,o=r?null:c}this._zone=t,this.loc=e.loc||Locale.create(),this.invalid=r,this.weekData=null,this.localWeekData=null,this.c=a,this.o=o,this.isLuxonDateTime=!0}static now(){return new DateTime({})}static local(){const[e,t]=lastOpts(arguments),[r,a,o,u,c,h,d]=t;return quickDT({year:r,month:a,day:o,hour:u,minute:c,second:h,millisecond:d},e)}static utc(){const[e,t]=lastOpts(arguments),[r,a,o,u,c,h,d]=t;return e.zone=FixedOffsetZone.utcInstance,quickDT({year:r,month:a,day:o,hour:u,minute:c,second:h,millisecond:d},e)}static fromJSDate(e,t={}){const r=isDate(e)?e.valueOf():NaN;if(Number.isNaN(r))return DateTime.invalid("invalid input");const a=normalizeZone(t.zone,Settings.defaultZone);return a.isValid?new DateTime({ts:r,zone:a,loc:Locale.fromObject(t)}):DateTime.invalid(unsupportedZone(a))}static fromMillis(e,t={}){if(isNumber(e))return e<-MAX_DATE||e>MAX_DATE?DateTime.invalid("Timestamp out of range"):new DateTime({ts:e,zone:normalizeZone(t.zone,Settings.defaultZone),loc:Locale.fromObject(t)});throw new InvalidArgumentError(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(isNumber(e))return new DateTime({ts:e*1e3,zone:normalizeZone(t.zone,Settings.defaultZone),loc:Locale.fromObject(t)});throw new InvalidArgumentError("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};const r=normalizeZone(t.zone,Settings.defaultZone);if(!r.isValid)return DateTime.invalid(unsupportedZone(r));const a=Locale.fromObject(t),o=normalizeObject(e,normalizeUnitWithLocalWeeks),{minDaysInFirstWeek:u,startOfWeek:c}=usesLocalWeekValues(o,a),h=Settings.now(),d=isUndefined$1(t.specificOffset)?r.offset(h):t.specificOffset,p=!isUndefined$1(o.ordinal),m=!isUndefined$1(o.year),f=!isUndefined$1(o.month)||!isUndefined$1(o.day),g=m||f,y=o.weekYear||o.weekNumber;if((g||p)&&y)throw new ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(f&&p)throw new ConflictingSpecificationError("Can't mix ordinal dates with month/day");const T=y||o.weekday&&!g;let A,R,C=tsToObj(h,d);T?(A=orderedWeekUnits,R=defaultWeekUnitValues,C=gregorianToWeek(C,u,c)):p?(A=orderedOrdinalUnits,R=defaultOrdinalUnitValues,C=gregorianToOrdinal(C)):(A=orderedUnits,R=defaultUnitValues);let N=!1;for(const w of A){const F=o[w];isUndefined$1(F)?N?o[w]=R[w]:o[w]=C[w]:N=!0}const S=T?hasInvalidWeekData(o,u,c):p?hasInvalidOrdinalData(o):hasInvalidGregorianData(o),_=S||hasInvalidTimeData(o);if(_)return DateTime.invalid(_);const O=T?weekToGregorian(o,u,c):p?ordinalToGregorian(o):o,[I,L]=objToTS(O,d,r),b=new DateTime({ts:I,zone:r,o:L,loc:a});return o.weekday&&g&&e.weekday!==b.weekday?DateTime.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${b.toISO()}`):b}static fromISO(e,t={}){const[r,a]=parseISODate(e);return parseDataToDateTime(r,a,t,"ISO 8601",e)}static fromRFC2822(e,t={}){const[r,a]=parseRFC2822Date(e);return parseDataToDateTime(r,a,t,"RFC 2822",e)}static fromHTTP(e,t={}){const[r,a]=parseHTTPDate(e);return parseDataToDateTime(r,a,t,"HTTP",t)}static fromFormat(e,t,r={}){if(isUndefined$1(e)||isUndefined$1(t))throw new InvalidArgumentError("fromFormat requires an input string and a format");const{locale:a=null,numberingSystem:o=null}=r,u=Locale.fromOpts({locale:a,numberingSystem:o,defaultToEN:!0}),[c,h,d,p]=parseFromTokens(u,e,t);return p?DateTime.invalid(p):parseDataToDateTime(c,h,r,`format ${t}`,e,d)}static fromString(e,t,r={}){return DateTime.fromFormat(e,t,r)}static fromSQL(e,t={}){const[r,a]=parseSQL(e);return parseDataToDateTime(r,a,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new InvalidArgumentError("need to specify a reason the DateTime is invalid");const r=e instanceof Invalid?e:new Invalid(e,t);if(Settings.throwOnInvalid)throw new InvalidDateTimeError(r);return new DateTime({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){const r=formatOptsToTokens(e,Locale.fromObject(t));return r?r.map(a=>a?a.val:null).join(""):null}static expandFormat(e,t={}){return expandMacroTokens(Formatter.parseFormat(e),Locale.fromObject(t)).map(a=>a.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?possiblyCachedWeekData(this).weekYear:NaN}get weekNumber(){return this.isValid?possiblyCachedWeekData(this).weekNumber:NaN}get weekday(){return this.isValid?possiblyCachedWeekData(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?possiblyCachedLocalWeekData(this).weekday:NaN}get localWeekNumber(){return this.isValid?possiblyCachedLocalWeekData(this).weekNumber:NaN}get localWeekYear(){return this.isValid?possiblyCachedLocalWeekData(this).weekYear:NaN}get ordinal(){return this.isValid?gregorianToOrdinal(this.c).ordinal:NaN}get monthShort(){return this.isValid?Info.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?Info.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Info.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?Info.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,t=6e4,r=objToLocalTS(this.c),a=this.zone.offset(r-e),o=this.zone.offset(r+e),u=this.zone.offset(r-a*t),c=this.zone.offset(r-o*t);if(u===c)return[this];const h=r-u*t,d=r-c*t,p=tsToObj(h,u),m=tsToObj(d,c);return p.hour===m.hour&&p.minute===m.minute&&p.second===m.second&&p.millisecond===m.millisecond?[clone(this,{ts:h}),clone(this,{ts:d})]:[this]}get isInLeapYear(){return isLeapYear(this.year)}get daysInMonth(){return daysInMonth(this.year,this.month)}get daysInYear(){return this.isValid?daysInYear(this.year):NaN}get weeksInWeekYear(){return this.isValid?weeksInWeekYear(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?weeksInWeekYear(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:t,numberingSystem:r,calendar:a}=Formatter.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:r,outputCalendar:a}}toUTC(e=0,t={}){return this.setZone(FixedOffsetZone.instance(e),t)}toLocal(){return this.setZone(Settings.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:r=!1}={}){if(e=normalizeZone(e,Settings.defaultZone),e.equals(this.zone))return this;if(e.isValid){let a=this.ts;if(t||r){const o=e.offset(this.ts),u=this.toObject();[a]=objToTS(u,o,e)}return clone(this,{ts:a,zone:e})}else return DateTime.invalid(unsupportedZone(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:r}={}){const a=this.loc.clone({locale:e,numberingSystem:t,outputCalendar:r});return clone(this,{loc:a})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=normalizeObject(e,normalizeUnitWithLocalWeeks),{minDaysInFirstWeek:r,startOfWeek:a}=usesLocalWeekValues(t,this.loc),o=!isUndefined$1(t.weekYear)||!isUndefined$1(t.weekNumber)||!isUndefined$1(t.weekday),u=!isUndefined$1(t.ordinal),c=!isUndefined$1(t.year),h=!isUndefined$1(t.month)||!isUndefined$1(t.day),d=c||h,p=t.weekYear||t.weekNumber;if((d||u)&&p)throw new ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(h&&u)throw new ConflictingSpecificationError("Can't mix ordinal dates with month/day");let m;o?m=weekToGregorian({...gregorianToWeek(this.c,r,a),...t},r,a):isUndefined$1(t.ordinal)?(m={...this.toObject(),...t},isUndefined$1(t.day)&&(m.day=Math.min(daysInMonth(m.year,m.month),m.day))):m=ordinalToGregorian({...gregorianToOrdinal(this.c),...t});const[f,g]=objToTS(m,this.o,this.zone);return clone(this,{ts:f,o:g})}plus(e){if(!this.isValid)return this;const t=Duration.fromDurationLike(e);return clone(this,adjustTime(this,t))}minus(e){if(!this.isValid)return this;const t=Duration.fromDurationLike(e).negate();return clone(this,adjustTime(this,t))}startOf(e,{useLocaleWeeks:t=!1}={}){if(!this.isValid)return this;const r={},a=Duration.normalizeUnit(e);switch(a){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(a==="weeks")if(t){const o=this.loc.getStartOfWeek(),{weekday:u}=this;u<o&&(r.weekNumber=this.weekNumber-1),r.weekday=o}else r.weekday=1;if(a==="quarters"){const o=Math.ceil(this.month/3);r.month=(o-1)*3+1}return this.set(r)}endOf(e,t){return this.isValid?this.plus({[e]:1}).startOf(e,t).minus(1):this}toFormat(e,t={}){return this.isValid?Formatter.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):INVALID}toLocaleString(e=DATE_SHORT,t={}){return this.isValid?Formatter.create(this.loc.clone(t),e).formatDateTime(this):INVALID}toLocaleParts(e={}){return this.isValid?Formatter.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:r=!1,includeOffset:a=!0,extendedZone:o=!1}={}){if(!this.isValid)return null;const u=e==="extended";let c=toISODate(this,u);return c+="T",c+=toISOTime(this,u,t,r,a,o),c}toISODate({format:e="extended"}={}){return this.isValid?toISODate(this,e==="extended"):null}toISOWeekDate(){return toTechFormat(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:r=!0,includePrefix:a=!1,extendedZone:o=!1,format:u="extended"}={}){return this.isValid?(a?"T":"")+toISOTime(this,u==="extended",t,e,r,o):null}toRFC2822(){return toTechFormat(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return toTechFormat(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?toISODate(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:r=!0}={}){let a="HH:mm:ss.SSS";return(t||e)&&(r&&(a+=" "),t?a+="z":e&&(a+="ZZ")),toTechFormat(this,a,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():INVALID}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",r={}){if(!this.isValid||!e.isValid)return Duration.invalid("created by diffing an invalid DateTime");const a={locale:this.locale,numberingSystem:this.numberingSystem,...r},o=maybeArray(t).map(Duration.normalizeUnit),u=e.valueOf()>this.valueOf(),c=u?this:e,h=u?e:this,d=diff(c,h,o,a);return u?d.negate():d}diffNow(e="milliseconds",t={}){return this.diff(DateTime.now(),e,t)}until(e){return this.isValid?Interval.fromDateTimes(this,e):this}hasSame(e,t,r){if(!this.isValid)return!1;const a=e.valueOf(),o=this.setZone(e.zone,{keepLocalTime:!0});return o.startOf(t,r)<=a&&a<=o.endOf(t,r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const t=e.base||DateTime.fromObject({},{zone:this.zone}),r=e.padding?this<t?-e.padding:e.padding:0;let a=["years","months","days","hours","minutes","seconds"],o=e.unit;return Array.isArray(e.unit)&&(a=e.unit,o=void 0),diffRelative(t,this.plus(r),{...e,numeric:"always",units:a,unit:o})}toRelativeCalendar(e={}){return this.isValid?diffRelative(e.base||DateTime.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(DateTime.isDateTime))throw new InvalidArgumentError("min requires all arguments be DateTimes");return bestBy(e,t=>t.valueOf(),Math.min)}static max(...e){if(!e.every(DateTime.isDateTime))throw new InvalidArgumentError("max requires all arguments be DateTimes");return bestBy(e,t=>t.valueOf(),Math.max)}static fromFormatExplain(e,t,r={}){const{locale:a=null,numberingSystem:o=null}=r,u=Locale.fromOpts({locale:a,numberingSystem:o,defaultToEN:!0});return explainFromTokens(u,e,t)}static fromStringExplain(e,t,r={}){return DateTime.fromFormatExplain(e,t,r)}static get DATE_SHORT(){return DATE_SHORT}static get DATE_MED(){return DATE_MED}static get DATE_MED_WITH_WEEKDAY(){return DATE_MED_WITH_WEEKDAY}static get DATE_FULL(){return DATE_FULL}static get DATE_HUGE(){return DATE_HUGE}static get TIME_SIMPLE(){return TIME_SIMPLE}static get TIME_WITH_SECONDS(){return TIME_WITH_SECONDS}static get TIME_WITH_SHORT_OFFSET(){return TIME_WITH_SHORT_OFFSET}static get TIME_WITH_LONG_OFFSET(){return TIME_WITH_LONG_OFFSET}static get TIME_24_SIMPLE(){return TIME_24_SIMPLE}static get TIME_24_WITH_SECONDS(){return TIME_24_WITH_SECONDS}static get TIME_24_WITH_SHORT_OFFSET(){return TIME_24_WITH_SHORT_OFFSET}static get TIME_24_WITH_LONG_OFFSET(){return TIME_24_WITH_LONG_OFFSET}static get DATETIME_SHORT(){return DATETIME_SHORT}static get DATETIME_SHORT_WITH_SECONDS(){return DATETIME_SHORT_WITH_SECONDS}static get DATETIME_MED(){return DATETIME_MED}static get DATETIME_MED_WITH_SECONDS(){return DATETIME_MED_WITH_SECONDS}static get DATETIME_MED_WITH_WEEKDAY(){return DATETIME_MED_WITH_WEEKDAY}static get DATETIME_FULL(){return DATETIME_FULL}static get DATETIME_FULL_WITH_SECONDS(){return DATETIME_FULL_WITH_SECONDS}static get DATETIME_HUGE(){return DATETIME_HUGE}static get DATETIME_HUGE_WITH_SECONDS(){return DATETIME_HUGE_WITH_SECONDS}}function friendlyDateTime(i){if(DateTime.isDateTime(i))return i;if(i&&i.valueOf&&isNumber(i.valueOf()))return DateTime.fromJSDate(i);if(i&&typeof i=="object")return DateTime.fromObject(i);throw new InvalidArgumentError(`Unknown datetime argument: ${i}, of type ${typeof i}`)}var top="top",bottom="bottom",right="right",left="left",auto="auto",basePlacements=[top,bottom,right,left],start="start",end="end",clippingParents="clippingParents",viewport="viewport",popper="popper",reference="reference",variationPlacements=basePlacements.reduce(function(i,e){return i.concat([e+"-"+start,e+"-"+end])},[]),placements=[].concat(basePlacements,[auto]).reduce(function(i,e){return i.concat([e,e+"-"+start,e+"-"+end])},[]),beforeRead="beforeRead",read="read",afterRead="afterRead",beforeMain="beforeMain",main="main",afterMain="afterMain",beforeWrite="beforeWrite",write="write",afterWrite="afterWrite",modifierPhases=[beforeRead,read,afterRead,beforeMain,main,afterMain,beforeWrite,write,afterWrite];function getNodeName(i){return i?(i.nodeName||"").toLowerCase():null}function getWindow(i){if(i==null)return window;if(i.toString()!=="[object Window]"){var e=i.ownerDocument;return e&&e.defaultView||window}return i}function isElement$1(i){var e=getWindow(i).Element;return i instanceof e||i instanceof Element}function isHTMLElement(i){var e=getWindow(i).HTMLElement;return i instanceof e||i instanceof HTMLElement}function isShadowRoot(i){if(typeof ShadowRoot>"u")return!1;var e=getWindow(i).ShadowRoot;return i instanceof e||i instanceof ShadowRoot}function applyStyles(i){var e=i.state;Object.keys(e.elements).forEach(function(t){var r=e.styles[t]||{},a=e.attributes[t]||{},o=e.elements[t];!isHTMLElement(o)||!getNodeName(o)||(Object.assign(o.style,r),Object.keys(a).forEach(function(u){var c=a[u];c===!1?o.removeAttribute(u):o.setAttribute(u,c===!0?"":c)}))})}function effect$2(i){var e=i.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(r){var a=e.elements[r],o=e.attributes[r]||{},u=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:t[r]),c=u.reduce(function(h,d){return h[d]="",h},{});!isHTMLElement(a)||!getNodeName(a)||(Object.assign(a.style,c),Object.keys(o).forEach(function(h){a.removeAttribute(h)}))})}}const applyStyles$1={name:"applyStyles",enabled:!0,phase:"write",fn:applyStyles,effect:effect$2,requires:["computeStyles"]};function getBasePlacement(i){return i.split("-")[0]}var max=Math.max,min=Math.min,round=Math.round;function getUAString(){var i=navigator.userAgentData;return i!=null&&i.brands&&Array.isArray(i.brands)?i.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function isLayoutViewport(){return!/^((?!chrome|android).)*safari/i.test(getUAString())}function getBoundingClientRect(i,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var r=i.getBoundingClientRect(),a=1,o=1;e&&isHTMLElement(i)&&(a=i.offsetWidth>0&&round(r.width)/i.offsetWidth||1,o=i.offsetHeight>0&&round(r.height)/i.offsetHeight||1);var u=isElement$1(i)?getWindow(i):window,c=u.visualViewport,h=!isLayoutViewport()&&t,d=(r.left+(h&&c?c.offsetLeft:0))/a,p=(r.top+(h&&c?c.offsetTop:0))/o,m=r.width/a,f=r.height/o;return{width:m,height:f,top:p,right:d+m,bottom:p+f,left:d,x:d,y:p}}function getLayoutRect(i){var e=getBoundingClientRect(i),t=i.offsetWidth,r=i.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:i.offsetLeft,y:i.offsetTop,width:t,height:r}}function contains$1(i,e){var t=e.getRootNode&&e.getRootNode();if(i.contains(e))return!0;if(t&&isShadowRoot(t)){var r=e;do{if(r&&i.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function getComputedStyle$1(i){return getWindow(i).getComputedStyle(i)}function isTableElement(i){return["table","td","th"].indexOf(getNodeName(i))>=0}function getDocumentElement(i){return((isElement$1(i)?i.ownerDocument:i.document)||window.document).documentElement}function getParentNode(i){return getNodeName(i)==="html"?i:i.assignedSlot||i.parentNode||(isShadowRoot(i)?i.host:null)||getDocumentElement(i)}function getTrueOffsetParent(i){return!isHTMLElement(i)||getComputedStyle$1(i).position==="fixed"?null:i.offsetParent}function getContainingBlock(i){var e=/firefox/i.test(getUAString()),t=/Trident/i.test(getUAString());if(t&&isHTMLElement(i)){var r=getComputedStyle$1(i);if(r.position==="fixed")return null}var a=getParentNode(i);for(isShadowRoot(a)&&(a=a.host);isHTMLElement(a)&&["html","body"].indexOf(getNodeName(a))<0;){var o=getComputedStyle$1(a);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||e&&o.willChange==="filter"||e&&o.filter&&o.filter!=="none")return a;a=a.parentNode}return null}function getOffsetParent(i){for(var e=getWindow(i),t=getTrueOffsetParent(i);t&&isTableElement(t)&&getComputedStyle$1(t).position==="static";)t=getTrueOffsetParent(t);return t&&(getNodeName(t)==="html"||getNodeName(t)==="body"&&getComputedStyle$1(t).position==="static")?e:t||getContainingBlock(i)||e}function getMainAxisFromPlacement(i){return["top","bottom"].indexOf(i)>=0?"x":"y"}function within(i,e,t){return max(i,min(e,t))}function withinMaxClamp(i,e,t){var r=within(i,e,t);return r>t?t:r}function getFreshSideObject(){return{top:0,right:0,bottom:0,left:0}}function mergePaddingObject(i){return Object.assign({},getFreshSideObject(),i)}function expandToHashMap(i,e){return e.reduce(function(t,r){return t[r]=i,t},{})}var toPaddingObject=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,mergePaddingObject(typeof e!="number"?e:expandToHashMap(e,basePlacements))};function arrow(i){var e,t=i.state,r=i.name,a=i.options,o=t.elements.arrow,u=t.modifiersData.popperOffsets,c=getBasePlacement(t.placement),h=getMainAxisFromPlacement(c),d=[left,right].indexOf(c)>=0,p=d?"height":"width";if(!(!o||!u)){var m=toPaddingObject(a.padding,t),f=getLayoutRect(o),g=h==="y"?top:left,y=h==="y"?bottom:right,T=t.rects.reference[p]+t.rects.reference[h]-u[h]-t.rects.popper[p],A=u[h]-t.rects.reference[h],R=getOffsetParent(o),C=R?h==="y"?R.clientHeight||0:R.clientWidth||0:0,N=T/2-A/2,S=m[g],_=C-f[p]-m[y],O=C/2-f[p]/2+N,I=within(S,O,_),L=h;t.modifiersData[r]=(e={},e[L]=I,e.centerOffset=I-O,e)}}function effect$1(i){var e=i.state,t=i.options,r=t.element,a=r===void 0?"[data-popper-arrow]":r;a!=null&&(typeof a=="string"&&(a=e.elements.popper.querySelector(a),!a)||contains$1(e.elements.popper,a)&&(e.elements.arrow=a))}const arrow$1={name:"arrow",enabled:!0,phase:"main",fn:arrow,effect:effect$1,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function getVariation(i){return i.split("-")[1]}var unsetSides={top:"auto",right:"auto",bottom:"auto",left:"auto"};function roundOffsetsByDPR(i,e){var t=i.x,r=i.y,a=e.devicePixelRatio||1;return{x:round(t*a)/a||0,y:round(r*a)/a||0}}function mapToStyles(i){var e,t=i.popper,r=i.popperRect,a=i.placement,o=i.variation,u=i.offsets,c=i.position,h=i.gpuAcceleration,d=i.adaptive,p=i.roundOffsets,m=i.isFixed,f=u.x,g=f===void 0?0:f,y=u.y,T=y===void 0?0:y,A=typeof p=="function"?p({x:g,y:T}):{x:g,y:T};g=A.x,T=A.y;var R=u.hasOwnProperty("x"),C=u.hasOwnProperty("y"),N=left,S=top,_=window;if(d){var O=getOffsetParent(t),I="clientHeight",L="clientWidth";if(O===getWindow(t)&&(O=getDocumentElement(t),getComputedStyle$1(O).position!=="static"&&c==="absolute"&&(I="scrollHeight",L="scrollWidth")),O=O,a===top||(a===left||a===right)&&o===end){S=bottom;var b=m&&O===_&&_.visualViewport?_.visualViewport.height:O[I];T-=b-r.height,T*=h?1:-1}if(a===left||(a===top||a===bottom)&&o===end){N=right;var w=m&&O===_&&_.visualViewport?_.visualViewport.width:O[L];g-=w-r.width,g*=h?1:-1}}var F=Object.assign({position:c},d&&unsetSides),P=p===!0?roundOffsetsByDPR({x:g,y:T},getWindow(t)):{x:g,y:T};if(g=P.x,T=P.y,h){var x;return Object.assign({},F,(x={},x[S]=C?"0":"",x[N]=R?"0":"",x.transform=(_.devicePixelRatio||1)<=1?"translate("+g+"px, "+T+"px)":"translate3d("+g+"px, "+T+"px, 0)",x))}return Object.assign({},F,(e={},e[S]=C?T+"px":"",e[N]=R?g+"px":"",e.transform="",e))}function computeStyles(i){var e=i.state,t=i.options,r=t.gpuAcceleration,a=r===void 0?!0:r,o=t.adaptive,u=o===void 0?!0:o,c=t.roundOffsets,h=c===void 0?!0:c,d={placement:getBasePlacement(e.placement),variation:getVariation(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:a,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,mapToStyles(Object.assign({},d,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:u,roundOffsets:h})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,mapToStyles(Object.assign({},d,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:h})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const computeStyles$1={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:computeStyles,data:{}};var passive={passive:!0};function effect(i){var e=i.state,t=i.instance,r=i.options,a=r.scroll,o=a===void 0?!0:a,u=r.resize,c=u===void 0?!0:u,h=getWindow(e.elements.popper),d=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&d.forEach(function(p){p.addEventListener("scroll",t.update,passive)}),c&&h.addEventListener("resize",t.update,passive),function(){o&&d.forEach(function(p){p.removeEventListener("scroll",t.update,passive)}),c&&h.removeEventListener("resize",t.update,passive)}}const eventListeners={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect,data:{}};var hash$1={left:"right",right:"left",bottom:"top",top:"bottom"};function getOppositePlacement(i){return i.replace(/left|right|bottom|top/g,function(e){return hash$1[e]})}var hash={start:"end",end:"start"};function getOppositeVariationPlacement(i){return i.replace(/start|end/g,function(e){return hash[e]})}function getWindowScroll(i){var e=getWindow(i),t=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:t,scrollTop:r}}function getWindowScrollBarX(i){return getBoundingClientRect(getDocumentElement(i)).left+getWindowScroll(i).scrollLeft}function getViewportRect(i,e){var t=getWindow(i),r=getDocumentElement(i),a=t.visualViewport,o=r.clientWidth,u=r.clientHeight,c=0,h=0;if(a){o=a.width,u=a.height;var d=isLayoutViewport();(d||!d&&e==="fixed")&&(c=a.offsetLeft,h=a.offsetTop)}return{width:o,height:u,x:c+getWindowScrollBarX(i),y:h}}function getDocumentRect(i){var e,t=getDocumentElement(i),r=getWindowScroll(i),a=(e=i.ownerDocument)==null?void 0:e.body,o=max(t.scrollWidth,t.clientWidth,a?a.scrollWidth:0,a?a.clientWidth:0),u=max(t.scrollHeight,t.clientHeight,a?a.scrollHeight:0,a?a.clientHeight:0),c=-r.scrollLeft+getWindowScrollBarX(i),h=-r.scrollTop;return getComputedStyle$1(a||t).direction==="rtl"&&(c+=max(t.clientWidth,a?a.clientWidth:0)-o),{width:o,height:u,x:c,y:h}}function isScrollParent(i){var e=getComputedStyle$1(i),t=e.overflow,r=e.overflowX,a=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+a+r)}function getScrollParent(i){return["html","body","#document"].indexOf(getNodeName(i))>=0?i.ownerDocument.body:isHTMLElement(i)&&isScrollParent(i)?i:getScrollParent(getParentNode(i))}function listScrollParents(i,e){var t;e===void 0&&(e=[]);var r=getScrollParent(i),a=r===((t=i.ownerDocument)==null?void 0:t.body),o=getWindow(r),u=a?[o].concat(o.visualViewport||[],isScrollParent(r)?r:[]):r,c=e.concat(u);return a?c:c.concat(listScrollParents(getParentNode(u)))}function rectToClientRect(i){return Object.assign({},i,{left:i.x,top:i.y,right:i.x+i.width,bottom:i.y+i.height})}function getInnerBoundingClientRect(i,e){var t=getBoundingClientRect(i,!1,e==="fixed");return t.top=t.top+i.clientTop,t.left=t.left+i.clientLeft,t.bottom=t.top+i.clientHeight,t.right=t.left+i.clientWidth,t.width=i.clientWidth,t.height=i.clientHeight,t.x=t.left,t.y=t.top,t}function getClientRectFromMixedType(i,e,t){return e===viewport?rectToClientRect(getViewportRect(i,t)):isElement$1(e)?getInnerBoundingClientRect(e,t):rectToClientRect(getDocumentRect(getDocumentElement(i)))}function getClippingParents(i){var e=listScrollParents(getParentNode(i)),t=["absolute","fixed"].indexOf(getComputedStyle$1(i).position)>=0,r=t&&isHTMLElement(i)?getOffsetParent(i):i;return isElement$1(r)?e.filter(function(a){return isElement$1(a)&&contains$1(a,r)&&getNodeName(a)!=="body"}):[]}function getClippingRect(i,e,t,r){var a=e==="clippingParents"?getClippingParents(i):[].concat(e),o=[].concat(a,[t]),u=o[0],c=o.reduce(function(h,d){var p=getClientRectFromMixedType(i,d,r);return h.top=max(p.top,h.top),h.right=min(p.right,h.right),h.bottom=min(p.bottom,h.bottom),h.left=max(p.left,h.left),h},getClientRectFromMixedType(i,u,r));return c.width=c.right-c.left,c.height=c.bottom-c.top,c.x=c.left,c.y=c.top,c}function computeOffsets(i){var e=i.reference,t=i.element,r=i.placement,a=r?getBasePlacement(r):null,o=r?getVariation(r):null,u=e.x+e.width/2-t.width/2,c=e.y+e.height/2-t.height/2,h;switch(a){case top:h={x:u,y:e.y-t.height};break;case bottom:h={x:u,y:e.y+e.height};break;case right:h={x:e.x+e.width,y:c};break;case left:h={x:e.x-t.width,y:c};break;default:h={x:e.x,y:e.y}}var d=a?getMainAxisFromPlacement(a):null;if(d!=null){var p=d==="y"?"height":"width";switch(o){case start:h[d]=h[d]-(e[p]/2-t[p]/2);break;case end:h[d]=h[d]+(e[p]/2-t[p]/2);break}}return h}function detectOverflow(i,e){e===void 0&&(e={});var t=e,r=t.placement,a=r===void 0?i.placement:r,o=t.strategy,u=o===void 0?i.strategy:o,c=t.boundary,h=c===void 0?clippingParents:c,d=t.rootBoundary,p=d===void 0?viewport:d,m=t.elementContext,f=m===void 0?popper:m,g=t.altBoundary,y=g===void 0?!1:g,T=t.padding,A=T===void 0?0:T,R=mergePaddingObject(typeof A!="number"?A:expandToHashMap(A,basePlacements)),C=f===popper?reference:popper,N=i.rects.popper,S=i.elements[y?C:f],_=getClippingRect(isElement$1(S)?S:S.contextElement||getDocumentElement(i.elements.popper),h,p,u),O=getBoundingClientRect(i.elements.reference),I=computeOffsets({reference:O,element:N,strategy:"absolute",placement:a}),L=rectToClientRect(Object.assign({},N,I)),b=f===popper?L:O,w={top:_.top-b.top+R.top,bottom:b.bottom-_.bottom+R.bottom,left:_.left-b.left+R.left,right:b.right-_.right+R.right},F=i.modifiersData.offset;if(f===popper&&F){var P=F[a];Object.keys(w).forEach(function(x){var B=[right,bottom].indexOf(x)>=0?1:-1,k=[top,bottom].indexOf(x)>=0?"y":"x";w[x]+=P[k]*B})}return w}function computeAutoPlacement(i,e){e===void 0&&(e={});var t=e,r=t.placement,a=t.boundary,o=t.rootBoundary,u=t.padding,c=t.flipVariations,h=t.allowedAutoPlacements,d=h===void 0?placements:h,p=getVariation(r),m=p?c?variationPlacements:variationPlacements.filter(function(y){return getVariation(y)===p}):basePlacements,f=m.filter(function(y){return d.indexOf(y)>=0});f.length===0&&(f=m);var g=f.reduce(function(y,T){return y[T]=detectOverflow(i,{placement:T,boundary:a,rootBoundary:o,padding:u})[getBasePlacement(T)],y},{});return Object.keys(g).sort(function(y,T){return g[y]-g[T]})}function getExpandedFallbackPlacements(i){if(getBasePlacement(i)===auto)return[];var e=getOppositePlacement(i);return[getOppositeVariationPlacement(i),e,getOppositeVariationPlacement(e)]}function flip(i){var e=i.state,t=i.options,r=i.name;if(!e.modifiersData[r]._skip){for(var a=t.mainAxis,o=a===void 0?!0:a,u=t.altAxis,c=u===void 0?!0:u,h=t.fallbackPlacements,d=t.padding,p=t.boundary,m=t.rootBoundary,f=t.altBoundary,g=t.flipVariations,y=g===void 0?!0:g,T=t.allowedAutoPlacements,A=e.options.placement,R=getBasePlacement(A),C=R===A,N=h||(C||!y?[getOppositePlacement(A)]:getExpandedFallbackPlacements(A)),S=[A].concat(N).reduce(function(W,K){return W.concat(getBasePlacement(K)===auto?computeAutoPlacement(e,{placement:K,boundary:p,rootBoundary:m,padding:d,flipVariations:y,allowedAutoPlacements:T}):K)},[]),_=e.rects.reference,O=e.rects.popper,I=new Map,L=!0,b=S[0],w=0;w<S.length;w++){var F=S[w],P=getBasePlacement(F),x=getVariation(F)===start,B=[top,bottom].indexOf(P)>=0,k=B?"width":"height",V=detectOverflow(e,{placement:F,boundary:p,rootBoundary:m,altBoundary:f,padding:d}),H=B?x?right:left:x?bottom:top;_[k]>O[k]&&(H=getOppositePlacement(H));var Y=getOppositePlacement(H),G=[];if(o&&G.push(V[P]<=0),c&&G.push(V[H]<=0,V[Y]<=0),G.every(function(W){return W})){b=F,L=!1;break}I.set(F,G)}if(L)for(var D=y?3:1,X=function(K){var J=S.find(function(re){var $=I.get(re);if($)return $.slice(0,K).every(function(Z){return Z})});if(J)return b=J,"break"},z=D;z>0;z--){var q=X(z);if(q==="break")break}e.placement!==b&&(e.modifiersData[r]._skip=!0,e.placement=b,e.reset=!0)}}const flip$1={name:"flip",enabled:!0,phase:"main",fn:flip,requiresIfExists:["offset"],data:{_skip:!1}};function getSideOffsets(i,e,t){return t===void 0&&(t={x:0,y:0}),{top:i.top-e.height-t.y,right:i.right-e.width+t.x,bottom:i.bottom-e.height+t.y,left:i.left-e.width-t.x}}function isAnySideFullyClipped(i){return[top,right,bottom,left].some(function(e){return i[e]>=0})}function hide(i){var e=i.state,t=i.name,r=e.rects.reference,a=e.rects.popper,o=e.modifiersData.preventOverflow,u=detectOverflow(e,{elementContext:"reference"}),c=detectOverflow(e,{altBoundary:!0}),h=getSideOffsets(u,r),d=getSideOffsets(c,a,o),p=isAnySideFullyClipped(h),m=isAnySideFullyClipped(d);e.modifiersData[t]={referenceClippingOffsets:h,popperEscapeOffsets:d,isReferenceHidden:p,hasPopperEscaped:m},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":p,"data-popper-escaped":m})}const hide$1={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:hide};function distanceAndSkiddingToXY(i,e,t){var r=getBasePlacement(i),a=[left,top].indexOf(r)>=0?-1:1,o=typeof t=="function"?t(Object.assign({},e,{placement:i})):t,u=o[0],c=o[1];return u=u||0,c=(c||0)*a,[left,right].indexOf(r)>=0?{x:c,y:u}:{x:u,y:c}}function offset(i){var e=i.state,t=i.options,r=i.name,a=t.offset,o=a===void 0?[0,0]:a,u=placements.reduce(function(p,m){return p[m]=distanceAndSkiddingToXY(m,e.rects,o),p},{}),c=u[e.placement],h=c.x,d=c.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=h,e.modifiersData.popperOffsets.y+=d),e.modifiersData[r]=u}const offset$1={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:offset};function popperOffsets(i){var e=i.state,t=i.name;e.modifiersData[t]=computeOffsets({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const popperOffsets$1={name:"popperOffsets",enabled:!0,phase:"read",fn:popperOffsets,data:{}};function getAltAxis(i){return i==="x"?"y":"x"}function preventOverflow(i){var e=i.state,t=i.options,r=i.name,a=t.mainAxis,o=a===void 0?!0:a,u=t.altAxis,c=u===void 0?!1:u,h=t.boundary,d=t.rootBoundary,p=t.altBoundary,m=t.padding,f=t.tether,g=f===void 0?!0:f,y=t.tetherOffset,T=y===void 0?0:y,A=detectOverflow(e,{boundary:h,rootBoundary:d,padding:m,altBoundary:p}),R=getBasePlacement(e.placement),C=getVariation(e.placement),N=!C,S=getMainAxisFromPlacement(R),_=getAltAxis(S),O=e.modifiersData.popperOffsets,I=e.rects.reference,L=e.rects.popper,b=typeof T=="function"?T(Object.assign({},e.rects,{placement:e.placement})):T,w=typeof b=="number"?{mainAxis:b,altAxis:b}:Object.assign({mainAxis:0,altAxis:0},b),F=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,P={x:0,y:0};if(O){if(o){var x,B=S==="y"?top:left,k=S==="y"?bottom:right,V=S==="y"?"height":"width",H=O[S],Y=H+A[B],G=H-A[k],D=g?-L[V]/2:0,X=C===start?I[V]:L[V],z=C===start?-L[V]:-I[V],q=e.elements.arrow,W=g&&q?getLayoutRect(q):{width:0,height:0},K=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:getFreshSideObject(),J=K[B],re=K[k],$=within(0,I[V],W[V]),Z=N?I[V]/2-D-$-J-w.mainAxis:X-$-J-w.mainAxis,ie=N?-I[V]/2+D+$+re+w.mainAxis:z+$+re+w.mainAxis,ee=e.elements.arrow&&getOffsetParent(e.elements.arrow),ne=ee?S==="y"?ee.clientTop||0:ee.clientLeft||0:0,se=(x=F==null?void 0:F[S])!=null?x:0,ae=H+Z-se-ne,oe=H+ie-se,ue=within(g?min(Y,ae):Y,H,g?max(G,oe):G);O[S]=ue,P[S]=ue-H}if(c){var le,te=S==="x"?top:left,ce=S==="x"?bottom:right,U=O[_],j=_==="y"?"height":"width",Q=U+A[te],he=U-A[ce],de=[top,left].indexOf(R)!==-1,pe=(le=F==null?void 0:F[_])!=null?le:0,me=de?Q:U-I[j]-L[j]-pe+w.altAxis,fe=de?U+I[j]+L[j]-pe-w.altAxis:he,Ee=g&&de?withinMaxClamp(me,U,fe):within(g?me:Q,U,g?fe:he);O[_]=Ee,P[_]=Ee-U}e.modifiersData[r]=P}}const preventOverflow$1={name:"preventOverflow",enabled:!0,phase:"main",fn:preventOverflow,requiresIfExists:["offset"]};function getHTMLElementScroll(i){return{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}}function getNodeScroll(i){return i===getWindow(i)||!isHTMLElement(i)?getWindowScroll(i):getHTMLElementScroll(i)}function isElementScaled(i){var e=i.getBoundingClientRect(),t=round(e.width)/i.offsetWidth||1,r=round(e.height)/i.offsetHeight||1;return t!==1||r!==1}function getCompositeRect(i,e,t){t===void 0&&(t=!1);var r=isHTMLElement(e),a=isHTMLElement(e)&&isElementScaled(e),o=getDocumentElement(e),u=getBoundingClientRect(i,a,t),c={scrollLeft:0,scrollTop:0},h={x:0,y:0};return(r||!r&&!t)&&((getNodeName(e)!=="body"||isScrollParent(o))&&(c=getNodeScroll(e)),isHTMLElement(e)?(h=getBoundingClientRect(e,!0),h.x+=e.clientLeft,h.y+=e.clientTop):o&&(h.x=getWindowScrollBarX(o))),{x:u.left+c.scrollLeft-h.x,y:u.top+c.scrollTop-h.y,width:u.width,height:u.height}}function order(i){var e=new Map,t=new Set,r=[];i.forEach(function(o){e.set(o.name,o)});function a(o){t.add(o.name);var u=[].concat(o.requires||[],o.requiresIfExists||[]);u.forEach(function(c){if(!t.has(c)){var h=e.get(c);h&&a(h)}}),r.push(o)}return i.forEach(function(o){t.has(o.name)||a(o)}),r}function orderModifiers(i){var e=order(i);return modifierPhases.reduce(function(t,r){return t.concat(e.filter(function(a){return a.phase===r}))},[])}function debounce(i){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(i())})})),e}}function mergeByName(i){var e=i.reduce(function(t,r){var a=t[r.name];return t[r.name]=a?Object.assign({},a,r,{options:Object.assign({},a.options,r.options),data:Object.assign({},a.data,r.data)}):r,t},{});return Object.keys(e).map(function(t){return e[t]})}var DEFAULT_OPTIONS={placement:"bottom",modifiers:[],strategy:"absolute"};function areValidElements(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function popperGenerator(i){i===void 0&&(i={});var e=i,t=e.defaultModifiers,r=t===void 0?[]:t,a=e.defaultOptions,o=a===void 0?DEFAULT_OPTIONS:a;return function(c,h,d){d===void 0&&(d=o);var p={placement:"bottom",orderedModifiers:[],options:Object.assign({},DEFAULT_OPTIONS,o),modifiersData:{},elements:{reference:c,popper:h},attributes:{},styles:{}},m=[],f=!1,g={state:p,setOptions:function(R){var C=typeof R=="function"?R(p.options):R;T(),p.options=Object.assign({},o,p.options,C),p.scrollParents={reference:isElement$1(c)?listScrollParents(c):c.contextElement?listScrollParents(c.contextElement):[],popper:listScrollParents(h)};var N=orderModifiers(mergeByName([].concat(r,p.options.modifiers)));return p.orderedModifiers=N.filter(function(S){return S.enabled}),y(),g.update()},forceUpdate:function(){if(!f){var R=p.elements,C=R.reference,N=R.popper;if(areValidElements(C,N)){p.rects={reference:getCompositeRect(C,getOffsetParent(N),p.options.strategy==="fixed"),popper:getLayoutRect(N)},p.reset=!1,p.placement=p.options.placement,p.orderedModifiers.forEach(function(w){return p.modifiersData[w.name]=Object.assign({},w.data)});for(var S=0;S<p.orderedModifiers.length;S++){if(p.reset===!0){p.reset=!1,S=-1;continue}var _=p.orderedModifiers[S],O=_.fn,I=_.options,L=I===void 0?{}:I,b=_.name;typeof O=="function"&&(p=O({state:p,options:L,name:b,instance:g})||p)}}}},update:debounce(function(){return new Promise(function(A){g.forceUpdate(),A(p)})}),destroy:function(){T(),f=!0}};if(!areValidElements(c,h))return g;g.setOptions(d).then(function(A){!f&&d.onFirstUpdate&&d.onFirstUpdate(A)});function y(){p.orderedModifiers.forEach(function(A){var R=A.name,C=A.options,N=C===void 0?{}:C,S=A.effect;if(typeof S=="function"){var _=S({state:p,name:R,instance:g,options:N}),O=function(){};m.push(_||O)}})}function T(){m.forEach(function(A){return A()}),m=[]}return g}}var createPopper$2=popperGenerator(),defaultModifiers$1=[eventListeners,popperOffsets$1,computeStyles$1,applyStyles$1],createPopper$1=popperGenerator({defaultModifiers:defaultModifiers$1}),defaultModifiers=[eventListeners,popperOffsets$1,computeStyles$1,applyStyles$1,offset$1,flip$1,preventOverflow$1,arrow$1,hide$1],createPopper=popperGenerator({defaultModifiers});const Popper=Object.freeze(Object.defineProperty({__proto__:null,afterMain,afterRead,afterWrite,applyStyles:applyStyles$1,arrow:arrow$1,auto,basePlacements,beforeMain,beforeRead,beforeWrite,bottom,clippingParents,computeStyles:computeStyles$1,createPopper,createPopperBase:createPopper$2,createPopperLite:createPopper$1,detectOverflow,end,eventListeners,flip:flip$1,hide:hide$1,left,main,modifierPhases,offset:offset$1,placements,popper,popperGenerator,popperOffsets:popperOffsets$1,preventOverflow:preventOverflow$1,read,reference,right,start,top,variationPlacements,viewport,write},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.3.2 (https://getbootstrap.com/)
  * Copyright 2011-2023 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const elementMap=new Map,Data={set(i,e,t){elementMap.has(i)||elementMap.set(i,new Map);const r=elementMap.get(i);if(!r.has(e)&&r.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(r.keys())[0]}.`);return}r.set(e,t)},get(i,e){return elementMap.has(i)&&elementMap.get(i).get(e)||null},remove(i,e){if(!elementMap.has(i))return;const t=elementMap.get(i);t.delete(e),t.size===0&&elementMap.delete(i)}},MAX_UID=1e6,MILLISECONDS_MULTIPLIER=1e3,TRANSITION_END="transitionend",parseSelector=i=>(i&&window.CSS&&window.CSS.escape&&(i=i.replace(/#([^\s"#']+)/g,(e,t)=>`#${CSS.escape(t)}`)),i),toType=i=>i==null?`${i}`:Object.prototype.toString.call(i).match(/\s([a-z]+)/i)[1].toLowerCase(),getUID=i=>{do i+=Math.floor(Math.random()*MAX_UID);while(document.getElementById(i));return i},getTransitionDurationFromElement=i=>{if(!i)return 0;let{transitionDuration:e,transitionDelay:t}=window.getComputedStyle(i);const r=Number.parseFloat(e),a=Number.parseFloat(t);return!r&&!a?0:(e=e.split(",")[0],t=t.split(",")[0],(Number.parseFloat(e)+Number.parseFloat(t))*MILLISECONDS_MULTIPLIER)},triggerTransitionEnd=i=>{i.dispatchEvent(new Event(TRANSITION_END))},isElement=i=>!i||typeof i!="object"?!1:(typeof i.jquery<"u"&&(i=i[0]),typeof i.nodeType<"u"),getElement=i=>isElement(i)?i.jquery?i[0]:i:typeof i=="string"&&i.length>0?document.querySelector(parseSelector(i)):null,isVisible=i=>{if(!isElement(i)||i.getClientRects().length===0)return!1;const e=getComputedStyle(i).getPropertyValue("visibility")==="visible",t=i.closest("details:not([open])");if(!t)return e;if(t!==i){const r=i.closest("summary");if(r&&r.parentNode!==t||r===null)return!1}return e},isDisabled=i=>!i||i.nodeType!==Node.ELEMENT_NODE||i.classList.contains("disabled")?!0:typeof i.disabled<"u"?i.disabled:i.hasAttribute("disabled")&&i.getAttribute("disabled")!=="false",findShadowRoot=i=>{if(!document.documentElement.attachShadow)return null;if(typeof i.getRootNode=="function"){const e=i.getRootNode();return e instanceof ShadowRoot?e:null}return i instanceof ShadowRoot?i:i.parentNode?findShadowRoot(i.parentNode):null},noop=()=>{},reflow=i=>{i.offsetHeight},getjQuery=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,DOMContentLoadedCallbacks=[],onDOMContentLoaded=i=>{document.readyState==="loading"?(DOMContentLoadedCallbacks.length||document.addEventListener("DOMContentLoaded",()=>{for(const e of DOMContentLoadedCallbacks)e()}),DOMContentLoadedCallbacks.push(i)):i()},isRTL=()=>document.documentElement.dir==="rtl",defineJQueryPlugin=i=>{onDOMContentLoaded(()=>{const e=getjQuery();if(e){const t=i.NAME,r=e.fn[t];e.fn[t]=i.jQueryInterface,e.fn[t].Constructor=i,e.fn[t].noConflict=()=>(e.fn[t]=r,i.jQueryInterface)}})},execute=(i,e=[],t=i)=>typeof i=="function"?i(...e):t,executeAfterTransition=(i,e,t=!0)=>{if(!t){execute(i);return}const a=getTransitionDurationFromElement(e)+5;let o=!1;const u=({target:c})=>{c===e&&(o=!0,e.removeEventListener(TRANSITION_END,u),execute(i))};e.addEventListener(TRANSITION_END,u),setTimeout(()=>{o||triggerTransitionEnd(e)},a)},getNextActiveElement=(i,e,t,r)=>{const a=i.length;let o=i.indexOf(e);return o===-1?!t&&r?i[a-1]:i[0]:(o+=t?1:-1,r&&(o=(o+a)%a),i[Math.max(0,Math.min(o,a-1))])},namespaceRegex=/[^.]*(?=\..*)\.|.*/,stripNameRegex=/\..*/,stripUidRegex=/::\d+$/,eventRegistry={};let uidEvent=1;const customEvents={mouseenter:"mouseover",mouseleave:"mouseout"},nativeEvents=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function makeEventUid(i,e){return e&&`${e}::${uidEvent++}`||i.uidEvent||uidEvent++}function getElementEvents(i){const e=makeEventUid(i);return i.uidEvent=e,eventRegistry[e]=eventRegistry[e]||{},eventRegistry[e]}function bootstrapHandler(i,e){return function t(r){return hydrateObj(r,{delegateTarget:i}),t.oneOff&&EventHandler.off(i,r.type,e),e.apply(i,[r])}}function bootstrapDelegationHandler(i,e,t){return function r(a){const o=i.querySelectorAll(e);for(let{target:u}=a;u&&u!==this;u=u.parentNode)for(const c of o)if(c===u)return hydrateObj(a,{delegateTarget:u}),r.oneOff&&EventHandler.off(i,a.type,e,t),t.apply(u,[a])}}function findHandler(i,e,t=null){return Object.values(i).find(r=>r.callable===e&&r.delegationSelector===t)}function normalizeParameters(i,e,t){const r=typeof e=="string",a=r?t:e||t;let o=getTypeEvent(i);return nativeEvents.has(o)||(o=i),[r,a,o]}function addHandler(i,e,t,r,a){if(typeof e!="string"||!i)return;let[o,u,c]=normalizeParameters(e,t,r);e in customEvents&&(u=(y=>function(T){if(!T.relatedTarget||T.relatedTarget!==T.delegateTarget&&!T.delegateTarget.contains(T.relatedTarget))return y.call(this,T)})(u));const h=getElementEvents(i),d=h[c]||(h[c]={}),p=findHandler(d,u,o?t:null);if(p){p.oneOff=p.oneOff&&a;return}const m=makeEventUid(u,e.replace(namespaceRegex,"")),f=o?bootstrapDelegationHandler(i,t,u):bootstrapHandler(i,u);f.delegationSelector=o?t:null,f.callable=u,f.oneOff=a,f.uidEvent=m,d[m]=f,i.addEventListener(c,f,o)}function removeHandler(i,e,t,r,a){const o=findHandler(e[t],r,a);o&&(i.removeEventListener(t,o,!!a),delete e[t][o.uidEvent])}function removeNamespacedHandlers(i,e,t,r){const a=e[t]||{};for(const[o,u]of Object.entries(a))o.includes(r)&&removeHandler(i,e,t,u.callable,u.delegationSelector)}function getTypeEvent(i){return i=i.replace(stripNameRegex,""),customEvents[i]||i}const EventHandler={on(i,e,t,r){addHandler(i,e,t,r,!1)},one(i,e,t,r){addHandler(i,e,t,r,!0)},off(i,e,t,r){if(typeof e!="string"||!i)return;const[a,o,u]=normalizeParameters(e,t,r),c=u!==e,h=getElementEvents(i),d=h[u]||{},p=e.startsWith(".");if(typeof o<"u"){if(!Object.keys(d).length)return;removeHandler(i,h,u,o,a?t:null);return}if(p)for(const m of Object.keys(h))removeNamespacedHandlers(i,h,m,e.slice(1));for(const[m,f]of Object.entries(d)){const g=m.replace(stripUidRegex,"");(!c||e.includes(g))&&removeHandler(i,h,u,f.callable,f.delegationSelector)}},trigger(i,e,t){if(typeof e!="string"||!i)return null;const r=getjQuery(),a=getTypeEvent(e),o=e!==a;let u=null,c=!0,h=!0,d=!1;o&&r&&(u=r.Event(e,t),r(i).trigger(u),c=!u.isPropagationStopped(),h=!u.isImmediatePropagationStopped(),d=u.isDefaultPrevented());const p=hydrateObj(new Event(e,{bubbles:c,cancelable:!0}),t);return d&&p.preventDefault(),h&&i.dispatchEvent(p),p.defaultPrevented&&u&&u.preventDefault(),p}};function hydrateObj(i,e={}){for(const[t,r]of Object.entries(e))try{i[t]=r}catch{Object.defineProperty(i,t,{configurable:!0,get(){return r}})}return i}function normalizeData(i){if(i==="true")return!0;if(i==="false")return!1;if(i===Number(i).toString())return Number(i);if(i===""||i==="null")return null;if(typeof i!="string")return i;try{return JSON.parse(decodeURIComponent(i))}catch{return i}}function normalizeDataKey(i){return i.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}const Manipulator={setDataAttribute(i,e,t){i.setAttribute(`data-bs-${normalizeDataKey(e)}`,t)},removeDataAttribute(i,e){i.removeAttribute(`data-bs-${normalizeDataKey(e)}`)},getDataAttributes(i){if(!i)return{};const e={},t=Object.keys(i.dataset).filter(r=>r.startsWith("bs")&&!r.startsWith("bsConfig"));for(const r of t){let a=r.replace(/^bs/,"");a=a.charAt(0).toLowerCase()+a.slice(1,a.length),e[a]=normalizeData(i.dataset[r])}return e},getDataAttribute(i,e){return normalizeData(i.getAttribute(`data-bs-${normalizeDataKey(e)}`))}};let Config$1=class{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(e){return e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e}_mergeConfigObj(e,t){const r=isElement(t)?Manipulator.getDataAttribute(t,"config"):{};return{...this.constructor.Default,...typeof r=="object"?r:{},...isElement(t)?Manipulator.getDataAttributes(t):{},...typeof e=="object"?e:{}}}_typeCheckConfig(e,t=this.constructor.DefaultType){for(const[r,a]of Object.entries(t)){const o=e[r],u=isElement(o)?"element":toType(o);if(!new RegExp(a).test(u))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${r}" provided type "${u}" but expected type "${a}".`)}}};const VERSION="5.3.2";class BaseComponent extends Config$1{constructor(e,t){super(),e=getElement(e),e&&(this._element=e,this._config=this._getConfig(t),Data.set(this._element,this.constructor.DATA_KEY,this))}dispose(){Data.remove(this._element,this.constructor.DATA_KEY),EventHandler.off(this._element,this.constructor.EVENT_KEY);for(const e of Object.getOwnPropertyNames(this))this[e]=null}_queueCallback(e,t,r=!0){executeAfterTransition(e,t,r)}_getConfig(e){return e=this._mergeConfigObj(e,this._element),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}static getInstance(e){return Data.get(getElement(e),this.DATA_KEY)}static getOrCreateInstance(e,t={}){return this.getInstance(e)||new this(e,typeof t=="object"?t:null)}static get VERSION(){return VERSION}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(e){return`${e}${this.EVENT_KEY}`}}const getSelector=i=>{let e=i.getAttribute("data-bs-target");if(!e||e==="#"){let t=i.getAttribute("href");if(!t||!t.includes("#")&&!t.startsWith("."))return null;t.includes("#")&&!t.startsWith("#")&&(t=`#${t.split("#")[1]}`),e=t&&t!=="#"?parseSelector(t.trim()):null}return e},SelectorEngine={find(i,e=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(e,i))},findOne(i,e=document.documentElement){return Element.prototype.querySelector.call(e,i)},children(i,e){return[].concat(...i.children).filter(t=>t.matches(e))},parents(i,e){const t=[];let r=i.parentNode.closest(e);for(;r;)t.push(r),r=r.parentNode.closest(e);return t},prev(i,e){let t=i.previousElementSibling;for(;t;){if(t.matches(e))return[t];t=t.previousElementSibling}return[]},next(i,e){let t=i.nextElementSibling;for(;t;){if(t.matches(e))return[t];t=t.nextElementSibling}return[]},focusableChildren(i){const e=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(t=>`${t}:not([tabindex^="-"])`).join(",");return this.find(e,i).filter(t=>!isDisabled(t)&&isVisible(t))},getSelectorFromElement(i){const e=getSelector(i);return e&&SelectorEngine.findOne(e)?e:null},getElementFromSelector(i){const e=getSelector(i);return e?SelectorEngine.findOne(e):null},getMultipleElementsFromSelector(i){const e=getSelector(i);return e?SelectorEngine.find(e):[]}},enableDismissTrigger=(i,e="hide")=>{const t=`click.dismiss${i.EVENT_KEY}`,r=i.NAME;EventHandler.on(document,t,`[data-bs-dismiss="${r}"]`,function(a){if(["A","AREA"].includes(this.tagName)&&a.preventDefault(),isDisabled(this))return;const o=SelectorEngine.getElementFromSelector(this)||this.closest(`.${r}`);i.getOrCreateInstance(o)[e]()})},NAME$f="alert",DATA_KEY$a="bs.alert",EVENT_KEY$b=`.${DATA_KEY$a}`,EVENT_CLOSE=`close${EVENT_KEY$b}`,EVENT_CLOSED=`closed${EVENT_KEY$b}`,CLASS_NAME_FADE$5="fade",CLASS_NAME_SHOW$8="show";class Alert extends BaseComponent{static get NAME(){return NAME$f}close(){if(EventHandler.trigger(this._element,EVENT_CLOSE).defaultPrevented)return;this._element.classList.remove(CLASS_NAME_SHOW$8);const t=this._element.classList.contains(CLASS_NAME_FADE$5);this._queueCallback(()=>this._destroyElement(),this._element,t)}_destroyElement(){this._element.remove(),EventHandler.trigger(this._element,EVENT_CLOSED),this.dispose()}static jQueryInterface(e){return this.each(function(){const t=Alert.getOrCreateInstance(this);if(typeof e=="string"){if(t[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);t[e](this)}})}}enableDismissTrigger(Alert,"close");defineJQueryPlugin(Alert);const NAME$e="button",DATA_KEY$9="bs.button",EVENT_KEY$a=`.${DATA_KEY$9}`,DATA_API_KEY$6=".data-api",CLASS_NAME_ACTIVE$3="active",SELECTOR_DATA_TOGGLE$5='[data-bs-toggle="button"]',EVENT_CLICK_DATA_API$6=`click${EVENT_KEY$a}${DATA_API_KEY$6}`;class Button extends BaseComponent{static get NAME(){return NAME$e}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(CLASS_NAME_ACTIVE$3))}static jQueryInterface(e){return this.each(function(){const t=Button.getOrCreateInstance(this);e==="toggle"&&t[e]()})}}EventHandler.on(document,EVENT_CLICK_DATA_API$6,SELECTOR_DATA_TOGGLE$5,i=>{i.preventDefault();const e=i.target.closest(SELECTOR_DATA_TOGGLE$5);Button.getOrCreateInstance(e).toggle()});defineJQueryPlugin(Button);const NAME$d="swipe",EVENT_KEY$9=".bs.swipe",EVENT_TOUCHSTART=`touchstart${EVENT_KEY$9}`,EVENT_TOUCHMOVE=`touchmove${EVENT_KEY$9}`,EVENT_TOUCHEND=`touchend${EVENT_KEY$9}`,EVENT_POINTERDOWN=`pointerdown${EVENT_KEY$9}`,EVENT_POINTERUP=`pointerup${EVENT_KEY$9}`,POINTER_TYPE_TOUCH="touch",POINTER_TYPE_PEN="pen",CLASS_NAME_POINTER_EVENT="pointer-event",SWIPE_THRESHOLD=40,Default$c={endCallback:null,leftCallback:null,rightCallback:null},DefaultType$c={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Swipe extends Config$1{constructor(e,t){super(),this._element=e,!(!e||!Swipe.isSupported())&&(this._config=this._getConfig(t),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return Default$c}static get DefaultType(){return DefaultType$c}static get NAME(){return NAME$d}dispose(){EventHandler.off(this._element,EVENT_KEY$9)}_start(e){if(!this._supportPointerEvents){this._deltaX=e.touches[0].clientX;return}this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX)}_end(e){this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX-this._deltaX),this._handleSwipe(),execute(this._config.endCallback)}_move(e){this._deltaX=e.touches&&e.touches.length>1?0:e.touches[0].clientX-this._deltaX}_handleSwipe(){const e=Math.abs(this._deltaX);if(e<=SWIPE_THRESHOLD)return;const t=e/this._deltaX;this._deltaX=0,t&&execute(t>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(EventHandler.on(this._element,EVENT_POINTERDOWN,e=>this._start(e)),EventHandler.on(this._element,EVENT_POINTERUP,e=>this._end(e)),this._element.classList.add(CLASS_NAME_POINTER_EVENT)):(EventHandler.on(this._element,EVENT_TOUCHSTART,e=>this._start(e)),EventHandler.on(this._element,EVENT_TOUCHMOVE,e=>this._move(e)),EventHandler.on(this._element,EVENT_TOUCHEND,e=>this._end(e)))}_eventIsPointerPenTouch(e){return this._supportPointerEvents&&(e.pointerType===POINTER_TYPE_PEN||e.pointerType===POINTER_TYPE_TOUCH)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const NAME$c="carousel",DATA_KEY$8="bs.carousel",EVENT_KEY$8=`.${DATA_KEY$8}`,DATA_API_KEY$5=".data-api",ARROW_LEFT_KEY$1="ArrowLeft",ARROW_RIGHT_KEY$1="ArrowRight",TOUCHEVENT_COMPAT_WAIT=500,ORDER_NEXT="next",ORDER_PREV="prev",DIRECTION_LEFT="left",DIRECTION_RIGHT="right",EVENT_SLIDE=`slide${EVENT_KEY$8}`,EVENT_SLID=`slid${EVENT_KEY$8}`,EVENT_KEYDOWN$1=`keydown${EVENT_KEY$8}`,EVENT_MOUSEENTER$1=`mouseenter${EVENT_KEY$8}`,EVENT_MOUSELEAVE$1=`mouseleave${EVENT_KEY$8}`,EVENT_DRAG_START=`dragstart${EVENT_KEY$8}`,EVENT_LOAD_DATA_API$3=`load${EVENT_KEY$8}${DATA_API_KEY$5}`,EVENT_CLICK_DATA_API$5=`click${EVENT_KEY$8}${DATA_API_KEY$5}`,CLASS_NAME_CAROUSEL="carousel",CLASS_NAME_ACTIVE$2="active",CLASS_NAME_SLIDE="slide",CLASS_NAME_END="carousel-item-end",CLASS_NAME_START="carousel-item-start",CLASS_NAME_NEXT="carousel-item-next",CLASS_NAME_PREV="carousel-item-prev",SELECTOR_ACTIVE=".active",SELECTOR_ITEM=".carousel-item",SELECTOR_ACTIVE_ITEM=SELECTOR_ACTIVE+SELECTOR_ITEM,SELECTOR_ITEM_IMG=".carousel-item img",SELECTOR_INDICATORS=".carousel-indicators",SELECTOR_DATA_SLIDE="[data-bs-slide], [data-bs-slide-to]",SELECTOR_DATA_RIDE='[data-bs-ride="carousel"]',KEY_TO_DIRECTION={[ARROW_LEFT_KEY$1]:DIRECTION_RIGHT,[ARROW_RIGHT_KEY$1]:DIRECTION_LEFT},Default$b={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},DefaultType$b={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Carousel extends BaseComponent{constructor(e,t){super(e,t),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=SelectorEngine.findOne(SELECTOR_INDICATORS,this._element),this._addEventListeners(),this._config.ride===CLASS_NAME_CAROUSEL&&this.cycle()}static get Default(){return Default$b}static get DefaultType(){return DefaultType$b}static get NAME(){return NAME$c}next(){this._slide(ORDER_NEXT)}nextWhenVisible(){!document.hidden&&isVisible(this._element)&&this.next()}prev(){this._slide(ORDER_PREV)}pause(){this._isSliding&&triggerTransitionEnd(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){EventHandler.one(this._element,EVENT_SLID,()=>this.cycle());return}this.cycle()}}to(e){const t=this._getItems();if(e>t.length-1||e<0)return;if(this._isSliding){EventHandler.one(this._element,EVENT_SLID,()=>this.to(e));return}const r=this._getItemIndex(this._getActive());if(r===e)return;const a=e>r?ORDER_NEXT:ORDER_PREV;this._slide(a,t[e])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(e){return e.defaultInterval=e.interval,e}_addEventListeners(){this._config.keyboard&&EventHandler.on(this._element,EVENT_KEYDOWN$1,e=>this._keydown(e)),this._config.pause==="hover"&&(EventHandler.on(this._element,EVENT_MOUSEENTER$1,()=>this.pause()),EventHandler.on(this._element,EVENT_MOUSELEAVE$1,()=>this._maybeEnableCycle())),this._config.touch&&Swipe.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const r of SelectorEngine.find(SELECTOR_ITEM_IMG,this._element))EventHandler.on(r,EVENT_DRAG_START,a=>a.preventDefault());const t={leftCallback:()=>this._slide(this._directionToOrder(DIRECTION_LEFT)),rightCallback:()=>this._slide(this._directionToOrder(DIRECTION_RIGHT)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),TOUCHEVENT_COMPAT_WAIT+this._config.interval))}};this._swipeHelper=new Swipe(this._element,t)}_keydown(e){if(/input|textarea/i.test(e.target.tagName))return;const t=KEY_TO_DIRECTION[e.key];t&&(e.preventDefault(),this._slide(this._directionToOrder(t)))}_getItemIndex(e){return this._getItems().indexOf(e)}_setActiveIndicatorElement(e){if(!this._indicatorsElement)return;const t=SelectorEngine.findOne(SELECTOR_ACTIVE,this._indicatorsElement);t.classList.remove(CLASS_NAME_ACTIVE$2),t.removeAttribute("aria-current");const r=SelectorEngine.findOne(`[data-bs-slide-to="${e}"]`,this._indicatorsElement);r&&(r.classList.add(CLASS_NAME_ACTIVE$2),r.setAttribute("aria-current","true"))}_updateInterval(){const e=this._activeElement||this._getActive();if(!e)return;const t=Number.parseInt(e.getAttribute("data-bs-interval"),10);this._config.interval=t||this._config.defaultInterval}_slide(e,t=null){if(this._isSliding)return;const r=this._getActive(),a=e===ORDER_NEXT,o=t||getNextActiveElement(this._getItems(),r,a,this._config.wrap);if(o===r)return;const u=this._getItemIndex(o),c=g=>EventHandler.trigger(this._element,g,{relatedTarget:o,direction:this._orderToDirection(e),from:this._getItemIndex(r),to:u});if(c(EVENT_SLIDE).defaultPrevented||!r||!o)return;const d=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(u),this._activeElement=o;const p=a?CLASS_NAME_START:CLASS_NAME_END,m=a?CLASS_NAME_NEXT:CLASS_NAME_PREV;o.classList.add(m),reflow(o),r.classList.add(p),o.classList.add(p);const f=()=>{o.classList.remove(p,m),o.classList.add(CLASS_NAME_ACTIVE$2),r.classList.remove(CLASS_NAME_ACTIVE$2,m,p),this._isSliding=!1,c(EVENT_SLID)};this._queueCallback(f,r,this._isAnimated()),d&&this.cycle()}_isAnimated(){return this._element.classList.contains(CLASS_NAME_SLIDE)}_getActive(){return SelectorEngine.findOne(SELECTOR_ACTIVE_ITEM,this._element)}_getItems(){return SelectorEngine.find(SELECTOR_ITEM,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(e){return isRTL()?e===DIRECTION_LEFT?ORDER_PREV:ORDER_NEXT:e===DIRECTION_LEFT?ORDER_NEXT:ORDER_PREV}_orderToDirection(e){return isRTL()?e===ORDER_PREV?DIRECTION_LEFT:DIRECTION_RIGHT:e===ORDER_PREV?DIRECTION_RIGHT:DIRECTION_LEFT}static jQueryInterface(e){return this.each(function(){const t=Carousel.getOrCreateInstance(this,e);if(typeof e=="number"){t.to(e);return}if(typeof e=="string"){if(t[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);t[e]()}})}}EventHandler.on(document,EVENT_CLICK_DATA_API$5,SELECTOR_DATA_SLIDE,function(i){const e=SelectorEngine.getElementFromSelector(this);if(!e||!e.classList.contains(CLASS_NAME_CAROUSEL))return;i.preventDefault();const t=Carousel.getOrCreateInstance(e),r=this.getAttribute("data-bs-slide-to");if(r){t.to(r),t._maybeEnableCycle();return}if(Manipulator.getDataAttribute(this,"slide")==="next"){t.next(),t._maybeEnableCycle();return}t.prev(),t._maybeEnableCycle()});EventHandler.on(window,EVENT_LOAD_DATA_API$3,()=>{const i=SelectorEngine.find(SELECTOR_DATA_RIDE);for(const e of i)Carousel.getOrCreateInstance(e)});defineJQueryPlugin(Carousel);const NAME$b="collapse",DATA_KEY$7="bs.collapse",EVENT_KEY$7=`.${DATA_KEY$7}`,DATA_API_KEY$4=".data-api",EVENT_SHOW$6=`show${EVENT_KEY$7}`,EVENT_SHOWN$6=`shown${EVENT_KEY$7}`,EVENT_HIDE$6=`hide${EVENT_KEY$7}`,EVENT_HIDDEN$6=`hidden${EVENT_KEY$7}`,EVENT_CLICK_DATA_API$4=`click${EVENT_KEY$7}${DATA_API_KEY$4}`,CLASS_NAME_SHOW$7="show",CLASS_NAME_COLLAPSE="collapse",CLASS_NAME_COLLAPSING="collapsing",CLASS_NAME_COLLAPSED="collapsed",CLASS_NAME_DEEPER_CHILDREN=`:scope .${CLASS_NAME_COLLAPSE} .${CLASS_NAME_COLLAPSE}`,CLASS_NAME_HORIZONTAL="collapse-horizontal",WIDTH="width",HEIGHT="height",SELECTOR_ACTIVES=".collapse.show, .collapse.collapsing",SELECTOR_DATA_TOGGLE$4='[data-bs-toggle="collapse"]',Default$a={parent:null,toggle:!0},DefaultType$a={parent:"(null|element)",toggle:"boolean"};class Collapse extends BaseComponent{constructor(e,t){super(e,t),this._isTransitioning=!1,this._triggerArray=[];const r=SelectorEngine.find(SELECTOR_DATA_TOGGLE$4);for(const a of r){const o=SelectorEngine.getSelectorFromElement(a),u=SelectorEngine.find(o).filter(c=>c===this._element);o!==null&&u.length&&this._triggerArray.push(a)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Default$a}static get DefaultType(){return DefaultType$a}static get NAME(){return NAME$b}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let e=[];if(this._config.parent&&(e=this._getFirstLevelChildren(SELECTOR_ACTIVES).filter(c=>c!==this._element).map(c=>Collapse.getOrCreateInstance(c,{toggle:!1}))),e.length&&e[0]._isTransitioning||EventHandler.trigger(this._element,EVENT_SHOW$6).defaultPrevented)return;for(const c of e)c.hide();const r=this._getDimension();this._element.classList.remove(CLASS_NAME_COLLAPSE),this._element.classList.add(CLASS_NAME_COLLAPSING),this._element.style[r]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const a=()=>{this._isTransitioning=!1,this._element.classList.remove(CLASS_NAME_COLLAPSING),this._element.classList.add(CLASS_NAME_COLLAPSE,CLASS_NAME_SHOW$7),this._element.style[r]="",EventHandler.trigger(this._element,EVENT_SHOWN$6)},u=`scroll${r[0].toUpperCase()+r.slice(1)}`;this._queueCallback(a,this._element,!0),this._element.style[r]=`${this._element[u]}px`}hide(){if(this._isTransitioning||!this._isShown()||EventHandler.trigger(this._element,EVENT_HIDE$6).defaultPrevented)return;const t=this._getDimension();this._element.style[t]=`${this._element.getBoundingClientRect()[t]}px`,reflow(this._element),this._element.classList.add(CLASS_NAME_COLLAPSING),this._element.classList.remove(CLASS_NAME_COLLAPSE,CLASS_NAME_SHOW$7);for(const a of this._triggerArray){const o=SelectorEngine.getElementFromSelector(a);o&&!this._isShown(o)&&this._addAriaAndCollapsedClass([a],!1)}this._isTransitioning=!0;const r=()=>{this._isTransitioning=!1,this._element.classList.remove(CLASS_NAME_COLLAPSING),this._element.classList.add(CLASS_NAME_COLLAPSE),EventHandler.trigger(this._element,EVENT_HIDDEN$6)};this._element.style[t]="",this._queueCallback(r,this._element,!0)}_isShown(e=this._element){return e.classList.contains(CLASS_NAME_SHOW$7)}_configAfterMerge(e){return e.toggle=!!e.toggle,e.parent=getElement(e.parent),e}_getDimension(){return this._element.classList.contains(CLASS_NAME_HORIZONTAL)?WIDTH:HEIGHT}_initializeChildren(){if(!this._config.parent)return;const e=this._getFirstLevelChildren(SELECTOR_DATA_TOGGLE$4);for(const t of e){const r=SelectorEngine.getElementFromSelector(t);r&&this._addAriaAndCollapsedClass([t],this._isShown(r))}}_getFirstLevelChildren(e){const t=SelectorEngine.find(CLASS_NAME_DEEPER_CHILDREN,this._config.parent);return SelectorEngine.find(e,this._config.parent).filter(r=>!t.includes(r))}_addAriaAndCollapsedClass(e,t){if(e.length)for(const r of e)r.classList.toggle(CLASS_NAME_COLLAPSED,!t),r.setAttribute("aria-expanded",t)}static jQueryInterface(e){const t={};return typeof e=="string"&&/show|hide/.test(e)&&(t.toggle=!1),this.each(function(){const r=Collapse.getOrCreateInstance(this,t);if(typeof e=="string"){if(typeof r[e]>"u")throw new TypeError(`No method named "${e}"`);r[e]()}})}}EventHandler.on(document,EVENT_CLICK_DATA_API$4,SELECTOR_DATA_TOGGLE$4,function(i){(i.target.tagName==="A"||i.delegateTarget&&i.delegateTarget.tagName==="A")&&i.preventDefault();for(const e of SelectorEngine.getMultipleElementsFromSelector(this))Collapse.getOrCreateInstance(e,{toggle:!1}).toggle()});defineJQueryPlugin(Collapse);const NAME$a="dropdown",DATA_KEY$6="bs.dropdown",EVENT_KEY$6=`.${DATA_KEY$6}`,DATA_API_KEY$3=".data-api",ESCAPE_KEY$2="Escape",TAB_KEY$1="Tab",ARROW_UP_KEY$1="ArrowUp",ARROW_DOWN_KEY$1="ArrowDown",RIGHT_MOUSE_BUTTON=2,EVENT_HIDE$5=`hide${EVENT_KEY$6}`,EVENT_HIDDEN$5=`hidden${EVENT_KEY$6}`,EVENT_SHOW$5=`show${EVENT_KEY$6}`,EVENT_SHOWN$5=`shown${EVENT_KEY$6}`,EVENT_CLICK_DATA_API$3=`click${EVENT_KEY$6}${DATA_API_KEY$3}`,EVENT_KEYDOWN_DATA_API=`keydown${EVENT_KEY$6}${DATA_API_KEY$3}`,EVENT_KEYUP_DATA_API=`keyup${EVENT_KEY$6}${DATA_API_KEY$3}`,CLASS_NAME_SHOW$6="show",CLASS_NAME_DROPUP="dropup",CLASS_NAME_DROPEND="dropend",CLASS_NAME_DROPSTART="dropstart",CLASS_NAME_DROPUP_CENTER="dropup-center",CLASS_NAME_DROPDOWN_CENTER="dropdown-center",SELECTOR_DATA_TOGGLE$3='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',SELECTOR_DATA_TOGGLE_SHOWN=`${SELECTOR_DATA_TOGGLE$3}.${CLASS_NAME_SHOW$6}`,SELECTOR_MENU=".dropdown-menu",SELECTOR_NAVBAR=".navbar",SELECTOR_NAVBAR_NAV=".navbar-nav",SELECTOR_VISIBLE_ITEMS=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",PLACEMENT_TOP=isRTL()?"top-end":"top-start",PLACEMENT_TOPEND=isRTL()?"top-start":"top-end",PLACEMENT_BOTTOM=isRTL()?"bottom-end":"bottom-start",PLACEMENT_BOTTOMEND=isRTL()?"bottom-start":"bottom-end",PLACEMENT_RIGHT=isRTL()?"left-start":"right-start",PLACEMENT_LEFT=isRTL()?"right-start":"left-start",PLACEMENT_TOPCENTER="top",PLACEMENT_BOTTOMCENTER="bottom",Default$9={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},DefaultType$9={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Dropdown extends BaseComponent{constructor(e,t){super(e,t),this._popper=null,this._parent=this._element.parentNode,this._menu=SelectorEngine.next(this._element,SELECTOR_MENU)[0]||SelectorEngine.prev(this._element,SELECTOR_MENU)[0]||SelectorEngine.findOne(SELECTOR_MENU,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Default$9}static get DefaultType(){return DefaultType$9}static get NAME(){return NAME$a}toggle(){return this._isShown()?this.hide():this.show()}show(){if(isDisabled(this._element)||this._isShown())return;const e={relatedTarget:this._element};if(!EventHandler.trigger(this._element,EVENT_SHOW$5,e).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(SELECTOR_NAVBAR_NAV))for(const r of[].concat(...document.body.children))EventHandler.on(r,"mouseover",noop);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(CLASS_NAME_SHOW$6),this._element.classList.add(CLASS_NAME_SHOW$6),EventHandler.trigger(this._element,EVENT_SHOWN$5,e)}}hide(){if(isDisabled(this._element)||!this._isShown())return;const e={relatedTarget:this._element};this._completeHide(e)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(e){if(!EventHandler.trigger(this._element,EVENT_HIDE$5,e).defaultPrevented){if("ontouchstart"in document.documentElement)for(const r of[].concat(...document.body.children))EventHandler.off(r,"mouseover",noop);this._popper&&this._popper.destroy(),this._menu.classList.remove(CLASS_NAME_SHOW$6),this._element.classList.remove(CLASS_NAME_SHOW$6),this._element.setAttribute("aria-expanded","false"),Manipulator.removeDataAttribute(this._menu,"popper"),EventHandler.trigger(this._element,EVENT_HIDDEN$5,e)}}_getConfig(e){if(e=super._getConfig(e),typeof e.reference=="object"&&!isElement(e.reference)&&typeof e.reference.getBoundingClientRect!="function")throw new TypeError(`${NAME$a.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return e}_createPopper(){if(typeof Popper>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let e=this._element;this._config.reference==="parent"?e=this._parent:isElement(this._config.reference)?e=getElement(this._config.reference):typeof this._config.reference=="object"&&(e=this._config.reference);const t=this._getPopperConfig();this._popper=createPopper(e,this._menu,t)}_isShown(){return this._menu.classList.contains(CLASS_NAME_SHOW$6)}_getPlacement(){const e=this._parent;if(e.classList.contains(CLASS_NAME_DROPEND))return PLACEMENT_RIGHT;if(e.classList.contains(CLASS_NAME_DROPSTART))return PLACEMENT_LEFT;if(e.classList.contains(CLASS_NAME_DROPUP_CENTER))return PLACEMENT_TOPCENTER;if(e.classList.contains(CLASS_NAME_DROPDOWN_CENTER))return PLACEMENT_BOTTOMCENTER;const t=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return e.classList.contains(CLASS_NAME_DROPUP)?t?PLACEMENT_TOPEND:PLACEMENT_TOP:t?PLACEMENT_BOTTOMEND:PLACEMENT_BOTTOM}_detectNavbar(){return this._element.closest(SELECTOR_NAVBAR)!==null}_getOffset(){const{offset:e}=this._config;return typeof e=="string"?e.split(",").map(t=>Number.parseInt(t,10)):typeof e=="function"?t=>e(t,this._element):e}_getPopperConfig(){const e={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(Manipulator.setDataAttribute(this._menu,"popper","static"),e.modifiers=[{name:"applyStyles",enabled:!1}]),{...e,...execute(this._config.popperConfig,[e])}}_selectMenuItem({key:e,target:t}){const r=SelectorEngine.find(SELECTOR_VISIBLE_ITEMS,this._menu).filter(a=>isVisible(a));r.length&&getNextActiveElement(r,t,e===ARROW_DOWN_KEY$1,!r.includes(t)).focus()}static jQueryInterface(e){return this.each(function(){const t=Dropdown.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof t[e]>"u")throw new TypeError(`No method named "${e}"`);t[e]()}})}static clearMenus(e){if(e.button===RIGHT_MOUSE_BUTTON||e.type==="keyup"&&e.key!==TAB_KEY$1)return;const t=SelectorEngine.find(SELECTOR_DATA_TOGGLE_SHOWN);for(const r of t){const a=Dropdown.getInstance(r);if(!a||a._config.autoClose===!1)continue;const o=e.composedPath(),u=o.includes(a._menu);if(o.includes(a._element)||a._config.autoClose==="inside"&&!u||a._config.autoClose==="outside"&&u||a._menu.contains(e.target)&&(e.type==="keyup"&&e.key===TAB_KEY$1||/input|select|option|textarea|form/i.test(e.target.tagName)))continue;const c={relatedTarget:a._element};e.type==="click"&&(c.clickEvent=e),a._completeHide(c)}}static dataApiKeydownHandler(e){const t=/input|textarea/i.test(e.target.tagName),r=e.key===ESCAPE_KEY$2,a=[ARROW_UP_KEY$1,ARROW_DOWN_KEY$1].includes(e.key);if(!a&&!r||t&&!r)return;e.preventDefault();const o=this.matches(SELECTOR_DATA_TOGGLE$3)?this:SelectorEngine.prev(this,SELECTOR_DATA_TOGGLE$3)[0]||SelectorEngine.next(this,SELECTOR_DATA_TOGGLE$3)[0]||SelectorEngine.findOne(SELECTOR_DATA_TOGGLE$3,e.delegateTarget.parentNode),u=Dropdown.getOrCreateInstance(o);if(a){e.stopPropagation(),u.show(),u._selectMenuItem(e);return}u._isShown()&&(e.stopPropagation(),u.hide(),o.focus())}}EventHandler.on(document,EVENT_KEYDOWN_DATA_API,SELECTOR_DATA_TOGGLE$3,Dropdown.dataApiKeydownHandler);EventHandler.on(document,EVENT_KEYDOWN_DATA_API,SELECTOR_MENU,Dropdown.dataApiKeydownHandler);EventHandler.on(document,EVENT_CLICK_DATA_API$3,Dropdown.clearMenus);EventHandler.on(document,EVENT_KEYUP_DATA_API,Dropdown.clearMenus);EventHandler.on(document,EVENT_CLICK_DATA_API$3,SELECTOR_DATA_TOGGLE$3,function(i){i.preventDefault(),Dropdown.getOrCreateInstance(this).toggle()});defineJQueryPlugin(Dropdown);const NAME$9="backdrop",CLASS_NAME_FADE$4="fade",CLASS_NAME_SHOW$5="show",EVENT_MOUSEDOWN=`mousedown.bs.${NAME$9}`,Default$8={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},DefaultType$8={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class Backdrop extends Config$1{constructor(e){super(),this._config=this._getConfig(e),this._isAppended=!1,this._element=null}static get Default(){return Default$8}static get DefaultType(){return DefaultType$8}static get NAME(){return NAME$9}show(e){if(!this._config.isVisible){execute(e);return}this._append();const t=this._getElement();this._config.isAnimated&&reflow(t),t.classList.add(CLASS_NAME_SHOW$5),this._emulateAnimation(()=>{execute(e)})}hide(e){if(!this._config.isVisible){execute(e);return}this._getElement().classList.remove(CLASS_NAME_SHOW$5),this._emulateAnimation(()=>{this.dispose(),execute(e)})}dispose(){this._isAppended&&(EventHandler.off(this._element,EVENT_MOUSEDOWN),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const e=document.createElement("div");e.className=this._config.className,this._config.isAnimated&&e.classList.add(CLASS_NAME_FADE$4),this._element=e}return this._element}_configAfterMerge(e){return e.rootElement=getElement(e.rootElement),e}_append(){if(this._isAppended)return;const e=this._getElement();this._config.rootElement.append(e),EventHandler.on(e,EVENT_MOUSEDOWN,()=>{execute(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(e){executeAfterTransition(e,this._getElement(),this._config.isAnimated)}}const NAME$8="focustrap",DATA_KEY$5="bs.focustrap",EVENT_KEY$5=`.${DATA_KEY$5}`,EVENT_FOCUSIN$2=`focusin${EVENT_KEY$5}`,EVENT_KEYDOWN_TAB=`keydown.tab${EVENT_KEY$5}`,TAB_KEY="Tab",TAB_NAV_FORWARD="forward",TAB_NAV_BACKWARD="backward",Default$7={autofocus:!0,trapElement:null},DefaultType$7={autofocus:"boolean",trapElement:"element"};class FocusTrap extends Config$1{constructor(e){super(),this._config=this._getConfig(e),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return Default$7}static get DefaultType(){return DefaultType$7}static get NAME(){return NAME$8}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),EventHandler.off(document,EVENT_KEY$5),EventHandler.on(document,EVENT_FOCUSIN$2,e=>this._handleFocusin(e)),EventHandler.on(document,EVENT_KEYDOWN_TAB,e=>this._handleKeydown(e)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,EventHandler.off(document,EVENT_KEY$5))}_handleFocusin(e){const{trapElement:t}=this._config;if(e.target===document||e.target===t||t.contains(e.target))return;const r=SelectorEngine.focusableChildren(t);r.length===0?t.focus():this._lastTabNavDirection===TAB_NAV_BACKWARD?r[r.length-1].focus():r[0].focus()}_handleKeydown(e){e.key===TAB_KEY&&(this._lastTabNavDirection=e.shiftKey?TAB_NAV_BACKWARD:TAB_NAV_FORWARD)}}const SELECTOR_FIXED_CONTENT=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",SELECTOR_STICKY_CONTENT=".sticky-top",PROPERTY_PADDING="padding-right",PROPERTY_MARGIN="margin-right";class ScrollBarHelper{constructor(){this._element=document.body}getWidth(){const e=document.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}hide(){const e=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,PROPERTY_PADDING,t=>t+e),this._setElementAttributes(SELECTOR_FIXED_CONTENT,PROPERTY_PADDING,t=>t+e),this._setElementAttributes(SELECTOR_STICKY_CONTENT,PROPERTY_MARGIN,t=>t-e)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,PROPERTY_PADDING),this._resetElementAttributes(SELECTOR_FIXED_CONTENT,PROPERTY_PADDING),this._resetElementAttributes(SELECTOR_STICKY_CONTENT,PROPERTY_MARGIN)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(e,t,r){const a=this.getWidth(),o=u=>{if(u!==this._element&&window.innerWidth>u.clientWidth+a)return;this._saveInitialAttribute(u,t);const c=window.getComputedStyle(u).getPropertyValue(t);u.style.setProperty(t,`${r(Number.parseFloat(c))}px`)};this._applyManipulationCallback(e,o)}_saveInitialAttribute(e,t){const r=e.style.getPropertyValue(t);r&&Manipulator.setDataAttribute(e,t,r)}_resetElementAttributes(e,t){const r=a=>{const o=Manipulator.getDataAttribute(a,t);if(o===null){a.style.removeProperty(t);return}Manipulator.removeDataAttribute(a,t),a.style.setProperty(t,o)};this._applyManipulationCallback(e,r)}_applyManipulationCallback(e,t){if(isElement(e)){t(e);return}for(const r of SelectorEngine.find(e,this._element))t(r)}}const NAME$7="modal",DATA_KEY$4="bs.modal",EVENT_KEY$4=`.${DATA_KEY$4}`,DATA_API_KEY$2=".data-api",ESCAPE_KEY$1="Escape",EVENT_HIDE$4=`hide${EVENT_KEY$4}`,EVENT_HIDE_PREVENTED$1=`hidePrevented${EVENT_KEY$4}`,EVENT_HIDDEN$4=`hidden${EVENT_KEY$4}`,EVENT_SHOW$4=`show${EVENT_KEY$4}`,EVENT_SHOWN$4=`shown${EVENT_KEY$4}`,EVENT_RESIZE$1=`resize${EVENT_KEY$4}`,EVENT_CLICK_DISMISS=`click.dismiss${EVENT_KEY$4}`,EVENT_MOUSEDOWN_DISMISS=`mousedown.dismiss${EVENT_KEY$4}`,EVENT_KEYDOWN_DISMISS$1=`keydown.dismiss${EVENT_KEY$4}`,EVENT_CLICK_DATA_API$2=`click${EVENT_KEY$4}${DATA_API_KEY$2}`,CLASS_NAME_OPEN="modal-open",CLASS_NAME_FADE$3="fade",CLASS_NAME_SHOW$4="show",CLASS_NAME_STATIC="modal-static",OPEN_SELECTOR$1=".modal.show",SELECTOR_DIALOG=".modal-dialog",SELECTOR_MODAL_BODY=".modal-body",SELECTOR_DATA_TOGGLE$2='[data-bs-toggle="modal"]',Default$6={backdrop:!0,focus:!0,keyboard:!0},DefaultType$6={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Modal extends BaseComponent{constructor(e,t){super(e,t),this._dialog=SelectorEngine.findOne(SELECTOR_DIALOG,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new ScrollBarHelper,this._addEventListeners()}static get Default(){return Default$6}static get DefaultType(){return DefaultType$6}static get NAME(){return NAME$7}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){this._isShown||this._isTransitioning||EventHandler.trigger(this._element,EVENT_SHOW$4,{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(CLASS_NAME_OPEN),this._adjustDialog(),this._backdrop.show(()=>this._showElement(e)))}hide(){!this._isShown||this._isTransitioning||EventHandler.trigger(this._element,EVENT_HIDE$4).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(CLASS_NAME_SHOW$4),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){EventHandler.off(window,EVENT_KEY$4),EventHandler.off(this._dialog,EVENT_KEY$4),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Backdrop({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new FocusTrap({trapElement:this._element})}_showElement(e){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const t=SelectorEngine.findOne(SELECTOR_MODAL_BODY,this._dialog);t&&(t.scrollTop=0),reflow(this._element),this._element.classList.add(CLASS_NAME_SHOW$4);const r=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,EventHandler.trigger(this._element,EVENT_SHOWN$4,{relatedTarget:e})};this._queueCallback(r,this._dialog,this._isAnimated())}_addEventListeners(){EventHandler.on(this._element,EVENT_KEYDOWN_DISMISS$1,e=>{if(e.key===ESCAPE_KEY$1){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),EventHandler.on(window,EVENT_RESIZE$1,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),EventHandler.on(this._element,EVENT_MOUSEDOWN_DISMISS,e=>{EventHandler.one(this._element,EVENT_CLICK_DISMISS,t=>{if(!(this._element!==e.target||this._element!==t.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(CLASS_NAME_OPEN),this._resetAdjustments(),this._scrollBar.reset(),EventHandler.trigger(this._element,EVENT_HIDDEN$4)})}_isAnimated(){return this._element.classList.contains(CLASS_NAME_FADE$3)}_triggerBackdropTransition(){if(EventHandler.trigger(this._element,EVENT_HIDE_PREVENTED$1).defaultPrevented)return;const t=this._element.scrollHeight>document.documentElement.clientHeight,r=this._element.style.overflowY;r==="hidden"||this._element.classList.contains(CLASS_NAME_STATIC)||(t||(this._element.style.overflowY="hidden"),this._element.classList.add(CLASS_NAME_STATIC),this._queueCallback(()=>{this._element.classList.remove(CLASS_NAME_STATIC),this._queueCallback(()=>{this._element.style.overflowY=r},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._scrollBar.getWidth(),r=t>0;if(r&&!e){const a=isRTL()?"paddingLeft":"paddingRight";this._element.style[a]=`${t}px`}if(!r&&e){const a=isRTL()?"paddingRight":"paddingLeft";this._element.style[a]=`${t}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(e,t){return this.each(function(){const r=Modal.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof r[e]>"u")throw new TypeError(`No method named "${e}"`);r[e](t)}})}}EventHandler.on(document,EVENT_CLICK_DATA_API$2,SELECTOR_DATA_TOGGLE$2,function(i){const e=SelectorEngine.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&i.preventDefault(),EventHandler.one(e,EVENT_SHOW$4,a=>{a.defaultPrevented||EventHandler.one(e,EVENT_HIDDEN$4,()=>{isVisible(this)&&this.focus()})});const t=SelectorEngine.findOne(OPEN_SELECTOR$1);t&&Modal.getInstance(t).hide(),Modal.getOrCreateInstance(e).toggle(this)});enableDismissTrigger(Modal);defineJQueryPlugin(Modal);const NAME$6="offcanvas",DATA_KEY$3="bs.offcanvas",EVENT_KEY$3=`.${DATA_KEY$3}`,DATA_API_KEY$1=".data-api",EVENT_LOAD_DATA_API$2=`load${EVENT_KEY$3}${DATA_API_KEY$1}`,ESCAPE_KEY="Escape",CLASS_NAME_SHOW$3="show",CLASS_NAME_SHOWING$1="showing",CLASS_NAME_HIDING="hiding",CLASS_NAME_BACKDROP="offcanvas-backdrop",OPEN_SELECTOR=".offcanvas.show",EVENT_SHOW$3=`show${EVENT_KEY$3}`,EVENT_SHOWN$3=`shown${EVENT_KEY$3}`,EVENT_HIDE$3=`hide${EVENT_KEY$3}`,EVENT_HIDE_PREVENTED=`hidePrevented${EVENT_KEY$3}`,EVENT_HIDDEN$3=`hidden${EVENT_KEY$3}`,EVENT_RESIZE=`resize${EVENT_KEY$3}`,EVENT_CLICK_DATA_API$1=`click${EVENT_KEY$3}${DATA_API_KEY$1}`,EVENT_KEYDOWN_DISMISS=`keydown.dismiss${EVENT_KEY$3}`,SELECTOR_DATA_TOGGLE$1='[data-bs-toggle="offcanvas"]',Default$5={backdrop:!0,keyboard:!0,scroll:!1},DefaultType$5={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Offcanvas extends BaseComponent{constructor(e,t){super(e,t),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return Default$5}static get DefaultType(){return DefaultType$5}static get NAME(){return NAME$6}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){if(this._isShown||EventHandler.trigger(this._element,EVENT_SHOW$3,{relatedTarget:e}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new ScrollBarHelper().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(CLASS_NAME_SHOWING$1);const r=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(CLASS_NAME_SHOW$3),this._element.classList.remove(CLASS_NAME_SHOWING$1),EventHandler.trigger(this._element,EVENT_SHOWN$3,{relatedTarget:e})};this._queueCallback(r,this._element,!0)}hide(){if(!this._isShown||EventHandler.trigger(this._element,EVENT_HIDE$3).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(CLASS_NAME_HIDING),this._backdrop.hide();const t=()=>{this._element.classList.remove(CLASS_NAME_SHOW$3,CLASS_NAME_HIDING),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new ScrollBarHelper().reset(),EventHandler.trigger(this._element,EVENT_HIDDEN$3)};this._queueCallback(t,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const e=()=>{if(this._config.backdrop==="static"){EventHandler.trigger(this._element,EVENT_HIDE_PREVENTED);return}this.hide()},t=!!this._config.backdrop;return new Backdrop({className:CLASS_NAME_BACKDROP,isVisible:t,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:t?e:null})}_initializeFocusTrap(){return new FocusTrap({trapElement:this._element})}_addEventListeners(){EventHandler.on(this._element,EVENT_KEYDOWN_DISMISS,e=>{if(e.key===ESCAPE_KEY){if(this._config.keyboard){this.hide();return}EventHandler.trigger(this._element,EVENT_HIDE_PREVENTED)}})}static jQueryInterface(e){return this.each(function(){const t=Offcanvas.getOrCreateInstance(this,e);if(typeof e=="string"){if(t[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);t[e](this)}})}}EventHandler.on(document,EVENT_CLICK_DATA_API$1,SELECTOR_DATA_TOGGLE$1,function(i){const e=SelectorEngine.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&i.preventDefault(),isDisabled(this))return;EventHandler.one(e,EVENT_HIDDEN$3,()=>{isVisible(this)&&this.focus()});const t=SelectorEngine.findOne(OPEN_SELECTOR);t&&t!==e&&Offcanvas.getInstance(t).hide(),Offcanvas.getOrCreateInstance(e).toggle(this)});EventHandler.on(window,EVENT_LOAD_DATA_API$2,()=>{for(const i of SelectorEngine.find(OPEN_SELECTOR))Offcanvas.getOrCreateInstance(i).show()});EventHandler.on(window,EVENT_RESIZE,()=>{for(const i of SelectorEngine.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(i).position!=="fixed"&&Offcanvas.getOrCreateInstance(i).hide()});enableDismissTrigger(Offcanvas);defineJQueryPlugin(Offcanvas);const ARIA_ATTRIBUTE_PATTERN=/^aria-[\w-]*$/i,DefaultAllowlist={"*":["class","dir","id","lang","role",ARIA_ATTRIBUTE_PATTERN],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},uriAttributes=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),SAFE_URL_PATTERN=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,allowedAttribute=(i,e)=>{const t=i.nodeName.toLowerCase();return e.includes(t)?uriAttributes.has(t)?!!SAFE_URL_PATTERN.test(i.nodeValue):!0:e.filter(r=>r instanceof RegExp).some(r=>r.test(t))};function sanitizeHtml(i,e,t){if(!i.length)return i;if(t&&typeof t=="function")return t(i);const a=new window.DOMParser().parseFromString(i,"text/html"),o=[].concat(...a.body.querySelectorAll("*"));for(const u of o){const c=u.nodeName.toLowerCase();if(!Object.keys(e).includes(c)){u.remove();continue}const h=[].concat(...u.attributes),d=[].concat(e["*"]||[],e[c]||[]);for(const p of h)allowedAttribute(p,d)||u.removeAttribute(p.nodeName)}return a.body.innerHTML}const NAME$5="TemplateFactory",Default$4={allowList:DefaultAllowlist,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},DefaultType$4={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},DefaultContentType={entry:"(string|element|function|null)",selector:"(string|element)"};class TemplateFactory extends Config$1{constructor(e){super(),this._config=this._getConfig(e)}static get Default(){return Default$4}static get DefaultType(){return DefaultType$4}static get NAME(){return NAME$5}getContent(){return Object.values(this._config.content).map(e=>this._resolvePossibleFunction(e)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(e){return this._checkContent(e),this._config.content={...this._config.content,...e},this}toHtml(){const e=document.createElement("div");e.innerHTML=this._maybeSanitize(this._config.template);for(const[a,o]of Object.entries(this._config.content))this._setContent(e,o,a);const t=e.children[0],r=this._resolvePossibleFunction(this._config.extraClass);return r&&t.classList.add(...r.split(" ")),t}_typeCheckConfig(e){super._typeCheckConfig(e),this._checkContent(e.content)}_checkContent(e){for(const[t,r]of Object.entries(e))super._typeCheckConfig({selector:t,entry:r},DefaultContentType)}_setContent(e,t,r){const a=SelectorEngine.findOne(r,e);if(a){if(t=this._resolvePossibleFunction(t),!t){a.remove();return}if(isElement(t)){this._putElementInTemplate(getElement(t),a);return}if(this._config.html){a.innerHTML=this._maybeSanitize(t);return}a.textContent=t}}_maybeSanitize(e){return this._config.sanitize?sanitizeHtml(e,this._config.allowList,this._config.sanitizeFn):e}_resolvePossibleFunction(e){return execute(e,[this])}_putElementInTemplate(e,t){if(this._config.html){t.innerHTML="",t.append(e);return}t.textContent=e.textContent}}const NAME$4="tooltip",DISALLOWED_ATTRIBUTES=new Set(["sanitize","allowList","sanitizeFn"]),CLASS_NAME_FADE$2="fade",CLASS_NAME_MODAL="modal",CLASS_NAME_SHOW$2="show",SELECTOR_TOOLTIP_INNER=".tooltip-inner",SELECTOR_MODAL=`.${CLASS_NAME_MODAL}`,EVENT_MODAL_HIDE="hide.bs.modal",TRIGGER_HOVER="hover",TRIGGER_FOCUS="focus",TRIGGER_CLICK="click",TRIGGER_MANUAL="manual",EVENT_HIDE$2="hide",EVENT_HIDDEN$2="hidden",EVENT_SHOW$2="show",EVENT_SHOWN$2="shown",EVENT_INSERTED="inserted",EVENT_CLICK$1="click",EVENT_FOCUSIN$1="focusin",EVENT_FOCUSOUT$1="focusout",EVENT_MOUSEENTER="mouseenter",EVENT_MOUSELEAVE="mouseleave",AttachmentMap={AUTO:"auto",TOP:"top",RIGHT:isRTL()?"left":"right",BOTTOM:"bottom",LEFT:isRTL()?"right":"left"},Default$3={allowList:DefaultAllowlist,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},DefaultType$3={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Tooltip extends BaseComponent{constructor(e,t){if(typeof Popper>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(e,t),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Default$3}static get DefaultType(){return DefaultType$3}static get NAME(){return NAME$4}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),EventHandler.off(this._element.closest(SELECTOR_MODAL),EVENT_MODAL_HIDE,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const e=EventHandler.trigger(this._element,this.constructor.eventName(EVENT_SHOW$2)),r=(findShadowRoot(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(e.defaultPrevented||!r)return;this._disposePopper();const a=this._getTipElement();this._element.setAttribute("aria-describedby",a.getAttribute("id"));const{container:o}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(o.append(a),EventHandler.trigger(this._element,this.constructor.eventName(EVENT_INSERTED))),this._popper=this._createPopper(a),a.classList.add(CLASS_NAME_SHOW$2),"ontouchstart"in document.documentElement)for(const c of[].concat(...document.body.children))EventHandler.on(c,"mouseover",noop);const u=()=>{EventHandler.trigger(this._element,this.constructor.eventName(EVENT_SHOWN$2)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(u,this.tip,this._isAnimated())}hide(){if(!this._isShown()||EventHandler.trigger(this._element,this.constructor.eventName(EVENT_HIDE$2)).defaultPrevented)return;if(this._getTipElement().classList.remove(CLASS_NAME_SHOW$2),"ontouchstart"in document.documentElement)for(const a of[].concat(...document.body.children))EventHandler.off(a,"mouseover",noop);this._activeTrigger[TRIGGER_CLICK]=!1,this._activeTrigger[TRIGGER_FOCUS]=!1,this._activeTrigger[TRIGGER_HOVER]=!1,this._isHovered=null;const r=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),EventHandler.trigger(this._element,this.constructor.eventName(EVENT_HIDDEN$2)))};this._queueCallback(r,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(e){const t=this._getTemplateFactory(e).toHtml();if(!t)return null;t.classList.remove(CLASS_NAME_FADE$2,CLASS_NAME_SHOW$2),t.classList.add(`bs-${this.constructor.NAME}-auto`);const r=getUID(this.constructor.NAME).toString();return t.setAttribute("id",r),this._isAnimated()&&t.classList.add(CLASS_NAME_FADE$2),t}setContent(e){this._newContent=e,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(e){return this._templateFactory?this._templateFactory.changeContent(e):this._templateFactory=new TemplateFactory({...this._config,content:e,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[SELECTOR_TOOLTIP_INNER]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(e){return this.constructor.getOrCreateInstance(e.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(CLASS_NAME_FADE$2)}_isShown(){return this.tip&&this.tip.classList.contains(CLASS_NAME_SHOW$2)}_createPopper(e){const t=execute(this._config.placement,[this,e,this._element]),r=AttachmentMap[t.toUpperCase()];return createPopper(this._element,e,this._getPopperConfig(r))}_getOffset(){const{offset:e}=this._config;return typeof e=="string"?e.split(",").map(t=>Number.parseInt(t,10)):typeof e=="function"?t=>e(t,this._element):e}_resolvePossibleFunction(e){return execute(e,[this._element])}_getPopperConfig(e){const t={placement:e,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:r=>{this._getTipElement().setAttribute("data-popper-placement",r.state.placement)}}]};return{...t,...execute(this._config.popperConfig,[t])}}_setListeners(){const e=this._config.trigger.split(" ");for(const t of e)if(t==="click")EventHandler.on(this._element,this.constructor.eventName(EVENT_CLICK$1),this._config.selector,r=>{this._initializeOnDelegatedTarget(r).toggle()});else if(t!==TRIGGER_MANUAL){const r=t===TRIGGER_HOVER?this.constructor.eventName(EVENT_MOUSEENTER):this.constructor.eventName(EVENT_FOCUSIN$1),a=t===TRIGGER_HOVER?this.constructor.eventName(EVENT_MOUSELEAVE):this.constructor.eventName(EVENT_FOCUSOUT$1);EventHandler.on(this._element,r,this._config.selector,o=>{const u=this._initializeOnDelegatedTarget(o);u._activeTrigger[o.type==="focusin"?TRIGGER_FOCUS:TRIGGER_HOVER]=!0,u._enter()}),EventHandler.on(this._element,a,this._config.selector,o=>{const u=this._initializeOnDelegatedTarget(o);u._activeTrigger[o.type==="focusout"?TRIGGER_FOCUS:TRIGGER_HOVER]=u._element.contains(o.relatedTarget),u._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},EventHandler.on(this._element.closest(SELECTOR_MODAL),EVENT_MODAL_HIDE,this._hideModalHandler)}_fixTitle(){const e=this._element.getAttribute("title");e&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",e),this._element.setAttribute("data-bs-original-title",e),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(e,t){clearTimeout(this._timeout),this._timeout=setTimeout(e,t)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(e){const t=Manipulator.getDataAttributes(this._element);for(const r of Object.keys(t))DISALLOWED_ATTRIBUTES.has(r)&&delete t[r];return e={...t,...typeof e=="object"&&e?e:{}},e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e.container=e.container===!1?document.body:getElement(e.container),typeof e.delay=="number"&&(e.delay={show:e.delay,hide:e.delay}),typeof e.title=="number"&&(e.title=e.title.toString()),typeof e.content=="number"&&(e.content=e.content.toString()),e}_getDelegateConfig(){const e={};for(const[t,r]of Object.entries(this._config))this.constructor.Default[t]!==r&&(e[t]=r);return e.selector=!1,e.trigger="manual",e}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(e){return this.each(function(){const t=Tooltip.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof t[e]>"u")throw new TypeError(`No method named "${e}"`);t[e]()}})}}defineJQueryPlugin(Tooltip);const NAME$3="popover",SELECTOR_TITLE=".popover-header",SELECTOR_CONTENT=".popover-body",Default$2={...Tooltip.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},DefaultType$2={...Tooltip.DefaultType,content:"(null|string|element|function)"};class Popover extends Tooltip{static get Default(){return Default$2}static get DefaultType(){return DefaultType$2}static get NAME(){return NAME$3}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[SELECTOR_TITLE]:this._getTitle(),[SELECTOR_CONTENT]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(e){return this.each(function(){const t=Popover.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof t[e]>"u")throw new TypeError(`No method named "${e}"`);t[e]()}})}}defineJQueryPlugin(Popover);const NAME$2="scrollspy",DATA_KEY$2="bs.scrollspy",EVENT_KEY$2=`.${DATA_KEY$2}`,DATA_API_KEY=".data-api",EVENT_ACTIVATE=`activate${EVENT_KEY$2}`,EVENT_CLICK=`click${EVENT_KEY$2}`,EVENT_LOAD_DATA_API$1=`load${EVENT_KEY$2}${DATA_API_KEY}`,CLASS_NAME_DROPDOWN_ITEM="dropdown-item",CLASS_NAME_ACTIVE$1="active",SELECTOR_DATA_SPY='[data-bs-spy="scroll"]',SELECTOR_TARGET_LINKS="[href]",SELECTOR_NAV_LIST_GROUP=".nav, .list-group",SELECTOR_NAV_LINKS=".nav-link",SELECTOR_NAV_ITEMS=".nav-item",SELECTOR_LIST_ITEMS=".list-group-item",SELECTOR_LINK_ITEMS=`${SELECTOR_NAV_LINKS}, ${SELECTOR_NAV_ITEMS} > ${SELECTOR_NAV_LINKS}, ${SELECTOR_LIST_ITEMS}`,SELECTOR_DROPDOWN=".dropdown",SELECTOR_DROPDOWN_TOGGLE$1=".dropdown-toggle",Default$1={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},DefaultType$1={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class ScrollSpy extends BaseComponent{constructor(e,t){super(e,t),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return Default$1}static get DefaultType(){return DefaultType$1}static get NAME(){return NAME$2}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const e of this._observableSections.values())this._observer.observe(e)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(e){return e.target=getElement(e.target)||document.body,e.rootMargin=e.offset?`${e.offset}px 0px -30%`:e.rootMargin,typeof e.threshold=="string"&&(e.threshold=e.threshold.split(",").map(t=>Number.parseFloat(t))),e}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(EventHandler.off(this._config.target,EVENT_CLICK),EventHandler.on(this._config.target,EVENT_CLICK,SELECTOR_TARGET_LINKS,e=>{const t=this._observableSections.get(e.target.hash);if(t){e.preventDefault();const r=this._rootElement||window,a=t.offsetTop-this._element.offsetTop;if(r.scrollTo){r.scrollTo({top:a,behavior:"smooth"});return}r.scrollTop=a}}))}_getNewObserver(){const e={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(t=>this._observerCallback(t),e)}_observerCallback(e){const t=u=>this._targetLinks.get(`#${u.target.id}`),r=u=>{this._previousScrollData.visibleEntryTop=u.target.offsetTop,this._process(t(u))},a=(this._rootElement||document.documentElement).scrollTop,o=a>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=a;for(const u of e){if(!u.isIntersecting){this._activeTarget=null,this._clearActiveClass(t(u));continue}const c=u.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(o&&c){if(r(u),!a)return;continue}!o&&!c&&r(u)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const e=SelectorEngine.find(SELECTOR_TARGET_LINKS,this._config.target);for(const t of e){if(!t.hash||isDisabled(t))continue;const r=SelectorEngine.findOne(decodeURI(t.hash),this._element);isVisible(r)&&(this._targetLinks.set(decodeURI(t.hash),t),this._observableSections.set(t.hash,r))}}_process(e){this._activeTarget!==e&&(this._clearActiveClass(this._config.target),this._activeTarget=e,e.classList.add(CLASS_NAME_ACTIVE$1),this._activateParents(e),EventHandler.trigger(this._element,EVENT_ACTIVATE,{relatedTarget:e}))}_activateParents(e){if(e.classList.contains(CLASS_NAME_DROPDOWN_ITEM)){SelectorEngine.findOne(SELECTOR_DROPDOWN_TOGGLE$1,e.closest(SELECTOR_DROPDOWN)).classList.add(CLASS_NAME_ACTIVE$1);return}for(const t of SelectorEngine.parents(e,SELECTOR_NAV_LIST_GROUP))for(const r of SelectorEngine.prev(t,SELECTOR_LINK_ITEMS))r.classList.add(CLASS_NAME_ACTIVE$1)}_clearActiveClass(e){e.classList.remove(CLASS_NAME_ACTIVE$1);const t=SelectorEngine.find(`${SELECTOR_TARGET_LINKS}.${CLASS_NAME_ACTIVE$1}`,e);for(const r of t)r.classList.remove(CLASS_NAME_ACTIVE$1)}static jQueryInterface(e){return this.each(function(){const t=ScrollSpy.getOrCreateInstance(this,e);if(typeof e=="string"){if(t[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);t[e]()}})}}EventHandler.on(window,EVENT_LOAD_DATA_API$1,()=>{for(const i of SelectorEngine.find(SELECTOR_DATA_SPY))ScrollSpy.getOrCreateInstance(i)});defineJQueryPlugin(ScrollSpy);const NAME$1="tab",DATA_KEY$1="bs.tab",EVENT_KEY$1=`.${DATA_KEY$1}`,EVENT_HIDE$1=`hide${EVENT_KEY$1}`,EVENT_HIDDEN$1=`hidden${EVENT_KEY$1}`,EVENT_SHOW$1=`show${EVENT_KEY$1}`,EVENT_SHOWN$1=`shown${EVENT_KEY$1}`,EVENT_CLICK_DATA_API=`click${EVENT_KEY$1}`,EVENT_KEYDOWN=`keydown${EVENT_KEY$1}`,EVENT_LOAD_DATA_API=`load${EVENT_KEY$1}`,ARROW_LEFT_KEY="ArrowLeft",ARROW_RIGHT_KEY="ArrowRight",ARROW_UP_KEY="ArrowUp",ARROW_DOWN_KEY="ArrowDown",HOME_KEY="Home",END_KEY="End",CLASS_NAME_ACTIVE="active",CLASS_NAME_FADE$1="fade",CLASS_NAME_SHOW$1="show",CLASS_DROPDOWN="dropdown",SELECTOR_DROPDOWN_TOGGLE=".dropdown-toggle",SELECTOR_DROPDOWN_MENU=".dropdown-menu",NOT_SELECTOR_DROPDOWN_TOGGLE=`:not(${SELECTOR_DROPDOWN_TOGGLE})`,SELECTOR_TAB_PANEL='.list-group, .nav, [role="tablist"]',SELECTOR_OUTER=".nav-item, .list-group-item",SELECTOR_INNER=`.nav-link${NOT_SELECTOR_DROPDOWN_TOGGLE}, .list-group-item${NOT_SELECTOR_DROPDOWN_TOGGLE}, [role="tab"]${NOT_SELECTOR_DROPDOWN_TOGGLE}`,SELECTOR_DATA_TOGGLE='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',SELECTOR_INNER_ELEM=`${SELECTOR_INNER}, ${SELECTOR_DATA_TOGGLE}`,SELECTOR_DATA_TOGGLE_ACTIVE=`.${CLASS_NAME_ACTIVE}[data-bs-toggle="tab"], .${CLASS_NAME_ACTIVE}[data-bs-toggle="pill"], .${CLASS_NAME_ACTIVE}[data-bs-toggle="list"]`;class Tab extends BaseComponent{constructor(e){super(e),this._parent=this._element.closest(SELECTOR_TAB_PANEL),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),EventHandler.on(this._element,EVENT_KEYDOWN,t=>this._keydown(t)))}static get NAME(){return NAME$1}show(){const e=this._element;if(this._elemIsActive(e))return;const t=this._getActiveElem(),r=t?EventHandler.trigger(t,EVENT_HIDE$1,{relatedTarget:e}):null;EventHandler.trigger(e,EVENT_SHOW$1,{relatedTarget:t}).defaultPrevented||r&&r.defaultPrevented||(this._deactivate(t,e),this._activate(e,t))}_activate(e,t){if(!e)return;e.classList.add(CLASS_NAME_ACTIVE),this._activate(SelectorEngine.getElementFromSelector(e));const r=()=>{if(e.getAttribute("role")!=="tab"){e.classList.add(CLASS_NAME_SHOW$1);return}e.removeAttribute("tabindex"),e.setAttribute("aria-selected",!0),this._toggleDropDown(e,!0),EventHandler.trigger(e,EVENT_SHOWN$1,{relatedTarget:t})};this._queueCallback(r,e,e.classList.contains(CLASS_NAME_FADE$1))}_deactivate(e,t){if(!e)return;e.classList.remove(CLASS_NAME_ACTIVE),e.blur(),this._deactivate(SelectorEngine.getElementFromSelector(e));const r=()=>{if(e.getAttribute("role")!=="tab"){e.classList.remove(CLASS_NAME_SHOW$1);return}e.setAttribute("aria-selected",!1),e.setAttribute("tabindex","-1"),this._toggleDropDown(e,!1),EventHandler.trigger(e,EVENT_HIDDEN$1,{relatedTarget:t})};this._queueCallback(r,e,e.classList.contains(CLASS_NAME_FADE$1))}_keydown(e){if(![ARROW_LEFT_KEY,ARROW_RIGHT_KEY,ARROW_UP_KEY,ARROW_DOWN_KEY,HOME_KEY,END_KEY].includes(e.key))return;e.stopPropagation(),e.preventDefault();const t=this._getChildren().filter(a=>!isDisabled(a));let r;if([HOME_KEY,END_KEY].includes(e.key))r=t[e.key===HOME_KEY?0:t.length-1];else{const a=[ARROW_RIGHT_KEY,ARROW_DOWN_KEY].includes(e.key);r=getNextActiveElement(t,e.target,a,!0)}r&&(r.focus({preventScroll:!0}),Tab.getOrCreateInstance(r).show())}_getChildren(){return SelectorEngine.find(SELECTOR_INNER_ELEM,this._parent)}_getActiveElem(){return this._getChildren().find(e=>this._elemIsActive(e))||null}_setInitialAttributes(e,t){this._setAttributeIfNotExists(e,"role","tablist");for(const r of t)this._setInitialAttributesOnChild(r)}_setInitialAttributesOnChild(e){e=this._getInnerElement(e);const t=this._elemIsActive(e),r=this._getOuterElement(e);e.setAttribute("aria-selected",t),r!==e&&this._setAttributeIfNotExists(r,"role","presentation"),t||e.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(e,"role","tab"),this._setInitialAttributesOnTargetPanel(e)}_setInitialAttributesOnTargetPanel(e){const t=SelectorEngine.getElementFromSelector(e);t&&(this._setAttributeIfNotExists(t,"role","tabpanel"),e.id&&this._setAttributeIfNotExists(t,"aria-labelledby",`${e.id}`))}_toggleDropDown(e,t){const r=this._getOuterElement(e);if(!r.classList.contains(CLASS_DROPDOWN))return;const a=(o,u)=>{const c=SelectorEngine.findOne(o,r);c&&c.classList.toggle(u,t)};a(SELECTOR_DROPDOWN_TOGGLE,CLASS_NAME_ACTIVE),a(SELECTOR_DROPDOWN_MENU,CLASS_NAME_SHOW$1),r.setAttribute("aria-expanded",t)}_setAttributeIfNotExists(e,t,r){e.hasAttribute(t)||e.setAttribute(t,r)}_elemIsActive(e){return e.classList.contains(CLASS_NAME_ACTIVE)}_getInnerElement(e){return e.matches(SELECTOR_INNER_ELEM)?e:SelectorEngine.findOne(SELECTOR_INNER_ELEM,e)}_getOuterElement(e){return e.closest(SELECTOR_OUTER)||e}static jQueryInterface(e){return this.each(function(){const t=Tab.getOrCreateInstance(this);if(typeof e=="string"){if(t[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);t[e]()}})}}EventHandler.on(document,EVENT_CLICK_DATA_API,SELECTOR_DATA_TOGGLE,function(i){["A","AREA"].includes(this.tagName)&&i.preventDefault(),!isDisabled(this)&&Tab.getOrCreateInstance(this).show()});EventHandler.on(window,EVENT_LOAD_DATA_API,()=>{for(const i of SelectorEngine.find(SELECTOR_DATA_TOGGLE_ACTIVE))Tab.getOrCreateInstance(i)});defineJQueryPlugin(Tab);const NAME$g="toast",DATA_KEY="bs.toast",EVENT_KEY=`.${DATA_KEY}`,EVENT_MOUSEOVER=`mouseover${EVENT_KEY}`,EVENT_MOUSEOUT=`mouseout${EVENT_KEY}`,EVENT_FOCUSIN=`focusin${EVENT_KEY}`,EVENT_FOCUSOUT=`focusout${EVENT_KEY}`,EVENT_HIDE=`hide${EVENT_KEY}`,EVENT_HIDDEN=`hidden${EVENT_KEY}`,EVENT_SHOW=`show${EVENT_KEY}`,EVENT_SHOWN=`shown${EVENT_KEY}`,CLASS_NAME_FADE="fade",CLASS_NAME_HIDE="hide",CLASS_NAME_SHOW="show",CLASS_NAME_SHOWING="showing",DefaultType={animation:"boolean",autohide:"boolean",delay:"number"},Default={animation:!0,autohide:!0,delay:5e3};class Toast extends BaseComponent{constructor(e,t){super(e,t),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Default}static get DefaultType(){return DefaultType}static get NAME(){return NAME$g}show(){if(EventHandler.trigger(this._element,EVENT_SHOW).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(CLASS_NAME_FADE);const t=()=>{this._element.classList.remove(CLASS_NAME_SHOWING),EventHandler.trigger(this._element,EVENT_SHOWN),this._maybeScheduleHide()};this._element.classList.remove(CLASS_NAME_HIDE),reflow(this._element),this._element.classList.add(CLASS_NAME_SHOW,CLASS_NAME_SHOWING),this._queueCallback(t,this._element,this._config.animation)}hide(){if(!this.isShown()||EventHandler.trigger(this._element,EVENT_HIDE).defaultPrevented)return;const t=()=>{this._element.classList.add(CLASS_NAME_HIDE),this._element.classList.remove(CLASS_NAME_SHOWING,CLASS_NAME_SHOW),EventHandler.trigger(this._element,EVENT_HIDDEN)};this._element.classList.add(CLASS_NAME_SHOWING),this._queueCallback(t,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(CLASS_NAME_SHOW),super.dispose()}isShown(){return this._element.classList.contains(CLASS_NAME_SHOW)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(e,t){switch(e.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=t;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=t;break}}if(t){this._clearTimeout();return}const r=e.relatedTarget;this._element===r||this._element.contains(r)||this._maybeScheduleHide()}_setListeners(){EventHandler.on(this._element,EVENT_MOUSEOVER,e=>this._onInteraction(e,!0)),EventHandler.on(this._element,EVENT_MOUSEOUT,e=>this._onInteraction(e,!1)),EventHandler.on(this._element,EVENT_FOCUSIN,e=>this._onInteraction(e,!0)),EventHandler.on(this._element,EVENT_FOCUSOUT,e=>this._onInteraction(e,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(e){return this.each(function(){const t=Toast.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof t[e]>"u")throw new TypeError(`No method named "${e}"`);t[e](this)}})}}enableDismissTrigger(Toast);defineJQueryPlugin(Toast);/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */var ReferenceType;(function(i){i.RELATIVE="RELATIVE",i.ABSOLUTE="ABSOLUTE"})(ReferenceType||(ReferenceType={}));class ColumnAddress{constructor(e,t,r){this.type=e,this.col=t,this.sheet=r}static absolute(e,t){return new ColumnAddress(ReferenceType.ABSOLUTE,e,t)}static relative(e,t){return new ColumnAddress(ReferenceType.RELATIVE,e,t)}static compareByAbsoluteAddress(e){return(t,r)=>t.toSimpleColumnAddress(e).col-r.toSimpleColumnAddress(e).col}isColumnAbsolute(){return this.type===ReferenceType.ABSOLUTE}isColumnRelative(){return this.type===ReferenceType.RELATIVE}isAbsolute(){return this.type===ReferenceType.ABSOLUTE&&this.sheet!==void 0}moved(e,t,r){const a=this.sheet===void 0?void 0:e;return new ColumnAddress(this.type,this.col+t,a)}shiftedByColumns(e){return new ColumnAddress(this.type,this.col+e,this.sheet)}toSimpleColumnAddress(e){const t=absoluteSheetReference(this,e);let r=this.col;return this.isColumnRelative()&&(r=e.col+this.col),simpleColumnAddress(t,r)}shiftRelativeDimensions(e,t){const r=this.isColumnRelative()?this.col+e:this.col;return new ColumnAddress(this.type,r,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isColumnAbsolute()?this.col+e:this.col;return new ColumnAddress(this.type,r,this.sheet)}withSheet(e){return new ColumnAddress(this.type,this.col,e)}isInvalid(e){return this.toSimpleColumnAddress(e).col<0}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case ReferenceType.RELATIVE:return`${t}#COLR${this.col}`;case ReferenceType.ABSOLUTE:return`${t}#COLA${this.col}`}}unparse(e){const t=this.toSimpleColumnAddress(e);if(invalidSimpleColumnAddress(t))return;const r=columnIndexToLabel(t.col);return`${this.type===ReferenceType.ABSOLUTE?"$":""}${r}`}exceedsSheetSizeLimits(e){return this.col>=e}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class RowAddress{constructor(e,t,r){this.type=e,this.row=t,this.sheet=r}static absolute(e,t){return new RowAddress(ReferenceType.ABSOLUTE,e,t)}static relative(e,t){return new RowAddress(ReferenceType.RELATIVE,e,t)}static compareByAbsoluteAddress(e){return(t,r)=>t.toSimpleRowAddress(e).row-r.toSimpleRowAddress(e).row}isRowAbsolute(){return this.type===ReferenceType.ABSOLUTE}isRowRelative(){return this.type===ReferenceType.RELATIVE}isAbsolute(){return this.type===ReferenceType.ABSOLUTE&&this.sheet!==void 0}moved(e,t,r){const a=this.sheet===void 0?void 0:e;return new RowAddress(this.type,this.row+r,a)}shiftedByRows(e){return new RowAddress(this.type,this.row+e,this.sheet)}toSimpleRowAddress(e){const t=absoluteSheetReference(this,e);let r=this.row;return this.isRowRelative()&&(r=e.row+this.row),simpleRowAddress(t,r)}shiftRelativeDimensions(e,t){const r=this.isRowRelative()?this.row+t:this.row;return new RowAddress(this.type,r,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isRowAbsolute()?this.row+t:this.row;return new RowAddress(this.type,r,this.sheet)}withSheet(e){return new RowAddress(this.type,this.row,e)}isInvalid(e){return this.toSimpleRowAddress(e).row<0}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case ReferenceType.RELATIVE:return`${t}#ROWR${this.row}`;case ReferenceType.ABSOLUTE:return`${t}#ROWA${this.row}`}}unparse(e){const t=this.toSimpleRowAddress(e);return invalidSimpleRowAddress(t)?void 0:`${this.type===ReferenceType.ABSOLUTE?"$":""}${t.row+1}`}exceedsSheetSizeLimits(e){return this.row>=e}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */var CellReferenceType;(function(i){i.CELL_REFERENCE_RELATIVE="CELL_REFERENCE",i.CELL_REFERENCE_ABSOLUTE="CELL_REFERENCE_ABSOLUTE",i.CELL_REFERENCE_ABSOLUTE_COL="CELL_REFERENCE_ABSOLUTE_COL",i.CELL_REFERENCE_ABSOLUTE_ROW="CELL_REFERENCE_ABSOLUTE_ROW"})(CellReferenceType||(CellReferenceType={}));class CellAddress{constructor(e,t,r,a){this.col=e,this.row=t,this.type=r,this.sheet=a}static fromColAndRow(e,t,r){return(e.isColumnAbsolute()&&t.isRowAbsolute()?CellAddress.absolute.bind(this):e.isColumnAbsolute()?CellAddress.absoluteCol.bind(this):t.isRowAbsolute()?CellAddress.absoluteRow.bind(this):CellAddress.relative.bind(this))(e.col,t.row,r)}static relative(e,t,r){return new CellAddress(e,t,CellReferenceType.CELL_REFERENCE_RELATIVE,r)}static absolute(e,t,r){return new CellAddress(e,t,CellReferenceType.CELL_REFERENCE_ABSOLUTE,r)}static absoluteCol(e,t,r){return new CellAddress(e,t,CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL,r)}static absoluteRow(e,t,r){return new CellAddress(e,t,CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW,r)}toSimpleCellAddress(e){const t=absoluteSheetReference(this,e);return this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE?simpleCellAddress(t,this.col,this.row):this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW?simpleCellAddress(t,e.col+this.col,this.row):this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL?simpleCellAddress(t,this.col,e.row+this.row):simpleCellAddress(t,e.col+this.col,e.row+this.row)}toColumnAddress(){const e=this.isColumnRelative()?ReferenceType.RELATIVE:ReferenceType.ABSOLUTE;return new ColumnAddress(e,this.col,this.sheet)}toRowAddress(){const e=this.isRowRelative()?ReferenceType.RELATIVE:ReferenceType.ABSOLUTE;return new RowAddress(e,this.row,this.sheet)}toSimpleColumnAddress(e){const t=absoluteSheetReference(this,e);let r=this.col;return this.isColumnRelative()&&(r+=e.col),simpleColumnAddress(t,r)}toSimpleRowAddress(e){const t=absoluteSheetReference(this,e);let r=this.row;return this.isRowRelative()&&(r+=e.row),simpleRowAddress(t,r)}isRowAbsolute(){return this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW}isColumnAbsolute(){return this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL}isColumnRelative(){return this.type===CellReferenceType.CELL_REFERENCE_RELATIVE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW}isRowRelative(){return this.type===CellReferenceType.CELL_REFERENCE_RELATIVE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL}isAbsolute(){return this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE&&this.sheet!==void 0}shiftedByRows(e){return new CellAddress(this.col,this.row+e,this.type,this.sheet)}shiftedByColumns(e){return new CellAddress(this.col+e,this.row,this.type,this.sheet)}moved(e,t,r){const a=this.sheet===void 0?void 0:e;return new CellAddress(this.col+t,this.row+r,this.type,a)}withSheet(e){return new CellAddress(this.col,this.row,this.type,e)}isInvalid(e){return invalidSimpleCellAddress(this.toSimpleCellAddress(e))}shiftRelativeDimensions(e,t){const r=this.isColumnAbsolute()?this.col:this.col+e,a=this.isRowAbsolute()?this.row:this.row+t;return new CellAddress(r,a,this.type,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isColumnRelative()?this.col:this.col+e,a=this.isRowRelative()?this.row:this.row+t;return new CellAddress(r,a,this.type,this.sheet)}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case CellReferenceType.CELL_REFERENCE_RELATIVE:return`${t}#${this.row}R${this.col}`;case CellReferenceType.CELL_REFERENCE_ABSOLUTE:return`${t}#${this.row}A${this.col}`;case CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL:return`${t}#${this.row}AC${this.col}`;case CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW:return`${t}#${this.row}AR${this.col}`}}unparse(e){const t=this.toSimpleCellAddress(e);if(invalidSimpleCellAddress(t))return;const r=columnIndexToLabel(t.col),a=this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW?"$":"";return`${this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL?"$":""}${r}${a}${t.row+1}`}exceedsSheetSizeLimits(e,t){return this.row>=t||this.col>=e}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const RANGE_OPERATOR=":",ABSOLUTE_OPERATOR="$",ALL_WHITESPACE_PATTERN="\\s+",ODFF_WHITESPACE_PATTERN="[ \\t\\n\\r]+",UNICODE_LETTER_PATTERN="A-Za-z-",NON_RESERVED_CHARACTER_PATTERN=`${UNICODE_LETTER_PATTERN}0-9_.`,UNQUOTED_SHEET_NAME_PATTERN=`[${UNICODE_LETTER_PATTERN}0-9_]+`,QUOTED_SHEET_NAME_PATTERN="'(((?!').|'')*)'",SHEET_NAME_PATTERN=`(${UNQUOTED_SHEET_NAME_PATTERN}|${QUOTED_SHEET_NAME_PATTERN})!`,CELL_REFERENCE_PATTERN=`(${SHEET_NAME_PATTERN})?\\${ABSOLUTE_OPERATOR}?[A-Za-z]+\\${ABSOLUTE_OPERATOR}?[0-9]+`,COLUMN_REFERENCE_PATTERN=`(${SHEET_NAME_PATTERN})?\\${ABSOLUTE_OPERATOR}?[A-Za-z]+`,ROW_REFERENCE_PATTERN=`(${SHEET_NAME_PATTERN})?\\${ABSOLUTE_OPERATOR}?[0-9]+`,R1C1_CELL_REFERENCE_PATTERN="[rR][0-9]*[cC][0-9]*",CELL_REFERENCE_WITH_NEXT_CHARACTER_PATTERN=`(${CELL_REFERENCE_PATTERN})[^${NON_RESERVED_CHARACTER_PATTERN}]`,NAMED_EXPRESSION_PATTERN=`[${UNICODE_LETTER_PATTERN}_][${NON_RESERVED_CHARACTER_PATTERN}]*`,ALL_DIGITS_ARRAY=["0","1","2","3","4","5","6","7","8","9"],ALL_UNICODE_LETTERS_ARRAY=[...Array.from(Array(26)).map((i,e)=>e+65),...Array.from(Array(26)).map((i,e)=>e+97),...Array.from(Array(496)).map((i,e)=>e+192)].map(i=>String.fromCharCode(i));/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const addressRegex=new RegExp(`^(${SHEET_NAME_PATTERN})?(\\${ABSOLUTE_OPERATOR}?)([A-Za-z]+)(\\${ABSOLUTE_OPERATOR}?)([0-9]+)$`),columnRegex=new RegExp(`^(${SHEET_NAME_PATTERN})?(\\${ABSOLUTE_OPERATOR}?)([A-Za-z]+)$`),rowRegex=new RegExp(`^(${SHEET_NAME_PATTERN})?(\\${ABSOLUTE_OPERATOR}?)([0-9]+)$`),simpleSheetNameRegex=new RegExp(`^${UNQUOTED_SHEET_NAME_PATTERN}$`),cellAddressFromString=(i,e,t)=>{const r=addressRegex.exec(e),a=columnLabelToIndex(r[6]);let o=extractSheetNumber(r,i);if(o===void 0)return;o===null&&(o=void 0);const u=Number(r[8])-1;return r[5]===ABSOLUTE_OPERATOR&&r[7]===ABSOLUTE_OPERATOR?CellAddress.absolute(a,u,o):r[5]===ABSOLUTE_OPERATOR?CellAddress.absoluteCol(a,u-t.row,o):r[7]===ABSOLUTE_OPERATOR?CellAddress.absoluteRow(a-t.col,u,o):CellAddress.relative(a-t.col,u-t.row,o)},columnAddressFromString=(i,e,t)=>{const r=columnRegex.exec(e);let a=extractSheetNumber(r,i);if(a===void 0)return;a===null&&(a=void 0);const o=columnLabelToIndex(r[6]);return r[5]===ABSOLUTE_OPERATOR?ColumnAddress.absolute(o,a):ColumnAddress.relative(o-t.col,a)},rowAddressFromString=(i,e,t)=>{const r=rowRegex.exec(e);let a=extractSheetNumber(r,i);if(a===void 0)return;a===null&&(a=void 0);const o=Number(r[6])-1;return r[5]===ABSOLUTE_OPERATOR?RowAddress.absolute(o,a):RowAddress.relative(o-t.row,a)},simpleCellAddressFromString=(i,e,t)=>{const r=addressRegex.exec(e);if(!r)return;const a=columnLabelToIndex(r[6]);let o=extractSheetNumber(r,i);if(o===void 0)return;o===null&&(o=t);const u=Number(r[8])-1;return simpleCellAddress(o,a,u)},simpleCellRangeFromString=(i,e,t)=>{const r=e.split(RANGE_OPERATOR);if(r.length!==2)return;const[a,o]=r,u=simpleCellAddressFromString(i,a,t);if(u===void 0)return;const c=simpleCellAddressFromString(i,o,u.sheet);if(c!==void 0&&u.sheet===c.sheet)return simpleCellRange(u,c)},simpleCellAddressToString=(i,e,t)=>{const r=columnIndexToLabel(e.col),a=sheetIndexToString(e.sheet,i);if(a!==void 0)return t!==e.sheet?`${a}!${r}${e.row+1}`:`${r}${e.row+1}`},simpleCellRangeToString=(i,e,t)=>{const r=simpleCellAddressToString(i,e.start,t),a=simpleCellAddressToString(i,e.end,e.start.sheet);if(!(r===void 0||a===void 0))return`${r}${RANGE_OPERATOR}${a}`};function columnLabelToIndex(i){return i.length===1?i.toUpperCase().charCodeAt(0)-65:i.split("").reduce((e,t)=>e*26+(t.toUpperCase().charCodeAt(0)-64),0)-1}function columnIndexToLabel(i){let e="";for(;i>=0;)e=String.fromCharCode(i%26+97)+e,i=Math.floor(i/26)-1;return e.toUpperCase()}function sheetIndexToString(i,e){let t=e(i);if(t!==void 0)return simpleSheetNameRegex.test(t)?t:(t=t.replace(/'/g,"''"),`'${t}'`)}function extractSheetNumber(i,e){var t;let r=(t=i[3])!==null&&t!==void 0?t:i[2];return r?(r=r.replace(/''/g,"'"),e(r)):null}function isEmpty(i){return i&&i.length===0}function keys(i){return i==null?[]:Object.keys(i)}function values(i){for(var e=[],t=Object.keys(i),r=0;r<t.length;r++)e.push(i[t[r]]);return e}function mapValues(i,e){for(var t=[],r=keys(i),a=0;a<r.length;a++){var o=r[a];t.push(e.call(null,i[o],o))}return t}function map(i,e){for(var t=[],r=0;r<i.length;r++)t.push(e.call(null,i[r],r));return t}function flatten(i){for(var e=[],t=0;t<i.length;t++){var r=i[t];Array.isArray(r)?e=e.concat(flatten(r)):e.push(r)}return e}function first$1(i){return isEmpty(i)?void 0:i[0]}function last(i){var e=i&&i.length;return e?i[e-1]:void 0}function forEach(i,e){if(Array.isArray(i))for(var t=0;t<i.length;t++)e.call(null,i[t],t);else if(isObject(i))for(var r=keys(i),t=0;t<r.length;t++){var a=r[t],o=i[a];e.call(null,o,a)}else throw Error("non exhaustive match")}function isString(i){return typeof i=="string"}function isUndefined(i){return i===void 0}function isFunction(i){return i instanceof Function}function drop(i,e){return e===void 0&&(e=1),i.slice(e,i.length)}function dropRight(i,e){return e===void 0&&(e=1),i.slice(0,i.length-e)}function filter(i,e){var t=[];if(Array.isArray(i))for(var r=0;r<i.length;r++){var a=i[r];e.call(null,a)&&t.push(a)}return t}function reject(i,e){return filter(i,function(t){return!e(t)})}function pick(i,e){for(var t=Object.keys(i),r={},a=0;a<t.length;a++){var o=t[a],u=i[o];e(u)&&(r[o]=u)}return r}function has(i,e){return isObject(i)?i.hasOwnProperty(e):!1}function contains(i,e){return find(i,function(t){return t===e})!==void 0}function cloneArr(i){for(var e=[],t=0;t<i.length;t++)e.push(i[t]);return e}function cloneObj(i){var e={};for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t]);return e}function find(i,e){for(var t=0;t<i.length;t++){var r=i[t];if(e.call(null,r))return r}}function findAll(i,e){for(var t=[],r=0;r<i.length;r++){var a=i[r];e.call(null,a)&&t.push(a)}return t}function reduce(i,e,t){for(var r=Array.isArray(i),a=r?i:values(i),o=r?[]:keys(i),u=t,c=0;c<a.length;c++)u=e.call(null,u,a[c],r?c:o[c]);return u}function compact(i){return reject(i,function(e){return e==null})}function uniq(i,e){e===void 0&&(e=function(r){return r});var t=[];return reduce(i,function(r,a){var o=e(a);return contains(t,o)?r:(t.push(o),r.concat(a))},[])}function isArray(i){return Array.isArray(i)}function isRegExp(i){return i instanceof RegExp}function isObject(i){return i instanceof Object}function every(i,e){for(var t=0;t<i.length;t++)if(!e(i[t],t))return!1;return!0}function difference(i,e){return reject(i,function(t){return contains(e,t)})}function some(i,e){for(var t=0;t<i.length;t++)if(e(i[t]))return!0;return!1}function indexOf(i,e){for(var t=0;t<i.length;t++)if(i[t]===e)return t;return-1}function assign(i){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var r=0;r<e.length;r++)for(var a=e[r],o=keys(a),u=0;u<o.length;u++){var c=o[u];i[c]=a[c]}return i}function assignNoOverwrite(i){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var r=0;r<e.length;r++){var a=e[r];if(!isUndefined(a))for(var o=keys(a),u=0;u<o.length;u++){var c=o[u];has(i,c)||(i[c]=a[c])}}return i}function defaults(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return assignNoOverwrite.apply(null,[{}].concat(i))}function groupBy(i,e){var t={};return forEach(i,function(r){var a=e(r),o=t[a];o?o.push(r):t[a]=[r]}),t}function merge(i,e){for(var t=cloneObj(i),r=keys(e),a=0;a<r.length;a++){var o=r[a],u=e[o];t[o]=u}return t}function NOOP(){}function IDENTITY(i){return i}function packArray(i){for(var e=[],t=0;t<i.length;t++){var r=i[t];e.push(r!==void 0?r:void 0)}return e}function PRINT_ERROR(i){console&&console.error&&console.error("Error: "+i)}function PRINT_WARNING(i){console&&console.warn&&console.warn("Warning: "+i)}function isES2015MapSupported(){return typeof Map=="function"}function applyMixins(i,e){e.forEach(function(t){var r=t.prototype;Object.getOwnPropertyNames(r).forEach(function(a){if(a!=="constructor"){var o=Object.getOwnPropertyDescriptor(r,a);o&&(o.get||o.set)?Object.defineProperty(i.prototype,a,o):i.prototype[a]=t.prototype[a]}})})}function toFastProperties(i){function e(){}e.prototype=i;var t=new e;function r(){return typeof t.bar}return r(),r(),i}function peek(i){return i[i.length-1]}function timer(i){var e=new Date().getTime(),t=i(),r=new Date().getTime(),a=r-e;return{time:a,value:t}}var regexpToAst={exports:{}};(function(i){(function(e,t){i.exports?i.exports=t():e.regexpToAst=t()})(typeof self<"u"?self:commonjsGlobal,function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(T){this.idx=T.idx,this.input=T.input,this.groupIdx=T.groupIdx},e.prototype.pattern=function(T){this.idx=0,this.input=T,this.groupIdx=0,this.consumeChar("/");var A=this.disjunction();this.consumeChar("/");for(var R={type:"Flags",global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":c(R,"global");break;case"i":c(R,"ignoreCase");break;case"m":c(R,"multiLine");break;case"u":c(R,"unicode");break;case"y":c(R,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:R,value:A}},e.prototype.disjunction=function(){var T=[];for(T.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),T.push(this.alternative());return{type:"Disjunction",value:T}},e.prototype.alternative=function(){for(var T=[];this.isTerm();)T.push(this.term());return{type:"Alternative",value:T}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){switch(this.popChar()){case"^":return{type:"StartAnchor"};case"$":return{type:"EndAnchor"};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary"};case"B":return{type:"NonWordBoundary"}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");var T;switch(this.popChar()){case"=":T="Lookahead";break;case"!":T="NegativeLookahead";break}h(T);var A=this.disjunction();return this.consumeChar(")"),{type:T,value:A}}d()},e.prototype.quantifier=function(T){var A;switch(this.popChar()){case"*":A={atLeast:0,atMost:1/0};break;case"+":A={atLeast:1,atMost:1/0};break;case"?":A={atLeast:0,atMost:1};break;case"{":var R=this.integerIncludingZero();switch(this.popChar()){case"}":A={atLeast:R,atMost:R};break;case",":var C;this.isDigit()?(C=this.integerIncludingZero(),A={atLeast:R,atMost:C}):A={atLeast:R,atMost:1/0},this.consumeChar("}");break}if(T===!0&&A===void 0)return;h(A);break}if(!(T===!0&&A===void 0))return h(A),this.peekChar(0)==="?"?(this.consumeChar("?"),A.greedy=!1):A.greedy=!0,A.type="Quantifier",A},e.prototype.atom=function(){var T;switch(this.peekChar()){case".":T=this.dotAll();break;case"\\":T=this.atomEscape();break;case"[":T=this.characterClass();break;case"(":T=this.group();break}return T===void 0&&this.isPatternCharacter()&&(T=this.patternCharacter()),h(T),this.isQuantifier()&&(T.quantifier=this.quantifier()),T},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[o(`
`),o("\r"),o("\u2028"),o("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){var T=this.positiveInteger();return{type:"GroupBackReference",value:T}},e.prototype.characterClassEscape=function(){var T,A=!1;switch(this.popChar()){case"d":T=m;break;case"D":T=m,A=!0;break;case"s":T=g;break;case"S":T=g,A=!0;break;case"w":T=f;break;case"W":T=f,A=!0;break}return h(T),{type:"Set",value:T,complement:A}},e.prototype.controlEscapeAtom=function(){var T;switch(this.popChar()){case"f":T=o("\f");break;case"n":T=o(`
`);break;case"r":T=o("\r");break;case"t":T=o("	");break;case"v":T=o("\v");break}return h(T),{type:"Character",value:T}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var T=this.popChar();if(/[a-zA-Z]/.test(T)===!1)throw Error("Invalid ");var A=T.toUpperCase().charCodeAt(0)-64;return{type:"Character",value:A}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:o("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){var T=this.popChar();return{type:"Character",value:o(T)}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:var T=this.popChar();return{type:"Character",value:o(T)}}},e.prototype.characterClass=function(){var T=[],A=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),A=!0);this.isClassAtom();){var R=this.classAtom(),C=R.type==="Character";if(C&&this.isRangeDash()){this.consumeChar("-");var N=this.classAtom(),S=N.type==="Character";if(S){if(N.value<R.value)throw Error("Range out of order in character class");T.push({from:R.value,to:N.value})}else u(R.value,T),T.push(o("-")),u(N.value,T)}else u(R.value,T)}return this.consumeChar("]"),{type:"Set",complement:A,value:T}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:o("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var T=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),T=!1;break;default:this.groupIdx++;break}var A=this.disjunction();this.consumeChar(")");var R={type:"Group",capturing:T,value:A};return T&&(R.idx=this.groupIdx),R},e.prototype.positiveInteger=function(){var T=this.popChar();if(a.test(T)===!1)throw Error("Expecting a positive integer");for(;r.test(this.peekChar(0));)T+=this.popChar();return parseInt(T,10)},e.prototype.integerIncludingZero=function(){var T=this.popChar();if(r.test(T)===!1)throw Error("Expecting an integer");for(;r.test(this.peekChar(0));)T+=this.popChar();return parseInt(T,10)},e.prototype.patternCharacter=function(){var T=this.popChar();switch(T){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:o(T)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return this.peekChar()==="-"&&this.isClassAtom(1)},e.prototype.isDigit=function(){return r.test(this.peekChar(0))},e.prototype.isClassAtom=function(T){switch(T===void 0&&(T=0),this.peekChar(T)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}},e.prototype.isQuantifier=function(){var T=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(T)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(T){for(var A="",R=0;R<T;R++){var C=this.popChar();if(t.test(C)===!1)throw Error("Expecting a HexDecimal digits");A+=C}var N=parseInt(A,16);return{type:"Character",value:N}},e.prototype.peekChar=function(T){return T===void 0&&(T=0),this.input[this.idx+T]},e.prototype.popChar=function(){var T=this.peekChar(0);return this.consumeChar(),T},e.prototype.consumeChar=function(T){if(T!==void 0&&this.input[this.idx]!==T)throw Error("Expected: '"+T+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++};var t=/[0-9a-fA-F]/,r=/[0-9]/,a=/[1-9]/;function o(T){return T.charCodeAt(0)}function u(T,A){T.length!==void 0?T.forEach(function(R){A.push(R)}):A.push(T)}function c(T,A){if(T[A]===!0)throw"duplicate flag "+A;T[A]=!0}function h(T){if(T===void 0)throw Error("Internal Error - Should never get here!")}function d(){throw Error("Internal Error - Should never get here!")}var p,m=[];for(p=o("0");p<=o("9");p++)m.push(p);var f=[o("_")].concat(m);for(p=o("a");p<=o("z");p++)f.push(p);for(p=o("A");p<=o("Z");p++)f.push(p);var g=[o(" "),o("\f"),o(`
`),o("\r"),o("	"),o("\v"),o("	"),o(""),o(""),o(""),o(""),o(""),o(""),o(""),o(""),o(""),o(""),o(""),o(""),o(""),o("\u2028"),o("\u2029"),o(""),o(""),o(""),o("\uFEFF")];function y(){}return y.prototype.visitChildren=function(T){for(var A in T){var R=T[A];T.hasOwnProperty(A)&&(R.type!==void 0?this.visit(R):Array.isArray(R)&&R.forEach(function(C){this.visit(C)},this))}},y.prototype.visit=function(T){switch(T.type){case"Pattern":this.visitPattern(T);break;case"Flags":this.visitFlags(T);break;case"Disjunction":this.visitDisjunction(T);break;case"Alternative":this.visitAlternative(T);break;case"StartAnchor":this.visitStartAnchor(T);break;case"EndAnchor":this.visitEndAnchor(T);break;case"WordBoundary":this.visitWordBoundary(T);break;case"NonWordBoundary":this.visitNonWordBoundary(T);break;case"Lookahead":this.visitLookahead(T);break;case"NegativeLookahead":this.visitNegativeLookahead(T);break;case"Character":this.visitCharacter(T);break;case"Set":this.visitSet(T);break;case"Group":this.visitGroup(T);break;case"GroupBackReference":this.visitGroupBackReference(T);break;case"Quantifier":this.visitQuantifier(T);break}this.visitChildren(T)},y.prototype.visitPattern=function(T){},y.prototype.visitFlags=function(T){},y.prototype.visitDisjunction=function(T){},y.prototype.visitAlternative=function(T){},y.prototype.visitStartAnchor=function(T){},y.prototype.visitEndAnchor=function(T){},y.prototype.visitWordBoundary=function(T){},y.prototype.visitNonWordBoundary=function(T){},y.prototype.visitLookahead=function(T){},y.prototype.visitNegativeLookahead=function(T){},y.prototype.visitCharacter=function(T){},y.prototype.visitSet=function(T){},y.prototype.visitGroup=function(T){},y.prototype.visitGroupBackReference=function(T){},y.prototype.visitQuantifier=function(T){},{RegExpParser:e,BaseRegExpVisitor:y,VERSION:"0.4.0"}})})(regexpToAst);var regexpToAstExports=regexpToAst.exports,regExpAstCache={},regExpParser=new regexpToAstExports.RegExpParser;function getRegExpAst(i){var e=i.toString();if(regExpAstCache.hasOwnProperty(e))return regExpAstCache[e];var t=regExpParser.pattern(e);return regExpAstCache[e]=t,t}function clearRegExpParserCache(){regExpAstCache={}}var __extends$a=function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o])},i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),complementErrorMessage="Complement Sets are not supported for first char optimization",failedOptimizationPrefixMsg=`Unable to use "first char" lexer optimizations:
`;function getOptimizedStartCodesIndices(i,e){e===void 0&&(e=!1);try{var t=getRegExpAst(i),r=firstCharOptimizedIndices(t.value,{},t.flags.ignoreCase);return r}catch(o){if(o.message===complementErrorMessage)e&&PRINT_WARNING(""+failedOptimizationPrefixMsg+("	Unable to optimize: < "+i.toString()+` >
`)+`	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{var a="";e&&(a=`
	This will disable the lexer's first char optimizations.
	See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),PRINT_ERROR(failedOptimizationPrefixMsg+`
`+("	Failed parsing: < "+i.toString()+` >
`)+("	Using the regexp-to-ast library version: "+regexpToAstExports.VERSION+`
`)+"	Please open an issue at: https://github.com/bd82/regexp-to-ast/issues"+a)}}return[]}function firstCharOptimizedIndices(i,e,t){switch(i.type){case"Disjunction":for(var r=0;r<i.value.length;r++)firstCharOptimizedIndices(i.value[r],e,t);break;case"Alternative":for(var a=i.value,r=0;r<a.length;r++){var o=a[r];switch(o.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var u=o;switch(u.type){case"Character":addOptimizedIdxToResult(u.value,e,t);break;case"Set":if(u.complement===!0)throw Error(complementErrorMessage);forEach(u.value,function(d){if(typeof d=="number")addOptimizedIdxToResult(d,e,t);else{var p=d;if(t===!0)for(var m=p.from;m<=p.to;m++)addOptimizedIdxToResult(m,e,t);else{for(var m=p.from;m<=p.to&&m<minOptimizationVal;m++)addOptimizedIdxToResult(m,e,t);if(p.to>=minOptimizationVal)for(var f=p.from>=minOptimizationVal?p.from:minOptimizationVal,g=p.to,y=charCodeToOptimizedIndex(f),T=charCodeToOptimizedIndex(g),A=y;A<=T;A++)e[A]=A}}});break;case"Group":firstCharOptimizedIndices(u.value,e,t);break;default:throw Error("Non Exhaustive Match")}var c=u.quantifier!==void 0&&u.quantifier.atLeast===0;if(u.type==="Group"&&isWholeOptional(u)===!1||u.type!=="Group"&&c===!1)break}break;default:throw Error("non exhaustive match!")}return values(e)}function addOptimizedIdxToResult(i,e,t){var r=charCodeToOptimizedIndex(i);e[r]=r,t===!0&&handleIgnoreCase(i,e)}function handleIgnoreCase(i,e){var t=String.fromCharCode(i),r=t.toUpperCase();if(r!==t){var a=charCodeToOptimizedIndex(r.charCodeAt(0));e[a]=a}else{var o=t.toLowerCase();if(o!==t){var a=charCodeToOptimizedIndex(o.charCodeAt(0));e[a]=a}}}function findCode(i,e){return find(i.value,function(t){if(typeof t=="number")return contains(e,t);var r=t;return find(e,function(a){return r.from<=a&&a<=r.to})!==void 0})}function isWholeOptional(i){return i.quantifier&&i.quantifier.atLeast===0?!0:i.value?isArray(i.value)?every(i.value,isWholeOptional):isWholeOptional(i.value):!1}var CharCodeFinder=function(i){__extends$a(e,i);function e(t){var r=i.call(this)||this;return r.targetCharCodes=t,r.found=!1,r}return e.prototype.visitChildren=function(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}i.prototype.visitChildren.call(this,t)}},e.prototype.visitCharacter=function(t){contains(this.targetCharCodes,t.value)&&(this.found=!0)},e.prototype.visitSet=function(t){t.complement?findCode(t,this.targetCharCodes)===void 0&&(this.found=!0):findCode(t,this.targetCharCodes)!==void 0&&(this.found=!0)},e}(regexpToAstExports.BaseRegExpVisitor);function canMatchCharCode(i,e){if(e instanceof RegExp){var t=getRegExpAst(e),r=new CharCodeFinder(i);return r.visit(t),r.found}else return find(e,function(a){return contains(i,a.charCodeAt(0))})!==void 0}var __extends$9=function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o])},i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),PATTERN="PATTERN",DEFAULT_MODE="defaultMode",MODES="modes",SUPPORT_STICKY=typeof new RegExp("(?:)").sticky=="boolean";function analyzeTokenTypes(i,e){e=defaults(e,{useSticky:SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:function(C,N){return N()}});var t=e.tracer;t("initCharCodeToOptimizedIndexMap",function(){initCharCodeToOptimizedIndexMap()});var r;t("Reject Lexer.NA",function(){r=reject(i,function(C){return C[PATTERN]===Lexer.NA})});var a=!1,o;t("Transform Patterns",function(){a=!1,o=map(r,function(C){var N=C[PATTERN];if(isRegExp(N)){var S=N.source;return S.length===1&&S!=="^"&&S!=="$"&&S!=="."?S:S.length===2&&S[0]==="\\"&&!contains(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],S[1])?S[1]:e.useSticky?addStickyFlag(N):addStartOfInput(N)}else{if(isFunction(N))return a=!0,{exec:N};if(has(N,"exec"))return a=!0,N;if(typeof N=="string"){if(N.length===1)return N;var _=N.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),O=new RegExp(_);return e.useSticky?addStickyFlag(O):addStartOfInput(O)}else throw Error("non exhaustive match")}})});var u,c,h,d,p;t("misc mapping",function(){u=map(r,function(C){return C.tokenTypeIdx}),c=map(r,function(C){var N=C.GROUP;if(N!==Lexer.SKIPPED){if(isString(N))return N;if(isUndefined(N))return!1;throw Error("non exhaustive match")}}),h=map(r,function(C){var N=C.LONGER_ALT;if(N){var S=indexOf(r,N);return S}}),d=map(r,function(C){return C.PUSH_MODE}),p=map(r,function(C){return has(C,"POP_MODE")})});var m;t("Line Terminator Handling",function(){var C=getCharCodes(e.lineTerminatorCharacters);m=map(r,function(N){return!1}),e.positionTracking!=="onlyOffset"&&(m=map(r,function(N){if(has(N,"LINE_BREAKS"))return N.LINE_BREAKS;if(checkLineBreaksIssues(N,C)===!1)return canMatchCharCode(C,N.PATTERN)}))});var f,g,y,T;t("Misc Mapping #2",function(){f=map(r,isCustomPattern),g=map(o,isShortPattern),y=reduce(r,function(C,N){var S=N.GROUP;return isString(S)&&S!==Lexer.SKIPPED&&(C[S]=[]),C},{}),T=map(o,function(C,N){return{pattern:o[N],longerAlt:h[N],canLineTerminator:m[N],isCustom:f[N],short:g[N],group:c[N],push:d[N],pop:p[N],tokenTypeIdx:u[N],tokenType:r[N]}})});var A=!0,R=[];return e.safeMode||t("First Char Optimization",function(){R=reduce(r,function(C,N,S){if(typeof N.PATTERN=="string"){var _=N.PATTERN.charCodeAt(0),O=charCodeToOptimizedIndex(_);addToMapOfArrays(C,O,T[S])}else if(isArray(N.START_CHARS_HINT)){var I;forEach(N.START_CHARS_HINT,function(b){var w=typeof b=="string"?b.charCodeAt(0):b,F=charCodeToOptimizedIndex(w);I!==F&&(I=F,addToMapOfArrays(C,F,T[S]))})}else if(isRegExp(N.PATTERN))if(N.PATTERN.unicode)A=!1,e.ensureOptimizations&&PRINT_ERROR(""+failedOptimizationPrefixMsg+("	Unable to analyze < "+N.PATTERN.toString()+` > pattern.
`)+`	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{var L=getOptimizedStartCodesIndices(N.PATTERN,e.ensureOptimizations);isEmpty(L)&&(A=!1),forEach(L,function(b){addToMapOfArrays(C,b,T[S])})}else e.ensureOptimizations&&PRINT_ERROR(""+failedOptimizationPrefixMsg+("	TokenType: <"+N.name+`> is using a custom token pattern without providing <start_chars_hint> parameter.
`)+`	This will disable the lexer's first char optimizations.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),A=!1;return C},[])}),t("ArrayPacking",function(){R=packArray(R)}),{emptyGroups:y,patternIdxToConfig:T,charCodeToPatternIdxToConfig:R,hasCustom:a,canBeOptimized:A}}function validatePatterns(i,e){var t=[],r=findMissingPatterns(i);t=t.concat(r.errors);var a=findInvalidPatterns(r.valid),o=a.valid;return t=t.concat(a.errors),t=t.concat(validateRegExpPattern(o)),t=t.concat(findInvalidGroupType(o)),t=t.concat(findModesThatDoNotExist(o,e)),t=t.concat(findUnreachablePatterns(o)),t}function validateRegExpPattern(i){var e=[],t=filter(i,function(r){return isRegExp(r[PATTERN])});return e=e.concat(findEndOfInputAnchor(t)),e=e.concat(findStartOfInputAnchor(t)),e=e.concat(findUnsupportedFlags(t)),e=e.concat(findDuplicatePatterns(t)),e=e.concat(findEmptyMatchRegExps(t)),e}function findMissingPatterns(i){var e=filter(i,function(a){return!has(a,PATTERN)}),t=map(e,function(a){return{message:"Token Type: ->"+a.name+"<- missing static 'PATTERN' property",type:LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[a]}}),r=difference(i,e);return{errors:t,valid:r}}function findInvalidPatterns(i){var e=filter(i,function(a){var o=a[PATTERN];return!isRegExp(o)&&!isFunction(o)&&!has(o,"exec")&&!isString(o)}),t=map(e,function(a){return{message:"Token Type: ->"+a.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[a]}}),r=difference(i,e);return{errors:t,valid:r}}var end_of_input=/[^\\][\$]/;function findEndOfInputAnchor(i){var e=function(a){__extends$9(o,a);function o(){var u=a!==null&&a.apply(this,arguments)||this;return u.found=!1,u}return o.prototype.visitEndAnchor=function(u){this.found=!0},o}(regexpToAstExports.BaseRegExpVisitor),t=filter(i,function(a){var o=a[PATTERN];try{var u=getRegExpAst(o),c=new e;return c.visit(u),c.found}catch{return end_of_input.test(o.source)}}),r=map(t,function(a){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+a.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[a]}});return r}function findEmptyMatchRegExps(i){var e=filter(i,function(r){var a=r[PATTERN];return a.test("")}),t=map(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[r]}});return t}var start_of_input=/[^\\[][\^]|^\^/;function findStartOfInputAnchor(i){var e=function(a){__extends$9(o,a);function o(){var u=a!==null&&a.apply(this,arguments)||this;return u.found=!1,u}return o.prototype.visitStartAnchor=function(u){this.found=!0},o}(regexpToAstExports.BaseRegExpVisitor),t=filter(i,function(a){var o=a[PATTERN];try{var u=getRegExpAst(o),c=new e;return c.visit(u),c.found}catch{return start_of_input.test(o.source)}}),r=map(t,function(a){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+a.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[a]}});return r}function findUnsupportedFlags(i){var e=filter(i,function(r){var a=r[PATTERN];return a instanceof RegExp&&(a.multiline||a.global)}),t=map(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}});return t}function findDuplicatePatterns(i){var e=[],t=map(i,function(o){return reduce(i,function(u,c){return o.PATTERN.source===c.PATTERN.source&&!contains(e,c)&&c.PATTERN!==Lexer.NA&&(e.push(c),u.push(c)),u},[])});t=compact(t);var r=filter(t,function(o){return o.length>1}),a=map(r,function(o){var u=map(o,function(h){return h.name}),c=first$1(o).PATTERN;return{message:"The same RegExp pattern ->"+c+"<-"+("has been used in all of the following Token Types: "+u.join(", ")+" <-"),type:LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:o}});return a}function findInvalidGroupType(i){var e=filter(i,function(r){if(!has(r,"GROUP"))return!1;var a=r.GROUP;return a!==Lexer.SKIPPED&&a!==Lexer.NA&&!isString(a)}),t=map(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}});return t}function findModesThatDoNotExist(i,e){var t=filter(i,function(a){return a.PUSH_MODE!==void 0&&!contains(e,a.PUSH_MODE)}),r=map(t,function(a){var o="Token Type: ->"+a.name+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+a.PUSH_MODE+"<-which does not exist";return{message:o,type:LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[a]}});return r}function findUnreachablePatterns(i){var e=[],t=reduce(i,function(r,a,o){var u=a.PATTERN;return u===Lexer.NA||(isString(u)?r.push({str:u,idx:o,tokenType:a}):isRegExp(u)&&noMetaChar(u)&&r.push({str:u.source,idx:o,tokenType:a})),r},[]);return forEach(i,function(r,a){forEach(t,function(o){var u=o.str,c=o.idx,h=o.tokenType;if(a<c&&testTokenType(u,r.PATTERN)){var d="Token: ->"+h.name+`<- can never be matched.
`+("Because it appears AFTER the Token Type ->"+r.name+"<-")+`in the lexer's definition.
See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:d,type:LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[r,h]})}})}),e}function testTokenType(i,e){if(isRegExp(e)){var t=e.exec(i);return t!==null&&t.index===0}else{if(isFunction(e))return e(i,0,[],{});if(has(e,"exec"))return e.exec(i,0,[],{});if(typeof e=="string")return e===i;throw Error("non exhaustive match")}}function noMetaChar(i){var e=[".","\\","[","]","|","^","$","(",")","?","*","+","{"];return find(e,function(t){return i.source.indexOf(t)!==-1})===void 0}function addStartOfInput(i){var e=i.ignoreCase?"i":"";return new RegExp("^(?:"+i.source+")",e)}function addStickyFlag(i){var e=i.ignoreCase?"iy":"y";return new RegExp(""+i.source,e)}function performRuntimeChecks(i,e,t){var r=[];return has(i,DEFAULT_MODE)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+DEFAULT_MODE+`> property in its definition
`,type:LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),has(i,MODES)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+MODES+`> property in its definition
`,type:LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),has(i,MODES)&&has(i,DEFAULT_MODE)&&!has(i.modes,i.defaultMode)&&r.push({message:"A MultiMode Lexer cannot be initialized with a "+DEFAULT_MODE+": <"+i.defaultMode+`>which does not exist
`,type:LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),has(i,MODES)&&forEach(i.modes,function(a,o){forEach(a,function(u,c){isUndefined(u)&&r.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:"+("<"+o+"> at index: <"+c+`>
`),type:LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})})}),r}function performWarningRuntimeChecks(i,e,t){var r=[],a=!1,o=compact(flatten(mapValues(i.modes,function(h){return h}))),u=reject(o,function(h){return h[PATTERN]===Lexer.NA}),c=getCharCodes(t);return e&&forEach(u,function(h){var d=checkLineBreaksIssues(h,c);if(d!==!1){var p=buildLineBreakIssueMessage(h,d),m={message:p,type:d.issue,tokenType:h};r.push(m)}else has(h,"LINE_BREAKS")?h.LINE_BREAKS===!0&&(a=!0):canMatchCharCode(c,h.PATTERN)&&(a=!0)}),e&&!a&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),r}function cloneEmptyGroups(i){var e={},t=keys(i);return forEach(t,function(r){var a=i[r];if(isArray(a))e[r]=[];else throw Error("non exhaustive match")}),e}function isCustomPattern(i){var e=i.PATTERN;if(isRegExp(e))return!1;if(isFunction(e))return!0;if(has(e,"exec"))return!0;if(isString(e))return!1;throw Error("non exhaustive match")}function isShortPattern(i){return isString(i)&&i.length===1?i.charCodeAt(0):!1}var LineTerminatorOptimizedTester={test:function(i){for(var e=i.length,t=this.lastIndex;t<e;t++){var r=i.charCodeAt(t);if(r===10)return this.lastIndex=t+1,!0;if(r===13)return i.charCodeAt(t+1)===10?this.lastIndex=t+2:this.lastIndex=t+1,!0}return!1},lastIndex:0};function checkLineBreaksIssues(i,e){if(has(i,"LINE_BREAKS"))return!1;if(isRegExp(i.PATTERN)){try{canMatchCharCode(e,i.PATTERN)}catch(t){return{issue:LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:t.message}}return!1}else{if(isString(i.PATTERN))return!1;if(isCustomPattern(i))return{issue:LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function buildLineBreakIssueMessage(i,e){if(e.issue===LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
`+("	The problem is in the <"+i.name+`> Token Type
`)+("	 Root cause: "+e.errMsg+`.
`)+"	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(e.issue===LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
`+("	The problem is in the <"+i.name+`> Token Type
`)+"	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function getCharCodes(i){var e=map(i,function(t){return isString(t)&&t.length>0?t.charCodeAt(0):t});return e}function addToMapOfArrays(i,e,t){i[e]===void 0?i[e]=[t]:i[e].push(t)}var minOptimizationVal=256;function charCodeToOptimizedIndex(i){return i<minOptimizationVal?i:charCodeToOptimizedIdxMap[i]}var charCodeToOptimizedIdxMap=[];function initCharCodeToOptimizedIndexMap(){if(isEmpty(charCodeToOptimizedIdxMap)){charCodeToOptimizedIdxMap=new Array(65536);for(var i=0;i<65536;i++)charCodeToOptimizedIdxMap[i]=i>255?255+~~(i/255):i}}function tokenStructuredMatcher(i,e){var t=i.tokenTypeIdx;return t===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[t]===!0}function tokenStructuredMatcherNoCategories(i,e){return i.tokenTypeIdx===e.tokenTypeIdx}var tokenShortNameIdx=1,tokenIdxToClass={};function augmentTokenTypes(i){var e=expandCategories(i);assignTokenDefaultProps(e),assignCategoriesMapProp(e),assignCategoriesTokensProp(e),forEach(e,function(t){t.isParent=t.categoryMatches.length>0})}function expandCategories(i){for(var e=cloneArr(i),t=i,r=!0;r;){t=compact(flatten(map(t,function(o){return o.CATEGORIES})));var a=difference(t,e);e=e.concat(a),isEmpty(a)?r=!1:t=a}return e}function assignTokenDefaultProps(i){forEach(i,function(e){hasShortKeyProperty(e)||(tokenIdxToClass[tokenShortNameIdx]=e,e.tokenTypeIdx=tokenShortNameIdx++),hasCategoriesProperty(e)&&!isArray(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),hasCategoriesProperty(e)||(e.CATEGORIES=[]),hasExtendingTokensTypesProperty(e)||(e.categoryMatches=[]),hasExtendingTokensTypesMapProperty(e)||(e.categoryMatchesMap={})})}function assignCategoriesTokensProp(i){forEach(i,function(e){e.categoryMatches=[],forEach(e.categoryMatchesMap,function(t,r){e.categoryMatches.push(tokenIdxToClass[r].tokenTypeIdx)})})}function assignCategoriesMapProp(i){forEach(i,function(e){singleAssignCategoriesToksMap([],e)})}function singleAssignCategoriesToksMap(i,e){forEach(i,function(t){e.categoryMatchesMap[t.tokenTypeIdx]=!0}),forEach(e.CATEGORIES,function(t){var r=i.concat(e);contains(r,t)||singleAssignCategoriesToksMap(r,t)})}function hasShortKeyProperty(i){return has(i,"tokenTypeIdx")}function hasCategoriesProperty(i){return has(i,"CATEGORIES")}function hasExtendingTokensTypesProperty(i){return has(i,"categoryMatches")}function hasExtendingTokensTypesMapProperty(i){return has(i,"categoryMatchesMap")}function isTokenType(i){return has(i,"tokenTypeIdx")}var defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(i){return"Unable to pop Lexer Mode after encountering Token ->"+i.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(i,e,t,r,a){return"unexpected character: ->"+i.charAt(e)+"<- at offset: "+e+","+(" skipped "+t+" characters.")}},LexerDefinitionErrorType;(function(i){i[i.MISSING_PATTERN=0]="MISSING_PATTERN",i[i.INVALID_PATTERN=1]="INVALID_PATTERN",i[i.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",i[i.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",i[i.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",i[i.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",i[i.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",i[i.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",i[i.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",i[i.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",i[i.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",i[i.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",i[i.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",i[i.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",i[i.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",i[i.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",i[i.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"})(LexerDefinitionErrorType||(LexerDefinitionErrorType={}));var DEFAULT_LEXER_CONFIG={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:defaultLexerErrorProvider,traceInitPerf:!1,skipValidations:!1};Object.freeze(DEFAULT_LEXER_CONFIG);var Lexer=function(){function i(e,t){var r=this;if(t===void 0&&(t=DEFAULT_LEXER_CONFIG),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},typeof t=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=merge(DEFAULT_LEXER_CONFIG,t);var a=this.config.traceInitPerf;a===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof a=="number"&&(this.traceInitMaxIdent=a,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",function(){var o,u=!0;r.TRACE_INIT("Lexer Config handling",function(){if(r.config.lineTerminatorsPattern===DEFAULT_LEXER_CONFIG.lineTerminatorsPattern)r.config.lineTerminatorsPattern=LineTerminatorOptimizedTester;else if(r.config.lineTerminatorCharacters===DEFAULT_LEXER_CONFIG.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');r.trackStartLines=/full|onlyStart/i.test(r.config.positionTracking),r.trackEndLines=/full/i.test(r.config.positionTracking),isArray(e)?(o={modes:{}},o.modes[DEFAULT_MODE]=cloneArr(e),o[DEFAULT_MODE]=DEFAULT_MODE):(u=!1,o=cloneObj(e))}),r.config.skipValidations===!1&&(r.TRACE_INIT("performRuntimeChecks",function(){r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(performRuntimeChecks(o,r.trackStartLines,r.config.lineTerminatorCharacters))}),r.TRACE_INIT("performWarningRuntimeChecks",function(){r.lexerDefinitionWarning=r.lexerDefinitionWarning.concat(performWarningRuntimeChecks(o,r.trackStartLines,r.config.lineTerminatorCharacters))})),o.modes=o.modes?o.modes:{},forEach(o.modes,function(p,m){o.modes[m]=reject(p,function(f){return isUndefined(f)})});var c=keys(o.modes);if(forEach(o.modes,function(p,m){r.TRACE_INIT("Mode: <"+m+"> processing",function(){if(r.modes.push(m),r.config.skipValidations===!1&&r.TRACE_INIT("validatePatterns",function(){r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(validatePatterns(p,c))}),isEmpty(r.lexerDefinitionErrors)){augmentTokenTypes(p);var f;r.TRACE_INIT("analyzeTokenTypes",function(){f=analyzeTokenTypes(p,{lineTerminatorCharacters:r.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode,tracer:r.TRACE_INIT.bind(r)})}),r.patternIdxToConfig[m]=f.patternIdxToConfig,r.charCodeToPatternIdxToConfig[m]=f.charCodeToPatternIdxToConfig,r.emptyGroups=merge(r.emptyGroups,f.emptyGroups),r.hasCustom=f.hasCustom||r.hasCustom,r.canModeBeOptimized[m]=f.canBeOptimized}})}),r.defaultMode=o.defaultMode,!isEmpty(r.lexerDefinitionErrors)&&!r.config.deferDefinitionErrorsHandling){var h=map(r.lexerDefinitionErrors,function(p){return p.message}),d=h.join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+d)}forEach(r.lexerDefinitionWarning,function(p){PRINT_WARNING(p.message)}),r.TRACE_INIT("Choosing sub-methods implementations",function(){if(SUPPORT_STICKY?(r.chopInput=IDENTITY,r.match=r.matchWithTest):(r.updateLastIndex=NOOP,r.match=r.matchWithExec),u&&(r.handleModes=NOOP),r.trackStartLines===!1&&(r.computeNewColumn=IDENTITY),r.trackEndLines===!1&&(r.updateTokenEndLineColumnLocation=NOOP),/full/i.test(r.config.positionTracking))r.createTokenInstance=r.createFullToken;else if(/onlyStart/i.test(r.config.positionTracking))r.createTokenInstance=r.createStartOnlyToken;else if(/onlyOffset/i.test(r.config.positionTracking))r.createTokenInstance=r.createOffsetOnlyToken;else throw Error('Invalid <positionTracking> config option: "'+r.config.positionTracking+'"');r.hasCustom?(r.addToken=r.addTokenUsingPush,r.handlePayload=r.handlePayloadWithCustom):(r.addToken=r.addTokenUsingMemberAccess,r.handlePayload=r.handlePayloadNoCustom)}),r.TRACE_INIT("Failed Optimization Warnings",function(){var p=reduce(r.canModeBeOptimized,function(m,f,g){return f===!1&&m.push(g),m},[]);if(t.ensureOptimizations&&!isEmpty(p))throw Error("Lexer Modes: < "+p.join(", ")+` > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),r.TRACE_INIT("clearRegExpParserCache",function(){clearRegExpParserCache()}),r.TRACE_INIT("toFastProperties",function(){toFastProperties(r)})})}return i.prototype.tokenize=function(e,t){if(t===void 0&&(t=this.defaultMode),!isEmpty(this.lexerDefinitionErrors)){var r=map(this.lexerDefinitionErrors,function(u){return u.message}),a=r.join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+a)}var o=this.tokenizeInternal(e,t);return o},i.prototype.tokenizeInternal=function(e,t){var r=this,a,o,u,c,h,d,p,m,f,g,y,T,A,R,C=e,N=C.length,S=0,_=0,O=this.hasCustom?0:Math.floor(e.length/10),I=new Array(O),L=[],b=this.trackStartLines?1:void 0,w=this.trackStartLines?1:void 0,F=cloneEmptyGroups(this.emptyGroups),P=this.trackStartLines,x=this.config.lineTerminatorsPattern,B=0,k=[],V=[],H=[],Y=[];Object.freeze(Y);var G=void 0;function D(){return k}function X(U){var j=charCodeToOptimizedIndex(U),Q=V[j];return Q===void 0?Y:Q}var z=function(U){if(H.length===1&&U.tokenType.PUSH_MODE===void 0){var j=r.config.errorMessageProvider.buildUnableToPopLexerModeMessage(U);L.push({offset:U.startOffset,line:U.startLine!==void 0?U.startLine:void 0,column:U.startColumn!==void 0?U.startColumn:void 0,length:U.image.length,message:j})}else{H.pop();var Q=last(H);k=r.patternIdxToConfig[Q],V=r.charCodeToPatternIdxToConfig[Q],B=k.length;var he=r.canModeBeOptimized[Q]&&r.config.safeMode===!1;V&&he?G=X:G=D}};function q(U){H.push(U),V=this.charCodeToPatternIdxToConfig[U],k=this.patternIdxToConfig[U],B=k.length,B=k.length;var j=this.canModeBeOptimized[U]&&this.config.safeMode===!1;V&&j?G=X:G=D}q.call(this,t);for(var W;S<N;){h=null;var K=C.charCodeAt(S),J=G(K),re=J.length;for(a=0;a<re;a++){W=J[a];var $=W.pattern;d=null;var Z=W.short;if(Z!==!1?K===Z&&(h=$):W.isCustom===!0?(R=$.exec(C,S,I,F),R!==null?(h=R[0],R.payload!==void 0&&(d=R.payload)):h=null):(this.updateLastIndex($,S),h=this.match($,e,S)),h!==null){if(c=W.longerAlt,c!==void 0){var ie=k[c],ee=ie.pattern;p=null,ie.isCustom===!0?(R=ee.exec(C,S,I,F),R!==null?(u=R[0],R.payload!==void 0&&(p=R.payload)):u=null):(this.updateLastIndex(ee,S),u=this.match(ee,e,S)),u&&u.length>h.length&&(h=u,d=p,W=ie)}break}}if(h!==null){if(m=h.length,f=W.group,f!==void 0&&(g=W.tokenTypeIdx,y=this.createTokenInstance(h,S,g,W.tokenType,b,w,m),this.handlePayload(y,d),f===!1?_=this.addToken(I,_,y):F[f].push(y)),e=this.chopInput(e,m),S=S+m,w=this.computeNewColumn(w,m),P===!0&&W.canLineTerminator===!0){var ne=0,se=void 0,ae=void 0;x.lastIndex=0;do se=x.test(h),se===!0&&(ae=x.lastIndex-1,ne++);while(se===!0);ne!==0&&(b=b+ne,w=m-ae,this.updateTokenEndLineColumnLocation(y,f,ae,ne,b,w,m))}this.handleModes(W,z,q,y)}else{for(var oe=S,ue=b,le=w,te=!1;!te&&S<N;)for(C.charCodeAt(S),e=this.chopInput(e,1),S++,o=0;o<B;o++){var ce=k[o],$=ce.pattern,Z=ce.short;if(Z!==!1?C.charCodeAt(S)===Z&&(te=!0):ce.isCustom===!0?te=$.exec(C,S,I,F)!==null:(this.updateLastIndex($,S),te=$.exec(e)!==null),te===!0)break}T=S-oe,A=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(C,oe,T,ue,le),L.push({offset:oe,line:ue,column:le,length:T,message:A})}}return this.hasCustom||(I.length=_),{tokens:I,groups:F,errors:L}},i.prototype.handleModes=function(e,t,r,a){if(e.pop===!0){var o=e.push;t(a),o!==void 0&&r.call(this,o)}else e.push!==void 0&&r.call(this,e.push)},i.prototype.chopInput=function(e,t){return e.substring(t)},i.prototype.updateLastIndex=function(e,t){e.lastIndex=t},i.prototype.updateTokenEndLineColumnLocation=function(e,t,r,a,o,u,c){var h,d;t!==void 0&&(h=r===c-1,d=h?-1:0,a===1&&h===!0||(e.endLine=o+d,e.endColumn=u-1+-d))},i.prototype.computeNewColumn=function(e,t){return e+t},i.prototype.createTokenInstance=function(){return null},i.prototype.createOffsetOnlyToken=function(e,t,r,a){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:a}},i.prototype.createStartOnlyToken=function(e,t,r,a,o,u){return{image:e,startOffset:t,startLine:o,startColumn:u,tokenTypeIdx:r,tokenType:a}},i.prototype.createFullToken=function(e,t,r,a,o,u,c){return{image:e,startOffset:t,endOffset:t+c-1,startLine:o,endLine:o,startColumn:u,endColumn:u+c-1,tokenTypeIdx:r,tokenType:a}},i.prototype.addToken=function(e,t,r){return 666},i.prototype.addTokenUsingPush=function(e,t,r){return e.push(r),t},i.prototype.addTokenUsingMemberAccess=function(e,t,r){return e[t]=r,t++,t},i.prototype.handlePayload=function(e,t){},i.prototype.handlePayloadNoCustom=function(e,t){},i.prototype.handlePayloadWithCustom=function(e,t){t!==null&&(e.payload=t)},i.prototype.match=function(e,t,r){return null},i.prototype.matchWithTest=function(e,t,r){var a=e.test(t);return a===!0?t.substring(r,e.lastIndex):null},i.prototype.matchWithExec=function(e,t){var r=e.exec(t);return r!==null?r[0]:r},i.prototype.TRACE_INIT=function(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;var r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(r+"--> <"+e+">");var a=timer(t),o=a.time,u=a.value,c=o>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&c(r+"<-- <"+e+"> time: "+o+"ms"),this.traceInitIndent--,u}else return t()},i.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",i.NA=/NOT_APPLICABLE/,i}();function tokenLabel(i){return hasTokenLabel(i)?i.LABEL:i.name}function hasTokenLabel(i){return isString(i.LABEL)&&i.LABEL!==""}var PARENT="parent",CATEGORIES="categories",LABEL="label",GROUP="group",PUSH_MODE="push_mode",POP_MODE="pop_mode",LONGER_ALT="longer_alt",LINE_BREAKS="line_breaks",START_CHARS_HINT="start_chars_hint";function createToken(i){return createTokenInternal(i)}function createTokenInternal(i){var e=i.pattern,t={};if(t.name=i.name,isUndefined(e)||(t.PATTERN=e),has(i,PARENT))throw`The parent property is no longer supported.
See: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.`;return has(i,CATEGORIES)&&(t.CATEGORIES=i[CATEGORIES]),augmentTokenTypes([t]),has(i,LABEL)&&(t.LABEL=i[LABEL]),has(i,GROUP)&&(t.GROUP=i[GROUP]),has(i,POP_MODE)&&(t.POP_MODE=i[POP_MODE]),has(i,PUSH_MODE)&&(t.PUSH_MODE=i[PUSH_MODE]),has(i,LONGER_ALT)&&(t.LONGER_ALT=i[LONGER_ALT]),has(i,LINE_BREAKS)&&(t.LINE_BREAKS=i[LINE_BREAKS]),has(i,START_CHARS_HINT)&&(t.START_CHARS_HINT=i[START_CHARS_HINT]),t}var EOF=createToken({name:"EOF",pattern:Lexer.NA});augmentTokenTypes([EOF]);function createTokenInstance(i,e,t,r,a,o,u,c){return{image:e,startOffset:t,endOffset:r,startLine:a,endLine:o,startColumn:u,endColumn:c,tokenTypeIdx:i.tokenTypeIdx,tokenType:i}}function tokenMatcher(i,e){return tokenStructuredMatcher(i,e)}var __extends$8=function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o])},i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),AbstractProduction=function(){function i(e){this.definition=e}return i.prototype.accept=function(e){e.visit(this),forEach(this.definition,function(t){t.accept(e)})},i}(),NonTerminal=function(i){__extends$8(e,i);function e(t){var r=i.call(this,[])||this;return r.idx=1,assign(r,pick(t,function(a){return a!==void 0})),r}return Object.defineProperty(e.prototype,"definition",{get:function(){return this.referencedRule!==void 0?this.referencedRule.definition:[]},set:function(t){},enumerable:!0,configurable:!0}),e.prototype.accept=function(t){t.visit(this)},e}(AbstractProduction),Rule=function(i){__extends$8(e,i);function e(t){var r=i.call(this,t.definition)||this;return r.orgText="",assign(r,pick(t,function(a){return a!==void 0})),r}return e}(AbstractProduction),Flat=function(i){__extends$8(e,i);function e(t){var r=i.call(this,t.definition)||this;return r.ignoreAmbiguities=!1,assign(r,pick(t,function(a){return a!==void 0})),r}return e}(AbstractProduction),Option=function(i){__extends$8(e,i);function e(t){var r=i.call(this,t.definition)||this;return r.idx=1,assign(r,pick(t,function(a){return a!==void 0})),r}return e}(AbstractProduction),RepetitionMandatory=function(i){__extends$8(e,i);function e(t){var r=i.call(this,t.definition)||this;return r.idx=1,assign(r,pick(t,function(a){return a!==void 0})),r}return e}(AbstractProduction),RepetitionMandatoryWithSeparator=function(i){__extends$8(e,i);function e(t){var r=i.call(this,t.definition)||this;return r.idx=1,assign(r,pick(t,function(a){return a!==void 0})),r}return e}(AbstractProduction),Repetition=function(i){__extends$8(e,i);function e(t){var r=i.call(this,t.definition)||this;return r.idx=1,assign(r,pick(t,function(a){return a!==void 0})),r}return e}(AbstractProduction),RepetitionWithSeparator=function(i){__extends$8(e,i);function e(t){var r=i.call(this,t.definition)||this;return r.idx=1,assign(r,pick(t,function(a){return a!==void 0})),r}return e}(AbstractProduction),Alternation=function(i){__extends$8(e,i);function e(t){var r=i.call(this,t.definition)||this;return r.idx=1,r.ignoreAmbiguities=!1,r.hasPredicates=!1,assign(r,pick(t,function(a){return a!==void 0})),r}return e}(AbstractProduction),Terminal=function(){function i(e){this.idx=1,assign(this,pick(e,function(t){return t!==void 0}))}return i.prototype.accept=function(e){e.visit(this)},i}();function serializeGrammar(i){return map(i,serializeProduction)}function serializeProduction(i){function e(a){return map(a,serializeProduction)}if(i instanceof NonTerminal)return{type:"NonTerminal",name:i.nonTerminalName,idx:i.idx};if(i instanceof Flat)return{type:"Flat",definition:e(i.definition)};if(i instanceof Option)return{type:"Option",idx:i.idx,definition:e(i.definition)};if(i instanceof RepetitionMandatory)return{type:"RepetitionMandatory",name:i.name,idx:i.idx,definition:e(i.definition)};if(i instanceof RepetitionMandatoryWithSeparator)return{type:"RepetitionMandatoryWithSeparator",name:i.name,idx:i.idx,separator:serializeProduction(new Terminal({terminalType:i.separator})),definition:e(i.definition)};if(i instanceof RepetitionWithSeparator)return{type:"RepetitionWithSeparator",name:i.name,idx:i.idx,separator:serializeProduction(new Terminal({terminalType:i.separator})),definition:e(i.definition)};if(i instanceof Repetition)return{type:"Repetition",name:i.name,idx:i.idx,definition:e(i.definition)};if(i instanceof Alternation)return{type:"Alternation",name:i.name,idx:i.idx,definition:e(i.definition)};if(i instanceof Terminal){var t={type:"Terminal",name:i.terminalType.name,label:tokenLabel(i.terminalType),idx:i.idx},r=i.terminalType.PATTERN;return i.terminalType.PATTERN&&(t.pattern=isRegExp(r)?r.source:r),t}else{if(i instanceof Rule)return{type:"Rule",name:i.name,orgText:i.orgText,definition:e(i.definition)};throw Error("non exhaustive match")}}var RestWalker=function(){function i(){}return i.prototype.walk=function(e,t){var r=this;t===void 0&&(t=[]),forEach(e.definition,function(a,o){var u=drop(e.definition,o+1);if(a instanceof NonTerminal)r.walkProdRef(a,u,t);else if(a instanceof Terminal)r.walkTerminal(a,u,t);else if(a instanceof Flat)r.walkFlat(a,u,t);else if(a instanceof Option)r.walkOption(a,u,t);else if(a instanceof RepetitionMandatory)r.walkAtLeastOne(a,u,t);else if(a instanceof RepetitionMandatoryWithSeparator)r.walkAtLeastOneSep(a,u,t);else if(a instanceof RepetitionWithSeparator)r.walkManySep(a,u,t);else if(a instanceof Repetition)r.walkMany(a,u,t);else if(a instanceof Alternation)r.walkOr(a,u,t);else throw Error("non exhaustive match")})},i.prototype.walkTerminal=function(e,t,r){},i.prototype.walkProdRef=function(e,t,r){},i.prototype.walkFlat=function(e,t,r){var a=t.concat(r);this.walk(e,a)},i.prototype.walkOption=function(e,t,r){var a=t.concat(r);this.walk(e,a)},i.prototype.walkAtLeastOne=function(e,t,r){var a=[new Option({definition:e.definition})].concat(t,r);this.walk(e,a)},i.prototype.walkAtLeastOneSep=function(e,t,r){var a=restForRepetitionWithSeparator(e,t,r);this.walk(e,a)},i.prototype.walkMany=function(e,t,r){var a=[new Option({definition:e.definition})].concat(t,r);this.walk(e,a)},i.prototype.walkManySep=function(e,t,r){var a=restForRepetitionWithSeparator(e,t,r);this.walk(e,a)},i.prototype.walkOr=function(e,t,r){var a=this,o=t.concat(r);forEach(e.definition,function(u){var c=new Flat({definition:[u]});a.walk(c,o)})},i}();function restForRepetitionWithSeparator(i,e,t){var r=[new Option({definition:[new Terminal({terminalType:i.separator})].concat(i.definition)})],a=r.concat(e,t);return a}var GAstVisitor=function(){function i(){}return i.prototype.visit=function(e){var t=e;switch(t.constructor){case NonTerminal:return this.visitNonTerminal(t);case Flat:return this.visitFlat(t);case Option:return this.visitOption(t);case RepetitionMandatory:return this.visitRepetitionMandatory(t);case RepetitionMandatoryWithSeparator:return this.visitRepetitionMandatoryWithSeparator(t);case RepetitionWithSeparator:return this.visitRepetitionWithSeparator(t);case Repetition:return this.visitRepetition(t);case Alternation:return this.visitAlternation(t);case Terminal:return this.visitTerminal(t);case Rule:return this.visitRule(t);default:throw Error("non exhaustive match")}},i.prototype.visitNonTerminal=function(e){},i.prototype.visitFlat=function(e){},i.prototype.visitOption=function(e){},i.prototype.visitRepetition=function(e){},i.prototype.visitRepetitionMandatory=function(e){},i.prototype.visitRepetitionMandatoryWithSeparator=function(e){},i.prototype.visitRepetitionWithSeparator=function(e){},i.prototype.visitAlternation=function(e){},i.prototype.visitTerminal=function(e){},i.prototype.visitRule=function(e){},i}(),__extends$7=function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o])},i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function isSequenceProd(i){return i instanceof Flat||i instanceof Option||i instanceof Repetition||i instanceof RepetitionMandatory||i instanceof RepetitionMandatoryWithSeparator||i instanceof RepetitionWithSeparator||i instanceof Terminal||i instanceof Rule}function isOptionalProd(i,e){e===void 0&&(e=[]);var t=i instanceof Option||i instanceof Repetition||i instanceof RepetitionWithSeparator;return t?!0:i instanceof Alternation?some(i.definition,function(r){return isOptionalProd(r,e)}):i instanceof NonTerminal&&contains(e,i)?!1:i instanceof AbstractProduction?(i instanceof NonTerminal&&e.push(i),every(i.definition,function(r){return isOptionalProd(r,e)})):!1}function isBranchingProd(i){return i instanceof Alternation}function getProductionDslName(i){if(i instanceof NonTerminal)return"SUBRULE";if(i instanceof Option)return"OPTION";if(i instanceof Alternation)return"OR";if(i instanceof RepetitionMandatory)return"AT_LEAST_ONE";if(i instanceof RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(i instanceof RepetitionWithSeparator)return"MANY_SEP";if(i instanceof Repetition)return"MANY";if(i instanceof Terminal)return"CONSUME";throw Error("non exhaustive match")}var DslMethodsCollectorVisitor=function(i){__extends$7(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t.separator="-",t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return e.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},e.prototype.visitTerminal=function(t){var r=t.terminalType.name+this.separator+"Terminal";has(this.dslMethods,r)||(this.dslMethods[r]=[]),this.dslMethods[r].push(t)},e.prototype.visitNonTerminal=function(t){var r=t.nonTerminalName+this.separator+"Terminal";has(this.dslMethods,r)||(this.dslMethods[r]=[]),this.dslMethods[r].push(t)},e.prototype.visitOption=function(t){this.dslMethods.option.push(t)},e.prototype.visitRepetitionWithSeparator=function(t){this.dslMethods.repetitionWithSeparator.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.dslMethods.repetitionMandatory.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)},e.prototype.visitRepetition=function(t){this.dslMethods.repetition.push(t)},e.prototype.visitAlternation=function(t){this.dslMethods.alternation.push(t)},e}(GAstVisitor),collectorVisitor=new DslMethodsCollectorVisitor;function collectMethods(i){collectorVisitor.reset(),i.accept(collectorVisitor);var e=collectorVisitor.dslMethods;return collectorVisitor.reset(),e}function first(i){if(i instanceof NonTerminal)return first(i.referencedRule);if(i instanceof Terminal)return firstForTerminal(i);if(isSequenceProd(i))return firstForSequence(i);if(isBranchingProd(i))return firstForBranching(i);throw Error("non exhaustive match")}function firstForSequence(i){for(var e=[],t=i.definition,r=0,a=t.length>r,o,u=!0;a&&u;)o=t[r],u=isOptionalProd(o),e=e.concat(first(o)),r=r+1,a=t.length>r;return uniq(e)}function firstForBranching(i){var e=map(i.definition,function(t){return first(t)});return uniq(flatten(e))}function firstForTerminal(i){return[i.terminalType]}var IN="_~IN~_",__extends$6=function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o])},i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ResyncFollowsWalker=function(i){__extends$6(e,i);function e(t){var r=i.call(this)||this;return r.topProd=t,r.follows={},r}return e.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},e.prototype.walkTerminal=function(t,r,a){},e.prototype.walkProdRef=function(t,r,a){var o=buildBetweenProdsFollowPrefix(t.referencedRule,t.idx)+this.topProd.name,u=r.concat(a),c=new Flat({definition:u}),h=first(c);this.follows[o]=h},e}(RestWalker);function computeAllProdsFollows(i){var e={};return forEach(i,function(t){var r=new ResyncFollowsWalker(t).startWalking();assign(e,r)}),e}function buildBetweenProdsFollowPrefix(i,e){return i.name+e+IN}var BITS_FOR_METHOD_TYPE=4,BITS_FOR_OCCURRENCE_IDX=8,BITS_FOR_ALT_IDX=8,OR_IDX=1<<BITS_FOR_OCCURRENCE_IDX,OPTION_IDX=2<<BITS_FOR_OCCURRENCE_IDX,MANY_IDX=3<<BITS_FOR_OCCURRENCE_IDX,AT_LEAST_ONE_IDX=4<<BITS_FOR_OCCURRENCE_IDX,MANY_SEP_IDX=5<<BITS_FOR_OCCURRENCE_IDX,AT_LEAST_ONE_SEP_IDX=6<<BITS_FOR_OCCURRENCE_IDX;function getKeyForAutomaticLookahead(i,e,t){return t|e|i}var BITS_START_FOR_ALT_IDX=32-BITS_FOR_ALT_IDX;function getKeyForAltIndex(i,e,t,r){var a=r+1<<BITS_START_FOR_ALT_IDX;return getKeyForAutomaticLookahead(i,e,t)|a}var __extends$5=function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o])},i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function setNodeLocationOnlyOffset(i,e){isNaN(i.startOffset)===!0?(i.startOffset=e.startOffset,i.endOffset=e.endOffset):i.endOffset<e.endOffset&&(i.endOffset=e.endOffset)}function setNodeLocationFull(i,e){isNaN(i.startOffset)===!0?(i.startOffset=e.startOffset,i.startColumn=e.startColumn,i.startLine=e.startLine,i.endOffset=e.endOffset,i.endColumn=e.endColumn,i.endLine=e.endLine):i.endOffset<e.endOffset&&(i.endOffset=e.endOffset,i.endColumn=e.endColumn,i.endLine=e.endLine)}function addTerminalToCst(i,e,t){i.children[t]===void 0?i.children[t]=[e]:i.children[t].push(e)}function addNoneTerminalToCst(i,e,t){i.children[e]===void 0?i.children[e]=[t]:i.children[e].push(t)}var NamedDSLMethodsCollectorVisitor=function(i){__extends$5(e,i);function e(t){var r=i.call(this)||this;return r.result=[],r.ruleIdx=t,r}return e.prototype.collectNamedDSLMethod=function(t,r,a){if(!isUndefined(t.name)){var o=void 0;if(t instanceof Option||t instanceof Repetition||t instanceof RepetitionMandatory||t instanceof Alternation)o=new r({definition:t.definition,idx:t.idx});else if(t instanceof RepetitionMandatoryWithSeparator||t instanceof RepetitionWithSeparator)o=new r({definition:t.definition,idx:t.idx,separator:t.separator});else throw Error("non exhaustive match");var u=[o],c=getKeyForAutomaticLookahead(this.ruleIdx,a,t.idx);this.result.push({def:u,key:c,name:t.name,orgProd:t})}},e.prototype.visitOption=function(t){this.collectNamedDSLMethod(t,Option,OPTION_IDX)},e.prototype.visitRepetition=function(t){this.collectNamedDSLMethod(t,Repetition,MANY_IDX)},e.prototype.visitRepetitionMandatory=function(t){this.collectNamedDSLMethod(t,RepetitionMandatory,AT_LEAST_ONE_IDX)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.collectNamedDSLMethod(t,RepetitionMandatoryWithSeparator,AT_LEAST_ONE_SEP_IDX)},e.prototype.visitRepetitionWithSeparator=function(t){this.collectNamedDSLMethod(t,RepetitionWithSeparator,MANY_SEP_IDX)},e.prototype.visitAlternation=function(t){var r=this;this.collectNamedDSLMethod(t,Alternation,OR_IDX);var a=t.definition.length>1;forEach(t.definition,function(o,u){if(!isUndefined(o.name)){var c=o.definition;a?c=[new Option({definition:o.definition})]:c=o.definition;var h=getKeyForAltIndex(r.ruleIdx,OR_IDX,t.idx,u);r.result.push({def:c,key:h,name:o.name,orgProd:o})}})},e}(GAstVisitor);function expandAllNestedRuleNames(i,e){var t={allRuleNames:[]};return forEach(i,function(r){var a=e[r.name];t.allRuleNames.push(r.name);var o=new NamedDSLMethodsCollectorVisitor(a);r.accept(o),forEach(o.result,function(u){u.def,u.key;var c=u.name;t.allRuleNames.push(r.name+c)})}),t}var __extends$4=function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o])},i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),AbstractNextPossibleTokensWalker=function(i){__extends$4(e,i);function e(t,r){var a=i.call(this)||this;return a.topProd=t,a.path=r,a.possibleTokTypes=[],a.nextProductionName="",a.nextProductionOccurrence=0,a.found=!1,a.isAtEndOfPath=!1,a}return e.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=cloneArr(this.path.ruleStack).reverse(),this.occurrenceStack=cloneArr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},e.prototype.walk=function(t,r){r===void 0&&(r=[]),this.found||i.prototype.walk.call(this,t,r)},e.prototype.walkProdRef=function(t,r,a){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){var o=r.concat(a);this.updateExpectedNext(),this.walk(t.referencedRule,o)}},e.prototype.updateExpectedNext=function(){isEmpty(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},e}(RestWalker),NextAfterTokenWalker=function(i){__extends$4(e,i);function e(t,r){var a=i.call(this,t,r)||this;return a.path=r,a.nextTerminalName="",a.nextTerminalOccurrence=0,a.nextTerminalName=a.path.lastTok.name,a.nextTerminalOccurrence=a.path.lastTokOccurrence,a}return e.prototype.walkTerminal=function(t,r,a){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){var o=r.concat(a),u=new Flat({definition:o});this.possibleTokTypes=first(u),this.found=!0}},e}(AbstractNextPossibleTokensWalker),AbstractNextTerminalAfterProductionWalker=function(i){__extends$4(e,i);function e(t,r){var a=i.call(this)||this;return a.topRule=t,a.occurrence=r,a.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},a}return e.prototype.startWalking=function(){return this.walk(this.topRule),this.result},e}(RestWalker),NextTerminalAfterManyWalker=function(i){__extends$4(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.walkMany=function(t,r,a){if(t.idx===this.occurrence){var o=first$1(r.concat(a));this.result.isEndOfRule=o===void 0,o instanceof Terminal&&(this.result.token=o.terminalType,this.result.occurrence=o.idx)}else i.prototype.walkMany.call(this,t,r,a)},e}(AbstractNextTerminalAfterProductionWalker),NextTerminalAfterManySepWalker=function(i){__extends$4(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.walkManySep=function(t,r,a){if(t.idx===this.occurrence){var o=first$1(r.concat(a));this.result.isEndOfRule=o===void 0,o instanceof Terminal&&(this.result.token=o.terminalType,this.result.occurrence=o.idx)}else i.prototype.walkManySep.call(this,t,r,a)},e}(AbstractNextTerminalAfterProductionWalker),NextTerminalAfterAtLeastOneWalker=function(i){__extends$4(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.walkAtLeastOne=function(t,r,a){if(t.idx===this.occurrence){var o=first$1(r.concat(a));this.result.isEndOfRule=o===void 0,o instanceof Terminal&&(this.result.token=o.terminalType,this.result.occurrence=o.idx)}else i.prototype.walkAtLeastOne.call(this,t,r,a)},e}(AbstractNextTerminalAfterProductionWalker),NextTerminalAfterAtLeastOneSepWalker=function(i){__extends$4(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.walkAtLeastOneSep=function(t,r,a){if(t.idx===this.occurrence){var o=first$1(r.concat(a));this.result.isEndOfRule=o===void 0,o instanceof Terminal&&(this.result.token=o.terminalType,this.result.occurrence=o.idx)}else i.prototype.walkAtLeastOneSep.call(this,t,r,a)},e}(AbstractNextTerminalAfterProductionWalker);function possiblePathsFrom(i,e,t){t===void 0&&(t=[]),t=cloneArr(t);var r=[],a=0;function o(d){return d.concat(drop(i,a+1))}function u(d){var p=possiblePathsFrom(o(d),e,t);return r.concat(p)}for(;t.length<e&&a<i.length;){var c=i[a];if(c instanceof Flat)return u(c.definition);if(c instanceof NonTerminal)return u(c.definition);if(c instanceof Option)r=u(c.definition);else if(c instanceof RepetitionMandatory){var h=c.definition.concat([new Repetition({definition:c.definition})]);return u(h)}else if(c instanceof RepetitionMandatoryWithSeparator){var h=[new Flat({definition:c.definition}),new Repetition({definition:[new Terminal({terminalType:c.separator})].concat(c.definition)})];return u(h)}else if(c instanceof RepetitionWithSeparator){var h=c.definition.concat([new Repetition({definition:[new Terminal({terminalType:c.separator})].concat(c.definition)})]);r=u(h)}else if(c instanceof Repetition){var h=c.definition.concat([new Repetition({definition:c.definition})]);r=u(h)}else{if(c instanceof Alternation)return forEach(c.definition,function(d){r=u(d.definition)}),r;if(c instanceof Terminal)t.push(c.terminalType);else throw Error("non exhaustive match")}a++}return r.push({partialPath:t,suffixDef:drop(i,a)}),r}function nextPossibleTokensAfter(i,e,t,r){var a="EXIT_NONE_TERMINAL",o=[a],u="EXIT_ALTERNATIVE",c=!1,h=e.length,d=h-r-1,p=[],m=[];for(m.push({idx:-1,def:i,ruleStack:[],occurrenceStack:[]});!isEmpty(m);){var f=m.pop();if(f===u){c&&last(m).idx<=d&&m.pop();continue}var g=f.def,y=f.idx,T=f.ruleStack,A=f.occurrenceStack;if(!isEmpty(g)){var R=g[0];if(R===a){var C={idx:y,def:drop(g),ruleStack:dropRight(T),occurrenceStack:dropRight(A)};m.push(C)}else if(R instanceof Terminal)if(y<h-1){var N=y+1,S=e[N];if(t(S,R.terminalType)){var C={idx:N,def:drop(g),ruleStack:T,occurrenceStack:A};m.push(C)}}else if(y===h-1)p.push({nextTokenType:R.terminalType,nextTokenOccurrence:R.idx,ruleStack:T,occurrenceStack:A}),c=!0;else throw Error("non exhaustive match");else if(R instanceof NonTerminal){var _=cloneArr(T);_.push(R.nonTerminalName);var O=cloneArr(A);O.push(R.idx);var C={idx:y,def:R.definition.concat(o,drop(g)),ruleStack:_,occurrenceStack:O};m.push(C)}else if(R instanceof Option){var I={idx:y,def:drop(g),ruleStack:T,occurrenceStack:A};m.push(I),m.push(u);var L={idx:y,def:R.definition.concat(drop(g)),ruleStack:T,occurrenceStack:A};m.push(L)}else if(R instanceof RepetitionMandatory){var b=new Repetition({definition:R.definition,idx:R.idx}),w=R.definition.concat([b],drop(g)),C={idx:y,def:w,ruleStack:T,occurrenceStack:A};m.push(C)}else if(R instanceof RepetitionMandatoryWithSeparator){var F=new Terminal({terminalType:R.separator}),b=new Repetition({definition:[F].concat(R.definition),idx:R.idx}),w=R.definition.concat([b],drop(g)),C={idx:y,def:w,ruleStack:T,occurrenceStack:A};m.push(C)}else if(R instanceof RepetitionWithSeparator){var I={idx:y,def:drop(g),ruleStack:T,occurrenceStack:A};m.push(I),m.push(u);var F=new Terminal({terminalType:R.separator}),P=new Repetition({definition:[F].concat(R.definition),idx:R.idx}),w=R.definition.concat([P],drop(g)),L={idx:y,def:w,ruleStack:T,occurrenceStack:A};m.push(L)}else if(R instanceof Repetition){var I={idx:y,def:drop(g),ruleStack:T,occurrenceStack:A};m.push(I),m.push(u);var P=new Repetition({definition:R.definition,idx:R.idx}),w=R.definition.concat([P],drop(g)),L={idx:y,def:w,ruleStack:T,occurrenceStack:A};m.push(L)}else if(R instanceof Alternation)for(var x=R.definition.length-1;x>=0;x--){var B=R.definition[x],k={idx:y,def:B.definition.concat(drop(g)),ruleStack:T,occurrenceStack:A};m.push(k),m.push(u)}else if(R instanceof Flat)m.push({idx:y,def:R.definition.concat(drop(g)),ruleStack:T,occurrenceStack:A});else if(R instanceof Rule)m.push(expandTopLevelRule(R,y,T,A));else throw Error("non exhaustive match")}}return p}function expandTopLevelRule(i,e,t,r){var a=cloneArr(t);a.push(i.name);var o=cloneArr(r);return o.push(1),{idx:e,def:i.definition,ruleStack:a,occurrenceStack:o}}var __extends$3=function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o])},i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),PROD_TYPE;(function(i){i[i.OPTION=0]="OPTION",i[i.REPETITION=1]="REPETITION",i[i.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",i[i.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",i[i.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",i[i.ALTERNATION=5]="ALTERNATION"})(PROD_TYPE||(PROD_TYPE={}));function getProdType(i){if(i instanceof Option)return PROD_TYPE.OPTION;if(i instanceof Repetition)return PROD_TYPE.REPETITION;if(i instanceof RepetitionMandatory)return PROD_TYPE.REPETITION_MANDATORY;if(i instanceof RepetitionMandatoryWithSeparator)return PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR;if(i instanceof RepetitionWithSeparator)return PROD_TYPE.REPETITION_WITH_SEPARATOR;if(i instanceof Alternation)return PROD_TYPE.ALTERNATION;throw Error("non exhaustive match")}function buildLookaheadFuncForOr(i,e,t,r,a,o){var u=getLookaheadPathsForOr(i,e,t),c=areTokenCategoriesNotUsed(u)?tokenStructuredMatcherNoCategories:tokenStructuredMatcher;return o(u,r,c,a)}function buildLookaheadFuncForOptionalProd(i,e,t,r,a,o){var u=getLookaheadPathsForOptionalProd(i,e,a,t),c=areTokenCategoriesNotUsed(u)?tokenStructuredMatcherNoCategories:tokenStructuredMatcher;return o(u[0],c,r)}function buildAlternativesLookAheadFunc(i,e,t,r){var a=i.length,o=every(i,function(h){return every(h,function(d){return d.length===1})});if(e)return function(h){for(var d=map(h,function(N){return N.GATE}),p=0;p<a;p++){var m=i[p],f=m.length,g=d[p];if(!(g!==void 0&&g.call(this)===!1))e:for(var y=0;y<f;y++){for(var T=m[y],A=T.length,R=0;R<A;R++){var C=this.LA(R+1);if(t(C,T[R])===!1)continue e}return p}}};if(o&&!r){var u=map(i,function(h){return flatten(h)}),c=reduce(u,function(h,d,p){return forEach(d,function(m){has(h,m.tokenTypeIdx)||(h[m.tokenTypeIdx]=p),forEach(m.categoryMatches,function(f){has(h,f)||(h[f]=p)})}),h},[]);return function(){var h=this.LA(1);return c[h.tokenTypeIdx]}}else return function(){for(var h=0;h<a;h++){var d=i[h],p=d.length;e:for(var m=0;m<p;m++){for(var f=d[m],g=f.length,y=0;y<g;y++){var T=this.LA(y+1);if(t(T,f[y])===!1)continue e}return h}}}}function buildSingleAlternativeLookaheadFunction(i,e,t){var r=every(i,function(d){return d.length===1}),a=i.length;if(r&&!t){var o=flatten(i);if(o.length===1&&isEmpty(o[0].categoryMatches)){var u=o[0],c=u.tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===c}}else{var h=reduce(o,function(d,p,m){return d[p.tokenTypeIdx]=!0,forEach(p.categoryMatches,function(f){d[f]=!0}),d},[]);return function(){var d=this.LA(1);return h[d.tokenTypeIdx]===!0}}}else return function(){e:for(var d=0;d<a;d++){for(var p=i[d],m=p.length,f=0;f<m;f++){var g=this.LA(f+1);if(e(g,p[f])===!1)continue e}return!0}return!1}}var RestDefinitionFinderWalker=function(i){__extends$3(e,i);function e(t,r,a){var o=i.call(this)||this;return o.topProd=t,o.targetOccurrence=r,o.targetProdType=a,o}return e.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},e.prototype.checkIsTarget=function(t,r,a,o){return t.idx===this.targetOccurrence&&this.targetProdType===r?(this.restDef=a.concat(o),!0):!1},e.prototype.walkOption=function(t,r,a){this.checkIsTarget(t,PROD_TYPE.OPTION,r,a)||i.prototype.walkOption.call(this,t,r,a)},e.prototype.walkAtLeastOne=function(t,r,a){this.checkIsTarget(t,PROD_TYPE.REPETITION_MANDATORY,r,a)||i.prototype.walkOption.call(this,t,r,a)},e.prototype.walkAtLeastOneSep=function(t,r,a){this.checkIsTarget(t,PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,r,a)||i.prototype.walkOption.call(this,t,r,a)},e.prototype.walkMany=function(t,r,a){this.checkIsTarget(t,PROD_TYPE.REPETITION,r,a)||i.prototype.walkOption.call(this,t,r,a)},e.prototype.walkManySep=function(t,r,a){this.checkIsTarget(t,PROD_TYPE.REPETITION_WITH_SEPARATOR,r,a)||i.prototype.walkOption.call(this,t,r,a)},e}(RestWalker),InsideDefinitionFinderVisitor=function(i){__extends$3(e,i);function e(t,r,a){var o=i.call(this)||this;return o.targetOccurrence=t,o.targetProdType=r,o.targetRef=a,o.result=[],o}return e.prototype.checkIsTarget=function(t,r){t.idx===this.targetOccurrence&&this.targetProdType===r&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)},e.prototype.visitOption=function(t){this.checkIsTarget(t,PROD_TYPE.OPTION)},e.prototype.visitRepetition=function(t){this.checkIsTarget(t,PROD_TYPE.REPETITION)},e.prototype.visitRepetitionMandatory=function(t){this.checkIsTarget(t,PROD_TYPE.REPETITION_MANDATORY)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.checkIsTarget(t,PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR)},e.prototype.visitRepetitionWithSeparator=function(t){this.checkIsTarget(t,PROD_TYPE.REPETITION_WITH_SEPARATOR)},e.prototype.visitAlternation=function(t){this.checkIsTarget(t,PROD_TYPE.ALTERNATION)},e}(GAstVisitor);function initializeArrayOfArrays(i){for(var e=new Array(i),t=0;t<i;t++)e[t]=[];return e}function pathToHashKeys(i){for(var e=[""],t=0;t<i.length;t++){for(var r=i[t],a=[],o=0;o<e.length;o++){var u=e[o];a.push(u+"_"+r.tokenTypeIdx);for(var c=0;c<r.categoryMatches.length;c++){var h="_"+r.categoryMatches[c];a.push(u+h)}}e=a}return e}function isUniquePrefixHash(i,e,t){for(var r=0;r<i.length;r++)if(r!==t)for(var a=i[r],o=0;o<e.length;o++){var u=e[o];if(a[u]===!0)return!1}return!0}function lookAheadSequenceFromAlternatives(i,e){for(var t=map(i,function(p){return possiblePathsFrom([p],1)}),r=initializeArrayOfArrays(t.length),a=map(t,function(p){var m={};return forEach(p,function(f){var g=pathToHashKeys(f.partialPath);forEach(g,function(y){m[y]=!0})}),m}),o=t,u=1;u<=e;u++){var c=o;o=initializeArrayOfArrays(c.length);for(var h=function(p){for(var m=c[p],f=0;f<m.length;f++){var g=m[f].partialPath,y=m[f].suffixDef,T=pathToHashKeys(g),A=isUniquePrefixHash(a,T,p);if(A||isEmpty(y)||g.length===e){var R=r[p];if(containsPath(R,g)===!1){R.push(g);for(var C=0;C<T.length;C++){var N=T[C];a[p][N]=!0}}}else{var S=possiblePathsFrom(y,u+1,g);o[p]=o[p].concat(S),forEach(S,function(_){var O=pathToHashKeys(_.partialPath);forEach(O,function(I){a[p][I]=!0})})}}},d=0;d<c.length;d++)h(d)}return r}function getLookaheadPathsForOr(i,e,t,r){var a=new InsideDefinitionFinderVisitor(i,PROD_TYPE.ALTERNATION,r);return e.accept(a),lookAheadSequenceFromAlternatives(a.result,t)}function getLookaheadPathsForOptionalProd(i,e,t,r){var a=new InsideDefinitionFinderVisitor(i,t);e.accept(a);var o=a.result,u=new RestDefinitionFinderWalker(e,i,t),c=u.startWalking(),h=new Flat({definition:o}),d=new Flat({definition:c});return lookAheadSequenceFromAlternatives([h,d],r)}function containsPath(i,e){e:for(var t=0;t<i.length;t++){var r=i[t];if(r.length===e.length){for(var a=0;a<r.length;a++){var o=e[a],u=r[a],c=o===u||u.categoryMatchesMap[o.tokenTypeIdx]!==void 0;if(c===!1)continue e}return!0}}return!1}function isStrictPrefixOfPath(i,e){return i.length<e.length&&every(i,function(t,r){var a=e[r];return t===a||a.categoryMatchesMap[t.tokenTypeIdx]})}function areTokenCategoriesNotUsed(i){return every(i,function(e){return every(e,function(t){return every(t,function(r){return isEmpty(r.categoryMatches)})})})}var __extends$2=function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o])},i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function validateGrammar$1(i,e,t,r,a,o){var u=map(i,function(C){return validateDuplicateProductions(C,a)}),c=map(i,function(C){return validateNoLeftRecursion(C,C,a)}),h=[],d=[],p=[];every(c,isEmpty)&&(h=map(i,function(C){return validateEmptyOrAlternative(C,a)}),d=map(i,function(C){return validateAmbiguousAlternationAlternatives(C,e,r,a)}),p=validateSomeNonEmptyLookaheadPath(i,e,a));var m=checkTerminalAndNoneTerminalsNameSpace(i,t,a),f=map(t,function(C){return validateTokenName(C,a)}),g=validateNestedRulesNames(i,a),y=validateDuplicateNestedRules(i,a),T=map(i,function(C){return validateTooManyAlts(C,a)}),A=map(i,function(C){return validateRuleName(C,a)}),R=map(i,function(C){return validateRuleDoesNotAlreadyExist(C,i,o,a)});return flatten(u.concat(f,g,y,p,c,h,d,m,T,A,R))}function validateNestedRulesNames(i,e){var t=[];return forEach(i,function(r){var a=new NamedDSLMethodsCollectorVisitor("");r.accept(a);var o=map(a.result,function(u){return u.orgProd});t.push(map(o,function(u){return validateNestedRuleName(r,u,e)}))}),flatten(t)}function validateDuplicateProductions(i,e){var t=new OccurrenceValidationCollector;i.accept(t);var r=t.allProductions,a=groupBy(r,identifyProductionForDuplicates),o=pick(a,function(c){return c.length>1}),u=map(values(o),function(c){var h=first$1(c),d=e.buildDuplicateFoundError(i,c),p=getProductionDslName(h),m={message:d,type:ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:i.name,dslName:p,occurrence:h.idx},f=getExtraProductionArgument(h);return f&&(m.parameter=f),m});return u}function identifyProductionForDuplicates(i){return getProductionDslName(i)+"_#_"+i.idx+"_#_"+getExtraProductionArgument(i)}function getExtraProductionArgument(i){return i instanceof Terminal?i.terminalType.name:i instanceof NonTerminal?i.nonTerminalName:""}var OccurrenceValidationCollector=function(i){__extends$2(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t.allProductions=[],t}return e.prototype.visitNonTerminal=function(t){this.allProductions.push(t)},e.prototype.visitOption=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetition=function(t){this.allProductions.push(t)},e.prototype.visitAlternation=function(t){this.allProductions.push(t)},e.prototype.visitTerminal=function(t){this.allProductions.push(t)},e}(GAstVisitor),validTermsPattern=/^[a-zA-Z_]\w*$/,validNestedRuleName=new RegExp(validTermsPattern.source.replace("^","^\\$"));function validateRuleName(i,e){var t=[],r=i.name;return r.match(validTermsPattern)||t.push({message:e.buildInvalidRuleNameError({topLevelRule:i,expectedPattern:validTermsPattern}),type:ParserDefinitionErrorType.INVALID_RULE_NAME,ruleName:r}),t}function validateNestedRuleName(i,e,t){var r=[],a;return e.name.match(validNestedRuleName)||(a=t.buildInvalidNestedRuleNameError(i,e),r.push({message:a,type:ParserDefinitionErrorType.INVALID_NESTED_RULE_NAME,ruleName:i.name})),r}function validateTokenName(i,e){var t=[],r=i.name;return r.match(validTermsPattern)||t.push({message:e.buildTokenNameError({tokenType:i,expectedPattern:validTermsPattern}),type:ParserDefinitionErrorType.INVALID_TOKEN_NAME}),t}function validateRuleDoesNotAlreadyExist(i,e,t,r){var a=[],o=reduce(e,function(c,h){return h.name===i.name?c+1:c},0);if(o>1){var u=r.buildDuplicateRuleNameError({topLevelRule:i,grammarName:t});a.push({message:u,type:ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:i.name})}return a}function validateRuleIsOverridden(i,e,t){var r=[],a;return contains(e,i)||(a="Invalid rule override, rule: ->"+i+"<- cannot be overridden in the grammar: ->"+t+"<-as it is not defined in any of the super grammars ",r.push({message:a,type:ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:i})),r}function validateNoLeftRecursion(i,e,t,r){r===void 0&&(r=[]);var a=[],o=getFirstNoneTerminal(e.definition);if(isEmpty(o))return[];var u=i.name,c=contains(o,i);c&&a.push({message:t.buildLeftRecursionError({topLevelRule:i,leftRecursionPath:r}),type:ParserDefinitionErrorType.LEFT_RECURSION,ruleName:u});var h=difference(o,r.concat([i])),d=map(h,function(p){var m=cloneArr(r);return m.push(p),validateNoLeftRecursion(i,p,t,m)});return a.concat(flatten(d))}function getFirstNoneTerminal(i){var e=[];if(isEmpty(i))return e;var t=first$1(i);if(t instanceof NonTerminal)e.push(t.referencedRule);else if(t instanceof Flat||t instanceof Option||t instanceof RepetitionMandatory||t instanceof RepetitionMandatoryWithSeparator||t instanceof RepetitionWithSeparator||t instanceof Repetition)e=e.concat(getFirstNoneTerminal(t.definition));else if(t instanceof Alternation)e=flatten(map(t.definition,function(u){return getFirstNoneTerminal(u.definition)}));else if(!(t instanceof Terminal))throw Error("non exhaustive match");var r=isOptionalProd(t),a=i.length>1;if(r&&a){var o=drop(i);return e.concat(getFirstNoneTerminal(o))}else return e}var OrCollector=function(i){__extends$2(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t.alternations=[],t}return e.prototype.visitAlternation=function(t){this.alternations.push(t)},e}(GAstVisitor);function validateEmptyOrAlternative(i,e){var t=new OrCollector;i.accept(t);var r=t.alternations,a=reduce(r,function(o,u){var c=dropRight(u.definition),h=map(c,function(d,p){var m=nextPossibleTokensAfter([d],[],null,1);return isEmpty(m)?{message:e.buildEmptyAlternationError({topLevelRule:i,alternation:u,emptyChoiceIdx:p}),type:ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:i.name,occurrence:u.idx,alternative:p+1}:null});return o.concat(compact(h))},[]);return a}function validateAmbiguousAlternationAlternatives(i,e,t,r){var a=new OrCollector;i.accept(a);var o=a.alternations,u=t[i.name];u&&(o=reject(o,function(h){return u[getProductionDslName(h)+(h.idx===0?"":h.idx)]})),o=reject(o,function(h){return h.ignoreAmbiguities===!0});var c=reduce(o,function(h,d){var p=d.idx,m=d.maxLookahead||e,f=getLookaheadPathsForOr(p,i,m,d),g=checkAlternativesAmbiguities(f,d,i,r),y=checkPrefixAlternativesAmbiguities(f,d,i,r);return h.concat(g,y)},[]);return c}var RepetionCollector=function(i){__extends$2(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t.allProductions=[],t}return e.prototype.visitRepetitionWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetition=function(t){this.allProductions.push(t)},e}(GAstVisitor);function validateTooManyAlts(i,e){var t=new OrCollector;i.accept(t);var r=t.alternations,a=reduce(r,function(o,u){return u.definition.length>255&&o.push({message:e.buildTooManyAlternativesError({topLevelRule:i,alternation:u}),type:ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:i.name,occurrence:u.idx}),o},[]);return a}function validateSomeNonEmptyLookaheadPath(i,e,t){var r=[];return forEach(i,function(a){var o=new RepetionCollector;a.accept(o);var u=o.allProductions;forEach(u,function(c){var h=getProdType(c),d=c.maxLookahead||e,p=c.idx,m=getLookaheadPathsForOptionalProd(p,a,h,d),f=m[0];if(isEmpty(flatten(f))){var g=t.buildEmptyRepetitionError({topLevelRule:a,repetition:c});r.push({message:g,type:ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:a.name})}})}),r}function checkAlternativesAmbiguities(i,e,t,r){var a=[],o=reduce(i,function(c,h,d){return e.definition[d].ignoreAmbiguities===!0||forEach(h,function(p){var m=[d];forEach(i,function(f,g){d!==g&&containsPath(f,p)&&e.definition[g].ignoreAmbiguities!==!0&&m.push(g)}),m.length>1&&!containsPath(a,p)&&(a.push(p),c.push({alts:m,path:p}))}),c},[]),u=map(o,function(c){var h=map(c.alts,function(p){return p+1}),d=r.buildAlternationAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:h,prefixPath:c.path});return{message:d,type:ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:t.name,occurrence:e.idx,alternatives:[c.alts]}});return u}function checkPrefixAlternativesAmbiguities(i,e,t,r){var a=[],o=reduce(i,function(u,c,h){var d=map(c,function(p){return{idx:h,path:p}});return u.concat(d)},[]);return forEach(o,function(u){var c=e.definition[u.idx];if(c.ignoreAmbiguities!==!0){var h=u.idx,d=u.path,p=findAll(o,function(f){return e.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<h&&isStrictPrefixOfPath(f.path,d)}),m=map(p,function(f){var g=[f.idx+1,h+1],y=e.idx===0?"":e.idx,T=r.buildAlternationPrefixAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:g,prefixPath:f.path});return{message:T,type:ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:t.name,occurrence:y,alternatives:g}});a=a.concat(m)}}),a}function checkTerminalAndNoneTerminalsNameSpace(i,e,t){var r=[],a=map(e,function(o){return o.name});return forEach(i,function(o){var u=o.name;if(contains(a,u)){var c=t.buildNamespaceConflictError(o);r.push({message:c,type:ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:u})}}),r}function validateDuplicateNestedRules(i,e){var t=[];return forEach(i,function(r){var a=new NamedDSLMethodsCollectorVisitor("");r.accept(a);var o=groupBy(a.result,function(c){return c.name}),u=pick(o,function(c){return c.length>1});forEach(values(u),function(c){var h=map(c,function(p){return p.orgProd}),d=e.buildDuplicateNestedRuleNameError(r,h);t.push({message:d,type:ParserDefinitionErrorType.DUPLICATE_NESTED_NAME,ruleName:r.name})})}),t}var defaultParserErrorProvider={buildMismatchTokenMessage:function(i){var e=i.expected,t=i.actual;i.previous,i.ruleName;var r=hasTokenLabel(e),a=r?"--> "+tokenLabel(e)+" <--":"token of type --> "+e.name+" <--",o="Expecting "+a+" but found --> '"+t.image+"' <--";return o},buildNotAllInputParsedMessage:function(i){var e=i.firstRedundant;return i.ruleName,"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage:function(i){var e=i.expectedPathsPerAlt,t=i.actual;i.previous;var r=i.customUserDescription;i.ruleName;var a="Expecting: ",o=first$1(t).image,u=`
but found: '`+o+"'";if(r)return a+r+u;var c=reduce(e,function(m,f){return m.concat(f)},[]),h=map(c,function(m){return"["+map(m,function(f){return tokenLabel(f)}).join(", ")+"]"}),d=map(h,function(m,f){return"  "+(f+1)+". "+m}),p=`one of these possible Token sequences:
`+d.join(`
`);return a+p+u},buildEarlyExitMessage:function(i){var e=i.expectedIterationPaths,t=i.actual,r=i.customUserDescription;i.ruleName;var a="Expecting: ",o=first$1(t).image,u=`
but found: '`+o+"'";if(r)return a+r+u;var c=map(e,function(d){return"["+map(d,function(p){return tokenLabel(p)}).join(",")+"]"}),h=`expecting at least one iteration which starts with one of these possible Token sequences::
  `+("<"+c.join(" ,")+">");return a+h+u}};Object.freeze(defaultParserErrorProvider);var defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(i,e){var t="Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+i.name+"<-";return t}},defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(i,e){function t(p){return p instanceof Terminal?p.terminalType.name:p instanceof NonTerminal?p.nonTerminalName:""}var r=i.name,a=first$1(e),o=a.idx,u=getProductionDslName(a),c=t(a),h=o>0,d="->"+u+(h?o:"")+"<- "+(c?"with argument: ->"+c+"<-":"")+`
                  appears more than once (`+e.length+" times) in the top level rule: ->"+r+`<-.                  
                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return d=d.replace(/[ \t]+/g," "),d=d.replace(/\s\s+/g,`
`),d},buildInvalidNestedRuleNameError:function(i,e){var t="Invalid nested rule name: ->"+e.name+"<- inside rule: ->"+i.name+`<-
`+("it must match the pattern: ->"+validNestedRuleName.toString()+`<-.
`)+"Note that this means a nested rule name must start with the '$'(dollar) sign.";return t},buildDuplicateNestedRuleNameError:function(i,e){var t=first$1(e).name,r="Duplicate nested rule name: ->"+t+"<- inside rule: ->"+i.name+`<-
A nested name must be unique in the scope of a top level grammar rule.`;return r},buildNamespaceConflictError:function(i){var e=`Namespace conflict found in grammar.
`+("The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+i.name+`>.
`)+`To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`;return e},buildAlternationPrefixAmbiguityError:function(i){var e=map(i.prefixPath,function(a){return tokenLabel(a)}).join(", "),t=i.alternation.idx===0?"":i.alternation.idx,r="Ambiguous alternatives: <"+i.ambiguityIndices.join(" ,")+`> due to common lookahead prefix
`+("in <OR"+t+"> inside <"+i.topLevelRule.name+`> Rule,
`)+("<"+e+`> may appears as a prefix path in all these alternatives.
`)+`See: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`;return r},buildAlternationAmbiguityError:function(i){var e=map(i.prefixPath,function(a){return tokenLabel(a)}).join(", "),t=i.alternation.idx===0?"":i.alternation.idx,r="Ambiguous Alternatives Detected: <"+i.ambiguityIndices.join(" ,")+"> in <OR"+t+">"+(" inside <"+i.topLevelRule.name+`> Rule,
`)+("<"+e+`> may appears as a prefix path in all these alternatives.
`);return r=r+`See: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError:function(i){var e=getProductionDslName(i.repetition);i.repetition.idx!==0&&(e+=i.repetition.idx);var t="The repetition <"+e+"> within Rule <"+i.topLevelRule.name+`> can never consume any tokens.
This could lead to an infinite loop.`;return t},buildTokenNameError:function(i){var e=i.tokenType.name,t="Invalid Grammar Token name: ->"+e+"<- it must match the pattern: ->"+i.expectedPattern.toString()+"<-";return t},buildEmptyAlternationError:function(i){var e="Ambiguous empty alternative: <"+(i.emptyChoiceIdx+1)+">"+(" in <OR"+i.alternation.idx+"> inside <"+i.topLevelRule.name+`> Rule.
`)+"Only the last alternative may be an empty alternative.";return e},buildTooManyAlternativesError:function(i){var e=`An Alternation cannot have more than 256 alternatives:
`+("<OR"+i.alternation.idx+"> inside <"+i.topLevelRule.name+`> Rule.
 has `+(i.alternation.definition.length+1)+" alternatives.");return e},buildLeftRecursionError:function(i){var e=i.topLevelRule.name,t=map(i.leftRecursionPath,function(o){return o.name}),r=e+" --> "+t.concat([e]).join(" --> "),a=`Left Recursion found in grammar.
`+("rule: <"+e+`> can be invoked from itself (directly or indirectly)
`)+(`without consuming any Tokens. The grammar path that causes this is: 
 `+r+`
`)+` To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring.`;return a},buildInvalidRuleNameError:function(i){var e=i.topLevelRule.name,t=i.expectedPattern.toString(),r="Invalid grammar rule name: ->"+e+"<- it must match the pattern: ->"+t+"<-";return r},buildDuplicateRuleNameError:function(i){var e;i.topLevelRule instanceof Rule?e=i.topLevelRule.name:e=i.topLevelRule;var t="Duplicate definition, rule: ->"+e+"<- is already defined in the grammar: ->"+i.grammarName+"<-";return t}},__extends$1=function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o])},i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function resolveGrammar$1(i,e){var t=new GastRefResolverVisitor(i,e);return t.resolveRefs(),t.errors}var GastRefResolverVisitor=function(i){__extends$1(e,i);function e(t,r){var a=i.call(this)||this;return a.nameToTopRule=t,a.errMsgProvider=r,a.errors=[],a}return e.prototype.resolveRefs=function(){var t=this;forEach(values(this.nameToTopRule),function(r){t.currTopLevel=r,r.accept(t)})},e.prototype.visitNonTerminal=function(t){var r=this.nameToTopRule[t.nonTerminalName];if(r)t.referencedRule=r;else{var a=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:a,type:ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}},e}(GAstVisitor);function resolveGrammar(i){i=defaults(i,{errMsgProvider:defaultGrammarResolverErrorProvider});var e={};return forEach(i.rules,function(t){e[t.name]=t}),resolveGrammar$1(e,i.errMsgProvider)}function validateGrammar(i){return i=defaults(i,{errMsgProvider:defaultGrammarValidatorErrorProvider,ignoredIssues:{}}),validateGrammar$1(i.rules,i.maxLookahead,i.tokenTypes,i.ignoredIssues,i.errMsgProvider,i.grammarName)}var MISMATCHED_TOKEN_EXCEPTION="MismatchedTokenException",NO_VIABLE_ALT_EXCEPTION="NoViableAltException",EARLY_EXIT_EXCEPTION="EarlyExitException",NOT_ALL_INPUT_PARSED_EXCEPTION="NotAllInputParsedException",RECOGNITION_EXCEPTION_NAMES=[MISMATCHED_TOKEN_EXCEPTION,NO_VIABLE_ALT_EXCEPTION,EARLY_EXIT_EXCEPTION,NOT_ALL_INPUT_PARSED_EXCEPTION];Object.freeze(RECOGNITION_EXCEPTION_NAMES);function isRecognitionException(i){return contains(RECOGNITION_EXCEPTION_NAMES,i.name)}function MismatchedTokenException(i,e,t){this.name=MISMATCHED_TOKEN_EXCEPTION,this.message=i,this.token=e,this.previousToken=t,this.resyncedTokens=[]}MismatchedTokenException.prototype=Error.prototype;function NoViableAltException(i,e,t){this.name=NO_VIABLE_ALT_EXCEPTION,this.message=i,this.token=e,this.previousToken=t,this.resyncedTokens=[]}NoViableAltException.prototype=Error.prototype;function NotAllInputParsedException(i,e){this.name=NOT_ALL_INPUT_PARSED_EXCEPTION,this.message=i,this.token=e,this.resyncedTokens=[]}NotAllInputParsedException.prototype=Error.prototype;function EarlyExitException(i,e,t){this.name=EARLY_EXIT_EXCEPTION,this.message=i,this.token=e,this.previousToken=t,this.resyncedTokens=[]}EarlyExitException.prototype=Error.prototype;var EOF_FOLLOW_KEY={},IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException";function InRuleRecoveryException(i){this.name=IN_RULE_RECOVERY_EXCEPTION,this.message=i}InRuleRecoveryException.prototype=Error.prototype;var Recoverable=function(){function i(){}return i.prototype.initRecoverable=function(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=has(e,"recoveryEnabled")?e.recoveryEnabled:DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=attemptInRepetitionRecovery)},i.prototype.getTokenToInsert=function(e){var t=createTokenInstance(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t},i.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},i.prototype.tryInRepetitionRecovery=function(e,t,r,a){for(var o=this,u=this.findReSyncTokenType(),c=this.exportLexerState(),h=[],d=!1,p=this.LA(1),m=this.LA(1),f=function(){var g=o.LA(0),y=o.errorMessageProvider.buildMismatchTokenMessage({expected:a,actual:p,previous:g,ruleName:o.getCurrRuleFullName()}),T=new MismatchedTokenException(y,p,o.LA(0));T.resyncedTokens=dropRight(h),o.SAVE_ERROR(T)};!d;)if(this.tokenMatcher(m,a)){f();return}else if(r.call(this)){f(),e.apply(this,t);return}else this.tokenMatcher(m,u)?d=!0:(m=this.SKIP_TOKEN(),this.addToResyncTokens(m,h));this.importLexerState(c)},i.prototype.shouldInRepetitionRecoveryBeTried=function(e,t,r){return!(r===!1||e===void 0||t===void 0||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t)))},i.prototype.getFollowsForInRuleRecovery=function(e,t){var r=this.getCurrentGrammarPath(e,t),a=this.getNextPossibleTokenTypes(r);return a},i.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t)){var r=this.getTokenToInsert(e);return r}if(this.canRecoverWithSingleTokenDeletion(e)){var a=this.SKIP_TOKEN();return this.consumeToken(),a}throw new InRuleRecoveryException("sad sad panda")},i.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},i.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var r=this;if(!this.canTokenTypeBeInsertedInRecovery(e)||isEmpty(t))return!1;var a=this.LA(1),o=find(t,function(u){return r.tokenMatcher(a,u)})!==void 0;return o},i.prototype.canRecoverWithSingleTokenDeletion=function(e){var t=this.tokenMatcher(this.LA(2),e);return t},i.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return contains(r,e)},i.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),r=2;;){var a=t.tokenType;if(contains(e,a))return a;t=this.LA(r),r++}},i.prototype.getCurrFollowKey=function(){if(this.RULE_STACK.length===1)return EOF_FOLLOW_KEY;var e=this.getLastExplicitRuleShortName(),t=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:t,inRule:this.shortRuleNameToFullName(r)}},i.prototype.buildFullFollowKeyStack=function(){var e=this,t=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return isEmpty(this.LAST_EXPLICIT_RULE_STACK)||(t=map(this.LAST_EXPLICIT_RULE_STACK,function(a){return e.RULE_STACK[a]}),r=map(this.LAST_EXPLICIT_RULE_STACK,function(a){return e.RULE_OCCURRENCE_STACK[a]})),map(t,function(a,o){return o===0?EOF_FOLLOW_KEY:{ruleName:e.shortRuleNameToFullName(a),idxInCallingRule:r[o],inRule:e.shortRuleNameToFullName(t[o-1])}})},i.prototype.flattenFollowSet=function(){var e=this,t=map(this.buildFullFollowKeyStack(),function(r){return e.getFollowSetFromFollowKey(r)});return flatten(t)},i.prototype.getFollowSetFromFollowKey=function(e){if(e===EOF_FOLLOW_KEY)return[EOF];var t=e.ruleName+e.idxInCallingRule+IN+e.inRule;return this.resyncFollows[t]},i.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,EOF)||t.push(e),t},i.prototype.reSyncTo=function(e){for(var t=[],r=this.LA(1);this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return dropRight(t)},i.prototype.attemptInRepetitionRecovery=function(e,t,r,a,o,u,c){},i.prototype.getCurrentGrammarPath=function(e,t){var r=this.getHumanReadableRuleStack(),a=cloneArr(this.RULE_OCCURRENCE_STACK),o={ruleStack:r,occurrenceStack:a,lastTok:e,lastTokOccurrence:t};return o},i.prototype.getHumanReadableRuleStack=function(){var e=this;return isEmpty(this.LAST_EXPLICIT_RULE_STACK)?map(this.RULE_STACK,function(t){return e.shortRuleNameToFullName(t)}):map(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.shortRuleNameToFullName(e.RULE_STACK[t])})},i}();function attemptInRepetitionRecovery(i,e,t,r,a,o,u){var c=this.getKeyForAutomaticLookahead(r,a),h=this.firstAfterRepMap[c];if(h===void 0){var d=this.getCurrRuleFullName(),p=this.getGAstProductions()[d],m=new o(p,a);h=m.startWalking(),this.firstAfterRepMap[c]=h}var f=h.token,g=h.occurrence,y=h.isEndOfRule;this.RULE_STACK.length===1&&y&&f===void 0&&(f=EOF,g=1),this.shouldInRepetitionRecoveryBeTried(f,g,u)&&this.tryInRepetitionRecovery(i,e,t,f)}var LooksAhead=function(){function i(){}return i.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=has(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=has(e,"maxLookahead")?e.maxLookahead:DEFAULT_PARSER_CONFIG.maxLookahead,this.lookAheadFuncsCache=isES2015MapSupported()?new Map:[],isES2015MapSupported()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},i.prototype.preComputeLookaheadFunctions=function(e){var t=this;forEach(e,function(r){t.TRACE_INIT(r.name+" Rule Lookahead",function(){var a=collectMethods(r),o=a.alternation,u=a.repetition,c=a.option,h=a.repetitionMandatory,d=a.repetitionMandatoryWithSeparator,p=a.repetitionWithSeparator;forEach(o,function(m){var f=m.idx===0?"":m.idx;t.TRACE_INIT(""+getProductionDslName(m)+f,function(){var g=buildLookaheadFuncForOr(m.idx,r,m.maxLookahead||t.maxLookahead,m.hasPredicates,t.dynamicTokensEnabled,t.lookAheadBuilderForAlternatives),y=getKeyForAutomaticLookahead(t.fullRuleNameToShort[r.name],OR_IDX,m.idx);t.setLaFuncCache(y,g)})}),forEach(u,function(m){t.computeLookaheadFunc(r,m.idx,MANY_IDX,PROD_TYPE.REPETITION,m.maxLookahead,getProductionDslName(m))}),forEach(c,function(m){t.computeLookaheadFunc(r,m.idx,OPTION_IDX,PROD_TYPE.OPTION,m.maxLookahead,getProductionDslName(m))}),forEach(h,function(m){t.computeLookaheadFunc(r,m.idx,AT_LEAST_ONE_IDX,PROD_TYPE.REPETITION_MANDATORY,m.maxLookahead,getProductionDslName(m))}),forEach(d,function(m){t.computeLookaheadFunc(r,m.idx,AT_LEAST_ONE_SEP_IDX,PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,m.maxLookahead,getProductionDslName(m))}),forEach(p,function(m){t.computeLookaheadFunc(r,m.idx,MANY_SEP_IDX,PROD_TYPE.REPETITION_WITH_SEPARATOR,m.maxLookahead,getProductionDslName(m))})})})},i.prototype.computeLookaheadFunc=function(e,t,r,a,o,u){var c=this;this.TRACE_INIT(""+u+(t===0?"":t),function(){var h=buildLookaheadFuncForOptionalProd(t,e,o||c.maxLookahead,c.dynamicTokensEnabled,a,c.lookAheadBuilderForOptional),d=getKeyForAutomaticLookahead(c.fullRuleNameToShort[e.name],r,t);c.setLaFuncCache(d,h)})},i.prototype.lookAheadBuilderForOptional=function(e,t,r){return buildSingleAlternativeLookaheadFunction(e,t,r)},i.prototype.lookAheadBuilderForAlternatives=function(e,t,r,a){return buildAlternativesLookAheadFunc(e,t,r,a)},i.prototype.getKeyForAutomaticLookahead=function(e,t){var r=this.getLastExplicitRuleShortName();return getKeyForAutomaticLookahead(r,e,t)},i.prototype.getLaFuncFromCache=function(e){},i.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},i.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},i.prototype.setLaFuncCache=function(e,t){},i.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},i.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},i}();function classNameFromInstance(i){return functionName(i.constructor)}var FUNC_NAME_REGEXP=/^\s*function\s*(\S*)\s*\(/,NAME="name";function functionName(i){var e=i.name;if(e)return e;var t=i.toString().match(FUNC_NAME_REGEXP)[1];return t}function defineNameProp(i,e){var t=Object.getOwnPropertyDescriptor(i,NAME);return isUndefined(t)||t.configurable?(Object.defineProperty(i,NAME,{enumerable:!1,configurable:!0,writable:!1,value:e}),!0):!1}function defaultVisit(i,e){for(var t=keys(i),r=t.length,a=0;a<r;a++)for(var o=t[a],u=i[o],c=u.length,h=0;h<c;h++){var d=u[h];d.tokenTypeIdx===void 0&&(d.fullName!==void 0?this[d.fullName](d.children,e):this[d.name](d.children,e))}}function createBaseSemanticVisitorConstructor(i,e){var t=function(){};defineNameProp(t,i+"BaseSemantics");var r={visit:function(a,o){if(isArray(a)&&(a=a[0]),!isUndefined(a))return a.fullName!==void 0?this[a.fullName](a.children,o):this[a.name](a.children,o)},validateVisitor:function(){var a=validateVisitor(this,e);if(!isEmpty(a)){var o=map(a,function(u){return u.msg});throw Error("Errors Detected in CST Visitor <"+functionName(this.constructor)+`>:
	`+(""+o.join(`

`).replace(/\n/g,`
	`)))}}};return t.prototype=r,t.prototype.constructor=t,t._RULE_NAMES=e,t}function createBaseVisitorConstructorWithDefaults(i,e,t){var r=function(){};defineNameProp(r,i+"BaseSemanticsWithDefaults");var a=Object.create(t.prototype);return forEach(e,function(o){a[o]=defaultVisit}),r.prototype=a,r.prototype.constructor=r,r}var CstVisitorDefinitionError;(function(i){i[i.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",i[i.MISSING_METHOD=1]="MISSING_METHOD"})(CstVisitorDefinitionError||(CstVisitorDefinitionError={}));function validateVisitor(i,e){var t=validateMissingCstMethods(i,e),r=validateRedundantMethods(i,e);return t.concat(r)}function validateMissingCstMethods(i,e){var t=map(e,function(r){if(!isFunction(i[r]))return{msg:"Missing visitor method: <"+r+"> on "+functionName(i.constructor)+" CST Visitor.",type:CstVisitorDefinitionError.MISSING_METHOD,methodName:r}});return compact(t)}var VALID_PROP_NAMES=["constructor","visit","validateVisitor"];function validateRedundantMethods(i,e){var t=[];for(var r in i)validTermsPattern.test(r)&&isFunction(i[r])&&!contains(VALID_PROP_NAMES,r)&&!contains(e,r)&&t.push({msg:"Redundant visitor method: <"+r+"> on "+functionName(i.constructor)+` CST Visitor
There is no Grammar Rule corresponding to this method's name.
`+("For utility methods on visitor classes use methods names that do not match /"+validTermsPattern.source+"/."),type:CstVisitorDefinitionError.REDUNDANT_METHOD,methodName:r});return t}var TreeBuilder=function(){function i(){}return i.prototype.initTreeBuilder=function(e){if(this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.outputCst=has(e,"outputCst")?e.outputCst:DEFAULT_PARSER_CONFIG.outputCst,this.nodeLocationTracking=has(e,"nodeLocationTracking")?e.nodeLocationTracking:DEFAULT_PARSER_CONFIG.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=NOOP,this.cstFinallyStateUpdate=NOOP,this.cstPostTerminal=NOOP,this.cstPostNonTerminal=NOOP,this.cstPostRule=NOOP,this.getLastExplicitRuleShortName=this.getLastExplicitRuleShortNameNoCst,this.getPreviousExplicitRuleShortName=this.getPreviousExplicitRuleShortNameNoCst,this.getLastExplicitRuleOccurrenceIndex=this.getLastExplicitRuleOccurrenceIndexNoCst,this.manyInternal=this.manyInternalNoCst,this.orInternal=this.orInternalNoCst,this.optionInternal=this.optionInternalNoCst,this.atLeastOneInternal=this.atLeastOneInternalNoCst,this.manySepFirstInternal=this.manySepFirstInternalNoCst,this.atLeastOneSepFirstInternal=this.atLeastOneSepFirstInternalNoCst;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=setNodeLocationFull,this.setNodeLocationFromNode=setNodeLocationFull,this.cstPostRule=NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=NOOP,this.setNodeLocationFromNode=NOOP,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=setNodeLocationOnlyOffset,this.setNodeLocationFromNode=setNodeLocationOnlyOffset,this.cstPostRule=NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=NOOP,this.setNodeLocationFromNode=NOOP,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=NOOP,this.setNodeLocationFromNode=NOOP,this.cstPostRule=NOOP,this.setInitialNodeLocation=NOOP;else throw Error('Invalid <nodeLocationTracking> config option: "'+e.nodeLocationTracking+'"')},i.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(e){e.location={startOffset:NaN,endOffset:NaN}},i.prototype.setInitialNodeLocationOnlyOffsetRegular=function(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},i.prototype.setInitialNodeLocationFullRecovery=function(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},i.prototype.setInitialNodeLocationFullRegular=function(e){var t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},i.prototype.cstNestedInvocationStateUpdate=function(e,t){var r={name:e,fullName:this.shortRuleNameToFull[this.getLastExplicitRuleShortName()]+e,children:{}};this.setInitialNodeLocation(r),this.CST_STACK.push(r)},i.prototype.cstInvocationStateUpdate=function(e,t){this.LAST_EXPLICIT_RULE_STACK.push(this.RULE_STACK.length-1);var r={name:e,children:{}};this.setInitialNodeLocation(r),this.CST_STACK.push(r)},i.prototype.cstFinallyStateUpdate=function(){this.LAST_EXPLICIT_RULE_STACK.pop(),this.CST_STACK.pop()},i.prototype.cstNestedFinallyStateUpdate=function(){var e=this.CST_STACK.pop();this.cstPostRule(e)},i.prototype.cstPostRuleFull=function(e){var t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?(r.endOffset=t.endOffset,r.endLine=t.endLine,r.endColumn=t.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)},i.prototype.cstPostRuleOnlyOffset=function(e){var t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?r.endOffset=t.endOffset:r.startOffset=NaN},i.prototype.cstPostTerminal=function(e,t){var r=this.CST_STACK[this.CST_STACK.length-1];addTerminalToCst(r,t,e),this.setNodeLocationFromToken(r.location,t)},i.prototype.cstPostNonTerminal=function(e,t){if(this.isBackTracking()!==!0){var r=this.CST_STACK[this.CST_STACK.length-1];addNoneTerminalToCst(r,t,e),this.setNodeLocationFromNode(r.location,e.location)}},i.prototype.getBaseCstVisitorConstructor=function(){if(isUndefined(this.baseCstVisitorConstructor)){var e=createBaseSemanticVisitorConstructor(this.className,this.allRuleNames);return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},i.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(isUndefined(this.baseCstVisitorWithDefaultsConstructor)){var e=createBaseVisitorConstructorWithDefaults(this.className,this.allRuleNames,this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},i.prototype.nestedRuleBeforeClause=function(e,t){var r;if(e.NAME!==void 0)return r=e.NAME,this.nestedRuleInvocationStateUpdate(r,t),r},i.prototype.nestedAltBeforeClause=function(e,t,r,a){var o=this.getLastExplicitRuleShortName(),u=getKeyForAltIndex(o,r,t,a),c;if(e.NAME!==void 0)return c=e.NAME,this.nestedRuleInvocationStateUpdate(c,u),{shortName:u,nestedName:c}},i.prototype.nestedRuleFinallyClause=function(e,t){var r=this.CST_STACK,a=r[r.length-1];this.nestedRuleFinallyStateUpdate();var o=r[r.length-1];addNoneTerminalToCst(o,t,a),this.setNodeLocationFromNode(o.location,a.location)},i.prototype.getLastExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_STACK[e]},i.prototype.getLastExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-1]},i.prototype.getPreviousExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-2];return this.RULE_STACK[e]},i.prototype.getPreviousExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-2]},i.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_OCCURRENCE_STACK[e]},i.prototype.getLastExplicitRuleOccurrenceIndexNoCst=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},i.prototype.nestedRuleInvocationStateUpdate=function(e,t){this.RULE_OCCURRENCE_STACK.push(1),this.RULE_STACK.push(t),this.cstNestedInvocationStateUpdate(e,t)},i.prototype.nestedRuleFinallyStateUpdate=function(){this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstNestedFinallyStateUpdate()},i}(),LexerAdapter=function(){function i(){}return i.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(i.prototype,"input",{get:function(){return this.tokVector},set:function(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!0,configurable:!0}),i.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):END_OF_FILE},i.prototype.LA=function(e){var t=this.currIdx+e;return t<0||this.tokVectorLength<=t?END_OF_FILE:this.tokVector[t]},i.prototype.consumeToken=function(){this.currIdx++},i.prototype.exportLexerState=function(){return this.currIdx},i.prototype.importLexerState=function(e){this.currIdx=e},i.prototype.resetLexerState=function(){this.currIdx=-1},i.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},i.prototype.getLexerPosition=function(){return this.exportLexerState()},i}(),RecognizerApi=function(){function i(){}return i.prototype.ACTION=function(e){return e.call(this)},i.prototype.consume=function(e,t,r){return this.consumeInternal(t,e,r)},i.prototype.subrule=function(e,t,r){return this.subruleInternal(t,e,r)},i.prototype.option=function(e,t){return this.optionInternal(t,e)},i.prototype.or=function(e,t){return this.orInternal(t,e)},i.prototype.many=function(e,t){return this.manyInternal(e,t)},i.prototype.atLeastOne=function(e,t){return this.atLeastOneInternal(e,t)},i.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},i.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},i.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},i.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},i.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},i.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},i.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},i.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},i.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},i.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},i.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},i.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},i.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},i.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},i.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},i.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},i.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},i.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},i.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},i.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},i.prototype.OPTION=function(e){return this.optionInternal(e,0)},i.prototype.OPTION1=function(e){return this.optionInternal(e,1)},i.prototype.OPTION2=function(e){return this.optionInternal(e,2)},i.prototype.OPTION3=function(e){return this.optionInternal(e,3)},i.prototype.OPTION4=function(e){return this.optionInternal(e,4)},i.prototype.OPTION5=function(e){return this.optionInternal(e,5)},i.prototype.OPTION6=function(e){return this.optionInternal(e,6)},i.prototype.OPTION7=function(e){return this.optionInternal(e,7)},i.prototype.OPTION8=function(e){return this.optionInternal(e,8)},i.prototype.OPTION9=function(e){return this.optionInternal(e,9)},i.prototype.OR=function(e){return this.orInternal(e,0)},i.prototype.OR1=function(e){return this.orInternal(e,1)},i.prototype.OR2=function(e){return this.orInternal(e,2)},i.prototype.OR3=function(e){return this.orInternal(e,3)},i.prototype.OR4=function(e){return this.orInternal(e,4)},i.prototype.OR5=function(e){return this.orInternal(e,5)},i.prototype.OR6=function(e){return this.orInternal(e,6)},i.prototype.OR7=function(e){return this.orInternal(e,7)},i.prototype.OR8=function(e){return this.orInternal(e,8)},i.prototype.OR9=function(e){return this.orInternal(e,9)},i.prototype.MANY=function(e){this.manyInternal(0,e)},i.prototype.MANY1=function(e){this.manyInternal(1,e)},i.prototype.MANY2=function(e){this.manyInternal(2,e)},i.prototype.MANY3=function(e){this.manyInternal(3,e)},i.prototype.MANY4=function(e){this.manyInternal(4,e)},i.prototype.MANY5=function(e){this.manyInternal(5,e)},i.prototype.MANY6=function(e){this.manyInternal(6,e)},i.prototype.MANY7=function(e){this.manyInternal(7,e)},i.prototype.MANY8=function(e){this.manyInternal(8,e)},i.prototype.MANY9=function(e){this.manyInternal(9,e)},i.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},i.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},i.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},i.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},i.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},i.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},i.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},i.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},i.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},i.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},i.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},i.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},i.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},i.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},i.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},i.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},i.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},i.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},i.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},i.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},i.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},i.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},i.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},i.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},i.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},i.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},i.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},i.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},i.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},i.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},i.prototype.RULE=function(e,t,r){if(r===void 0&&(r=DEFAULT_RULE_CONFIG),contains(this.definedRulesNames,e)){var a=defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),o={message:a,type:ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);var u=this.defineRule(e,t,r);return this[e]=u,u},i.prototype.OVERRIDE_RULE=function(e,t,r){r===void 0&&(r=DEFAULT_RULE_CONFIG);var a=[];a=a.concat(validateRuleIsOverridden(e,this.definedRulesNames,this.className)),this.definitionErrors.push.apply(this.definitionErrors,a);var o=this.defineRule(e,t,r);return this[e]=o,o},i.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var r=this.saveRecogState();try{return e.apply(this,t),!0}catch(a){if(isRecognitionException(a))return!1;throw a}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}},i.prototype.getGAstProductions=function(){return this.gastProductionsCache},i.prototype.getSerializedGastProductions=function(){return serializeGrammar(values(this.gastProductionsCache))},i}(),RecognizerEngine=function(){function i(){}return i.prototype.initRecognizerEngine=function(e,t){if(this.className=classNameFromInstance(this),this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=tokenStructuredMatcherNoCategories,this.definedRulesNames=[],this.tokensMap={},this.allRuleNames=[],this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},has(t,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(isArray(e)){if(isEmpty(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(isArray(e))this.tokensMap=reduce(e,function(u,c){return u[c.name]=c,u},{});else if(has(e,"modes")&&every(flatten(values(e.modes)),isTokenType)){var r=flatten(values(e.modes)),a=uniq(r);this.tokensMap=reduce(a,function(u,c){return u[c.name]=c,u},{})}else if(isObject(e))this.tokensMap=cloneObj(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=EOF;var o=every(values(e),function(u){return isEmpty(u.categoryMatches)});this.tokenMatcher=o?tokenStructuredMatcherNoCategories:tokenStructuredMatcher,augmentTokenTypes(values(this.tokensMap))},i.prototype.defineRule=function(e,t,r){if(this.selfAnalysisDone)throw Error("Grammar rule <"+e+`> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);var a=has(r,"resyncEnabled")?r.resyncEnabled:DEFAULT_RULE_CONFIG.resyncEnabled,o=has(r,"recoveryValueFunc")?r.recoveryValueFunc:DEFAULT_RULE_CONFIG.recoveryValueFunc,u=this.ruleShortNameIdx<<BITS_FOR_METHOD_TYPE+BITS_FOR_OCCURRENCE_IDX;this.ruleShortNameIdx++,this.shortRuleNameToFull[u]=e,this.fullRuleNameToShort[e]=u;function c(p){try{if(this.outputCst===!0){t.apply(this,p);var m=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(m),m}else return t.apply(this,p)}catch(f){return this.invokeRuleCatch(f,a,o)}finally{this.ruleFinallyStateUpdate()}}var h;h=function(p,m){return p===void 0&&(p=0),this.ruleInvocationStateUpdate(u,e,p),c.call(this,m)};var d="ruleName";return h[d]=e,h.originalGrammarAction=t,h},i.prototype.invokeRuleCatch=function(e,t,r){var a=this.RULE_STACK.length===1,o=t&&!this.isBackTracking()&&this.recoveryEnabled;if(isRecognitionException(e)){var u=e;if(o){var c=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(c))if(u.resyncedTokens=this.reSyncTo(c),this.outputCst){var h=this.CST_STACK[this.CST_STACK.length-1];return h.recoveredNode=!0,h}else return r();else{if(this.outputCst){var h=this.CST_STACK[this.CST_STACK.length-1];h.recoveredNode=!0,u.partialCstResult=h}throw u}}else{if(a)return this.moveToTerminatedState(),r();throw u}}else throw e},i.prototype.optionInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(OPTION_IDX,t),a=this.nestedRuleBeforeClause(e,r);try{return this.optionInternalLogic(e,t,r)}finally{a!==void 0&&this.nestedRuleFinallyClause(r,a)}},i.prototype.optionInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(OPTION_IDX,t);return this.optionInternalLogic(e,t,r)},i.prototype.optionInternalLogic=function(e,t,r){var a=this,o=this.getLaFuncFromCache(r),u,c;if(e.DEF!==void 0){if(u=e.DEF,c=e.GATE,c!==void 0){var h=o;o=function(){return c.call(a)&&h.call(a)}}}else u=e;if(o.call(this)===!0)return u.call(this)},i.prototype.atLeastOneInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(AT_LEAST_ONE_IDX,e),a=this.nestedRuleBeforeClause(t,r);try{return this.atLeastOneInternalLogic(e,t,r)}finally{a!==void 0&&this.nestedRuleFinallyClause(r,a)}},i.prototype.atLeastOneInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(AT_LEAST_ONE_IDX,e);this.atLeastOneInternalLogic(e,t,r)},i.prototype.atLeastOneInternalLogic=function(e,t,r){var a=this,o=this.getLaFuncFromCache(r),u,c;if(t.DEF!==void 0){if(u=t.DEF,c=t.GATE,c!==void 0){var h=o;o=function(){return c.call(a)&&h.call(a)}}}else u=t;if(o.call(this)===!0)for(var d=this.doSingleRepetition(u);o.call(this)===!0&&d===!0;)d=this.doSingleRepetition(u);else throw this.raiseEarlyExitException(e,PROD_TYPE.REPETITION_MANDATORY,t.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],o,AT_LEAST_ONE_IDX,e,NextTerminalAfterAtLeastOneWalker)},i.prototype.atLeastOneSepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(AT_LEAST_ONE_SEP_IDX,e),a=this.nestedRuleBeforeClause(t,r);try{this.atLeastOneSepFirstInternalLogic(e,t,r)}finally{a!==void 0&&this.nestedRuleFinallyClause(r,a)}},i.prototype.atLeastOneSepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(AT_LEAST_ONE_SEP_IDX,e);this.atLeastOneSepFirstInternalLogic(e,t,r)},i.prototype.atLeastOneSepFirstInternalLogic=function(e,t,r){var a=this,o=t.DEF,u=t.SEP,c=this.getLaFuncFromCache(r);if(c.call(this)===!0){o.call(this);for(var h=function(){return a.tokenMatcher(a.LA(1),u)};this.tokenMatcher(this.LA(1),u)===!0;)this.CONSUME(u),o.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,u,h,o,NextTerminalAfterAtLeastOneSepWalker],h,AT_LEAST_ONE_SEP_IDX,e,NextTerminalAfterAtLeastOneSepWalker)}else throw this.raiseEarlyExitException(e,PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG)},i.prototype.manyInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(MANY_IDX,e),a=this.nestedRuleBeforeClause(t,r);try{return this.manyInternalLogic(e,t,r)}finally{a!==void 0&&this.nestedRuleFinallyClause(r,a)}},i.prototype.manyInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(MANY_IDX,e);return this.manyInternalLogic(e,t,r)},i.prototype.manyInternalLogic=function(e,t,r){var a=this,o=this.getLaFuncFromCache(r),u,c;if(t.DEF!==void 0){if(u=t.DEF,c=t.GATE,c!==void 0){var h=o;o=function(){return c.call(a)&&h.call(a)}}}else u=t;for(var d=!0;o.call(this)===!0&&d===!0;)d=this.doSingleRepetition(u);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],o,MANY_IDX,e,NextTerminalAfterManyWalker,d)},i.prototype.manySepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(MANY_SEP_IDX,e),a=this.nestedRuleBeforeClause(t,r);try{this.manySepFirstInternalLogic(e,t,r)}finally{a!==void 0&&this.nestedRuleFinallyClause(r,a)}},i.prototype.manySepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(MANY_SEP_IDX,e);this.manySepFirstInternalLogic(e,t,r)},i.prototype.manySepFirstInternalLogic=function(e,t,r){var a=this,o=t.DEF,u=t.SEP,c=this.getLaFuncFromCache(r);if(c.call(this)===!0){o.call(this);for(var h=function(){return a.tokenMatcher(a.LA(1),u)};this.tokenMatcher(this.LA(1),u)===!0;)this.CONSUME(u),o.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,u,h,o,NextTerminalAfterManySepWalker],h,MANY_SEP_IDX,e,NextTerminalAfterManySepWalker)}},i.prototype.repetitionSepSecondInternal=function(e,t,r,a,o){for(;r();)this.CONSUME(t),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,a,o],r,AT_LEAST_ONE_SEP_IDX,e,o)},i.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();e.call(this);var r=this.getLexerPosition();return r>t},i.prototype.orInternalNoCst=function(e,t){var r=isArray(e)?e:e.DEF,a=this.getKeyForAutomaticLookahead(OR_IDX,t),o=this.getLaFuncFromCache(a),u=o.call(this,r);if(u!==void 0){var c=r[u];return c.ALT.call(this)}this.raiseNoAltException(t,e.ERR_MSG)},i.prototype.orInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(OR_IDX,t),a=this.nestedRuleBeforeClause(e,r);try{var o=isArray(e)?e:e.DEF,u=this.getLaFuncFromCache(r),c=u.call(this,o);if(c!==void 0){var h=o[c],d=this.nestedAltBeforeClause(h,t,OR_IDX,c);try{return h.ALT.call(this)}finally{d!==void 0&&this.nestedRuleFinallyClause(d.shortName,d.nestedName)}}this.raiseNoAltException(t,e.ERR_MSG)}finally{a!==void 0&&this.nestedRuleFinallyClause(r,a)}},i.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new NotAllInputParsedException(t,e))}},i.prototype.subruleInternal=function(e,t,r){var a;try{var o=r!==void 0?r.ARGS:void 0;return a=e.call(this,t,o),this.cstPostNonTerminal(a,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),a}catch(u){this.subruleInternalError(u,r,e.ruleName)}},i.prototype.subruleInternalError=function(e,t,r){throw isRecognitionException(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,t!==void 0&&t.LABEL!==void 0?t.LABEL:r),delete e.partialCstResult),e},i.prototype.consumeInternal=function(e,t,r){var a;try{var o=this.LA(1);this.tokenMatcher(o,e)===!0?(this.consumeToken(),a=o):this.consumeInternalError(e,o,r)}catch(u){a=this.consumeInternalRecovery(e,t,u)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,a),a},i.prototype.consumeInternalError=function(e,t,r){var a,o=this.LA(0);throw r!==void 0&&r.ERR_MSG?a=r.ERR_MSG:a=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:o,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new MismatchedTokenException(a,t,o))},i.prototype.consumeInternalRecovery=function(e,t,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){var a=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,a)}catch(o){throw o.name===IN_RULE_RECOVERY_EXCEPTION?r:o}}else throw r},i.prototype.saveRecogState=function(){var e=this.errors,t=cloneArr(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK,LAST_EXPLICIT_RULE_STACK:this.LAST_EXPLICIT_RULE_STACK}},i.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},i.prototype.ruleInvocationStateUpdate=function(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},i.prototype.isBackTracking=function(){return this.isBackTrackingStack.length!==0},i.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]},i.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull[e]},i.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),EOF)},i.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},i}(),ErrorHandler=function(){function i(){}return i.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=defaults(e.errorMessageProvider,DEFAULT_PARSER_CONFIG.errorMessageProvider)},i.prototype.SAVE_ERROR=function(e){if(isRecognitionException(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:cloneArr(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(i.prototype,"errors",{get:function(){return cloneArr(this._errors)},set:function(e){this._errors=e},enumerable:!0,configurable:!0}),i.prototype.raiseEarlyExitException=function(e,t,r){for(var a=this.getCurrRuleFullName(),o=this.getGAstProductions()[a],u=getLookaheadPathsForOptionalProd(e,o,t,this.maxLookahead),c=u[0],h=[],d=1;d<=this.maxLookahead;d++)h.push(this.LA(d));var p=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:c,actual:h,previous:this.LA(0),customUserDescription:r,ruleName:a});throw this.SAVE_ERROR(new EarlyExitException(p,this.LA(1),this.LA(0)))},i.prototype.raiseNoAltException=function(e,t){for(var r=this.getCurrRuleFullName(),a=this.getGAstProductions()[r],o=getLookaheadPathsForOr(e,a,this.maxLookahead),u=[],c=1;c<=this.maxLookahead;c++)u.push(this.LA(c));var h=this.LA(0),d=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:o,actual:u,previous:h,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new NoViableAltException(d,this.LA(1),h))},i}(),ContentAssist=function(){function i(){}return i.prototype.initContentAssist=function(){},i.prototype.computeContentAssist=function(e,t){var r=this.gastProductionsCache[e];if(isUndefined(r))throw Error("Rule ->"+e+"<- does not exist in this grammar.");return nextPossibleTokensAfter([r],t,this.tokenMatcher,this.maxLookahead)},i.prototype.getNextPossibleTokenTypes=function(e){var t=first$1(e.ruleStack),r=this.getGAstProductions(),a=r[t],o=new NextAfterTokenWalker(a,e).startWalking();return o},i}(),RECORDING_NULL_OBJECT={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(RECORDING_NULL_OBJECT);var HANDLE_SEPARATOR=!0,MAX_METHOD_IDX=Math.pow(2,BITS_FOR_OCCURRENCE_IDX)-1,RFT=createToken({name:"RECORDING_PHASE_TOKEN",pattern:Lexer.NA});augmentTokenTypes([RFT]);var RECORDING_PHASE_TOKEN=createTokenInstance(RFT,`This IToken indicates the Parser is in Recording Phase
	See: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(RECORDING_PHASE_TOKEN);var RECORDING_PHASE_CSTNODE={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details`,children:{}},GastRecorder=function(){function i(){}return i.prototype.initGastRecorder=function(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1},i.prototype.enableRecording=function(){var e=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",function(){for(var t=function(a){var o=a>0?a:"";e["CONSUME"+o]=function(u,c){return this.consumeInternalRecord(u,a,c)},e["SUBRULE"+o]=function(u,c){return this.subruleInternalRecord(u,a,c)},e["OPTION"+o]=function(u){return this.optionInternalRecord(u,a)},e["OR"+o]=function(u){return this.orInternalRecord(u,a)},e["MANY"+o]=function(u){this.manyInternalRecord(a,u)},e["MANY_SEP"+o]=function(u){this.manySepFirstInternalRecord(a,u)},e["AT_LEAST_ONE"+o]=function(u){this.atLeastOneInternalRecord(a,u)},e["AT_LEAST_ONE_SEP"+o]=function(u){this.atLeastOneSepFirstInternalRecord(a,u)}},r=0;r<10;r++)t(r);e.consume=function(a,o,u){return this.consumeInternalRecord(o,a,u)},e.subrule=function(a,o,u){return this.subruleInternalRecord(o,a,u)},e.option=function(a,o){return this.optionInternalRecord(o,a)},e.or=function(a,o){return this.orInternalRecord(o,a)},e.many=function(a,o){this.manyInternalRecord(a,o)},e.atLeastOne=function(a,o){this.atLeastOneInternalRecord(a,o)},e.ACTION=e.ACTION_RECORD,e.BACKTRACK=e.BACKTRACK_RECORD,e.LA=e.LA_RECORD})},i.prototype.disableRecording=function(){var e=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",function(){for(var t=0;t<10;t++){var r=t>0?t:"";delete e["CONSUME"+r],delete e["SUBRULE"+r],delete e["OPTION"+r],delete e["OR"+r],delete e["MANY"+r],delete e["MANY_SEP"+r],delete e["AT_LEAST_ONE"+r],delete e["AT_LEAST_ONE_SEP"+r]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})},i.prototype.ACTION_RECORD=function(e){},i.prototype.BACKTRACK_RECORD=function(e,t){return function(){return!0}},i.prototype.LA_RECORD=function(e){return END_OF_FILE},i.prototype.topLevelRuleRecord=function(e,t){try{var r=new Rule({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),t.call(this),this.recordingProdStack.pop(),r}catch(a){if(a.KNOWN_RECORDER_ERROR!==!0)try{a.message=a.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording`}catch{throw a}throw a}},i.prototype.optionInternalRecord=function(e,t){return recordProd.call(this,Option,e,t)},i.prototype.atLeastOneInternalRecord=function(e,t){recordProd.call(this,RepetitionMandatory,t,e)},i.prototype.atLeastOneSepFirstInternalRecord=function(e,t){recordProd.call(this,RepetitionMandatoryWithSeparator,t,e,HANDLE_SEPARATOR)},i.prototype.manyInternalRecord=function(e,t){recordProd.call(this,Repetition,t,e)},i.prototype.manySepFirstInternalRecord=function(e,t){recordProd.call(this,RepetitionWithSeparator,t,e,HANDLE_SEPARATOR)},i.prototype.orInternalRecord=function(e,t){return recordOrProd.call(this,e,t)},i.prototype.subruleInternalRecord=function(e,t,r){if(assertMethodIdxIsValid(t),!e||has(e,"ruleName")===!1){var a=new Error("<SUBRULE"+getIdxSuffix(t)+"> argument is invalid"+(" expecting a Parser method reference but got: <"+JSON.stringify(e)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw a.KNOWN_RECORDER_ERROR=!0,a}var o=peek(this.recordingProdStack),u=e.ruleName,c=new NonTerminal({idx:t,nonTerminalName:u,referencedRule:void 0});return o.definition.push(c),this.outputCst?RECORDING_PHASE_CSTNODE:RECORDING_NULL_OBJECT},i.prototype.consumeInternalRecord=function(e,t,r){if(assertMethodIdxIsValid(t),!hasShortKeyProperty(e)){var a=new Error("<CONSUME"+getIdxSuffix(t)+"> argument is invalid"+(" expecting a TokenType reference but got: <"+JSON.stringify(e)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw a.KNOWN_RECORDER_ERROR=!0,a}var o=peek(this.recordingProdStack),u=new Terminal({idx:t,terminalType:e});return o.definition.push(u),RECORDING_PHASE_TOKEN},i}();function recordProd(i,e,t,r){r===void 0&&(r=!1),assertMethodIdxIsValid(t);var a=peek(this.recordingProdStack),o=isFunction(e)?e:e.DEF,u=new i({definition:[],idx:t});return has(e,"NAME")&&(u.name=e.NAME),r&&(u.separator=e.SEP),has(e,"MAX_LOOKAHEAD")&&(u.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(u),o.call(this),a.definition.push(u),this.recordingProdStack.pop(),RECORDING_NULL_OBJECT}function recordOrProd(i,e){var t=this;assertMethodIdxIsValid(e);var r=peek(this.recordingProdStack),a=isArray(i)===!1,o=a===!1?i:i.DEF,u=new Alternation({definition:[],idx:e,ignoreAmbiguities:a&&i.IGNORE_AMBIGUITIES===!0});has(i,"NAME")&&(u.name=i.NAME),has(i,"MAX_LOOKAHEAD")&&(u.maxLookahead=i.MAX_LOOKAHEAD);var c=some(o,function(h){return isFunction(h.GATE)});return u.hasPredicates=c,r.definition.push(u),forEach(o,function(h){var d=new Flat({definition:[]});u.definition.push(d),has(h,"NAME")&&(d.name=h.NAME),has(h,"IGNORE_AMBIGUITIES")?d.ignoreAmbiguities=h.IGNORE_AMBIGUITIES:has(h,"GATE")&&(d.ignoreAmbiguities=!0),t.recordingProdStack.push(d),h.ALT.call(t),t.recordingProdStack.pop()}),RECORDING_NULL_OBJECT}function getIdxSuffix(i){return i===0?"":""+i}function assertMethodIdxIsValid(i){if(i<0||i>MAX_METHOD_IDX){var e=new Error("Invalid DSL Method idx value: <"+i+`>
	`+("Idx value must be a none negative value smaller than "+(MAX_METHOD_IDX+1)));throw e.KNOWN_RECORDER_ERROR=!0,e}}var PerformanceTracer=function(){function i(){}return i.prototype.initPerformanceTracer=function(e){if(has(e,"traceInitPerf")){var t=e.traceInitPerf,r=typeof t=="number";this.traceInitMaxIdent=r?t:1/0,this.traceInitPerf=r?t>0:t}else this.traceInitMaxIdent=0,this.traceInitPerf=DEFAULT_PARSER_CONFIG.traceInitPerf;this.traceInitIndent=-1},i.prototype.TRACE_INIT=function(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;var r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(r+"--> <"+e+">");var a=timer(t),o=a.time,u=a.value,c=o>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&c(r+"<-- <"+e+"> time: "+o+"ms"),this.traceInitIndent--,u}else return t()},i}(),__extends=function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o])},i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),END_OF_FILE=createTokenInstance(EOF,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(END_OF_FILE);var DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:4,ignoredIssues:{},dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:defaultParserErrorProvider,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),ParserDefinitionErrorType;(function(i){i[i.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",i[i.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",i[i.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",i[i.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",i[i.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",i[i.LEFT_RECURSION=5]="LEFT_RECURSION",i[i.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",i[i.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",i[i.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",i[i.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",i[i.INVALID_NESTED_RULE_NAME=10]="INVALID_NESTED_RULE_NAME",i[i.DUPLICATE_NESTED_NAME=11]="DUPLICATE_NESTED_NAME",i[i.NO_NON_EMPTY_LOOKAHEAD=12]="NO_NON_EMPTY_LOOKAHEAD",i[i.AMBIGUOUS_PREFIX_ALTS=13]="AMBIGUOUS_PREFIX_ALTS",i[i.TOO_MANY_ALTS=14]="TOO_MANY_ALTS"})(ParserDefinitionErrorType||(ParserDefinitionErrorType={}));function EMPTY_ALT(i){return i===void 0&&(i=void 0),function(){return i}}var Parser=function(){function i(e,t){t===void 0&&(t=DEFAULT_PARSER_CONFIG),this.ignoredIssues=DEFAULT_PARSER_CONFIG.ignoredIssues,this.definitionErrors=[],this.selfAnalysisDone=!1;var r=this;r.initErrorHandler(t),r.initLexerAdapter(),r.initLooksAhead(t),r.initRecognizerEngine(e,t),r.initRecoverable(t),r.initTreeBuilder(t),r.initContentAssist(),r.initGastRecorder(t),r.initPerformanceTracer(t),has(t,"ignoredIssues")&&t.ignoredIssues!==DEFAULT_PARSER_CONFIG.ignoredIssues&&PRINT_WARNING(`The <ignoredIssues> IParserConfig property is soft-deprecated and will be removed in future versions.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.`),this.ignoredIssues=has(t,"ignoredIssues")?t.ignoredIssues:DEFAULT_PARSER_CONFIG.ignoredIssues,this.skipValidations=has(t,"skipValidations")?t.skipValidations:DEFAULT_PARSER_CONFIG.skipValidations}return i.performSelfAnalysis=function(e){e.performSelfAnalysis()},i.prototype.performSelfAnalysis=function(){var e=this;this.TRACE_INIT("performSelfAnalysis",function(){var t;e.selfAnalysisDone=!0;var r=e.className;e.TRACE_INIT("toFastProps",function(){toFastProperties(e)}),e.TRACE_INIT("Grammar Recording",function(){try{e.enableRecording(),forEach(e.definedRulesNames,function(o){var u=e[o],c=u.originalGrammarAction,h=void 0;e.TRACE_INIT(o+" Rule",function(){h=e.topLevelRuleRecord(o,c)}),e.gastProductionsCache[o]=h})}finally{e.disableRecording()}});var a=[];if(e.TRACE_INIT("Grammar Resolving",function(){a=resolveGrammar({rules:values(e.gastProductionsCache)}),e.definitionErrors.push.apply(e.definitionErrors,a)}),e.TRACE_INIT("Grammar Validations",function(){if(isEmpty(a)&&e.skipValidations===!1){var o=validateGrammar({rules:values(e.gastProductionsCache),maxLookahead:e.maxLookahead,tokenTypes:values(e.tokensMap),ignoredIssues:e.ignoredIssues,errMsgProvider:defaultGrammarValidatorErrorProvider,grammarName:r});e.definitionErrors.push.apply(e.definitionErrors,o)}}),isEmpty(e.definitionErrors)&&(e.recoveryEnabled&&e.TRACE_INIT("computeAllProdsFollows",function(){var o=computeAllProdsFollows(values(e.gastProductionsCache));e.resyncFollows=o}),e.TRACE_INIT("ComputeLookaheadFunctions",function(){e.preComputeLookaheadFunctions(values(e.gastProductionsCache))})),e.TRACE_INIT("expandAllNestedRuleNames",function(){var o=expandAllNestedRuleNames(values(e.gastProductionsCache),e.fullRuleNameToShort);e.allRuleNames=o.allRuleNames}),!i.DEFER_DEFINITION_ERRORS_HANDLING&&!isEmpty(e.definitionErrors))throw t=map(e.definitionErrors,function(o){return o.message}),new Error(`Parser Definition Errors detected:
 `+t.join(`
-------------------------------
`))})},i.DEFER_DEFINITION_ERRORS_HANDLING=!1,i}();applyMixins(Parser,[Recoverable,LooksAhead,TreeBuilder,LexerAdapter,RecognizerEngine,RecognizerApi,ErrorHandler,ContentAssist,GastRecorder,PerformanceTracer]);(function(i){__extends(e,i);function e(t,r){r===void 0&&(r=DEFAULT_PARSER_CONFIG);var a=this,o=cloneObj(r);return o.outputCst=!0,a=i.call(this,t,o)||this,a}return e})(Parser);var EmbeddedActionsParser=function(i){__extends(e,i);function e(t,r){r===void 0&&(r=DEFAULT_PARSER_CONFIG);var a=this,o=cloneObj(r);return o.outputCst=!1,a=i.call(this,t,o)||this,a}return e}(Parser);/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const parsingError=(i,e)=>({type:i,message:e});var ParsingErrorType;(function(i){i.LexingError="LexingError",i.ParserError="ParsingError",i.StaticOffsetError="StaticOffsetError",i.StaticOffsetOutOfRangeError="StaticOffsetOutOfRangeError",i.RangeOffsetNotAllowed="RangeOffsetNotAllowed",i.InvalidRangeSize="InvalidRangeSize"})(ParsingErrorType||(ParsingErrorType={}));var AstNodeType;(function(i){i.EMPTY="EMPTY",i.NUMBER="NUMBER",i.STRING="STRING",i.MINUS_UNARY_OP="MINUS_UNARY_OP",i.PLUS_UNARY_OP="PLUS_UNARY_OP",i.PERCENT_OP="PERCENT_OP",i.CONCATENATE_OP="CONCATENATE_OP",i.EQUALS_OP="EQUALS_OP",i.NOT_EQUAL_OP="NOT_EQUAL_OP",i.GREATER_THAN_OP="GREATER_THAN_OP",i.LESS_THAN_OP="LESS_THAN_OP",i.GREATER_THAN_OR_EQUAL_OP="GREATER_THAN_OR_EQUAL_OP",i.LESS_THAN_OR_EQUAL_OP="LESS_THAN_OR_EQUAL_OP",i.PLUS_OP="PLUS_OP",i.MINUS_OP="MINUS_OP",i.TIMES_OP="TIMES_OP",i.DIV_OP="DIV_OP",i.POWER_OP="POWER_OP",i.FUNCTION_CALL="FUNCTION_CALL",i.NAMED_EXPRESSION="NAMED_EXPRESSION",i.PARENTHESIS="PARENTHESES",i.CELL_REFERENCE="CELL_REFERENCE",i.CELL_RANGE="CELL_RANGE",i.COLUMN_RANGE="COLUMN_RANGE",i.ROW_RANGE="ROW_RANGE",i.ERROR="ERROR",i.ERROR_WITH_RAW_INPUT="ERROR_WITH_RAW_INPUT",i.ARRAY="ARRAY"})(AstNodeType||(AstNodeType={}));var RangeSheetReferenceType;(function(i){i[i.RELATIVE=0]="RELATIVE",i[i.START_ABSOLUTE=1]="START_ABSOLUTE",i[i.BOTH_ABSOLUTE=2]="BOTH_ABSOLUTE"})(RangeSheetReferenceType||(RangeSheetReferenceType={}));const buildEmptyArgAst=i=>({type:AstNodeType.EMPTY,leadingWhitespace:i==null?void 0:i.image}),buildNumberAst=(i,e)=>({type:AstNodeType.NUMBER,value:i,leadingWhitespace:e==null?void 0:e.image}),buildStringAst=i=>{var e;return{type:AstNodeType.STRING,value:i.image.slice(1,-1),leadingWhitespace:(e=i.leadingWhitespace)===null||e===void 0?void 0:e.image}},buildCellReferenceAst=(i,e)=>({type:AstNodeType.CELL_REFERENCE,reference:i,leadingWhitespace:e==null?void 0:e.image}),buildCellRangeAst=(i,e,t,r)=>(assertRangeConsistency(i,e,t),{type:AstNodeType.CELL_RANGE,start:i,end:e,sheetReferenceType:t,leadingWhitespace:r}),buildColumnRangeAst=(i,e,t,r)=>(assertRangeConsistency(i,e,t),{type:AstNodeType.COLUMN_RANGE,start:i,end:e,sheetReferenceType:t,leadingWhitespace:r==null?void 0:r.image}),buildRowRangeAst=(i,e,t,r)=>(assertRangeConsistency(i,e,t),{type:AstNodeType.ROW_RANGE,start:i,end:e,sheetReferenceType:t,leadingWhitespace:r==null?void 0:r.image}),buildConcatenateOpAst=(i,e,t)=>({type:AstNodeType.CONCATENATE_OP,left:i,right:e,leadingWhitespace:t==null?void 0:t.image}),buildEqualsOpAst=(i,e,t)=>({type:AstNodeType.EQUALS_OP,left:i,right:e,leadingWhitespace:t==null?void 0:t.image}),buildNotEqualOpAst=(i,e,t)=>({type:AstNodeType.NOT_EQUAL_OP,left:i,right:e,leadingWhitespace:t==null?void 0:t.image}),buildGreaterThanOpAst=(i,e,t)=>({type:AstNodeType.GREATER_THAN_OP,left:i,right:e,leadingWhitespace:t==null?void 0:t.image}),buildLessThanOpAst=(i,e,t)=>({type:AstNodeType.LESS_THAN_OP,left:i,right:e,leadingWhitespace:t==null?void 0:t.image}),buildGreaterThanOrEqualOpAst=(i,e,t)=>({type:AstNodeType.GREATER_THAN_OR_EQUAL_OP,left:i,right:e,leadingWhitespace:t==null?void 0:t.image}),buildLessThanOrEqualOpAst=(i,e,t)=>({type:AstNodeType.LESS_THAN_OR_EQUAL_OP,left:i,right:e,leadingWhitespace:t==null?void 0:t.image}),buildPlusOpAst=(i,e,t)=>({type:AstNodeType.PLUS_OP,left:i,right:e,leadingWhitespace:t==null?void 0:t.image}),buildMinusOpAst=(i,e,t)=>({type:AstNodeType.MINUS_OP,left:i,right:e,leadingWhitespace:t==null?void 0:t.image}),buildTimesOpAst=(i,e,t)=>({type:AstNodeType.TIMES_OP,left:i,right:e,leadingWhitespace:t==null?void 0:t.image}),buildDivOpAst=(i,e,t)=>({type:AstNodeType.DIV_OP,left:i,right:e,leadingWhitespace:t==null?void 0:t.image}),buildPowerOpAst=(i,e,t)=>({type:AstNodeType.POWER_OP,left:i,right:e,leadingWhitespace:t==null?void 0:t.image}),buildMinusUnaryOpAst=(i,e)=>({type:AstNodeType.MINUS_UNARY_OP,value:i,leadingWhitespace:e==null?void 0:e.image}),buildPlusUnaryOpAst=(i,e)=>({type:AstNodeType.PLUS_UNARY_OP,value:i,leadingWhitespace:e==null?void 0:e.image}),buildPercentOpAst=(i,e)=>({type:AstNodeType.PERCENT_OP,value:i,leadingWhitespace:e==null?void 0:e.image}),buildProcedureAst=(i,e,t,r,a)=>({type:AstNodeType.FUNCTION_CALL,procedureName:i,args:e,leadingWhitespace:t==null?void 0:t.image,internalWhitespace:r==null?void 0:r.image,hyperlink:a}),buildArrayAst=(i,e,t)=>({type:AstNodeType.ARRAY,args:i,leadingWhitespace:e==null?void 0:e.image,internalWhitespace:t==null?void 0:t.image}),buildNamedExpressionAst=(i,e)=>({type:AstNodeType.NAMED_EXPRESSION,expressionName:i,leadingWhitespace:e==null?void 0:e.image}),buildParenthesisAst=(i,e,t)=>({type:AstNodeType.PARENTHESIS,expression:i,leadingWhitespace:e==null?void 0:e.image,internalWhitespace:t==null?void 0:t.image}),buildCellErrorAst=(i,e)=>({type:AstNodeType.ERROR,error:i,leadingWhitespace:e==null?void 0:e.image}),buildErrorWithRawInputAst=(i,e,t)=>({type:AstNodeType.ERROR_WITH_RAW_INPUT,error:e,rawInput:i,leadingWhitespace:t==null?void 0:t.image}),buildParsingErrorAst=()=>({type:AstNodeType.ERROR,error:CellError.parsingError()});function assertRangeConsistency(i,e,t){if(i.sheet!==void 0&&e.sheet===void 0||i.sheet===void 0&&e.sheet!==void 0)throw new Error("Start address inconsistent with end address");if(i.sheet===void 0&&t!==RangeSheetReferenceType.RELATIVE||i.sheet!==void 0&&t===RangeSheetReferenceType.RELATIVE)throw new Error("Sheet address inconsistent with sheet reference type")}function imageWithWhitespace(i,e){return(e??"")+i}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const binaryOpTokenMap={[AstNodeType.PLUS_OP]:"+",[AstNodeType.MINUS_OP]:"-",[AstNodeType.TIMES_OP]:"*",[AstNodeType.DIV_OP]:"/",[AstNodeType.CONCATENATE_OP]:"&",[AstNodeType.POWER_OP]:"^",[AstNodeType.EQUALS_OP]:"=",[AstNodeType.NOT_EQUAL_OP]:"<>",[AstNodeType.GREATER_THAN_OP]:">",[AstNodeType.GREATER_THAN_OR_EQUAL_OP]:">=",[AstNodeType.LESS_THAN_OP]:"<",[AstNodeType.LESS_THAN_OR_EQUAL_OP]:"<="};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const buildCacheEntry=(i,e,t,r)=>({ast:i,relativeDependencies:e,hasVolatileFunction:t,hasStructuralChangeFunction:r});class Cache{constructor(e){this.functionRegistry=e,this.cache=new Map}set(e,t){const r=collectDependencies(t,this.functionRegistry),a=buildCacheEntry(t,r,doesContainFunctions(t,this.functionRegistry.isFunctionVolatile),doesContainFunctions(t,this.functionRegistry.isFunctionDependentOnSheetStructureChange));return this.cache.set(e,a),a}get(e){return this.cache.get(e)}maybeSetAndThenGet(e,t){const r=this.cache.get(e);return r!==void 0?r.ast:(this.set(e,t),t)}}const doesContainFunctions=(i,e)=>{switch(i.type){case AstNodeType.EMPTY:case AstNodeType.NUMBER:case AstNodeType.STRING:case AstNodeType.ERROR:case AstNodeType.ERROR_WITH_RAW_INPUT:case AstNodeType.CELL_REFERENCE:case AstNodeType.CELL_RANGE:case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:case AstNodeType.NAMED_EXPRESSION:return!1;case AstNodeType.PERCENT_OP:case AstNodeType.PLUS_UNARY_OP:case AstNodeType.MINUS_UNARY_OP:return doesContainFunctions(i.value,e);case AstNodeType.CONCATENATE_OP:case AstNodeType.EQUALS_OP:case AstNodeType.NOT_EQUAL_OP:case AstNodeType.LESS_THAN_OP:case AstNodeType.GREATER_THAN_OP:case AstNodeType.LESS_THAN_OR_EQUAL_OP:case AstNodeType.GREATER_THAN_OR_EQUAL_OP:case AstNodeType.MINUS_OP:case AstNodeType.PLUS_OP:case AstNodeType.TIMES_OP:case AstNodeType.DIV_OP:case AstNodeType.POWER_OP:return doesContainFunctions(i.left,e)||doesContainFunctions(i.right,e);case AstNodeType.PARENTHESIS:return doesContainFunctions(i.expression,e);case AstNodeType.FUNCTION_CALL:return e(i.procedureName)?!0:i.args.some(t=>doesContainFunctions(t,e));case AstNodeType.ARRAY:return i.args.some(t=>t.some(r=>doesContainFunctions(r,e)))}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ErrorMessage{}ErrorMessage.DistinctSigns="Distinct signs.";ErrorMessage.WrongArgNumber="Wrong number of arguments.";ErrorMessage.EmptyArg="Empty function argument.";ErrorMessage.EmptyArray="Empty array not allowed.";ErrorMessage.ArrayDimensions="Array dimensions are not compatible.";ErrorMessage.NoSpaceForArrayResult="No space for array result.";ErrorMessage.ValueSmall="Value too small.";ErrorMessage.ValueLarge="Value too large.";ErrorMessage.BadCriterion="Incorrect criterion.";ErrorMessage.RangeManySheets="Range spans more than one sheet.";ErrorMessage.CellRangeExpected="Cell range expected.";ErrorMessage.WrongDimension="Wrong range dimension.";ErrorMessage.ScalarExpected="Cell range not allowed.";ErrorMessage.NumberCoercion="Value cannot be coerced to number.";ErrorMessage.NumberExpected="Number argument expected.";ErrorMessage.IntegerExpected="Value needs to be an integer.";ErrorMessage.BadMode="Mode not recognized.";ErrorMessage.DateBounds="Date outside of bounds.";ErrorMessage.OutOfSheet="Resulting reference is out of the sheet.";ErrorMessage.WrongType="Wrong type of argument.";ErrorMessage.NaN="NaN or infinite value encountered.";ErrorMessage.EqualLength="Ranges need to be of equal length.";ErrorMessage.Negative="Value cannot be negative.";ErrorMessage.NotBinary="String does not represent a binary number.";ErrorMessage.NotOctal="String does not represent an octal number.";ErrorMessage.NotHex="String does not represent a hexadecimal number.";ErrorMessage.EndStartPeriod="End period needs to be at least start period.";ErrorMessage.CellRefExpected="Cell reference expected.";ErrorMessage.EmptyRange="Empty range not allowed.";ErrorMessage.BadRef="Address is not correct.";ErrorMessage.NumberRange="Number-only range expected.";ErrorMessage.ValueNotFound="Value not found.";ErrorMessage.ValueBaseLarge="Value in base too large.";ErrorMessage.ValueBaseSmall="Value in base too small.";ErrorMessage.ValueBaseLong="Value in base too long.";ErrorMessage.NegativeLength="Length cannot be negative.";ErrorMessage.PatternNotFound="Pattern not found.";ErrorMessage.OneValue="Needs at least one value.";ErrorMessage.TwoValues="Range needs to contain at least two elements.";ErrorMessage.ThreeValues="Range needs to contain at least three elements.";ErrorMessage.IndexBounds="Index out of bounds.";ErrorMessage.IndexLarge="Index too large.";ErrorMessage.Formula="Expected formula.";ErrorMessage.NegativeCount="Count cannot be negative.";ErrorMessage.ParseError="Parsing error.";ErrorMessage.SheetRef="Sheet does not exist.";ErrorMessage.PeriodLong="Period number cannot exceed life length.";ErrorMessage.InvalidDate="Invalid date.";ErrorMessage.BitshiftLong="Result of bitshift is too long.";ErrorMessage.EmptyString="Empty-string argument not allowed.";ErrorMessage.LengthBounds="Length out of bounds.";ErrorMessage.NegativeTime="Time cannot be negative.";ErrorMessage.NoDefault="No default option.";ErrorMessage.NoConditionMet="None of the conditions were met.";ErrorMessage.Selector="Selector cannot exceed the number of arguments.";ErrorMessage.StartEndDate="Start date needs to be earlier than end date.";ErrorMessage.IncorrectDateTime="String does not represent correct DateTime.";ErrorMessage.CharacterCodeBounds="Character code out of bounds.";ErrorMessage.NonZero="Argument cannot be 0.";ErrorMessage.LessThanOne="Argument cannot be less than 1.";ErrorMessage.WeekendString="Incorrect weekend bitmask string.";ErrorMessage.InvalidRoman="Invalid roman numeral.";ErrorMessage.WrongOrder="Wrong order of values.";ErrorMessage.ComplexNumberExpected="Complex number expected.";ErrorMessage.ShouldBeIorJ="Should be 'i' or 'j'.";ErrorMessage.SizeMismatch="Array dimensions mismatched.";ErrorMessage.FunctionName=i=>`Function name ${i} not recognized.`;ErrorMessage.NamedExpressionName=i=>`Named expression ${i} not recognized.`;ErrorMessage.LicenseKey=i=>`License key is ${i}.`;/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class CellReferenceMatcher{constructor(){this.POSSIBLE_START_CHARACTERS=[...ALL_UNICODE_LETTERS_ARRAY,...ALL_DIGITS_ARRAY,ABSOLUTE_OPERATOR,"'","_"],this.cellReferenceRegexp=new RegExp(CELL_REFERENCE_WITH_NEXT_CHARACTER_PATTERN,"y")}match(e,t){this.cellReferenceRegexp.lastIndex=t;const r=this.cellReferenceRegexp.exec(e+"@");return r==null||r[1]==null?null:(r[0]=r[1],r)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class NamedExpressionMatcher{constructor(){this.POSSIBLE_START_CHARACTERS=[...ALL_UNICODE_LETTERS_ARRAY,"_"],this.namedExpressionRegexp=new RegExp(NAMED_EXPRESSION_PATTERN,"y"),this.r1c1CellRefRegexp=new RegExp(`^${R1C1_CELL_REFERENCE_PATTERN}$`)}match(e,t){this.namedExpressionRegexp.lastIndex=t;const r=this.namedExpressionRegexp.exec(e);return r==null||r[0]==null||this.r1c1CellRefRegexp.test(r[0])?null:r}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const AdditionOp=createToken({name:"AdditionOp",pattern:Lexer.NA}),PlusOp=createToken({name:"PlusOp",pattern:/\+/,categories:AdditionOp}),MinusOp=createToken({name:"MinusOp",pattern:/-/,categories:AdditionOp}),MultiplicationOp=createToken({name:"MultiplicationOp",pattern:Lexer.NA}),TimesOp=createToken({name:"TimesOp",pattern:/\*/,categories:MultiplicationOp}),DivOp=createToken({name:"DivOp",pattern:/\//,categories:MultiplicationOp}),PowerOp=createToken({name:"PowerOp",pattern:/\^/}),PercentOp=createToken({name:"PercentOp",pattern:/%/}),BooleanOp=createToken({name:"BooleanOp",pattern:Lexer.NA}),EqualsOp=createToken({name:"EqualsOp",pattern:/=/,categories:BooleanOp}),NotEqualOp=createToken({name:"NotEqualOp",pattern:/<>/,categories:BooleanOp}),GreaterThanOp=createToken({name:"GreaterThanOp",pattern:/>/,categories:BooleanOp}),LessThanOp=createToken({name:"LessThanOp",pattern:/</,categories:BooleanOp}),GreaterThanOrEqualOp=createToken({name:"GreaterThanOrEqualOp",pattern:/>=/,categories:BooleanOp}),LessThanOrEqualOp=createToken({name:"LessThanOrEqualOp",pattern:/<=/,categories:BooleanOp}),ConcatenateOp=createToken({name:"ConcatenateOp",pattern:/&/}),LParen=createToken({name:"LParen",pattern:/\(/}),RParen=createToken({name:"RParen",pattern:/\)/}),ArrayLParen=createToken({name:"ArrayLParen",pattern:/{/}),ArrayRParen=createToken({name:"ArrayRParen",pattern:/}/}),StringLiteral=createToken({name:"StringLiteral",pattern:/"([^"\\]*(\\.[^"\\]*)*)"/}),ErrorLiteral=createToken({name:"ErrorLiteral",pattern:/#[A-Za-z0-9\/]+[?!]?/}),RangeSeparator=createToken({name:"RangeSeparator",pattern:new RegExp(RANGE_OPERATOR)}),ColumnRange=createToken({name:"ColumnRange",pattern:new RegExp(`${COLUMN_REFERENCE_PATTERN}${RANGE_OPERATOR}${COLUMN_REFERENCE_PATTERN}`)}),RowRange=createToken({name:"RowRange",pattern:new RegExp(`${ROW_REFERENCE_PATTERN}${RANGE_OPERATOR}${ROW_REFERENCE_PATTERN}`)}),ProcedureName=createToken({name:"ProcedureName",pattern:new RegExp(`([${UNICODE_LETTER_PATTERN}][${NON_RESERVED_CHARACTER_PATTERN}]*)\\(`)}),cellReferenceMatcher=new CellReferenceMatcher,CellReference=createToken({name:"CellReference",pattern:cellReferenceMatcher.match.bind(cellReferenceMatcher),start_chars_hint:cellReferenceMatcher.POSSIBLE_START_CHARACTERS,line_breaks:!1}),namedExpressionMatcher=new NamedExpressionMatcher,NamedExpression=createToken({name:"NamedExpression",pattern:namedExpressionMatcher.match.bind(namedExpressionMatcher),start_chars_hint:namedExpressionMatcher.POSSIBLE_START_CHARACTERS,line_breaks:!1}),buildLexerConfig=i=>{const e=i.translationPackage.getFunctionTranslation("OFFSET"),t=i.errorMapping,r=i.translationPackage.buildFunctionMapping(),a=new RegExp(i.ignoreWhiteSpace==="standard"?ODFF_WHITESPACE_PATTERN:ALL_WHITESPACE_PATTERN),o=createToken({name:"WhiteSpace",pattern:a}),u=createToken({name:"ArrayRowSep",pattern:i.arrayRowSeparator}),c=createToken({name:"ArrayColSep",pattern:i.arrayColumnSeparator}),h=createToken({name:"NumberLiteral",pattern:new RegExp(`(([${i.decimalSeparator}]\\d+)|(\\d+([${i.decimalSeparator}]\\d*)?))(e[+-]?\\d+)?`)}),d=createToken({name:"OffsetProcedureName",pattern:new RegExp(e,"i")});let p,m;i.functionArgSeparator===i.arrayColumnSeparator?(p=c,m=[]):i.functionArgSeparator===i.arrayRowSeparator?(p=u,m=[]):(p=createToken({name:"ArgSeparator",pattern:i.functionArgSeparator}),m=[p]);const f=[o,PlusOp,MinusOp,TimesOp,DivOp,PowerOp,EqualsOp,NotEqualOp,PercentOp,GreaterThanOrEqualOp,LessThanOrEqualOp,GreaterThanOp,LessThanOp,LParen,RParen,ArrayLParen,ArrayRParen,d,ProcedureName,RangeSeparator,...m,ColumnRange,RowRange,h,StringLiteral,ErrorLiteral,ConcatenateOp,BooleanOp,AdditionOp,MultiplicationOp,CellReference,NamedExpression,u,c];return{ArgSeparator:p,NumberLiteral:h,OffsetProcedureName:d,ArrayRowSeparator:u,ArrayColSeparator:c,WhiteSpace:o,allTokens:f,errorMapping:t,functionMapping:r,decimalSeparator:i.decimalSeparator,maxColumns:i.maxColumns,maxRows:i.maxRows}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class FormulaParser extends EmbeddedActionsParser{constructor(e,t){super(e.allTokens,{outputCst:!1,maxLookahead:7}),this.booleanExpressionOrEmpty=this.RULE("booleanExpressionOrEmpty",()=>this.OR([{ALT:()=>this.SUBRULE(this.booleanExpression)},{ALT:EMPTY_ALT(buildEmptyArgAst())}])),this.procedureExpression=this.RULE("procedureExpression",()=>{var r;const a=this.CONSUME(ProcedureName),o=a.image.toUpperCase().slice(0,-1),u=(r=this.lexerConfig.functionMapping[o])!==null&&r!==void 0?r:o,c=[];let h=this.SUBRULE(this.booleanExpressionOrEmpty);this.MANY(()=>{var p;const m=this.CONSUME(this.lexerConfig.ArgSeparator);h.type===AstNodeType.EMPTY&&(h.leadingWhitespace=(p=m.leadingWhitespace)===null||p===void 0?void 0:p.image),c.push(h),h=this.SUBRULE2(this.booleanExpressionOrEmpty)}),c.push(h),c.length===1&&c[0].type===AstNodeType.EMPTY&&(c.length=0);const d=this.CONSUME(RParen);return buildProcedureAst(u,c,a.leadingWhitespace,d.leadingWhitespace)}),this.namedExpressionExpression=this.RULE("namedExpressionExpression",()=>{const r=this.CONSUME(NamedExpression);return buildNamedExpressionAst(r.image,r.leadingWhitespace)}),this.offsetProcedureExpression=this.RULE("offsetProcedureExpression",()=>{const r=[];return this.CONSUME(this.lexerConfig.OffsetProcedureName),this.CONSUME(LParen),this.MANY_SEP({SEP:this.lexerConfig.ArgSeparator,DEF:()=>{r.push(this.SUBRULE(this.booleanExpression))}}),this.CONSUME(RParen),this.handleOffsetHeuristic(r)}),this.columnRangeExpression=this.RULE("columnRangeExpression",()=>{const r=this.CONSUME(ColumnRange),[a,o]=r.image.split(":"),u=this.ACTION(()=>columnAddressFromString(this.sheetMapping,a,this.formulaAddress)),c=this.ACTION(()=>columnAddressFromString(this.sheetMapping,o,this.formulaAddress));if(u===void 0||c===void 0)return buildCellErrorAst(new CellError(ErrorType.REF));if(u.exceedsSheetSizeLimits(this.lexerConfig.maxColumns)||c.exceedsSheetSizeLimits(this.lexerConfig.maxColumns))return buildErrorWithRawInputAst(r.image,new CellError(ErrorType.NAME),r.leadingWhitespace);if(u.sheet===void 0&&c.sheet!==void 0)return this.parsingError(ParsingErrorType.ParserError,"Malformed range expression");const{firstEnd:h,secondEnd:d,sheetRefType:p}=FormulaParser.fixSheetIdsForRangeEnds(u,c);return buildColumnRangeAst(h,d,p,r.leadingWhitespace)}),this.rowRangeExpression=this.RULE("rowRangeExpression",()=>{const r=this.CONSUME(RowRange),[a,o]=r.image.split(":"),u=this.ACTION(()=>rowAddressFromString(this.sheetMapping,a,this.formulaAddress)),c=this.ACTION(()=>rowAddressFromString(this.sheetMapping,o,this.formulaAddress));if(u===void 0||c===void 0)return buildCellErrorAst(new CellError(ErrorType.REF));if(u.exceedsSheetSizeLimits(this.lexerConfig.maxRows)||c.exceedsSheetSizeLimits(this.lexerConfig.maxRows))return buildErrorWithRawInputAst(r.image,new CellError(ErrorType.NAME),r.leadingWhitespace);if(u.sheet===void 0&&c.sheet!==void 0)return this.parsingError(ParsingErrorType.ParserError,"Malformed range expression");const{firstEnd:h,secondEnd:d,sheetRefType:p}=FormulaParser.fixSheetIdsForRangeEnds(u,c);return buildRowRangeAst(h,d,p,r.leadingWhitespace)}),this.cellReference=this.RULE("cellReference",()=>{const r=this.CONSUME(CellReference),a=this.ACTION(()=>cellAddressFromString(this.sheetMapping,r.image,this.formulaAddress));return a===void 0?buildErrorWithRawInputAst(r.image,new CellError(ErrorType.REF),r.leadingWhitespace):a.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?buildErrorWithRawInputAst(r.image,new CellError(ErrorType.NAME),r.leadingWhitespace):buildCellReferenceAst(a,r.leadingWhitespace)}),this.endRangeReference=this.RULE("endRangeReference",r=>{var a;const o=this.CONSUME(CellReference),u=this.ACTION(()=>cellAddressFromString(this.sheetMapping,r.image,this.formulaAddress)),c=this.ACTION(()=>cellAddressFromString(this.sheetMapping,o.image,this.formulaAddress));return u===void 0||c===void 0?this.ACTION(()=>buildErrorWithRawInputAst(`${r.image}:${o.image}`,new CellError(ErrorType.REF),r.leadingWhitespace)):u.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)||c.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?this.ACTION(()=>buildErrorWithRawInputAst(`${r.image}:${o.image}`,new CellError(ErrorType.NAME),r.leadingWhitespace)):this.buildCellRange(u,c,(a=r.leadingWhitespace)===null||a===void 0?void 0:a.image)}),this.endOfRangeExpression=this.RULE("endOfRangeExpression",r=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeReference,{ARGS:[r]})},{ALT:()=>{var a;const o=this.SUBRULE(this.offsetProcedureExpression),u=this.ACTION(()=>cellAddressFromString(this.sheetMapping,r.image,this.formulaAddress));return u===void 0?buildCellErrorAst(new CellError(ErrorType.REF)):o.type===AstNodeType.CELL_REFERENCE?this.buildCellRange(u,o.reference,(a=r.leadingWhitespace)===null||a===void 0?void 0:a.image):this.parsingError(ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here")}}])),this.cellRangeExpression=this.RULE("cellRangeExpression",()=>{const r=this.CONSUME(CellReference);return this.CONSUME2(RangeSeparator),this.SUBRULE(this.endOfRangeExpression,{ARGS:[r]})}),this.endRangeWithOffsetStartReference=this.RULE("endRangeWithOffsetStartReference",r=>{const a=this.CONSUME(CellReference),o=this.ACTION(()=>cellAddressFromString(this.sheetMapping,a.image,this.formulaAddress));return o===void 0?this.ACTION(()=>buildCellErrorAst(new CellError(ErrorType.REF))):this.buildCellRange(r.reference,o,r.leadingWhitespace)}),this.endOfRangeWithOffsetStartExpression=this.RULE("endOfRangeWithOffsetStartExpression",r=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeWithOffsetStartReference,{ARGS:[r]})},{ALT:()=>{const a=this.SUBRULE(this.offsetProcedureExpression);return a.type===AstNodeType.CELL_REFERENCE?this.buildCellRange(r.reference,a.reference,r.leadingWhitespace):this.parsingError(ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here")}}])),this.offsetExpression=this.RULE("offsetExpression",()=>{const r=this.SUBRULE(this.offsetProcedureExpression);let a;return this.OPTION(()=>{this.CONSUME(RangeSeparator),r.type===AstNodeType.CELL_RANGE?a=this.parsingError(ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here"):a=this.SUBRULE(this.endOfRangeWithOffsetStartExpression,{ARGS:[r]})}),a!==void 0?a:r}),this.insideArrayExpression=this.RULE("insideArrayExpression",()=>{const r=[[]];return r[r.length-1].push(this.SUBRULE(this.booleanExpression)),this.MANY(()=>{this.OR([{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayColSeparator),r[r.length-1].push(this.SUBRULE2(this.booleanExpression))}},{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayRowSeparator),r.push([]),r[r.length-1].push(this.SUBRULE3(this.booleanExpression))}}])}),buildArrayAst(r)}),this.parenthesisExpression=this.RULE("parenthesisExpression",()=>{const r=this.CONSUME(LParen),a=this.SUBRULE(this.booleanExpression),o=this.CONSUME(RParen);return buildParenthesisAst(a,r.leadingWhitespace,o.leadingWhitespace)}),this.arrayExpression=this.RULE("arrayExpression",()=>this.OR([{ALT:()=>{const r=this.CONSUME(ArrayLParen),a=this.SUBRULE(this.insideArrayExpression),o=this.CONSUME(ArrayRParen);return buildArrayAst(a.args,r.leadingWhitespace,o.leadingWhitespace)}},{ALT:()=>this.SUBRULE(this.parenthesisExpression)}])),this.numericStringToNumber=r=>{const a=r.replace(this.lexerConfig.decimalSeparator,".");return Number(a)},this.positiveAtomicExpression=this.RULE("positiveAtomicExpression",()=>{var r;return this.OR((r=this.atomicExpCache)!==null&&r!==void 0?r:this.atomicExpCache=[{ALT:()=>this.SUBRULE(this.arrayExpression)},{ALT:()=>this.SUBRULE(this.cellRangeExpression)},{ALT:()=>this.SUBRULE(this.columnRangeExpression)},{ALT:()=>this.SUBRULE(this.rowRangeExpression)},{ALT:()=>this.SUBRULE(this.offsetExpression)},{ALT:()=>this.SUBRULE(this.cellReference)},{ALT:()=>this.SUBRULE(this.procedureExpression)},{ALT:()=>this.SUBRULE(this.namedExpressionExpression)},{ALT:()=>{const a=this.CONSUME(this.lexerConfig.NumberLiteral);return buildNumberAst(this.numericStringToNumber(a.image),a.leadingWhitespace)}},{ALT:()=>{const a=this.CONSUME(StringLiteral);return buildStringAst(a)}},{ALT:()=>{const a=this.CONSUME(ErrorLiteral),o=a.image.toUpperCase(),u=this.lexerConfig.errorMapping[o];return u?buildCellErrorAst(new CellError(u),a.leadingWhitespace):this.parsingError(ParsingErrorType.ParserError,"Unknown error literal")}}])}),this.rightUnaryOpAtomicExpression=this.RULE("rightUnaryOpAtomicExpression",()=>{const r=this.SUBRULE(this.positiveAtomicExpression),a=this.OPTION(()=>this.CONSUME(PercentOp));return a?buildPercentOpAst(r,a.leadingWhitespace):r}),this.atomicExpression=this.RULE("atomicExpression",()=>this.OR([{ALT:()=>{const r=this.CONSUME(AdditionOp),a=this.SUBRULE(this.atomicExpression);return tokenMatcher(r,PlusOp)?buildPlusUnaryOpAst(a,r.leadingWhitespace):tokenMatcher(r,MinusOp)?buildMinusUnaryOpAst(a,r.leadingWhitespace):(this.customParsingError=parsingError(ParsingErrorType.ParserError,"Mismatched token type"),this.customParsingError)}},{ALT:()=>this.SUBRULE2(this.rightUnaryOpAtomicExpression)}])),this.powerExpression=this.RULE("powerExpression",()=>{let r=this.SUBRULE(this.atomicExpression);return this.MANY(()=>{const a=this.CONSUME(PowerOp),o=this.SUBRULE2(this.atomicExpression);tokenMatcher(a,PowerOp)?r=buildPowerOpAst(r,o,a.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.multiplicationExpression=this.RULE("multiplicationExpression",()=>{let r=this.SUBRULE(this.powerExpression);return this.MANY(()=>{const a=this.CONSUME(MultiplicationOp),o=this.SUBRULE2(this.powerExpression);tokenMatcher(a,TimesOp)?r=buildTimesOpAst(r,o,a.leadingWhitespace):tokenMatcher(a,DivOp)?r=buildDivOpAst(r,o,a.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.additionExpression=this.RULE("additionExpression",()=>{let r=this.SUBRULE(this.multiplicationExpression);return this.MANY(()=>{const a=this.CONSUME(AdditionOp),o=this.SUBRULE2(this.multiplicationExpression);tokenMatcher(a,PlusOp)?r=buildPlusOpAst(r,o,a.leadingWhitespace):tokenMatcher(a,MinusOp)?r=buildMinusOpAst(r,o,a.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.concatenateExpression=this.RULE("concatenateExpression",()=>{let r=this.SUBRULE(this.additionExpression);return this.MANY(()=>{const a=this.CONSUME(ConcatenateOp),o=this.SUBRULE2(this.additionExpression);r=buildConcatenateOpAst(r,o,a.leadingWhitespace)}),r}),this.booleanExpression=this.RULE("booleanExpression",()=>{let r=this.SUBRULE(this.concatenateExpression);return this.MANY(()=>{const a=this.CONSUME(BooleanOp),o=this.SUBRULE2(this.concatenateExpression);tokenMatcher(a,EqualsOp)?r=buildEqualsOpAst(r,o,a.leadingWhitespace):tokenMatcher(a,NotEqualOp)?r=buildNotEqualOpAst(r,o,a.leadingWhitespace):tokenMatcher(a,GreaterThanOp)?r=buildGreaterThanOpAst(r,o,a.leadingWhitespace):tokenMatcher(a,LessThanOp)?r=buildLessThanOpAst(r,o,a.leadingWhitespace):tokenMatcher(a,GreaterThanOrEqualOp)?r=buildGreaterThanOrEqualOpAst(r,o,a.leadingWhitespace):tokenMatcher(a,LessThanOrEqualOp)?r=buildLessThanOrEqualOpAst(r,o,a.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.formula=this.RULE("formula",()=>(this.CONSUME(EqualsOp),this.SUBRULE(this.booleanExpression))),this.lexerConfig=e,this.sheetMapping=t,this.formulaAddress=simpleCellAddress(0,0,0),this.performSelfAnalysis()}parseFromTokens(e,t){this.input=e;let r=this.formulaWithContext(t),a=[];return this.customParsingError&&a.push(this.customParsingError),a=a.concat(this.errors.map(o=>({type:ParsingErrorType.ParserError,message:o.message}))),a.length>0&&(r=buildParsingErrorAst()),{ast:r,errors:a}}reset(){super.reset(),this.customParsingError=void 0}formulaWithContext(e){return this.formulaAddress=e,this.formula()}buildCellRange(e,t,r){if(e.sheet===void 0&&t.sheet!==void 0)return this.parsingError(ParsingErrorType.ParserError,"Malformed range expression");const{firstEnd:a,secondEnd:o,sheetRefType:u}=FormulaParser.fixSheetIdsForRangeEnds(e,t);return buildCellRangeAst(a,o,u,r)}static fixSheetIdsForRangeEnds(e,t){const r=FormulaParser.rangeSheetReferenceType(e.sheet,t.sheet),a=e.sheet!==void 0&&t.sheet===void 0?t.withSheet(e.sheet):t;return{firstEnd:e,secondEnd:a,sheetRefType:r}}handleOffsetHeuristic(e){const t=e[0];if(t.type!==AstNodeType.CELL_REFERENCE)return this.parsingError(ParsingErrorType.StaticOffsetError,"First argument to OFFSET is not a reference");const r=e[1];let a;if(r.type===AstNodeType.NUMBER&&Number.isInteger(r.value))a=r.value;else if(r.type===AstNodeType.PLUS_UNARY_OP&&r.value.type===AstNodeType.NUMBER&&Number.isInteger(r.value.value))a=r.value.value;else if(r.type===AstNodeType.MINUS_UNARY_OP&&r.value.type===AstNodeType.NUMBER&&Number.isInteger(r.value.value))a=-r.value.value;else return this.parsingError(ParsingErrorType.StaticOffsetError,"Second argument to OFFSET is not a static number");const o=e[2];let u;if(o.type===AstNodeType.NUMBER&&Number.isInteger(o.value))u=o.value;else if(o.type===AstNodeType.PLUS_UNARY_OP&&o.value.type===AstNodeType.NUMBER&&Number.isInteger(o.value.value))u=o.value.value;else if(o.type===AstNodeType.MINUS_UNARY_OP&&o.value.type===AstNodeType.NUMBER&&Number.isInteger(o.value.value))u=-o.value.value;else return this.parsingError(ParsingErrorType.StaticOffsetError,"Third argument to OFFSET is not a static number");const c=e[3];let h;if(c===void 0)h=1;else if(c.type===AstNodeType.NUMBER){if(h=c.value,h<1)return this.parsingError(ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is too small number");if(!Number.isInteger(h))return this.parsingError(ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is not integer")}else return this.parsingError(ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is not a static number");const d=e[4];let p;if(d===void 0)p=1;else if(d.type===AstNodeType.NUMBER){if(p=d.value,p<1)return this.parsingError(ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is too small number");if(!Number.isInteger(p))return this.parsingError(ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is not integer")}else return this.parsingError(ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is not a static number");const m=new CellAddress(t.reference.col+u,t.reference.row+a,t.reference.type);let f=m.col,g=m.row;if((t.reference.type===CellReferenceType.CELL_REFERENCE_RELATIVE||t.reference.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL)&&(g=g+this.formulaAddress.row),(t.reference.type===CellReferenceType.CELL_REFERENCE_RELATIVE||t.reference.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW)&&(f=f+this.formulaAddress.col),f<0||g<0)return buildCellErrorAst(new CellError(ErrorType.REF,ErrorMessage.OutOfSheet));if(p===1&&h===1)return buildCellReferenceAst(m);{const y=new CellAddress(m.col+p-1,m.row+h-1,m.type);return buildCellRangeAst(m,y,RangeSheetReferenceType.RELATIVE)}}parsingError(e,t){return this.customParsingError=parsingError(e,t),buildParsingErrorAst()}static rangeSheetReferenceType(e,t){return e===void 0?RangeSheetReferenceType.RELATIVE:t===void 0?RangeSheetReferenceType.START_ABSOLUTE:RangeSheetReferenceType.BOTH_ABSOLUTE}}class FormulaLexer{constructor(e){this.lexerConfig=e,this.lexer=new Lexer(e.allTokens,{ensureOptimizations:!0})}tokenizeFormula(e){const t=this.lexer.tokenize(e);let r=t.tokens;return r=this.trimTrailingWhitespaces(r),r=this.skipWhitespacesInsideRanges(r),r=this.skipWhitespacesBeforeArgSeparators(r),t.tokens=r,t}skipWhitespacesInsideRanges(e){return FormulaLexer.filterTokensByNeighbors(e,(t,r,a)=>(tokenMatcher(t,CellReference)||tokenMatcher(t,RangeSeparator))&&tokenMatcher(r,this.lexerConfig.WhiteSpace)&&(tokenMatcher(a,CellReference)||tokenMatcher(a,RangeSeparator)))}skipWhitespacesBeforeArgSeparators(e){return FormulaLexer.filterTokensByNeighbors(e,(t,r,a)=>!tokenMatcher(t,this.lexerConfig.ArgSeparator)&&tokenMatcher(r,this.lexerConfig.WhiteSpace)&&tokenMatcher(a,this.lexerConfig.ArgSeparator))}static filterTokensByNeighbors(e,t){if(e.length<3)return e;let r=0;const a=[e[r++]];for(;r<e.length-1;)t(e[r-1],e[r],e[r+1])||a.push(e[r]),++r;return a.push(e[r]),a}trimTrailingWhitespaces(e){return e.length>0&&tokenMatcher(e[e.length-1],this.lexerConfig.WhiteSpace)&&e.pop(),e}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class Unparser{constructor(e,t,r,a){this.config=e,this.lexerConfig=t,this.sheetMappingFn=r,this.namedExpressions=a}unparse(e,t){return"="+this.unparseAst(e,t)}unparseAst(e,t){var r,a;switch(e.type){case AstNodeType.EMPTY:return imageWithWhitespace("",e.leadingWhitespace);case AstNodeType.NUMBER:return imageWithWhitespace(formatNumber(e.value,this.config.decimalSeparator),e.leadingWhitespace);case AstNodeType.STRING:return imageWithWhitespace('"'+e.value+'"',e.leadingWhitespace);case AstNodeType.FUNCTION_CALL:{const o=e.args.map(h=>h!==void 0?this.unparseAst(h,t):"").join(this.config.functionArgSeparator),c=(this.config.translationPackage.isFunctionTranslated(e.procedureName)?this.config.translationPackage.getFunctionTranslation(e.procedureName):e.procedureName)+"("+o+imageWithWhitespace(")",e.internalWhitespace);return imageWithWhitespace(c,e.leadingWhitespace)}case AstNodeType.NAMED_EXPRESSION:{const o=(r=this.namedExpressions.nearestNamedExpression(e.expressionName,t.sheet))===null||r===void 0?void 0:r.displayName;return imageWithWhitespace(o||e.expressionName,e.leadingWhitespace)}case AstNodeType.CELL_REFERENCE:{let o;return e.reference.sheet!==void 0?o=this.unparseSheetName(e.reference.sheet)+"!":o="",o+=(a=e.reference.unparse(t))!==null&&a!==void 0?a:this.config.translationPackage.getErrorTranslation(ErrorType.REF),imageWithWhitespace(o,e.leadingWhitespace)}case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:case AstNodeType.CELL_RANGE:return imageWithWhitespace(this.formatRange(e,t),e.leadingWhitespace);case AstNodeType.PLUS_UNARY_OP:{const o=this.unparseAst(e.value,t);return imageWithWhitespace("+",e.leadingWhitespace)+o}case AstNodeType.MINUS_UNARY_OP:{const o=this.unparseAst(e.value,t);return imageWithWhitespace("-",e.leadingWhitespace)+o}case AstNodeType.PERCENT_OP:return this.unparseAst(e.value,t)+imageWithWhitespace("%",e.leadingWhitespace);case AstNodeType.ERROR:{const o=this.config.translationPackage.getErrorTranslation(e.error?e.error.type:ErrorType.ERROR);return imageWithWhitespace(o,e.leadingWhitespace)}case AstNodeType.ERROR_WITH_RAW_INPUT:return imageWithWhitespace(e.rawInput,e.leadingWhitespace);case AstNodeType.PARENTHESIS:{const u="("+this.unparseAst(e.expression,t)+imageWithWhitespace(")",e.internalWhitespace);return imageWithWhitespace(u,e.leadingWhitespace)}case AstNodeType.ARRAY:{const o="{"+e.args.map(u=>u.map(c=>this.unparseAst(c,t)).join(this.config.arrayColumnSeparator)).join(this.config.arrayRowSeparator)+imageWithWhitespace("}",e.internalWhitespace);return imageWithWhitespace(o,e.leadingWhitespace)}default:{const o=this.unparseAst(e.left,t),u=this.unparseAst(e.right,t);return o+imageWithWhitespace(binaryOpTokenMap[e.type],e.leadingWhitespace)+u}}}unparseSheetName(e){const t=sheetIndexToString(e,this.sheetMappingFn);if(t===void 0)throw new NoSheetWithIdError(e);return t}formatRange(e,t){let r="",a="";e.start.sheet!==void 0&&e.sheetReferenceType!==RangeSheetReferenceType.RELATIVE&&(r=this.unparseSheetName(e.start.sheet)+"!"),e.end.sheet!==void 0&&e.sheetReferenceType===RangeSheetReferenceType.BOTH_ABSOLUTE&&(a=this.unparseSheetName(e.end.sheet)+"!");const o=e.start.unparse(t),u=e.end.unparse(t);return o===void 0||u===void 0?this.config.translationPackage.getErrorTranslation(ErrorType.REF):`${r}${o}:${a}${u}`}}function formatNumber(i,e){return i.toString().replace(".",e)}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ParserWithCaching{constructor(e,t,r){this.config=e,this.functionRegistry=t,this.sheetMapping=r,this.statsCacheUsed=0,this.lexerConfig=buildLexerConfig(e),this.lexer=new FormulaLexer(this.lexerConfig),this.formulaParser=new FormulaParser(this.lexerConfig,this.sheetMapping),this.cache=new Cache(this.functionRegistry)}parse(e,t){this.formulaAddress=t;const r=this.tokenizeFormula(e);if(r.errors.length>0){const m=r.errors.map(f=>({type:ParsingErrorType.LexingError,message:f.message}));return{ast:buildParsingErrorAst(),errors:m,hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]}}const a=this.computeHashFromTokens(r.tokens,t);let o=this.cache.get(a);if(o!==void 0)++this.statsCacheUsed;else{const m=this.bindWhitespacesToTokens(r.tokens),f=this.formulaParser.parseFromTokens(m,t);if(f.errors.length>0)return Object.assign(Object.assign({},f),{hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]});o=this.cache.set(a,f.ast)}const{ast:u,hasVolatileFunction:c,hasStructuralChangeFunction:h}=o,d=this.convertReversedRangesToRegularRanges(u),p=collectDependencies(d,this.functionRegistry);return{ast:d,errors:[],hasVolatileFunction:c,hasStructuralChangeFunction:h,dependencies:p}}convertReversedRangesToRegularRanges(e){switch(e.type){case AstNodeType.EMPTY:case AstNodeType.NUMBER:case AstNodeType.STRING:case AstNodeType.ERROR:case AstNodeType.ERROR_WITH_RAW_INPUT:case AstNodeType.CELL_REFERENCE:case AstNodeType.NAMED_EXPRESSION:return e;case AstNodeType.CELL_RANGE:{const{start:t,end:r}=e,a=this.orderCellRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:a.start,end:a.end})}case AstNodeType.COLUMN_RANGE:{const{start:t,end:r}=e,a=this.orderColumnRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:a.start,end:a.end})}case AstNodeType.ROW_RANGE:{const{start:t,end:r}=e,a=this.orderRowRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:a.start,end:a.end})}case AstNodeType.PERCENT_OP:case AstNodeType.PLUS_UNARY_OP:case AstNodeType.MINUS_UNARY_OP:{const t=this.convertReversedRangesToRegularRanges(e.value);return Object.assign(Object.assign({},e),{value:t})}case AstNodeType.CONCATENATE_OP:case AstNodeType.EQUALS_OP:case AstNodeType.NOT_EQUAL_OP:case AstNodeType.LESS_THAN_OP:case AstNodeType.GREATER_THAN_OP:case AstNodeType.LESS_THAN_OR_EQUAL_OP:case AstNodeType.GREATER_THAN_OR_EQUAL_OP:case AstNodeType.MINUS_OP:case AstNodeType.PLUS_OP:case AstNodeType.TIMES_OP:case AstNodeType.DIV_OP:case AstNodeType.POWER_OP:{const t=this.convertReversedRangesToRegularRanges(e.left),r=this.convertReversedRangesToRegularRanges(e.right);return Object.assign(Object.assign({},e),{left:t,right:r})}case AstNodeType.PARENTHESIS:{const t=this.convertReversedRangesToRegularRanges(e.expression);return Object.assign(Object.assign({},e),{expression:t})}case AstNodeType.FUNCTION_CALL:{const t=e.args.map(r=>this.convertReversedRangesToRegularRanges(r));return Object.assign(Object.assign({},e),{args:t})}case AstNodeType.ARRAY:{const t=e.args.map(r=>r.map(a=>this.convertReversedRangesToRegularRanges(a)));return Object.assign(Object.assign({},e),{args:t})}}}orderCellRangeEnds(e,t){const r=[e,t],[a,o]=r.map(p=>p.toColumnAddress()).sort(ColumnAddress.compareByAbsoluteAddress(this.formulaAddress)),[u,c]=r.map(p=>p.toRowAddress()).sort(RowAddress.compareByAbsoluteAddress(this.formulaAddress)),[h,d]=r.map(p=>p.sheet).sort(ParserWithCaching.compareSheetIds.bind(this));return{start:CellAddress.fromColAndRow(a,u,h),end:CellAddress.fromColAndRow(o,c,d)}}orderColumnRangeEnds(e,t){const r=[e,t],[a,o]=r.sort(ColumnAddress.compareByAbsoluteAddress(this.formulaAddress)),[u,c]=r.map(h=>h.sheet).sort(ParserWithCaching.compareSheetIds.bind(this));return{start:new ColumnAddress(a.type,a.col,u),end:new ColumnAddress(o.type,o.col,c)}}orderRowRangeEnds(e,t){const r=[e,t],[a,o]=r.sort(RowAddress.compareByAbsoluteAddress(this.formulaAddress)),[u,c]=r.map(h=>h.sheet).sort(ParserWithCaching.compareSheetIds.bind(this));return{start:new RowAddress(a.type,a.row,u),end:new RowAddress(o.type,o.row,c)}}static compareSheetIds(e,t){return e=e??1/0,t=t??1/0,e-t}fetchCachedResultForAst(e){const t=this.computeHashFromAst(e);return this.fetchCachedResult(t)}fetchCachedResult(e){const t=this.cache.get(e);if(t===void 0)throw new Error("There is no AST with such key in the cache");{const{ast:r,hasVolatileFunction:a,hasStructuralChangeFunction:o,relativeDependencies:u}=t;return{ast:r,errors:[],hasVolatileFunction:a,hasStructuralChangeFunction:o,dependencies:u}}}computeHashFromTokens(e,t){var r;let a="",o=0;for(;o<e.length;){const u=e[o];if(tokenMatcher(u,CellReference)){const c=cellAddressFromString(this.sheetMapping,u.image,t);c===void 0?a=a.concat(u.image):a=a.concat(c.hash(!0))}else if(tokenMatcher(u,ProcedureName)){const c=u.image.toUpperCase().slice(0,-1),h=(r=this.lexerConfig.functionMapping[c])!==null&&r!==void 0?r:c;a=a.concat(h,"(")}else if(tokenMatcher(u,ColumnRange)){const[c,h]=u.image.split(":"),d=columnAddressFromString(this.sheetMapping,c,t),p=columnAddressFromString(this.sheetMapping,h,t);d===void 0||p===void 0?a=a.concat("!REF"):a=a.concat(d.hash(!0),":",p.hash(!0))}else if(tokenMatcher(u,RowRange)){const[c,h]=u.image.split(":"),d=rowAddressFromString(this.sheetMapping,c,t),p=rowAddressFromString(this.sheetMapping,h,t);d===void 0||p===void 0?a=a.concat("!REF"):a=a.concat(d.hash(!0),":",p.hash(!0))}else a=a.concat(u.image);o++}return a}rememberNewAst(e){const t=this.computeHashFromAst(e);return this.cache.maybeSetAndThenGet(t,e)}computeHashFromAst(e){return"="+this.computeHashOfAstNode(e)}computeHashOfAstNode(e){switch(e.type){case AstNodeType.EMPTY:return e.leadingWhitespace||"";case AstNodeType.NUMBER:return imageWithWhitespace(formatNumber(e.value,this.config.decimalSeparator),e.leadingWhitespace);case AstNodeType.STRING:return imageWithWhitespace('"'+e.value+'"',e.leadingWhitespace);case AstNodeType.NAMED_EXPRESSION:return imageWithWhitespace(e.expressionName,e.leadingWhitespace);case AstNodeType.FUNCTION_CALL:{const t=e.args.map(a=>this.computeHashOfAstNode(a)).join(this.config.functionArgSeparator),r=e.procedureName+"("+t+imageWithWhitespace(")",e.internalWhitespace);return imageWithWhitespace(r,e.leadingWhitespace)}case AstNodeType.CELL_REFERENCE:return imageWithWhitespace(e.reference.hash(!0),e.leadingWhitespace);case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:case AstNodeType.CELL_RANGE:{const t=e.start.hash(e.sheetReferenceType!==RangeSheetReferenceType.RELATIVE),r=e.end.hash(e.sheetReferenceType===RangeSheetReferenceType.BOTH_ABSOLUTE);return imageWithWhitespace(t+":"+r,e.leadingWhitespace)}case AstNodeType.MINUS_UNARY_OP:return imageWithWhitespace("-"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case AstNodeType.PLUS_UNARY_OP:return imageWithWhitespace("+"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case AstNodeType.PERCENT_OP:return this.computeHashOfAstNode(e.value)+imageWithWhitespace("%",e.leadingWhitespace);case AstNodeType.ERROR:{const t=this.config.translationPackage.getErrorTranslation(e.error?e.error.type:ErrorType.ERROR);return imageWithWhitespace(t,e.leadingWhitespace)}case AstNodeType.ERROR_WITH_RAW_INPUT:return imageWithWhitespace(e.rawInput,e.leadingWhitespace);case AstNodeType.ARRAY:{const t=e.args.map(r=>r.map(a=>this.computeHashOfAstNode(a)).join(",")).join(";");return imageWithWhitespace("{"+t+imageWithWhitespace("}",e.internalWhitespace),e.leadingWhitespace)}case AstNodeType.PARENTHESIS:{const r="("+this.computeHashOfAstNode(e.expression)+imageWithWhitespace(")",e.internalWhitespace);return imageWithWhitespace(r,e.leadingWhitespace)}default:return this.computeHashOfAstNode(e.left)+imageWithWhitespace(binaryOpTokenMap[e.type],e.leadingWhitespace)+this.computeHashOfAstNode(e.right)}}bindWhitespacesToTokens(e){const t=[],r=e[0];tokenMatcher(r,this.lexerConfig.WhiteSpace)||t.push(r);for(let a=1;a<e.length;++a){const o=e[a];if(tokenMatcher(o,this.lexerConfig.WhiteSpace))continue;const u=e[a-1];tokenMatcher(u,this.lexerConfig.WhiteSpace)&&(o.leadingWhitespace=u),t.push(o)}return t}tokenizeFormula(e){return this.lexer.tokenizeFormula(e)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const collectDependenciesFn=(i,e,t,r)=>{switch(i.type){case AstNodeType.EMPTY:case AstNodeType.NUMBER:case AstNodeType.STRING:case AstNodeType.ERROR:return;case AstNodeType.NAMED_EXPRESSION:{r&&t.push(new NamedExpressionDependency(i.expressionName));return}case AstNodeType.CELL_REFERENCE:{r&&t.push(new AddressDependency(i.reference));return}case AstNodeType.CELL_RANGE:{r&&i.start.sheet===i.end.sheet&&t.push(new CellRangeDependency(i.start,i.end));return}case AstNodeType.COLUMN_RANGE:{r&&i.start.sheet===i.end.sheet&&t.push(new ColumnRangeDependency(i.start,i.end));return}case AstNodeType.ROW_RANGE:{r&&i.start.sheet===i.end.sheet&&t.push(new RowRangeDependency(i.start,i.end));return}case AstNodeType.PERCENT_OP:case AstNodeType.PLUS_UNARY_OP:case AstNodeType.MINUS_UNARY_OP:{collectDependenciesFn(i.value,e,t,!0);return}case AstNodeType.CONCATENATE_OP:case AstNodeType.EQUALS_OP:case AstNodeType.NOT_EQUAL_OP:case AstNodeType.LESS_THAN_OP:case AstNodeType.GREATER_THAN_OP:case AstNodeType.LESS_THAN_OR_EQUAL_OP:case AstNodeType.GREATER_THAN_OR_EQUAL_OP:case AstNodeType.MINUS_OP:case AstNodeType.PLUS_OP:case AstNodeType.TIMES_OP:case AstNodeType.DIV_OP:case AstNodeType.POWER_OP:collectDependenciesFn(i.left,e,t,!0),collectDependenciesFn(i.right,e,t,!0);return;case AstNodeType.PARENTHESIS:collectDependenciesFn(i.expression,e,t,r);return;case AstNodeType.FUNCTION_CALL:{const a=!e.doesFunctionNeedArgumentToBeComputed(i.procedureName);i.args.forEach(o=>collectDependenciesFn(o,e,t,a));return}}},collectDependencies=(i,e)=>{const t=new Array;return collectDependenciesFn(i,e,t,!0),t};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class AddressDependency{constructor(e){this.dependency=e}absolutize(e){return this.dependency.toSimpleCellAddress(e)}}class CellRangeDependency{constructor(e,t){this.start=e,this.end=t}absolutize(e){return new AbsoluteCellRange(this.start.toSimpleCellAddress(e),this.end.toSimpleCellAddress(e))}}class ColumnRangeDependency{constructor(e,t){this.start=e,this.end=t}absolutize(e){const t=this.start.toSimpleColumnAddress(e),r=this.end.toSimpleColumnAddress(e);return new AbsoluteColumnRange(t.sheet,t.col,r.col)}}class RowRangeDependency{constructor(e,t){this.start=e,this.end=t}absolutize(e){const t=this.start.toSimpleRowAddress(e),r=this.end.toSimpleRowAddress(e);return new AbsoluteRowRange(t.sheet,t.row,r.row)}}class NamedExpressionDependency{constructor(e){this.name=e}absolutize(e){return this}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const absolutizeDependencies=(i,e)=>i.map(t=>t.absolutize(e)),filterDependenciesOutOfScope=i=>i.filter(e=>e instanceof NamedExpressionDependency?!0:e instanceof AbsoluteCellRange?!(invalidSimpleCellAddress(e.start)||invalidSimpleCellAddress(e.end)):!invalidSimpleCellAddress(e));/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const EmptyValue=Symbol("Empty value");function getRawValue(i){return i instanceof RichNumber?i.val:i}class RichNumber{constructor(e,t){this.val=e,this.format=t}fromNumber(e){return new this.constructor(e)}}function cloneNumber(i,e){if(typeof i=="number")return e;{const t=i.fromNumber(e);return t.format=i.format,t}}class DateNumber extends RichNumber{getDetailedType(){return NumberType.NUMBER_DATE}}class CurrencyNumber extends RichNumber{getDetailedType(){return NumberType.NUMBER_CURRENCY}}class TimeNumber extends RichNumber{getDetailedType(){return NumberType.NUMBER_TIME}}class DateTimeNumber extends RichNumber{getDetailedType(){return NumberType.NUMBER_DATETIME}}class PercentNumber extends RichNumber{getDetailedType(){return NumberType.NUMBER_PERCENT}}function isExtendedNumber(i){return typeof i=="number"||i instanceof RichNumber}var NumberType;(function(i){i.NUMBER_RAW="NUMBER_RAW",i.NUMBER_DATE="NUMBER_DATE",i.NUMBER_TIME="NUMBER_TIME",i.NUMBER_DATETIME="NUMBER_DATETIME",i.NUMBER_CURRENCY="NUMBER_CURRENCY",i.NUMBER_PERCENT="NUMBER_PERCENT"})(NumberType||(NumberType={}));function getTypeOfExtendedNumber(i){return i instanceof RichNumber?i.getDetailedType():NumberType.NUMBER_RAW}function getFormatOfExtendedNumber(i){if(i instanceof RichNumber)return i.format}function getTypeFormatOfExtendedNumber(i){return i instanceof RichNumber?{type:i.getDetailedType(),format:i.format}:{type:NumberType.NUMBER_RAW}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class SimpleRangeValue{constructor(e,t,r,a){this._data=e,this.range=t,this.dependencyGraph=r,this._hasOnlyNumbers=a,this.size=e===void 0?new ArraySize(t.effectiveWidth(r),t.effectiveHeight(r)):new ArraySize(e[0].length,e.length)}get data(){return this.ensureThatComputed(),this._data}static fromRange(e,t,r){return new SimpleRangeValue(e,t,r,!0)}static onlyNumbers(e){return new SimpleRangeValue(e,void 0,void 0,!0)}static onlyValues(e){return new SimpleRangeValue(e,void 0,void 0,void 0)}static onlyRange(e,t){return new SimpleRangeValue(void 0,e,t,void 0)}static fromScalar(e){return new SimpleRangeValue([[e]],void 0,void 0,void 0)}isAdHoc(){return this.range===void 0}width(){return this.size.width}height(){return this.size.height}valuesFromTopLeftCorner(){this.ensureThatComputed();const e=[];for(let t=0;t<this._data.length;t++)for(let r=0;r<this._data[0].length;r++)e.push(this._data[t][r]);return e}*effectiveAddressesFromData(e){for(let t=0;t<this.data.length;++t){const r=this.data[t];for(let a=0;a<r.length;++a)yield simpleCellAddress(e.sheet,e.col+a,e.row+t)}}*entriesFromTopLeftCorner(e){this.ensureThatComputed();for(let t=0;t<this.size.height;++t)for(let r=0;r<this.size.width;++r)yield[this._data[t][r],simpleCellAddress(e.sheet,e.col+r,e.row+t)]}*iterateValuesFromTopLeftCorner(){yield*this.valuesFromTopLeftCorner()}numberOfElements(){return this.size.width*this.size.height}hasOnlyNumbers(){if(this._hasOnlyNumbers===void 0){this._hasOnlyNumbers=!0;for(const e of this.data)for(const t of e)if(typeof t!="number")return this._hasOnlyNumbers=!1,!1}return this._hasOnlyNumbers}rawNumbers(){return this._data}rawData(){var e;return this.ensureThatComputed(),(e=this._data)!==null&&e!==void 0?e:[]}sameDimensionsAs(e){return this.width()===e.width()&&this.height()===e.height()}ensureThatComputed(){this._data===void 0&&(this._hasOnlyNumbers=!0,this._data=this.range.addressesArrayMap(this.dependencyGraph,e=>{const t=this.dependencyGraph.getCellValue(e);return t instanceof SimpleRangeValue?(this._hasOnlyNumbers=!1,new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)):(isExtendedNumber(t)||(this._hasOnlyNumbers=!1),t)}))}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ContentChanges{constructor(){this.changes=new Map}static empty(){return new ContentChanges}addAll(e){for(const t of e.changes.values())this.add(t.address,t);return this}addChange(e,t,r){this.addInterpreterValue(e,t,r)}exportChanges(e){let t=[];return this.changes.forEach(r=>{const a=e.exportChange(r);Array.isArray(a)?t=t.concat(a):t.push(a)}),t}getChanges(){return Array.from(this.changes.values())}isEmpty(){return this.changes.size===0}add(e,t){const r=t.value;if(r instanceof SimpleRangeValue)for(const a of r.effectiveAddressesFromData(e))this.changes.delete(addressKey(a));this.changes.set(addressKey(e),t)}addInterpreterValue(e,t,r){this.add(t,{address:t,value:e,oldValue:r})}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class RowsSpan{constructor(e,t,r){if(this.sheet=e,this.rowStart=t,this.rowEnd=r,t<0)throw Error("Starting row cant be less than 0");if(r<t)throw Error("Row span cant end before start")}get numberOfRows(){return this.rowEnd-this.rowStart+1}get start(){return this.rowStart}get end(){return this.rowEnd}static fromNumberOfRows(e,t,r){return new RowsSpan(e,t,t+r-1)}static fromRowStartAndEnd(e,t,r){return new RowsSpan(e,t,r)}*rows(){for(let e=this.rowStart;e<=this.rowEnd;++e)yield e}intersect(e){if(this.sheet!==e.sheet)throw Error("Can't intersect spans from different sheets");const t=Math.max(this.rowStart,e.rowStart),r=Math.min(this.rowEnd,e.rowEnd);return t>r?null:new RowsSpan(this.sheet,t,r)}firstRow(){return new RowsSpan(this.sheet,this.rowStart,this.rowStart)}}class ColumnsSpan{constructor(e,t,r){if(this.sheet=e,this.columnStart=t,this.columnEnd=r,t<0)throw Error("Starting column cant be less than 0");if(r<t)throw Error("Column span cant end before start")}get numberOfColumns(){return this.columnEnd-this.columnStart+1}get start(){return this.columnStart}get end(){return this.columnEnd}static fromNumberOfColumns(e,t,r){return new ColumnsSpan(e,t,t+r-1)}static fromColumnStartAndEnd(e,t,r){return new ColumnsSpan(e,t,r)}*columns(){for(let e=this.columnStart;e<=this.columnEnd;++e)yield e}intersect(e){if(this.sheet!==e.sheet)throw Error("Can't intersect spans from different sheets");const t=Math.max(this.columnStart,e.columnStart),r=Math.min(this.columnEnd,e.columnEnd);return t>r?null:new ColumnsSpan(this.sheet,t,r)}firstColumn(){return new ColumnsSpan(this.sheet,this.columnStart,this.columnStart)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */var StatType;(function(i){i.BUILD_ENGINE_TOTAL="BUILD_ENGINE_TOTAL",i.PARSER="PARSER",i.GRAPH_BUILD="GRAPH_BUILD",i.COLLECT_DEPENDENCIES="COLLECT_DEPENDENCIES",i.PROCESS_DEPENDENCIES="PROCESS_DEPENDENCIES",i.TOP_SORT="TOP_SORT",i.BUILD_COLUMN_INDEX="BUILD_COLUMN_INDEX",i.EVALUATION="EVALUATION",i.VLOOKUP="VLOOKUP",i.TRANSFORM_ASTS="TRANSFORM_ASTS",i.TRANSFORM_ASTS_POSTPONED="TRANSFORM_ASTS_POSTPONED",i.ADJUSTING_ADDRESS_MAPPING="ADJUSTING_ADDRESS_MAPPING",i.ADJUSTING_ARRAY_MAPPING="ADJUSTING_ARRAY_MAPPING",i.ADJUSTING_RANGES="ADJUSTING_RANGES",i.ADJUSTING_GRAPH="ADJUSTING_GRAPH",i.CRITERION_FUNCTION_FULL_CACHE_USED="CRITERION_FUNCTION_FULL_CACHE_USED",i.CRITERION_FUNCTION_PARTIAL_CACHE_USED="CRITERION_FUNCTION_PARTIAL_CACHE_USED"})(StatType||(StatType={}));/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class Statistics{constructor(){this.stats=new Map([[StatType.CRITERION_FUNCTION_FULL_CACHE_USED,0],[StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0]]),this.startTimes=new Map}incrementCriterionFunctionFullCacheUsed(){var e;const t=((e=this.stats.get(StatType.CRITERION_FUNCTION_FULL_CACHE_USED))!==null&&e!==void 0?e:0)+1;this.stats.set(StatType.CRITERION_FUNCTION_FULL_CACHE_USED,t)}incrementCriterionFunctionPartialCacheUsed(){var e;const t=((e=this.stats.get(StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED))!==null&&e!==void 0?e:0)+1;this.stats.set(StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,t)}reset(){this.stats.clear(),this.startTimes.clear(),this.stats.set(StatType.CRITERION_FUNCTION_FULL_CACHE_USED,0),this.stats.set(StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0)}start(e){if(this.startTimes.get(e))throw Error(`Statistics ${e} already started`);this.startTimes.set(e,Date.now())}end(e){var t;const r=Date.now(),a=this.startTimes.get(e);if(a){let o=(t=this.stats.get(e))!==null&&t!==void 0?t:0;o+=r-a,this.stats.set(e,o),this.startTimes.delete(e)}else throw Error(`Statistics ${e} not started`)}measure(e,t){this.start(e);const r=t();return this.end(e),r}snapshot(){return new Map(this.stats)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class EmptyStatistics extends Statistics{incrementCriterionFunctionFullCacheUsed(){}incrementCriterionFunctionPartialCacheUsed(){}start(e){}end(e){}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class NoSheetWithIdError extends Error{constructor(e){super(`There's no sheet with id = ${e}`)}}class NoSheetWithNameError extends Error{constructor(e){super(`There's no sheet with name '${e}'`)}}class SheetNameAlreadyTakenError extends Error{constructor(e){super(`Sheet with name ${e} already exists`)}}class SheetSizeLimitExceededError extends Error{constructor(){super("Sheet size limit exceeded")}}class NotAFormulaError extends Error{constructor(){super("This is not a formula")}}class InvalidAddressError extends Error{constructor(e){super(`Address (row = ${e.row}, col = ${e.col}) is invalid`)}}class InvalidArgumentsError extends Error{constructor(e){super(`Invalid arguments, expected ${e}`)}}class SheetsNotEqual extends Error{constructor(e,t){super(`Sheets ${e} and ${t} are not equal.`)}}class NamedExpressionNameIsAlreadyTakenError extends Error{constructor(e){super(`Name of Named Expression '${e}' is already present`)}}class NamedExpressionNameIsInvalidError extends Error{constructor(e){super(`Name of Named Expression '${e}' is invalid`)}}class NamedExpressionDoesNotExistError extends Error{constructor(e){super(`Named Expression '${e}' does not exist`)}}class NoOperationToUndoError extends Error{constructor(){super("There is no operation to undo")}}class NoOperationToRedoError extends Error{constructor(){super("There is no operation to redo")}}class NothingToPasteError extends Error{constructor(){super("There is nothing to paste")}}function replacer(i,e){switch(typeof e){case"function":case"symbol":return e.toString();case"bigint":return"BigInt("+e.toString()+")";default:return e instanceof RegExp?"RegExp("+e.toString()+")":e}}class UnableToParseError extends Error{constructor(e){super(`Unable to parse value: ${JSON.stringify(e,replacer,4)}`)}}class ExpectedValueOfTypeError extends Error{constructor(e,t){super(`Expected value of type: ${e} for config parameter: ${t}`)}}class ConfigValueEmpty extends Error{constructor(e){super(`Config parameter ${e} cannot be empty.`)}}class ConfigValueTooSmallError extends Error{constructor(e,t){super(`Config parameter ${e} should be at least ${t}`)}}class ConfigValueTooBigError extends Error{constructor(e,t){super(`Config parameter ${e} should be at most ${t}`)}}class ExpectedOneOfValuesError extends Error{constructor(e,t){super(`Expected one of ${e} for config parameter: ${t}`)}}class EvaluationSuspendedError extends Error{constructor(){super("Computations are suspended")}}class MissingTranslationError extends Error{constructor(e){super(`Translation for ${e} is missing in the translation package you're using.`)}}class ProtectedFunctionTranslationError extends Error{constructor(e){super(`Cannot register translation for function with id: ${e}`)}}class LanguageNotRegisteredError extends Error{constructor(){super("Language not registered.")}}class LanguageAlreadyRegisteredError extends Error{constructor(){super("Language already registered.")}}class FunctionPluginValidationError extends Error{static functionNotDeclaredInPlugin(e,t){return new FunctionPluginValidationError(`Function with id ${e} not declared in plugin ${t}`)}static functionMethodNotFound(e,t){return new FunctionPluginValidationError(`Function method ${e} not found in plugin ${t}`)}}class ProtectedFunctionError extends Error{static cannotRegisterFunctionWithId(e){return new ProtectedFunctionError(`Cannot register function with id ${e}`)}static cannotUnregisterFunctionWithId(e){return new ProtectedFunctionError(`Cannot unregister function with id ${e}`)}static cannotUnregisterProtectedPlugin(){return new ProtectedFunctionError("Cannot unregister protected plugin")}}class SourceLocationHasArrayError extends Error{constructor(){super("Cannot perform this operation, source location has an array inside.")}}class TargetLocationHasArrayError extends Error{constructor(){super("Cannot perform this operation, target location has an array inside.")}}class NoRelativeAddressesAllowedError extends Error{constructor(){super("Relative addresses not allowed in named expressions.")}}class AliasAlreadyExisting extends Error{constructor(e,t){super(`Alias id ${e} in plugin ${t} already defined as a function or alias.`)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class AddressMapping{constructor(e){this.policy=e,this.mapping=new Map}getCell(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new NoSheetWithIdError(e.sheet);return t.getCell(e)}fetchCell(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new NoSheetWithIdError(e.sheet);const r=t.getCell(e);if(!r)throw Error("Vertex for address missing in AddressMapping");return r}strategyFor(e){const t=this.mapping.get(e);if(t===void 0)throw new NoSheetWithIdError(e);return t}addSheet(e,t){if(this.mapping.has(e))throw Error("Sheet already added");this.mapping.set(e,t)}autoAddSheet(e,t){const{height:r,width:a,fill:o}=t,u=this.policy.call(o);this.addSheet(e,new u(a,r))}getCellValue(e){const t=this.getCell(e);return t===void 0?EmptyValue:t instanceof ArrayVertex?t.getArrayCellValue(e):t.getCellValue()}getRawValue(e){const t=this.getCell(e);return t instanceof ValueCellVertex?t.getValues().rawValue:t instanceof ArrayVertex?t.getArrayCellRawValue(e):null}setCell(e,t){const r=this.mapping.get(e.sheet);if(!r)throw Error("Sheet not initialized");r.setCell(e,t)}moveCell(e,t){const r=this.mapping.get(e.sheet);if(!r)throw Error("Sheet not initialized.");if(e.sheet!==t.sheet)throw Error("Cannot move cells between sheets.");if(r.has(t))throw new Error("Cannot move cell. Destination already occupied.");const a=r.getCell(e);if(a===void 0)throw new Error("Cannot move cell. No cell with such address.");this.setCell(t,a),this.removeCell(e)}removeCell(e){const t=this.mapping.get(e.sheet);if(!t)throw Error("Sheet not initialized");t.removeCell(e)}has(e){const t=this.mapping.get(e.sheet);return t===void 0?!1:t.has(e)}getHeight(e){const t=this.mapping.get(e);if(t===void 0)throw new NoSheetWithIdError(e);return t.getHeight()}getWidth(e){const t=this.mapping.get(e);if(!t)throw new NoSheetWithIdError(e);return t.getWidth()}addRows(e,t,r){const a=this.mapping.get(e);if(a===void 0)throw new NoSheetWithIdError(e);a.addRows(t,r)}removeRows(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new NoSheetWithIdError(e.sheet);t.removeRows(e)}removeSheet(e){this.mapping.delete(e)}addColumns(e,t,r){const a=this.mapping.get(e);if(a===void 0)throw new NoSheetWithIdError(e);a.addColumns(t,r)}removeColumns(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new NoSheetWithIdError(e.sheet);t.removeColumns(e)}*verticesFromRowsSpan(e){yield*this.mapping.get(e.sheet).verticesFromRowsSpan(e)}*verticesFromColumnsSpan(e){yield*this.mapping.get(e.sheet).verticesFromColumnsSpan(e)}*entriesFromRowsSpan(e){yield*this.mapping.get(e.sheet).entriesFromRowsSpan(e)}*entriesFromColumnsSpan(e){yield*this.mapping.get(e.sheet).entriesFromColumnsSpan(e)}*entries(){for(const[e,t]of this.mapping.entries())yield*t.getEntries(e)}*sheetEntries(e){const t=this.mapping.get(e);if(t!==void 0)yield*t.getEntries(e);else throw new NoSheetWithIdError(e)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ArrayMapping{constructor(){this.arrayMapping=new Map}getArray(e){const t=this.getArrayByCorner(e.start);if(t!=null&&t.getRange().sameAs(e))return t}getArrayByCorner(e){return this.arrayMapping.get(addressKey(e))}setArray(e,t){this.arrayMapping.set(addressKey(e.start),t)}removeArray(e){typeof e=="string"?this.arrayMapping.delete(e):this.arrayMapping.delete(addressKey(e.start))}count(){return this.arrayMapping.size}*arraysInRows(e){for(const[t,r]of this.arrayMapping.entries())r.spansThroughSheetRows(e.sheet,e.rowStart,e.rowEnd)&&(yield[t,r])}*arraysInCols(e){for(const[t,r]of this.arrayMapping.entries())r.spansThroughSheetColumn(e.sheet,e.columnStart,e.columnEnd)&&(yield[t,r])}isFormulaArrayInRow(e,t){for(const r of this.arrayMapping.values())if(r.spansThroughSheetRows(e,t))return!0;return!1}isFormulaArrayInAllRows(e){let t=!0;for(const r of e.rows())this.isFormulaArrayInRow(e.sheet,r)||(t=!1);return t}isFormulaArrayInColumn(e,t){for(const r of this.arrayMapping.values())if(r.spansThroughSheetColumn(e,t))return!0;return!1}isFormulaArrayInAllColumns(e){let t=!0;for(const r of e.columns())this.isFormulaArrayInColumn(e.sheet,r)||(t=!1);return t}isFormulaArrayInRange(e){for(const t of this.arrayMapping.values())if(t.getRange().doesOverlap(e))return!0;return!1}isFormulaArrayAtAddress(e){for(const t of this.arrayMapping.values())if(t.getRange().addressInRange(e))return!0;return!1}moveArrayVerticesAfterRowByRows(e,t,r){this.updateArrayVerticesInSheet(e,(a,o)=>{const u=o.getRange();return t<=u.start.row?[u.shifted(0,r),o]:void 0})}moveArrayVerticesAfterColumnByColumns(e,t,r){this.updateArrayVerticesInSheet(e,(a,o)=>{const u=o.getRange();return t<=u.start.col?[u.shifted(r,0),o]:void 0})}updateArrayVerticesInSheet(e,t){const r=Array();for(const[a,o]of this.arrayMapping.entries()){if(o.sheet!==e)continue;const u=t(a,o);u!==void 0&&(this.removeArray(a),r.push(u))}r.forEach(([a,o])=>{this.setArray(a,o)})}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class NotComputedArray{constructor(e){this.size=e}width(){return this.size.width}height(){return this.size.height}get(e,t){throw Error("Array not computed yet.")}simpleRangeValue(){throw Error("Array not computed yet.")}}class ArrayValue{constructor(e){if(this.size=new ArraySize(e.length>0?e[0].length:0,e.length),this.array=e,this.size.width<=0||this.size.height<=0)throw Error("Incorrect array size")}static fromInterpreterValue(e){return e instanceof SimpleRangeValue?new ArrayValue(e.data):new ArrayValue([[e]])}simpleRangeValue(){return SimpleRangeValue.onlyValues(this.array)}addRows(e,t){this.array.splice(e,0,...this.nullArrays(t,this.width())),this.size.height+=t}addColumns(e,t){for(let r=0;r<this.height();r++)this.array[r].splice(e,0,...new Array(t).fill(EmptyValue));this.size.width+=t}removeRows(e,t){if(this.outOfBound(0,e)||this.outOfBound(0,t))throw Error("Array index out of bound");const r=t-e+1;this.array.splice(e,r),this.size.height-=r}removeColumns(e,t){if(this.outOfBound(e,0)||this.outOfBound(t,0))throw Error("Array index out of bound");const r=t-e+1;for(const a of this.array)a.splice(e,r);this.size.width-=r}nullArrays(e,t){const r=[];for(let a=0;a<e;++a)r.push(new Array(t).fill(EmptyValue));return r}get(e,t){if(this.outOfBound(e,t))throw Error("Array index out of bound");return this.array[t][e]}set(e,t,r){if(this.outOfBound(e,t))throw Error("Array index out of bound");this.array[t][e]=r}width(){return this.size.width}height(){return this.size.height}raw(){return this.array}resize(e){if(this.height()<e.height&&isFinite(e.height)&&this.addRows(this.height(),e.height-this.height()),this.height()>e.height||(this.width()<e.width&&isFinite(e.width)&&this.addColumns(this.width(),e.width-this.width()),this.width()>e.width))throw Error("Resizing to smaller array")}outOfBound(e,t){return e<0||t<0||t>this.size.height-1||e>this.size.width-1}}class ErroredArray{constructor(e,t){this.error=e,this.size=t}get(e,t){return this.error}width(){return this.size.width}height(){return this.size.height}simpleRangeValue(){return this.error}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class FormulaVertex{constructor(e,t,r){this.formula=e,this.cellAddress=t,this.version=r}get width(){return 1}get height(){return 1}static fromAst(e,t,r,a){return r.isScalar()?new FormulaCellVertex(e,t,a):new ArrayVertex(e,t,r,a)}getFormula(e){return this.ensureRecentData(e),this.formula}ensureRecentData(e){if(this.version!=e.version()){const[t,r,a]=e.applyTransformations(this.formula,this.cellAddress,this.version);this.formula=t,this.cellAddress=r,this.version=a}}getAddress(e){return this.ensureRecentData(e),this.cellAddress}}class ArrayVertex extends FormulaVertex{constructor(e,t,r,a=0){super(e,t,a),r.isRef?this.array=new ErroredArray(new CellError(ErrorType.REF,ErrorMessage.NoSpaceForArrayResult),ArraySize.error()):this.array=new NotComputedArray(r)}get width(){return this.array.width()}get height(){return this.array.height()}get sheet(){return this.cellAddress.sheet}get leftCorner(){return this.cellAddress}setCellValue(e){if(e instanceof CellError)return this.setErrorValue(e),e;const t=ArrayValue.fromInterpreterValue(e);return t.resize(this.array.size),this.array=t,e}getCellValue(){if(this.array instanceof NotComputedArray)throw Error("Array not computed yet.");return this.array.simpleRangeValue()}valueOrUndef(){if(!(this.array instanceof NotComputedArray))return this.array.simpleRangeValue()}getArrayCellValue(e){const t=e.col-this.cellAddress.col,r=e.row-this.cellAddress.row;try{return this.array.get(t,r)}catch{return new CellError(ErrorType.REF)}}getArrayCellRawValue(e){const t=this.getArrayCellValue(e);if(!(t instanceof CellError||t===EmptyValue))return getRawValue(t)}setArrayCellValue(e,t){const r=e.col-this.cellAddress.col,a=e.row-this.cellAddress.row;this.array instanceof ArrayValue&&this.array.set(r,a,t)}setNoSpace(){return this.array=new ErroredArray(new CellError(ErrorType.SPILL,ErrorMessage.NoSpaceForArrayResult),ArraySize.error()),this.getCellValue()}getRange(){return AbsoluteCellRange.spanFrom(this.cellAddress,this.width,this.height)}getRangeOrUndef(){return AbsoluteCellRange.spanFromOrUndef(this.cellAddress,this.width,this.height)}setAddress(e){this.cellAddress=e}setFormula(e){this.formula=e}spansThroughSheetRows(e,t,r=t){return this.cellAddress.sheet===e&&this.cellAddress.row<=r&&t<this.cellAddress.row+this.height}spansThroughSheetColumn(e,t,r=t){return this.cellAddress.sheet===e&&this.cellAddress.col<=r&&t<this.cellAddress.col+this.width}isComputed(){return!(this.array instanceof NotComputedArray)}columnsFromArray(){return ColumnsSpan.fromNumberOfColumns(this.cellAddress.sheet,this.cellAddress.col,this.width)}rowsFromArray(){return RowsSpan.fromNumberOfRows(this.cellAddress.sheet,this.cellAddress.row,this.height)}ensureRecentData(e){}isLeftCorner(e){return equalSimpleCellAddress(this.cellAddress,e)}setErrorValue(e){this.array=new ErroredArray(e,this.array.size)}}class FormulaCellVertex extends FormulaVertex{constructor(e,t,r){super(e,t,r)}valueOrUndef(){return this.cachedCellValue}setCellValue(e){return this.cachedCellValue=e,this.cachedCellValue}getCellValue(){if(this.cachedCellValue!==void 0)return this.cachedCellValue;throw Error("Value of the formula cell is not computed.")}isComputed(){return this.cachedCellValue!==void 0}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class RangeVertex{constructor(e){this.range=e,this.functionCache=new Map,this.criterionFunctionCache=new Map,this.dependentCacheRanges=new Set,this.bruteForce=!1}get start(){return this.range.start}get end(){return this.range.end}get sheet(){return this.range.start.sheet}getFunctionValue(e){return this.functionCache.get(e)}setFunctionValue(e,t){this.functionCache.set(e,t)}getCriterionFunctionValue(e,t){var r;return(r=this.getCriterionFunctionValues(e).get(t))===null||r===void 0?void 0:r[0]}getCriterionFunctionValues(e){var t;return(t=this.criterionFunctionCache.get(e))!==null&&t!==void 0?t:new Map}setCriterionFunctionValues(e,t){this.criterionFunctionCache.set(e,t)}addDependentCacheRange(e){e!==this&&this.dependentCacheRanges.add(e)}clearCache(){this.functionCache.clear(),this.criterionFunctionCache.clear(),this.dependentCacheRanges.forEach(e=>e.criterionFunctionCache.clear()),this.dependentCacheRanges.clear()}getStart(){return this.start}getEnd(){return this.end}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const collectAddressesDependentToRange=(i,e,t,r,a)=>{if(e instanceof RangeVertex){const c=e.range.intersectionWith(t);return c!==void 0?Array.from(c.addresses(a)):[]}let o,u;if(e instanceof FormulaVertex)o=e.getFormula(r),u=e.getAddress(r);else return[];return collectDependencies(o,i).filter(c=>c instanceof AddressDependency).map(c=>c.dependency.toSimpleCellAddress(u)).filter(c=>t.addressInRange(c))};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */var NodeVisitStatus;(function(i){i[i.ON_STACK=0]="ON_STACK",i[i.PROCESSED=1]="PROCESSED",i[i.POPPED=2]="POPPED"})(NodeVisitStatus||(NodeVisitStatus={}));class TopSort{constructor(e=[],t=[]){this.nodesSparseArray=e,this.edgesSparseArray=t,this.entranceTime=[],this.low=[],this.parent=[],this.inSCC=[],this.nodeStatus=[],this.order=[],this.sccNonSingletons=[],this.timeCounter=0}getTopSortedWithSccSubgraphFrom(e,t,r){const a=e.reverse();return a.forEach(o=>this.runDFS(o)),this.postprocess(a,r,t)}getAdjacentNodeIds(e){return this.edgesSparseArray[e].filter(t=>t!==void 0&&this.nodesSparseArray[t])}runDFS(e){if(this.nodeStatus[e]!==void 0)return;this.nodeStatus[e]=NodeVisitStatus.ON_STACK;const t=[e],r=[];for(;t.length>0;){const a=t[t.length-1];switch(this.nodeStatus[a]){case NodeVisitStatus.ON_STACK:{this.handleOnStack(a,r,t);break}case NodeVisitStatus.PROCESSED:{this.handleProcessed(a,r,t);break}case NodeVisitStatus.POPPED:{t.pop();break}}}}handleOnStack(e,t,r){this.entranceTime[e]=this.timeCounter,this.low[e]=this.timeCounter,this.timeCounter++,t.push(e),this.getAdjacentNodeIds(e).forEach(a=>{this.entranceTime[a]===void 0&&(r.push(a),this.parent[a]=e,this.nodeStatus[a]=NodeVisitStatus.ON_STACK)}),this.nodeStatus[e]=NodeVisitStatus.PROCESSED}handleProcessed(e,t,r){let a=this.entranceTime[e];if(this.getAdjacentNodeIds(e).forEach(o=>{this.inSCC[o]||(a=this.parent[o]===e?Math.min(a,this.low[o]):Math.min(a,this.entranceTime[o]))}),this.low[e]=a,a===this.entranceTime[e]){const o=[];do o.push(t[t.length-1]),t.pop();while(o[o.length-1]!==e);o.forEach(u=>{this.inSCC[u]=!0}),this.order.push(...o),o.length>1&&o.forEach(u=>{this.sccNonSingletons[u]=!0})}r.pop(),this.nodeStatus[e]=NodeVisitStatus.POPPED}postprocess(e,t,r){const a=[];e.forEach(c=>{a[c]=!0});const o=[],u=[];return this.order.reverse(),this.order.forEach(c=>{const h=this.getAdjacentNodeIds(c);this.sccNonSingletons[c]||h.includes(c)?(u.push(this.nodesSparseArray[c]),t(this.nodesSparseArray[c]),h.forEach(d=>a[d]=!0)):(o.push(this.nodesSparseArray[c]),a[c]&&r(this.nodesSparseArray[c])&&h.forEach(d=>a[d]=!0))}),{sorted:o,cycled:u}}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ProcessableValue{constructor(e,t){this.rawValue=e,this.processFn=t,this.processedValue=null}getProcessedValue(){return this.processedValue===null&&(this.processedValue=this.processFn(this.rawValue)),this.processedValue}markAsModified(){this.processedValue=null}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class Graph{constructor(e){this.dependencyQuery=e,this.nodesSparseArray=[],this.edgesSparseArray=[],this.nodesIds=new Map,this.dirtyAndVolatileNodeIds=new ProcessableValue({dirty:[],volatile:[]},t=>this.processDirtyAndVolatileNodeIds(t)),this.infiniteRangeIds=new Set,this.changingWithStructureNodeIds=[],this.nextId=0}getNodes(){return this.nodesSparseArray.filter(e=>e!==void 0)}hasNode(e){return this.nodesIds.has(e)}existsEdge(e,t){const r=this.getNodeId(e),a=this.getNodeId(t);return r===void 0||a===void 0?!1:this.edgesSparseArray[r].includes(a)}adjacentNodes(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);return new Set(this.edgesSparseArray[t].filter(r=>r!==void 0).map(r=>this.nodesSparseArray[r]))}adjacentNodesCount(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);return this.fixEdgesArrayForNode(t).length}addNodeAndReturnId(e){const t=this.nodesIds.get(e);if(t!==void 0)return t;const r=this.nextId;return this.nextId++,this.nodesSparseArray[r]=e,this.edgesSparseArray[r]=[],this.nodesIds.set(e,r),r}addEdge(e,t){const r=this.getNodeIdIfNotNumber(e),a=this.getNodeIdIfNotNumber(t);if(r===void 0)throw this.missingNodeError(e);if(a===void 0)throw this.missingNodeError(t);this.edgesSparseArray[r].includes(a)||this.edgesSparseArray[r].push(a)}removeNode(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);this.edgesSparseArray[t].length>0&&(this.edgesSparseArray[t].forEach(a=>this.dirtyAndVolatileNodeIds.rawValue.dirty.push(a)),this.dirtyAndVolatileNodeIds.markAsModified());const r=this.removeDependencies(e);return delete this.nodesSparseArray[t],delete this.edgesSparseArray[t],this.infiniteRangeIds.delete(t),this.nodesIds.delete(e),r}removeEdge(e,t){const r=this.getNodeIdIfNotNumber(e),a=this.getNodeIdIfNotNumber(t);if(r===void 0)throw this.missingNodeError(e);if(a===void 0)throw this.missingNodeError(t);const o=this.edgesSparseArray[r].indexOf(a);if(o===-1)throw new Error("Edge does not exist");delete this.edgesSparseArray[r][o]}removeEdgeIfExists(e,t){const r=this.getNodeId(e),a=this.getNodeId(t);if(r===void 0||a===void 0)return;const o=this.edgesSparseArray[r].indexOf(a);o!==-1&&delete this.edgesSparseArray[r][o]}topSortWithScc(){return this.getTopSortedWithSccSubgraphFrom(this.getNodes(),()=>!0,()=>{})}getTopSortedWithSccSubgraphFrom(e,t,r){const a=new TopSort(this.nodesSparseArray,this.edgesSparseArray),o=e.map(u=>this.getNodeId(u)).filter(u=>u!==void 0);return a.getTopSortedWithSccSubgraphFrom(o,t,r)}markNodeAsVolatile(e){const t=this.getNodeId(e);t!==void 0&&(this.dirtyAndVolatileNodeIds.rawValue.volatile.push(t),this.dirtyAndVolatileNodeIds.markAsModified())}markNodeAsDirty(e){const t=this.getNodeId(e);t!==void 0&&(this.dirtyAndVolatileNodeIds.rawValue.dirty.push(t),this.dirtyAndVolatileNodeIds.markAsModified())}getDirtyAndVolatileNodes(){return this.dirtyAndVolatileNodeIds.getProcessedValue()}clearDirtyNodes(){this.dirtyAndVolatileNodeIds.rawValue.dirty=[],this.dirtyAndVolatileNodeIds.markAsModified()}markNodeAsChangingWithStructure(e){const t=this.getNodeId(e);t!==void 0&&this.changingWithStructureNodeIds.push(t)}markChangingWithStructureNodesAsDirty(){this.changingWithStructureNodeIds.length<=0||(this.dirtyAndVolatileNodeIds.rawValue.dirty=[...this.dirtyAndVolatileNodeIds.rawValue.dirty,...this.changingWithStructureNodeIds],this.dirtyAndVolatileNodeIds.markAsModified())}markNodeAsInfiniteRange(e){const t=this.getNodeIdIfNotNumber(e);t!==void 0&&this.infiniteRangeIds.add(t)}getInfiniteRanges(){return[...this.infiniteRangeIds].map(e=>({node:this.nodesSparseArray[e],id:e}))}getNodeId(e){return this.nodesIds.get(e)}getNodeIdIfNotNumber(e){return typeof e=="number"?e:this.nodesIds.get(e)}fixEdgesArrayForNode(e){const t=this.edgesSparseArray[e];return this.edgesSparseArray[e]=t.filter(r=>r!==void 0&&this.nodesSparseArray[r]),this.edgesSparseArray[e]}removeDependencies(e){const t=this.dependencyQuery(e);return t.forEach(([r,a])=>{this.removeEdgeIfExists(a,e)}),t}processDirtyAndVolatileNodeIds({dirty:e,volatile:t}){return[...new Set([...e,...t])].map(r=>this.nodesSparseArray[r]).filter(r=>r!==void 0)}missingNodeError(e){return new Error(`Unknown node ${e}`)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class RangeMapping{constructor(){this.rangeMapping=new Map}getMappingSize(e){var t,r;return(r=(t=this.rangeMapping.get(e))===null||t===void 0?void 0:t.size)!==null&&r!==void 0?r:0}setRange(e){let t=this.rangeMapping.get(e.getStart().sheet);t===void 0&&(t=new Map,this.rangeMapping.set(e.getStart().sheet,t));const r=keyFromAddresses(e.getStart(),e.getEnd());t.set(r,e)}removeRange(e){const t=e.getStart().sheet,r=this.rangeMapping.get(t);if(r===void 0)return;const a=keyFromAddresses(e.getStart(),e.getEnd());r.delete(a),r.size===0&&this.rangeMapping.delete(t)}getRange(e,t){const r=this.rangeMapping.get(e.sheet),a=keyFromAddresses(e,t);return r==null?void 0:r.get(a)}fetchRange(e,t){const r=this.getRange(e,t);if(!r)throw Error("Range does not exist");return r}truncateRanges(e,t){const r=Array(),a=Array(),o=Array(),u=e.sheet;for(const[h,d]of this.entriesFromSheet(e.sheet)){const p=d.range;e.start<=t(d.range.end)&&(p.removeSpan(e),p.shouldBeRemoved()?(this.removeByKey(u,h),r.push(d)):a.push([h,d]),o.push(d))}const c=[];a.sort((h,d)=>compareBy(h[1],d[1],t));for(const[h,d]of a){const p=keyFromRange(d.range);if(p===h)continue;const m=this.getByKey(u,p);this.removeByKey(u,h),m!==void 0&&d!=m?c.push([m,d]):this.setRange(d)}return{verticesToRemove:r,verticesToMerge:c,verticesWithChangedSize:o}}moveAllRangesInSheetAfterRowByRows(e,t,r){return this.updateVerticesFromSheet(e,(a,o)=>t<=o.start.row?(o.range.shiftByRows(r),{changedSize:!1,vertex:o}):t>o.start.row&&t<=o.end.row?(o.range.expandByRows(r),{changedSize:!0,vertex:o}):void 0)}moveAllRangesInSheetAfterColumnByColumns(e,t,r){return this.updateVerticesFromSheet(e,(a,o)=>t<=o.start.col?(o.range.shiftByColumns(r),{changedSize:!1,vertex:o}):t>o.start.col&&t<=o.end.col?(o.range.expandByColumns(r),{changedSize:!0,vertex:o}):void 0)}moveRangesInsideSourceRange(e,t,r,a){this.updateVerticesFromSheet(e.sheet,(o,u)=>{if(e.containsRange(u.range))return u.range.shiftByColumns(t),u.range.shiftByRows(r),u.range.moveToSheet(a),{changedSize:!1,vertex:u}})}removeRangesInSheet(e){if(this.rangeMapping.has(e)){const t=this.rangeMapping.get(e).values();return this.rangeMapping.delete(e),t}return[][Symbol.iterator]()}*rangesInSheet(e){const t=this.rangeMapping.get(e);t&&(yield*t.values())}*rangeVerticesContainedInRange(e){for(const t of this.rangesInSheet(e.sheet))e.containsRange(t.range)&&(yield t)}findSmallerRange(e){if(e.height()>1&&Number.isFinite(e.height())){const t=simpleCellAddress(e.end.sheet,e.end.col,e.end.row-1),r=this.getRange(e.start,t);if(r!==void 0){const a=AbsoluteCellRange.fromSimpleCellAddresses(simpleCellAddress(e.start.sheet,e.start.col,e.end.row),e.end);return{smallerRangeVertex:r,restRange:a}}}return{restRange:e}}*entriesFromSheet(e){const t=this.rangeMapping.get(e);t&&(yield*t.entries())}removeByKey(e,t){this.rangeMapping.get(e).delete(t)}getByKey(e,t){var r;return(r=this.rangeMapping.get(e))===null||r===void 0?void 0:r.get(t)}updateVerticesFromSheet(e,t){const r=Array();for(const[a,o]of this.entriesFromSheet(e)){const u=t(a,o);u!==void 0&&(this.removeByKey(e,a),r.push(u))}return r.forEach(a=>{this.setRange(a.vertex)}),{verticesWithChangedSize:r.filter(a=>a.changedSize).map(a=>a.vertex)}}}function keyFromAddresses(i,e){return`${i.col},${i.row},${e.col},${e.row}`}function keyFromRange(i){return keyFromAddresses(i.start,i.end)}const compareBy=(i,e,t)=>{const r=t(i.range.start),a=t(i.range.start);if(r===a){const o=t(i.range.end),u=t(e.range.end);return o-u}else return r-a};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class TranslationPackage{constructor(e,t,r){this.functions=e,this.errors=t,this.ui=r,this._protectedTranslations={VERSION:"VERSION"},this.checkUI(),this.checkErrors(),this.checkFunctionTranslations(this.functions),Object.assign(this.functions,this._protectedTranslations)}extendFunctions(e){this.checkFunctionTranslations(e),Object.assign(this.functions,e)}buildFunctionMapping(){return Object.keys(this.functions).reduce((e,t)=>(e[this.functions[t]]=t,e),{})}buildErrorMapping(){return Object.keys(this.errors).reduce((e,t)=>(e[this.errors[t]]=t,e),{})}isFunctionTranslated(e){return this.functions[e]!==void 0}getFunctionTranslations(e){const t=[];for(const r of e)this.isFunctionTranslated(r)&&t.push(this.functions[r]);return t}getFunctionTranslation(e){const t=this.functions[e];if(t===void 0)throw new MissingTranslationError(`functions.${e}`);return t}getMaybeFunctionTranslation(e){return this.functions[e]}getErrorTranslation(e){if(e===ErrorType.LIC)return`#${ErrorType.LIC}!`;const t=this.errors[e];if(t===void 0)throw new MissingTranslationError(`errors.${e}`);return t}getUITranslation(e){const t=this.ui[e];if(t===void 0)throw new MissingTranslationError(`ui.${e}`);return t}checkUI(){for(const e of Object.values(UIElement))if(!(e in this.ui))throw new MissingTranslationError(`ui.${e}`)}checkErrors(){for(const e of Object.values(ErrorType))if(!(e in this.errors)&&e!==ErrorType.LIC)throw new MissingTranslationError(`errors.${e}`)}checkFunctionTranslations(e){const t=new Set(Object.getOwnPropertyNames(e));for(const r of Object.getOwnPropertyNames(this._protectedTranslations))if(t.has(r))throw new ProtectedFunctionTranslationError(r)}}function buildTranslationPackage(i){return new TranslationPackage(Object.assign({},i.functions),Object.assign({},i.errors),Object.assign({},i.ui))}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */var UIElement;(function(i){i.NEW_SHEET_PREFIX="NEW_SHEET_PREFIX"})(UIElement||(UIElement={}));/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */function canonicalize(i){return i.toLowerCase()}class Sheet{constructor(e,t){this.id=e,this.displayName=t}get canonicalName(){return canonicalize(this.displayName)}}class SheetMapping{constructor(e){this.languages=e,this.mappingFromCanonicalName=new Map,this.mappingFromId=new Map,this.lastSheetId=-1,this.fetch=t=>{const r=this.mappingFromCanonicalName.get(canonicalize(t));if(r===void 0)throw new NoSheetWithNameError(t);return r.id},this.get=t=>{var r;return(r=this.mappingFromCanonicalName.get(canonicalize(t)))===null||r===void 0?void 0:r.id},this.fetchDisplayName=t=>this.fetchSheetById(t).displayName,this.sheetNamePrefix=e.getUITranslation(UIElement.NEW_SHEET_PREFIX)}addSheet(e=`${this.sheetNamePrefix}${this.lastSheetId+2}`){const t=canonicalize(e);if(this.mappingFromCanonicalName.has(t))throw new SheetNameAlreadyTakenError(e);this.lastSheetId++;const r=new Sheet(this.lastSheetId,e);return this.store(r),r.id}removeSheet(e){const t=this.fetchSheetById(e);e==this.lastSheetId&&--this.lastSheetId,this.mappingFromCanonicalName.delete(t.canonicalName),this.mappingFromId.delete(t.id)}getDisplayName(e){var t;return(t=this.mappingFromId.get(e))===null||t===void 0?void 0:t.displayName}*displayNames(){for(const e of this.mappingFromCanonicalName.values())yield e.displayName}numberOfSheets(){return this.mappingFromCanonicalName.size}hasSheetWithId(e){return this.mappingFromId.has(e)}hasSheetWithName(e){return this.mappingFromCanonicalName.has(canonicalize(e))}renameSheet(e,t){const r=this.fetchSheetById(e),a=r.displayName;if(a===t)return;const o=this.mappingFromCanonicalName.get(canonicalize(t));if(o!==void 0&&o.id!==r.id)throw new SheetNameAlreadyTakenError(t);const u=r.canonicalName;return this.mappingFromCanonicalName.delete(u),r.displayName=t,this.store(r),a}sheetNames(){return Array.from(this.mappingFromId.values()).map(e=>e.displayName)}store(e){this.mappingFromId.set(e.id,e),this.mappingFromCanonicalName.set(e.canonicalName,e)}fetchSheetById(e){const t=this.mappingFromId.get(e);if(t===void 0)throw new NoSheetWithIdError(e);return t}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class DependencyGraph{constructor(e,t,r,a,o,u,c,h){this.addressMapping=e,this.rangeMapping=t,this.sheetMapping=r,this.arrayMapping=a,this.stats=o,this.lazilyTransformingAstService=u,this.functionRegistry=c,this.namedExpressions=h,this.changes=ContentChanges.empty(),this.dependencyQueryAddresses=d=>{if(d instanceof RangeVertex)return this.rangeDependencyQuery(d).map(([p,m])=>p);{const p=this.formulaDependencyQuery(d);if(p!==void 0){const[m,f]=p;return f.map(g=>g instanceof NamedExpressionDependency?this.namedExpressions.namedExpressionOrPlaceholder(g.name,m.sheet).address:isSimpleCellAddress(g)?g:simpleCellRange(g.start,g.end))}else return[]}},this.dependencyQueryVertices=d=>{if(d instanceof RangeVertex)return this.rangeDependencyQuery(d);{const p=this.formulaDependencyQuery(d);if(p!==void 0){const[m,f]=p;return f.map(g=>{if(g instanceof AbsoluteCellRange)return[g.start,this.rangeMapping.fetchRange(g.start,g.end)];if(g instanceof NamedExpressionDependency){const y=this.namedExpressions.namedExpressionOrPlaceholder(g.name,m.sheet);return[y.address,this.addressMapping.fetchCell(y.address)]}else return[g,this.addressMapping.fetchCell(g)]})}else return[]}},this.rangeDependencyQuery=d=>{const p=[],{smallerRangeVertex:m,restRange:f}=this.rangeMapping.findSmallerRange(d.range);let g;m!==void 0&&this.graph.adjacentNodes(m).has(d)?(g=f,p.push([new AbsoluteCellRange(m.start,m.end),m])):g=d.range;for(const y of g.addresses(this)){const T=this.addressMapping.getCell(y);T!==void 0&&p.push([y,T])}return p},this.formulaDependencyQuery=d=>{let p,m;if(d instanceof FormulaVertex)m=d.getAddress(this.lazilyTransformingAstService),p=d.getFormula(this.lazilyTransformingAstService);else return;const f=collectDependencies(p,this.functionRegistry);return[m,absolutizeDependencies(f,m)]},this.graph=new Graph(this.dependencyQueryVertices)}static buildEmpty(e,t,r,a,o){return new DependencyGraph(new AddressMapping(t.chooseAddressMappingPolicy),new RangeMapping,new SheetMapping(t.translationPackage),new ArrayMapping,o,e,r,a)}setFormulaToCell(e,t,r,a,o,u){const c=FormulaVertex.fromAst(t,e,a,this.lazilyTransformingAstService.version());return this.exchangeOrAddFormulaVertex(c),this.processCellDependencies(r,c),this.graph.markNodeAsDirty(c),o&&this.markAsVolatile(c),u&&this.markAsDependentOnStructureChange(c),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setParsingErrorToCell(e,t){const r=this.shrinkPossibleArrayAndGetCell(e);return this.exchangeOrAddGraphNode(r,t),this.addressMapping.setCell(e,t),this.graph.markNodeAsDirty(t),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setValueToCell(e,t){const r=this.shrinkPossibleArrayAndGetCell(e);if(r instanceof ArrayVertex&&this.arrayMapping.removeArray(r.getRange()),r instanceof ValueCellVertex)r.getValues().rawValue!==t.rawValue&&(r.setValues(t),this.graph.markNodeAsDirty(r));else{const a=new ValueCellVertex(t.parsedValue,t.rawValue);this.exchangeOrAddGraphNode(r,a),this.addressMapping.setCell(e,a),this.graph.markNodeAsDirty(a)}return this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setCellEmpty(e){const t=this.shrinkPossibleArrayAndGetCell(e);if(t===void 0)return ContentChanges.empty();if(this.graph.adjacentNodes(t).size>0){const r=new EmptyCellVertex;this.exchangeGraphNode(t,r),this.graph.adjacentNodesCount(r)===0?(this.removeVertex(r),this.addressMapping.removeCell(e)):(this.graph.markNodeAsDirty(r),this.addressMapping.setCell(e,r))}else this.removeVertex(t),this.addressMapping.removeCell(e);return this.getAndClearContentChanges()}clearDirtyVertices(){this.graph.clearDirtyNodes()}verticesToRecompute(){return this.graph.getDirtyAndVolatileNodes()}processCellDependencies(e,t){const r=this.graph.getNodeId(t);e.forEach(a=>{if(a instanceof AbsoluteCellRange){const o=a;let u=this.getRange(o.start,o.end);u===void 0&&(u=new RangeVertex(o),this.rangeMapping.setRange(u)),this.graph.addNodeAndReturnId(u);const c=this.graph.getNodeId(u);o.isFinite()||this.graph.markNodeAsInfiniteRange(c);const{smallerRangeVertex:h,restRange:d}=this.rangeMapping.findSmallerRange(o);if(h!==void 0){if(this.graph.addEdge(h,c),u.bruteForce){u.bruteForce=!1;for(const m of o.addresses(this))this.graph.removeEdge(this.fetchCell(m),c)}}else u.bruteForce=!0;const p=this.arrayMapping.getArray(d);if(p!==void 0)this.graph.addEdge(p,c);else for(const m of d.addresses(this)){const{vertex:f,id:g}=this.fetchCellOrCreateEmpty(m);this.graph.addEdge(g??f,c)}this.graph.addEdge(c,r),o.isFinite()&&this.correctInfiniteRangesDependenciesByRangeVertex(u)}else if(a instanceof NamedExpressionDependency){const o=t.getAddress(this.lazilyTransformingAstService).sheet,{vertex:u,id:c}=this.fetchNamedExpressionVertex(a.name,o);this.graph.addEdge(c??u,r)}else{const{vertex:o,id:u}=this.fetchCellOrCreateEmpty(a);this.graph.addEdge(u??o,r)}})}fetchNamedExpressionVertex(e,t){const r=this.namedExpressions.namedExpressionOrPlaceholder(e,t);return this.fetchCellOrCreateEmpty(r.address)}exchangeNode(e,t){const r=this.fetchCellOrCreateEmpty(e).vertex,a=this.fetchCellOrCreateEmpty(t).vertex;this.addressMapping.removeCell(e),this.exchangeGraphNode(r,a)}fetchCellOrCreateEmpty(e){const t=this.addressMapping.getCell(e);if(t!==void 0)return{vertex:t,id:void 0};const r=new EmptyCellVertex,a=this.graph.addNodeAndReturnId(r);return this.addressMapping.setCell(e,r),{vertex:r,id:a}}removeRows(e){this.stats.measure(StatType.ADJUSTING_GRAPH,()=>{for(const[r,a]of this.addressMapping.entriesFromRowsSpan(e)){for(const o of this.graph.adjacentNodes(a))this.graph.markNodeAsDirty(o);if(a instanceof ArrayVertex)if(a.isLeftCorner(r))this.shrinkArrayToCorner(a),this.arrayMapping.removeArray(a.getRange());else continue;this.removeVertex(a)}}),this.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeRows(e)});const t=this.stats.measure(StatType.ADJUSTING_RANGES,()=>{const r=this.truncateRanges(e,a=>a.row);return this.getArrayVerticesRelatedToRanges(r)});return this.stats.measure(StatType.ADJUSTING_ARRAY_MAPPING,()=>{this.fixArraysAfterRemovingRows(e.sheet,e.rowStart,e.numberOfRows)}),this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}removeSheet(e){this.clearSheet(e);for(const[t,r]of this.addressMapping.sheetEntries(e)){for(const a of this.graph.adjacentNodes(r))this.graph.markNodeAsDirty(a);this.removeVertex(r),this.addressMapping.removeCell(t)}this.stats.measure(StatType.ADJUSTING_RANGES,()=>{const t=this.rangeMapping.removeRangesInSheet(e);for(const r of t)this.removeVertex(r);this.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeSheet(e)})})}clearSheet(e){const t=new Set;for(const[r,a]of this.addressMapping.sheetEntries(e))a instanceof ArrayVertex?t.add(a):this.setCellEmpty(r);for(const r of t.values())this.setArrayEmpty(r);this.addStructuralNodesToChangeSet()}removeColumns(e){this.stats.measure(StatType.ADJUSTING_GRAPH,()=>{for(const[r,a]of this.addressMapping.entriesFromColumnsSpan(e)){for(const o of this.graph.adjacentNodes(a))this.graph.markNodeAsDirty(o);if(a instanceof ArrayVertex)if(a.isLeftCorner(r))this.shrinkArrayToCorner(a),this.arrayMapping.removeArray(a.getRange());else continue;this.removeVertex(a)}}),this.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeColumns(e)});const t=this.stats.measure(StatType.ADJUSTING_RANGES,()=>{const r=this.truncateRanges(e,a=>a.col);return this.getArrayVerticesRelatedToRanges(r)});return this.stats.measure(StatType.ADJUSTING_ARRAY_MAPPING,()=>this.fixArraysAfterRemovingColumns(e.sheet,e.columnStart,e.numberOfColumns)),this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}addRows(e){this.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.addRows(e.sheet,e.rowStart,e.numberOfRows)});const t=this.stats.measure(StatType.ADJUSTING_RANGES,()=>{const r=this.rangeMapping.moveAllRangesInSheetAfterRowByRows(e.sheet,e.rowStart,e.numberOfRows);return this.fixRangesWhenAddingRows(e.sheet,e.rowStart,e.numberOfRows),this.getArrayVerticesRelatedToRanges(r.verticesWithChangedSize)});this.stats.measure(StatType.ADJUSTING_ARRAY_MAPPING,()=>{this.fixArraysAfterAddingRow(e.sheet,e.rowStart,e.numberOfRows)});for(const r of this.addressMapping.verticesFromRowsSpan(e))this.graph.markNodeAsDirty(r);return this.addStructuralNodesToChangeSet(),{affectedArrays:t}}addColumns(e){this.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.addColumns(e.sheet,e.columnStart,e.numberOfColumns)});const t=this.stats.measure(StatType.ADJUSTING_RANGES,()=>{const r=this.rangeMapping.moveAllRangesInSheetAfterColumnByColumns(e.sheet,e.columnStart,e.numberOfColumns);return this.fixRangesWhenAddingColumns(e.sheet,e.columnStart,e.numberOfColumns),this.getArrayVerticesRelatedToRanges(r.verticesWithChangedSize)});this.stats.measure(StatType.ADJUSTING_ARRAY_MAPPING,()=>this.fixArraysAfterAddingColumn(e.sheet,e.columnStart,e.numberOfColumns));for(const r of this.addressMapping.verticesFromColumnsSpan(e))this.graph.markNodeAsDirty(r);return this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}isThereSpaceForArray(e){const t=e.getRangeOrUndef();if(t===void 0)return!1;for(const r of t.addresses(this)){const a=this.addressMapping.getCell(r);if(a!==void 0&&!(a instanceof EmptyCellVertex)&&a!==e)return!1}return!0}moveCells(e,t,r,a){for(const o of e.addressesWithDirection(t,r,this)){const u=simpleCellAddress(a,o.col+t,o.row+r);let c=this.addressMapping.getCell(o);const h=this.addressMapping.getCell(u);if(this.addressMapping.removeCell(o),c!==void 0){this.graph.markNodeAsDirty(c),this.addressMapping.setCell(u,c);let d;for(const p of this.graph.adjacentNodes(c))p instanceof RangeVertex&&!e.containsRange(p.range)&&(d=d??this.fetchCellOrCreateEmpty(o).vertex,this.graph.addEdge(d,p),this.graph.removeEdge(c,p));d&&(this.graph.markNodeAsDirty(d),this.addressMapping.setCell(o,d))}if(h!==void 0){c===void 0&&this.addressMapping.removeCell(u);for(const d of this.graph.adjacentNodes(h))c=c??this.fetchCellOrCreateEmpty(u).vertex,this.graph.addEdge(c,d),this.graph.markNodeAsDirty(c);this.removeVertex(h)}}for(const o of this.rangeMapping.rangeVerticesContainedInRange(e))for(const u of this.graph.adjacentNodes(o))if(u instanceof RangeVertex&&!e.containsRange(u.range)){this.graph.removeEdge(o,u);for(const c of o.range.addresses(this)){const{vertex:h,id:d}=this.fetchCellOrCreateEmpty(c);this.graph.addEdge(d??h,u),this.addressMapping.setCell(c,h),this.graph.markNodeAsDirty(h)}}this.rangeMapping.moveRangesInsideSourceRange(e,t,r,a)}setArrayEmpty(e){const t=AbsoluteCellRange.spanFrom(e.getAddress(this.lazilyTransformingAstService),e.width,e.height),r=this.graph.adjacentNodes(e);for(const a of t.addresses(this))this.addressMapping.removeCell(a);for(const a of r.values()){const o=collectAddressesDependentToRange(this.functionRegistry,a,e.getRange(),this.lazilyTransformingAstService,this);for(const u of o){const{vertex:c,id:h}=this.fetchCellOrCreateEmpty(u);this.graph.addEdge(h??c,a)}o.length>0&&this.graph.markNodeAsDirty(a)}this.removeVertex(e),this.arrayMapping.removeArray(e.getRange())}addVertex(e,t){this.graph.addNodeAndReturnId(t),this.addressMapping.setCell(e,t)}addArrayVertex(e,t){this.graph.addNodeAndReturnId(t),this.setAddressMappingForArrayVertex(t,e)}*arrayFormulaNodes(){for(const e of this.graph.getNodes())e instanceof ArrayVertex&&(yield e)}*entriesFromRowsSpan(e){yield*this.addressMapping.entriesFromRowsSpan(e)}*entriesFromColumnsSpan(e){yield*this.addressMapping.entriesFromColumnsSpan(e)}fetchCell(e){return this.addressMapping.fetchCell(e)}getCell(e){return this.addressMapping.getCell(e)}getCellValue(e){return this.addressMapping.getCellValue(e)}getRawValue(e){return this.addressMapping.getRawValue(e)}getScalarValue(e){const t=this.addressMapping.getCellValue(e);return t instanceof SimpleRangeValue?new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected):t}existsEdge(e,t){return this.graph.existsEdge(e,t)}getSheetId(e){return this.sheetMapping.fetch(e)}getSheetHeight(e){return this.addressMapping.getHeight(e)}getSheetWidth(e){return this.addressMapping.getWidth(e)}getArray(e){return this.arrayMapping.getArray(e)}getRange(e,t){return this.rangeMapping.getRange(e,t)}topSortWithScc(){return this.graph.topSortWithScc()}markAsVolatile(e){this.graph.markNodeAsVolatile(e)}markAsDependentOnStructureChange(e){this.graph.markNodeAsChangingWithStructure(e)}forceApplyPostponedTransformations(){for(const e of this.graph.getNodes())e instanceof FormulaCellVertex&&e.ensureRecentData(this.lazilyTransformingAstService)}*rawValuesFromRange(e){for(const t of e.addresses(this)){const r=this.getScalarValue(t);r!==EmptyValue&&(yield[getRawValue(r),t])}}computeListOfValuesInRange(e){const t=[];for(const r of e.addresses(this)){const a=this.getScalarValue(r);t.push(a)}return t}shrinkArrayToCorner(e){this.cleanAddressMappingUnderArray(e);for(const t of this.adjacentArrayVertices(e)){let r;t instanceof FormulaVertex?r=this.formulaDirectDependenciesToArray(t,e):r=this.rangeDirectDependenciesToArray(t,e);let a=!1;for(const[o,u]of r)e.isLeftCorner(o)&&(a=!0),this.graph.addEdge(u,t),this.graph.markNodeAsDirty(u);a||this.graph.removeEdge(e,t)}this.graph.markNodeAsDirty(e)}isArrayInternalCell(e){const t=this.getCell(e);return t instanceof ArrayVertex&&!t.isLeftCorner(e)}getAndClearContentChanges(){const e=this.changes;return this.changes=ContentChanges.empty(),e}getAdjacentNodesAddresses(e){const t=this.graph.adjacentNodes(e),r=[];return t.forEach(a=>{const o=a;o instanceof RangeVertex?r.push(simpleCellRange(o.start,o.end)):r.push(o.getAddress(this.lazilyTransformingAstService))}),r}exchangeGraphNode(e,t){this.graph.addNodeAndReturnId(t);const r=this.graph.adjacentNodes(e);this.removeVertex(e),r.forEach(a=>{this.graph.hasNode(a)&&this.graph.addEdge(t,a)})}setArray(e,t){this.arrayMapping.setArray(e,t)}correctInfiniteRangesDependency(e){const t=this.graph.getInfiniteRanges().filter(({node:u})=>u.range.addressInRange(e));if(t.length<=0)return;const{vertex:r,id:a}=this.fetchCellOrCreateEmpty(e),o=a??this.graph.getNodeId(r);t.forEach(({id:u})=>{this.graph.addEdge(o,u)})}exchangeOrAddGraphNode(e,t){e?this.exchangeGraphNode(e,t):this.graph.addNodeAndReturnId(t)}getArrayVerticesRelatedToRanges(e){const t=new Set;return e.forEach(r=>{this.graph.hasNode(r)&&this.graph.adjacentNodes(r).forEach(a=>{a instanceof ArrayVertex&&t.add(a)})}),t}correctInfiniteRangesDependenciesByRangeVertex(e){this.graph.getInfiniteRanges().forEach(({id:t,node:r})=>{const a=e.range.intersectionWith(r.range);a!==void 0&&a.addresses(this).forEach(o=>{const{vertex:u,id:c}=this.fetchCellOrCreateEmpty(o);this.graph.addEdge(c??u,t)})})}cleanAddressMappingUnderArray(e){const t=e.getRange();for(const r of t.addresses(this)){const a=e.getArrayCellValue(r);this.getCell(r)===e?e.isLeftCorner(r)?this.changes.addChange(new CellError(ErrorType.REF),r,a):(this.addressMapping.removeCell(r),this.changes.addChange(EmptyValue,r,a)):this.changes.addChange(EmptyValue,r,a)}}*formulaDirectDependenciesToArray(e,t){var r;const[,a]=(r=this.formulaDependencyQuery(e))!==null&&r!==void 0?r:[];if(a!==void 0){for(const o of a)if(!(o instanceof NamedExpressionDependency||o instanceof AbsoluteCellRange)&&t.getRange().addressInRange(o)){const u=this.fetchCellOrCreateEmpty(o).vertex;yield[o,u]}}}*rangeDirectDependenciesToArray(e,t){const{restRange:r}=this.rangeMapping.findSmallerRange(e.range);for(const a of r.addresses(this))if(t.getRange().addressInRange(a)){const o=this.fetchCellOrCreateEmpty(a).vertex;yield[a,o]}}*adjacentArrayVertices(e){const t=this.graph.adjacentNodes(e);for(const r of t)(r instanceof FormulaVertex||r instanceof RangeVertex)&&(yield r)}addStructuralNodesToChangeSet(){this.graph.markChangingWithStructureNodesAsDirty()}fixRangesWhenAddingRows(e,t,r){const a=Array.from(this.rangeMapping.rangesInSheet(e));for(const o of a)if(o.range.includesRow(t+r))if(o.bruteForce){const u=o.range.rangeWithSameWidth(t,r);for(const c of u.addresses(this)){const{vertex:h,id:d}=this.fetchCellOrCreateEmpty(c);this.graph.addEdge(d??h,o)}}else{let u=o,c=this.rangeMapping.findSmallerRange(u.range);if(c.smallerRangeVertex!==void 0)continue;for(;c.smallerRangeVertex===void 0;){const h=new RangeVertex(AbsoluteCellRange.spanFrom(u.range.start,u.range.width(),u.range.height()-1));this.rangeMapping.setRange(h),this.graph.addNodeAndReturnId(h);const d=new AbsoluteCellRange(simpleCellAddress(u.range.start.sheet,u.range.start.col,u.range.end.row),u.range.end);this.addAllFromRange(d,u),this.graph.addEdge(h,u),u=h,c=this.rangeMapping.findSmallerRange(u.range)}this.graph.addEdge(c.smallerRangeVertex,u),this.addAllFromRange(c.restRange,u),this.graph.removeEdge(c.smallerRangeVertex,o)}}addAllFromRange(e,t){for(const r of e.addresses(this)){const{vertex:a,id:o}=this.fetchCellOrCreateEmpty(r);this.graph.addEdge(o??a,t)}}fixRangesWhenAddingColumns(e,t,r){for(const a of this.rangeMapping.rangesInSheet(e))if(a.range.includesColumn(t+r)){let o;a.bruteForce?o=a.range.rangeWithSameHeight(t,r):o=AbsoluteCellRange.spanFrom(simpleCellAddress(e,t,a.range.end.row),r,1);for(const u of o.addresses(this)){const{vertex:c,id:h}=this.fetchCellOrCreateEmpty(u);this.graph.addEdge(h??c,a)}}}exchangeOrAddFormulaVertex(e){const t=e.getAddress(this.lazilyTransformingAstService),r=AbsoluteCellRange.spanFrom(t,e.width,e.height),a=this.shrinkPossibleArrayAndGetCell(t);if(e instanceof ArrayVertex&&this.setArray(r,e),this.exchangeOrAddGraphNode(a,e),this.addressMapping.setCell(t,e),e instanceof ArrayVertex){if(!this.isThereSpaceForArray(e))return;for(const o of r.addresses(this)){if(e.isLeftCorner(o))continue;const u=this.getCell(o);this.exchangeOrAddGraphNode(u,e)}}for(const o of r.addresses(this))this.addressMapping.setCell(o,e)}setAddressMappingForArrayVertex(e,t){if(this.addressMapping.setCell(t,e),!(e instanceof ArrayVertex))return;const r=AbsoluteCellRange.spanFromOrUndef(t,e.width,e.height);if(r!==void 0&&(this.setArray(r,e),!!this.isThereSpaceForArray(e)))for(const a of r.addresses(this))this.addressMapping.setCell(a,e)}truncateRanges(e,t){const{verticesToRemove:r,verticesToMerge:a,verticesWithChangedSize:o}=this.rangeMapping.truncateRanges(e,t);for(const[u,c]of a)this.mergeRangeVertices(u,c);for(const u of r)this.removeVertexAndCleanupDependencies(u);return o}fixArraysAfterAddingRow(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,r),!(t<=0))for(const[,a]of this.arrayMapping.arraysInRows(RowsSpan.fromRowStartAndEnd(e,t-1,t-1))){const o=a.getRange();for(let u=o.start.col;u<=o.end.col;++u)for(let c=t;c<=o.end.row;++c){const h=simpleCellAddress(e,u,c),d=simpleCellAddress(e,u,c+r),p=a.getArrayCellValue(h);this.addressMapping.moveCell(d,h),this.changes.addChange(EmptyValue,d,p)}}}fixArraysAfterRemovingRows(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,-r),!(t<=0))for(const[,a]of this.arrayMapping.arraysInRows(RowsSpan.fromRowStartAndEnd(e,t-1,t-1)))if(this.isThereSpaceForArray(a))for(const o of a.getRange().addresses(this))this.addressMapping.setCell(o,a);else this.setNoSpaceIfArray(a)}fixArraysAfterAddingColumn(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,r),!(t<=0))for(const[,a]of this.arrayMapping.arraysInCols(ColumnsSpan.fromColumnStartAndEnd(e,t-1,t-1))){const o=a.getRange();for(let u=o.start.row;u<=o.end.row;++u)for(let c=t;c<=o.end.col;++c){const h=simpleCellAddress(e,c,u),d=simpleCellAddress(e,c+r,u),p=a.getArrayCellValue(h);this.addressMapping.moveCell(d,h),this.changes.addChange(EmptyValue,d,p)}}}fixArraysAfterRemovingColumns(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,-r),!(t<=0))for(const[,a]of this.arrayMapping.arraysInCols(ColumnsSpan.fromColumnStartAndEnd(e,t-1,t-1)))if(this.isThereSpaceForArray(a))for(const o of a.getRange().addresses(this))this.addressMapping.setCell(o,a);else this.setNoSpaceIfArray(a)}shrinkPossibleArrayAndGetCell(e){const t=this.getCell(e);return t instanceof ArrayVertex?(this.setNoSpaceIfArray(t),this.getCell(e)):t}setNoSpaceIfArray(e){e instanceof ArrayVertex&&(this.shrinkArrayToCorner(e),e.setNoSpace())}removeVertex(e){this.removeVertexAndCleanupDependencies(e),e instanceof RangeVertex&&this.rangeMapping.removeRange(e)}mergeRangeVertices(e,t){const r=this.graph.adjacentNodes(t);this.removeVertexAndCleanupDependencies(t),this.graph.removeEdgeIfExists(e,t),r.forEach(a=>{this.graph.hasNode(a)&&this.graph.addEdge(e,a)})}removeVertexAndCleanupDependencies(e){const t=new Set(this.graph.removeNode(e));for(;t.size>0;){const r=t.values().next().value;t.delete(r);const[a,o]=r;this.graph.hasNode(o)&&this.graph.adjacentNodesCount(o)===0&&((o instanceof RangeVertex||o instanceof EmptyCellVertex)&&this.graph.removeNode(o).forEach(u=>t.add(u)),o instanceof RangeVertex?this.rangeMapping.removeRange(o):o instanceof EmptyCellVertex&&this.addressMapping.removeCell(a))}}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class EmptyCellVertex{constructor(){}getCellValue(){return EmptyValue}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ValueCellVertex{constructor(e,t){this.parsedValue=e,this.rawValue=t}getValues(){return{parsedValue:this.parsedValue,rawValue:this.rawValue}}setValues(e){this.parsedValue=e.parsedValue,this.rawValue=e.rawValue}getCellValue(){return this.parsedValue}setCellValue(e){throw Error("SetCellValue is deprecated for ValueCellVertex")}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ParsingErrorVertex{constructor(e,t){this.errors=e,this.rawInput=t}getCellValue(){const e=this.errors.map(t=>t.message).find(t=>t);return CellError.parsingError(e)}getFormula(){return this.rawInput}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class SparseStrategy{constructor(e,t){this.width=e,this.height=t,this.mapping=new Map}getCell(e){var t;return(t=this.mapping.get(e.col))===null||t===void 0?void 0:t.get(e.row)}setCell(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1);let r=this.mapping.get(e.col);r||(r=new Map,this.mapping.set(e.col,r)),r.set(e.row,t)}has(e){var t;return!!(!((t=this.mapping.get(e.col))===null||t===void 0)&&t.get(e.row))}getHeight(){return this.height}getWidth(){return this.width}removeCell(e){var t;(t=this.mapping.get(e.col))===null||t===void 0||t.delete(e.row)}addRows(e,t){this.mapping.forEach(r=>{const a=new Map;r.forEach((o,u)=>{u>=e&&(a.set(u+t,o),r.delete(u))}),a.forEach((o,u)=>{r.set(u,o)})}),this.height+=t}addColumns(e,t){const r=new Map;this.mapping.forEach((a,o)=>{o>=e&&(r.set(o+t,a),this.mapping.delete(o))}),r.forEach((a,o)=>{this.mapping.set(o,a)}),this.width+=t}removeRows(e){this.mapping.forEach(a=>{const o=new Map;a.forEach((u,c)=>{c>=e.rowStart&&(a.delete(c),c>e.rowEnd&&o.set(c-e.numberOfRows,u))}),o.forEach((u,c)=>{a.set(c,u)})});const t=Math.min(this.height-1,e.rowEnd),r=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-r)}removeColumns(e){const t=new Map;this.mapping.forEach((o,u)=>{u>=e.columnStart&&(this.mapping.delete(u),u>e.columnEnd&&t.set(u-e.numberOfColumns,o))}),t.forEach((o,u)=>{this.mapping.set(u,o)});const r=Math.min(this.width-1,e.columnEnd),a=Math.max(0,r-e.columnStart+1);this.width=Math.max(0,this.width-a)}*getEntries(e){for(const[t,r]of this.mapping)for(const[a,o]of r)yield[simpleCellAddress(e,t,a),o]}*verticesFromColumn(e){const t=this.mapping.get(e);if(t!==void 0)for(const[r,a]of t)yield a}*verticesFromRow(e){for(const t of this.mapping.values()){const r=t.get(e);r!==void 0&&(yield r)}}*verticesFromColumnsSpan(e){for(const t of e.columns()){const r=this.mapping.get(t);if(r!==void 0)for(const[a,o]of r)yield o}}*verticesFromRowsSpan(e){for(const t of this.mapping.values())for(const r of e.rows()){const a=t.get(r);a!==void 0&&(yield a)}}*entriesFromRowsSpan(e){for(const[t,r]of this.mapping.entries())for(const a of e.rows()){const o=r.get(a);o!==void 0&&(yield[simpleCellAddress(e.sheet,t,a),o])}}*entriesFromColumnsSpan(e){for(const t of e.columns()){const r=this.mapping.get(t);if(r!==void 0)for(const[a,o]of r.entries())yield[simpleCellAddress(e.sheet,t,a),o]}}*vertices(){for(const[e,t]of this.mapping)for(const[r,a]of t)a!==void 0&&(yield a)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class DenseStrategy{constructor(e,t){this.width=e,this.height=t,this.mapping=new Array(t);for(let r=0;r<t;r++)this.mapping[r]=new Array(e)}getCell(e){return this.getCellVertex(e.col,e.row)}setCell(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1),this.mapping[e.row]||(this.mapping[e.row]=new Array(this.width)),this.mapping[e.row][e.col]=t}has(e){const t=this.mapping[e.row];return t?!!t[e.col]:!1}getHeight(){return this.height}getWidth(){return this.width}removeCell(e){this.mapping[e.row]!==void 0&&delete this.mapping[e.row][e.col]}addRows(e,t){const r=[];for(let a=0;a<t;a++)r.push(new Array(this.width));this.mapping.splice(e,0,...r),this.height+=t}addColumns(e,t){for(let r=0;r<this.height;r++)this.mapping[r].splice(e,0,...new Array(t));this.width+=t}removeRows(e){this.mapping.splice(e.rowStart,e.numberOfRows);const t=Math.min(this.height-1,e.rowEnd),r=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-r)}removeColumns(e){for(let a=0;a<this.height;a++)this.mapping[a].splice(e.columnStart,e.numberOfColumns);const t=Math.min(this.width-1,e.columnEnd),r=Math.max(0,t-e.columnStart+1);this.width=Math.max(0,this.width-r)}*getEntries(e){for(let t=0;t<this.height;++t)for(let r=0;r<this.width;++r){const a=this.getCellVertex(r,t);a&&(yield[simpleCellAddress(e,r,t),a])}}*verticesFromColumn(e){for(let t=0;t<this.height;++t){const r=this.getCellVertex(e,t);r&&(yield r)}}*verticesFromRow(e){for(let t=0;t<this.width;++t){const r=this.getCellVertex(t,e);r&&(yield r)}}*verticesFromColumnsSpan(e){for(let t=e.columnStart;t<=e.columnEnd;++t)for(let r=0;r<this.height;++r){const a=this.getCellVertex(t,r);a&&(yield a)}}*verticesFromRowsSpan(e){for(let t=0;t<this.width;++t)for(let r=e.rowStart;r<=e.rowEnd;++r){const a=this.getCellVertex(t,r);a&&(yield a)}}*entriesFromRowsSpan(e){for(let t=0;t<this.width;++t)for(let r=e.rowStart;r<=e.rowEnd;++r){const a=this.getCellVertex(t,r);a&&(yield[simpleCellAddress(e.sheet,t,r),a])}}*entriesFromColumnsSpan(e){for(let t=e.columnStart;t<=e.columnEnd;++t)for(let r=0;r<this.height;++r){const a=this.getCellVertex(t,r);a&&(yield[simpleCellAddress(e.sheet,t,r),a])}}*vertices(){for(let e=0;e<this.height;++e)for(let t=0;t<this.width;++t){const r=this.getCellVertex(t,e);r&&(yield r)}}getCellVertex(e,t){var r;return(r=this.mapping[t])===null||r===void 0?void 0:r[e]}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */var ErrorType;(function(i){i.DIV_BY_ZERO="DIV_BY_ZERO",i.NAME="NAME",i.VALUE="VALUE",i.NUM="NUM",i.NA="NA",i.CYCLE="CYCLE",i.REF="REF",i.SPILL="SPILL",i.LIC="LIC",i.ERROR="ERROR"})(ErrorType||(ErrorType={}));var CellType;(function(i){i.FORMULA="FORMULA",i.VALUE="VALUE",i.ARRAY="ARRAY",i.EMPTY="EMPTY",i.ARRAYFORMULA="ARRAYFORMULA"})(CellType||(CellType={}));const getCellType=(i,e)=>i instanceof ArrayVertex?i.isLeftCorner(e)?CellType.ARRAYFORMULA:CellType.ARRAY:i instanceof FormulaCellVertex||i instanceof ParsingErrorVertex?CellType.FORMULA:i instanceof ValueCellVertex?CellType.VALUE:CellType.EMPTY;var CellValueNoNumber;(function(i){i.EMPTY="EMPTY",i.NUMBER="NUMBER",i.STRING="STRING",i.BOOLEAN="BOOLEAN",i.ERROR="ERROR"})(CellValueNoNumber||(CellValueNoNumber={}));var CellValueJustNumber;(function(i){i.NUMBER="NUMBER"})(CellValueJustNumber||(CellValueJustNumber={}));const CellValueType=Object.assign(Object.assign({},CellValueNoNumber),CellValueJustNumber),CellValueDetailedType=Object.assign(Object.assign({},CellValueNoNumber),NumberType),CellValueTypeOrd=i=>{switch(i){case CellValueType.EMPTY:return 0;case CellValueType.NUMBER:return 1;case CellValueType.STRING:return 2;case CellValueType.BOOLEAN:return 3;case CellValueType.ERROR:return 4}throw new Error("Cell value not computed")},getCellValueType=i=>{if(i===EmptyValue)return CellValueType.EMPTY;if(i instanceof CellError||i instanceof SimpleRangeValue)return CellValueType.ERROR;if(typeof i=="string")return CellValueType.STRING;if(isExtendedNumber(i))return CellValueType.NUMBER;if(typeof i=="boolean")return CellValueType.BOOLEAN;throw new Error("Cell value not computed")},getCellValueDetailedType=i=>isExtendedNumber(i)?getTypeOfExtendedNumber(i):getCellValueType(i),getCellValueFormat=i=>{if(isExtendedNumber(i))return getFormatOfExtendedNumber(i)};class CellError{constructor(e,t,r){this.type=e,this.message=t,this.root=r}static parsingError(e){return new CellError(ErrorType.ERROR,`${ErrorMessage.ParseError}${e?" "+e:""}`)}attachRootVertex(e){return this.root===void 0?new CellError(this.type,this.message,e):this}}const simpleRowAddress=(i,e)=>({sheet:i,row:e}),invalidSimpleRowAddress=i=>i.row<0,simpleColumnAddress=(i,e)=>({sheet:i,col:e}),invalidSimpleColumnAddress=i=>i.col<0,simpleCellAddress=(i,e,t)=>({sheet:i,col:e,row:t}),invalidSimpleCellAddress=i=>i.col<0||i.row<0,movedSimpleCellAddress=(i,e,t,r)=>simpleCellAddress(e,i.col+t,i.row+r),addressKey=i=>`${i.sheet},${i.row},${i.col}`;function isSimpleCellAddress(i){var e,t,r;return i&&(typeof i=="object"||typeof i=="function")&&typeof((e=i)===null||e===void 0?void 0:e.sheet)=="number"&&typeof((t=i)===null||t===void 0?void 0:t.col)=="number"&&typeof((r=i)===null||r===void 0?void 0:r.row)=="number"}const absoluteSheetReference=(i,e)=>{var t;return(t=i.sheet)!==null&&t!==void 0?t:e.sheet},equalSimpleCellAddress=(i,e)=>i.sheet===e.sheet&&i.col===e.col&&i.row===e.row;/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const WRONG_RANGE_SIZE="AbsoluteCellRange: Wrong range size";function isSimpleCellRange(i){return i&&(typeof i=="object"||typeof i=="function")?"start"in i&&isSimpleCellAddress(i.start)&&"end"in i&&isSimpleCellAddress(i.end):!1}const simpleCellRange=(i,e)=>({start:i,end:e});class AbsoluteCellRange{constructor(e,t){if(e.sheet!==t.sheet)throw new SheetsNotEqual(e.sheet,t.sheet);this.start=simpleCellAddress(e.sheet,e.col,e.row),this.end=simpleCellAddress(t.sheet,t.col,t.row)}get sheet(){return this.start.sheet}static fromSimpleCellAddresses(e,t){if(e.sheet!==t.sheet)throw new SheetsNotEqual(e.sheet,t.sheet);const r=t.col-e.col,a=t.row-e.row;return Number.isFinite(a)&&Number.isFinite(r)?new AbsoluteCellRange(e,t):Number.isFinite(a)?new AbsoluteRowRange(e.sheet,e.row,t.row):new AbsoluteColumnRange(e.sheet,e.col,t.col)}static fromAst(e,t){return e.type===AstNodeType.CELL_RANGE?AbsoluteCellRange.fromCellRange(e,t):e.type===AstNodeType.COLUMN_RANGE?AbsoluteColumnRange.fromColumnRange(e,t):AbsoluteRowRange.fromRowRangeAst(e,t)}static fromAstOrUndef(e,t){try{return AbsoluteCellRange.fromAst(e,t)}catch{return}}static fromCellRange(e,t){return new AbsoluteCellRange(e.start.toSimpleCellAddress(t),e.end.toSimpleCellAddress(t))}static spanFrom(e,t,r){const a=AbsoluteCellRange.spanFromOrUndef(e,t,r);if(a===void 0)throw new Error(WRONG_RANGE_SIZE);return a}static spanFromOrUndef(e,t,r){if(!Number.isFinite(t)&&Number.isFinite(r))return e.col!==0?void 0:new AbsoluteRowRange(e.sheet,e.row,e.row+r-1);if(!Number.isFinite(r)&&Number.isFinite(t))return e.row!==0?void 0:new AbsoluteColumnRange(e.sheet,e.col,e.col+t-1);if(Number.isFinite(r)&&Number.isFinite(t))return new AbsoluteCellRange(e,simpleCellAddress(e.sheet,e.col+t-1,e.row+r-1))}static fromCoordinates(e,t,r,a,o){return new AbsoluteCellRange(simpleCellAddress(e,t,r),simpleCellAddress(e,a,o))}isFinite(){return Number.isFinite(this.size())}doesOverlap(e){return!(this.start.sheet!=e.start.sheet||this.end.row<e.start.row||this.start.row>e.end.row||this.end.col<e.start.col||this.start.col>e.end.col)}addressInRange(e){return this.sheet!==e.sheet?!1:this.start.row<=e.row&&this.end.row>=e.row&&this.start.col<=e.col&&this.end.col>=e.col}columnInRange(e){return this.sheet!==e.sheet?!1:this.start.col<=e.col&&this.end.col>=e.col}rowInRange(e){return this.sheet!==e.sheet?!1:this.start.row<=e.row&&this.end.row>=e.row}containsRange(e){return this.addressInRange(e.start)&&this.addressInRange(e.end)}intersectionWith(e){if(this.sheet!==e.start.sheet)return;const t=Math.max(this.start.row,e.start.row),r=Math.min(this.end.row,e.end.row),a=Math.max(this.start.col,e.start.col),o=Math.min(this.end.col,e.end.col);if(!(t>r||a>o))return new AbsoluteCellRange(simpleCellAddress(this.sheet,a,t),simpleCellAddress(this.sheet,o,r))}includesRow(e){return this.start.row<e&&this.end.row>=e}includesColumn(e){return this.start.col<e&&this.end.col>=e}shiftByRows(e){this.start.row+=e,this.end.row+=e}expandByRows(e){this.end.row+=e}shiftByColumns(e){this.start.col+=e,this.end.col+=e}shifted(e,t){return AbsoluteCellRange.spanFrom(simpleCellAddress(this.sheet,this.start.col+e,this.start.row+t),this.width(),this.height())}expandByColumns(e){this.end.col+=e}moveToSheet(e){this.start.sheet=e,this.end.sheet=e}removeSpan(e){e instanceof RowsSpan?this.removeRows(e.start,e.end):this.removeColumns(e.start,e.end)}shouldBeRemoved(){return this.width()<=0||this.height()<=0}rangeWithSameWidth(e,t){return AbsoluteCellRange.spanFrom(simpleCellAddress(this.sheet,this.start.col,e),this.width(),t)}rangeWithSameHeight(e,t){return AbsoluteCellRange.spanFrom(simpleCellAddress(this.sheet,e,this.start.row),t,this.height())}toString(){return`${this.start.sheet},${this.start.col},${this.start.row},${this.end.col},${this.end.row}`}width(){return this.end.col-this.start.col+1}height(){return this.end.row-this.start.row+1}size(){return this.height()*this.width()}arrayOfAddressesInRange(){const e=[];for(let t=0;t<this.height();++t){e[t]=[];for(let r=0;r<this.width();++r){const a=simpleCellAddress(this.sheet,this.start.col+r,this.start.row+t);e[t].push(a)}}return e}withStart(e){return new AbsoluteCellRange(e,this.end)}sameDimensionsAs(e){return this.width()===e.width()&&this.height()===e.height()}sameAs(e){return equalSimpleCellAddress(this.start,e.start)&&equalSimpleCellAddress(this.end,e.end)}addressesArrayMap(e,t){const r=[];let a=this.start.row;for(;a<=this.effectiveEndRow(e);){let o=this.start.col;const u=[];for(;o<=this.effectiveEndColumn(e);)u.push(t(simpleCellAddress(this.start.sheet,o,a))),o++;r.push(u),a++}return r}addresses(e){const t=[];let r=this.start.row;const a=this.effectiveEndRow(e),o=this.effectiveEndColumn(e);for(;r<=a;){let u=this.start.col;for(;u<=o;)t.push(simpleCellAddress(this.start.sheet,u,r)),u++;r++}return t}*addressesWithDirection(e,t,r){if(e>0)if(t>0){let a=this.effectiveEndRow(r);for(;a>=this.start.row;){let o=this.effectiveEndColumn(r);for(;o>=this.start.col;)yield simpleCellAddress(this.start.sheet,o,a),o-=1;a-=1}}else{let a=this.start.row;for(;a<=this.effectiveEndRow(r);){let o=this.effectiveEndColumn(r);for(;o>=this.start.col;)yield simpleCellAddress(this.start.sheet,o,a),o-=1;a+=1}}else if(t>0){let a=this.effectiveEndRow(r);for(;a>=this.start.row;){let o=this.start.col;for(;o<=this.effectiveEndColumn(r);)yield simpleCellAddress(this.start.sheet,o,a),o+=1;a-=1}}else{let a=this.start.row;for(;a<=this.effectiveEndRow(r);){let o=this.start.col;for(;o<=this.effectiveEndColumn(r);)yield simpleCellAddress(this.start.sheet,o,a),o+=1;a+=1}}}getAddress(e,t){if(e<0||t<0||t>this.height()-1||e>this.width()-1)throw Error("Index out of bound");return simpleCellAddress(this.start.sheet,this.start.col+e,this.start.row+t)}exceedsSheetSizeLimits(e,t){return this.end.col>=e||this.end.row>=t}effectiveEndColumn(e){return this.end.col}effectiveEndRow(e){return this.end.row}effectiveWidth(e){return this.width()}effectiveHeight(e){return this.height()}removeRows(e,t){if(!(e>this.end.row)){if(t<this.start.row){const r=t-e+1;return this.shiftByRows(-r)}e<=this.start.row&&(this.start.row=e),this.end.row-=Math.min(t,this.end.row)-e+1}}removeColumns(e,t){if(!(e>this.end.col)){if(t<this.start.col){const r=t-e+1;return this.shiftByColumns(-r)}e<=this.start.col&&(this.start.col=e),this.end.col-=Math.min(t,this.end.col)-e+1}}}class AbsoluteColumnRange extends AbsoluteCellRange{constructor(e,t,r){super(simpleCellAddress(e,t,0),simpleCellAddress(e,r,Number.POSITIVE_INFINITY))}static fromColumnRange(e,t){const r=e.start.toSimpleColumnAddress(t),a=e.end.toSimpleColumnAddress(t);if(r.sheet!==a.sheet)throw new SheetsNotEqual(r.sheet,a.sheet);return new AbsoluteColumnRange(r.sheet,r.col,a.col)}shouldBeRemoved(){return this.width()<=0}shiftByRows(e){}expandByRows(e){}shifted(e,t){return new AbsoluteColumnRange(this.sheet,this.start.col+e,this.end.col+e)}rangeWithSameHeight(e,t){return new AbsoluteColumnRange(this.sheet,e,e+t-1)}exceedsSheetSizeLimits(e,t){return this.end.col>=e}effectiveEndRow(e){return this.effectiveHeight(e)-1}effectiveHeight(e){return e.getSheetHeight(this.sheet)}removeRows(e,t){}}class AbsoluteRowRange extends AbsoluteCellRange{constructor(e,t,r){super(simpleCellAddress(e,0,t),simpleCellAddress(e,Number.POSITIVE_INFINITY,r))}static fromRowRangeAst(e,t){const r=e.start.toSimpleRowAddress(t),a=e.end.toSimpleRowAddress(t);if(r.sheet!==a.sheet)throw new SheetsNotEqual(r.sheet,a.sheet);return new AbsoluteRowRange(r.sheet,r.row,a.row)}shouldBeRemoved(){return this.height()<=0}shiftByColumns(e){}expandByColumns(e){}shifted(e,t){return new AbsoluteRowRange(this.sheet,this.start.row+t,this.end.row+t)}rangeWithSameWidth(e,t){return new AbsoluteRowRange(this.sheet,e,e+t-1)}exceedsSheetSizeLimits(e,t){return this.end.row>=t}effectiveEndColumn(e){return this.effectiveWidth(e)-1}effectiveWidth(e){return e.getSheetWidth(this.sheet)}removeColumns(e,t){}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class InterpreterState{constructor(e,t,r){this.formulaAddress=e,this.arraysFlag=t,this.formulaVertex=r}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */function collatorFromConfig(i){const e=i.caseSensitive?i.accentSensitive?"variant":"case":i.accentSensitive?"accent":"base",t=i.caseFirst,r=i.ignorePunctuation;return new Intl.Collator(i.localeLang,{sensitivity:e,caseFirst:t,ignorePunctuation:r})}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const COMPLEX_NUMBER_SYMBOL="i",complexParsingRegexp=/^\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij]))\s*(([+-])\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij])))?$/;class ArithmeticHelper{constructor(e,t,r){this.config=e,this.dateTimeHelper=t,this.numberLiteralsHelper=r,this.lt=(a,o)=>this.compare(a,o)<0,this.leq=(a,o)=>this.compare(a,o)<=0,this.gt=(a,o)=>this.compare(a,o)>0,this.geq=(a,o)=>this.compare(a,o)>=0,this.eq=(a,o)=>this.compare(a,o)===0,this.neq=(a,o)=>this.compare(a,o)!==0,this.pow=(a,o)=>Math.pow(getRawValue(a),getRawValue(o)),this.addWithEpsilonRaw=(a,o)=>{const u=a+o;return Math.abs(u)<this.actualEps*Math.abs(a)?0:u},this.addWithEpsilon=(a,o)=>{const u=inferExtendedNumberTypeAdditive(a,o);return this.ExtendedNumberFactory(this.addWithEpsilonRaw(getRawValue(a),getRawValue(o)),u)},this.unaryMinus=a=>cloneNumber(a,-getRawValue(a)),this.unaryPlus=a=>a,this.unaryPercent=a=>new PercentNumber(getRawValue(a)/100),this.concat=(a,o)=>a.concat(o),this.nonstrictadd=(a,o)=>a instanceof CellError?a:o instanceof CellError?o:typeof a=="number"?typeof o=="number"?this.addWithEpsilonRaw(a,o):a:typeof o=="number"?o:0,this.subtract=(a,o)=>{const u=inferExtendedNumberTypeAdditive(a,o),c=getRawValue(a),h=getRawValue(o);let d=c-h;return Math.abs(d)<this.actualEps*Math.abs(c)&&(d=0),this.ExtendedNumberFactory(d,u)},this.divide=(a,o)=>{const u=getRawValue(a),c=getRawValue(o);if(c===0)return new CellError(ErrorType.DIV_BY_ZERO);{const h=inferExtendedNumberTypeMultiplicative(a,o);return this.ExtendedNumberFactory(u/c,h)}},this.multiply=(a,o)=>{const u=inferExtendedNumberTypeMultiplicative(a,o);return this.ExtendedNumberFactory(getRawValue(a)*getRawValue(o),u)},this.manyToExactComplex=a=>{const o=[];for(const u of a){if(u instanceof CellError)return u;if(isExtendedNumber(u)||typeof u=="string"){const c=this.coerceScalarToComplex(u);c instanceof CellError||o.push(c)}}return o},this.coerceNumbersExactRanges=a=>this.manyToNumbers(a,this.manyToExactNumbers),this.coerceNumbersCoerceRangesDropNulls=a=>this.manyToNumbers(a,this.manyToCoercedNumbersDropNulls),this.manyToExactNumbers=a=>{const o=[];for(const u of a){if(u instanceof CellError)return u;isExtendedNumber(u)&&o.push(getRawValue(u))}return o},this.manyToOnlyNumbersDropNulls=a=>{const o=[];for(const u of a){if(u instanceof CellError)return u;if(isExtendedNumber(u))o.push(getRawValue(u));else if(u!==EmptyValue)return new CellError(ErrorType.VALUE,ErrorMessage.NumberExpected)}return o},this.manyToCoercedNumbersDropNulls=a=>{const o=[];for(const u of a){if(u instanceof CellError)return u;if(u===EmptyValue)continue;const c=this.coerceScalarToNumberOrError(u);isExtendedNumber(c)&&o.push(getRawValue(c))}return o},this.collator=collatorFromConfig(e),this.actualEps=e.smartRounding?e.precisionEpsilon:0}eqMatcherFunction(e){const t=this.buildRegex(e);return r=>typeof r=="string"&&t.test(this.normalizeString(r))}neqMatcherFunction(e){const t=this.buildRegex(e);return r=>typeof r!="string"||!t.test(this.normalizeString(r))}searchString(e,t){var r;const o=this.buildRegex(e,!1).exec(t);return(r=o==null?void 0:o.index)!==null&&r!==void 0?r:-1}requiresRegex(e){if(!this.config.useRegularExpressions&&!this.config.useWildcards)return!this.config.matchWholeCell;for(let t=0;t<e.length;t++){const r=e.charAt(t);if(isWildcard(r)||this.config.useRegularExpressions&&needsEscape(r))return!0}return!1}floatCmp(e,t){const r=getRawValue(e),a=getRawValue(t),o=1+this.actualEps;return a>=0&&r*o>=a&&r<=a*o||a<=0&&r*o<=a&&r>=a*o?0:r>a?1:-1}coerceScalarToNumberOrError(e){var t;return e instanceof CellError?e:(t=this.coerceToMaybeNumber(e))!==null&&t!==void 0?t:new CellError(ErrorType.VALUE,ErrorMessage.NumberCoercion)}coerceToMaybeNumber(e){var t;return(t=this.coerceNonDateScalarToMaybeNumber(e))!==null&&t!==void 0?t:typeof e=="string"?this.dateTimeHelper.dateStringToDateNumber(e):void 0}coerceNonDateScalarToMaybeNumber(e){if(e===EmptyValue)return 0;if(typeof e=="string"){if(e==="")return 0;const t=this.coerceStringToMaybePercentNumber(e);if(t!==void 0)return t;const r=this.coerceStringToMaybeCurrencyNumber(e);return r!==void 0?r:this.numberLiteralsHelper.numericStringToMaybeNumber(e.trim())}else return isExtendedNumber(e)?e:typeof e=="boolean"?Number(e):void 0}coerceStringToMaybePercentNumber(e){const t=e.trim();if(t.endsWith("%")){const r=t.slice(0,t.length-1).trim(),a=this.numberLiteralsHelper.numericStringToMaybeNumber(r);if(a!==void 0)return new PercentNumber(a/100)}}coerceStringToMaybeCurrencyNumber(e){const t=this.currencyMatcher(e.trim());if(t!==void 0){const[r,a]=t,o=this.numberLiteralsHelper.numericStringToMaybeNumber(a);if(o!==void 0)return new CurrencyNumber(o,r)}}currencyMatcher(e){for(const t of this.config.currencySymbol){if(e.startsWith(t))return[t,e.slice(t.length).trim()];if(e.endsWith(t))return[t,e.slice(0,e.length-t.length).trim()]}}coerceComplexExactRanges(e){const t=[];for(const a of e)if(a instanceof SimpleRangeValue)t.push(a);else if(a!==EmptyValue){const o=this.coerceScalarToComplex(a);if(o instanceof CellError)return o;t.push(o)}const r=[];for(const a of t)if(a instanceof SimpleRangeValue){const o=this.manyToExactComplex(a.valuesFromTopLeftCorner());if(o instanceof CellError)return o;r.push(...o)}else r.push(a);return r}coerceScalarToComplex(e){return e instanceof CellError?e:e===EmptyValue?[0,0]:isExtendedNumber(e)?[getRawValue(e),0]:typeof e=="string"?this.coerceStringToComplex(e):new CellError(ErrorType.NUM,ErrorMessage.ComplexNumberExpected)}ExtendedNumberFactory(e,t){const{type:r,format:a}=t;switch(r){case NumberType.NUMBER_RAW:return e;case NumberType.NUMBER_CURRENCY:return new CurrencyNumber(e,a??this.config.currencySymbol[0]);case NumberType.NUMBER_DATE:return new DateNumber(e,a);case NumberType.NUMBER_DATETIME:return new DateTimeNumber(e,a);case NumberType.NUMBER_TIME:return new TimeNumber(e,a);case NumberType.NUMBER_PERCENT:return new PercentNumber(e,a)}}buildRegex(e,t=!0){e=this.normalizeString(e);let r,a=this.config.useWildcards,o=this.config.useRegularExpressions;if(o)try{RegExp(e)}catch{o=!1,a=!1}return o?r=escapeNoCharacters(e,this.config.caseSensitive):a?r=escapeNonWildcards(e,this.config.caseSensitive):r=escapeAllCharacters(e,this.config.caseSensitive),this.config.matchWholeCell&&t?RegExp("^("+r+")$"):RegExp(r)}normalizeString(e){return this.config.caseSensitive||(e=e.toLowerCase()),this.config.accentSensitive||(e=normalizeString(e,"nfd").replace(/[\u0300-\u036f]/g,"")),e}compare(e,t){if(typeof e=="string"||typeof t=="string"){const r=typeof e=="string"?this.dateTimeHelper.dateStringToDateNumber(e):e,a=typeof t=="string"?this.dateTimeHelper.dateStringToDateNumber(t):t;if(isExtendedNumber(r)&&isExtendedNumber(a))return this.floatCmp(r,a)}return e===EmptyValue?e=coerceEmptyToValue(t):t===EmptyValue&&(t=coerceEmptyToValue(e)),typeof e=="string"&&typeof t=="string"?this.stringCmp(e,t):typeof e=="boolean"&&typeof t=="boolean"?numberCmp(coerceBooleanToNumber(e),coerceBooleanToNumber(t)):isExtendedNumber(e)&&isExtendedNumber(t)?this.floatCmp(e,t):e===EmptyValue&&t===EmptyValue?0:numberCmp(CellValueTypeOrd(getCellValueType(e)),CellValueTypeOrd(getCellValueType(t)))}stringCmp(e,t){return this.collator.compare(e,t)}manyToNumbers(e,t){const r=[];for(const o of e)if(o instanceof SimpleRangeValue)r.push(o);else{const u=getRawValue(this.coerceScalarToNumberOrError(o));if(u instanceof CellError)return u;r.push(u)}const a=[];for(const o of r)if(o instanceof SimpleRangeValue){const u=t(o.valuesFromTopLeftCorner());if(u instanceof CellError)return u;a.push(...u)}else a.push(o);return a}coerceStringToComplex(e){const t=complexParsingRegexp.exec(e);if(t===null)return new CellError(ErrorType.NUM,ErrorMessage.ComplexNumberExpected);let r;if(t[6]!==void 0?r=t[1]==="-"?[0,-1]:[0,1]:r=this.parseComplexToken(t[1]+t[3],t[5]),r instanceof CellError||t[8]===void 0)return r;let a;return t[14]!==void 0?a=t[9]==="-"?[0,-1]:[0,1]:a=this.parseComplexToken(t[9]+t[11],t[13]),a instanceof CellError?a:t[5]!==""||t[13]===""?new CellError(ErrorType.NUM,ErrorMessage.ComplexNumberExpected):t[8]==="+"?[r[0]+a[0],r[1]+a[1]]:[r[0]-a[0],r[1]-a[1]]}parseComplexToken(e,t){const r=getRawValue(this.coerceNonDateScalarToMaybeNumber(e));return r===void 0?new CellError(ErrorType.NUM,ErrorMessage.ComplexNumberExpected):t===""?[r,0]:[0,r]}}function coerceComplexToString([i,e],t){if(!isFinite(i)||!isFinite(e))return new CellError(ErrorType.NUM,ErrorMessage.NaN);if(t=t??COMPLEX_NUMBER_SYMBOL,e===0)return`${i}`;const r=`${e===-1||e===1?"":Math.abs(e)}${t}`;return i===0?`${e<0?"-":""}${r}`:`${i}${e<0?"-":"+"}${r}`}function coerceToRange(i){return i instanceof SimpleRangeValue?i:SimpleRangeValue.fromScalar(i)}function coerceBooleanToNumber(i){return Number(i)}function coerceEmptyToValue(i){return typeof i=="string"?"":isExtendedNumber(i)?0:typeof i=="boolean"?!1:EmptyValue}function coerceScalarToBoolean(i){if(i instanceof CellError||typeof i=="boolean")return i;if(i===EmptyValue)return!1;if(isExtendedNumber(i))return getRawValue(i)!==0;{const e=i.toUpperCase();return e==="TRUE"?!0:e==="FALSE"||e===""?!1:void 0}}function coerceScalarToString(i){return i instanceof CellError||typeof i=="string"?i:i===EmptyValue?"":isExtendedNumber(i)?getRawValue(i).toString():i?"TRUE":"FALSE"}function zeroIfEmpty(i){return i===EmptyValue?0:i}function numberCmp(i,e){const t=getRawValue(i),r=getRawValue(e);return t>r?1:t<r?-1:0}function isNumberOverflow(i){return isNaN(i)||i===1/0||i===-1/0}function fixNegativeZero(i){return i===0?0:i}function isWildcard(i){return["*","?"].includes(i)}const escapedCharacters=["{","}","[","]","(",")","<",">","=",".","+","-",",","\\","$","^","!"];function needsEscape(i){return escapedCharacters.includes(i)}function escapeNonWildcards(i,e){let t="";for(let r=0;r<i.length;r++){const a=i.charAt(r);if(a==="~"){if(r==i.length-1){t+="~";continue}const o=i.charAt(r+1);isWildcard(o)||needsEscape(o)?(t+="\\"+o,r++):(t+=o,r++)}else isWildcard(a)?t+="."+a:needsEscape(a)?t+="\\"+a:e?t+=a:t+=a.toLowerCase()}return t}function escapeAllCharacters(i,e){let t="";for(let r=0;r<i.length;r++){const a=i.charAt(r);isWildcard(a)||needsEscape(a)?t+="\\"+a:e?t+=a:t+=a.toLowerCase()}return t}function escapeNoCharacters(i,e){let t="";for(let r=0;r<i.length;r++){const a=i.charAt(r);isWildcard(a)||needsEscape(a)||e?t+=a:t+=a.toLowerCase()}return t}function inferExtendedNumberTypeAdditive(i,e){const{type:t,format:r}=getTypeFormatOfExtendedNumber(i),{type:a,format:o}=getTypeFormatOfExtendedNumber(e);if(t===NumberType.NUMBER_RAW)return{type:a,format:o};if(a===NumberType.NUMBER_RAW)return{type:t,format:r};if((t===NumberType.NUMBER_DATETIME||t===NumberType.NUMBER_DATE)&&(a===NumberType.NUMBER_DATETIME||a===NumberType.NUMBER_DATE))return{type:NumberType.NUMBER_RAW};if(t===NumberType.NUMBER_TIME){if(a===NumberType.NUMBER_DATE)return{type:NumberType.NUMBER_DATETIME,format:`${o} ${r}`};if(a===NumberType.NUMBER_DATETIME)return{type:NumberType.NUMBER_DATETIME,format:o}}if(a===NumberType.NUMBER_TIME){if(t===NumberType.NUMBER_DATE)return{type:NumberType.NUMBER_DATETIME,format:`${r} ${o}`};if(t===NumberType.NUMBER_DATETIME)return{type:NumberType.NUMBER_DATETIME,format:r}}return{type:t,format:r}}function inferExtendedNumberTypeMultiplicative(i,e){let{type:t,format:r}=getTypeFormatOfExtendedNumber(i),{type:a,format:o}=getTypeFormatOfExtendedNumber(e);return t===NumberType.NUMBER_PERCENT&&(t=NumberType.NUMBER_RAW,r=void 0),a===NumberType.NUMBER_PERCENT&&(a=NumberType.NUMBER_RAW,o=void 0),t===NumberType.NUMBER_RAW?{type:a,format:o}:a===NumberType.NUMBER_RAW?{type:t,format:r}:{type:NumberType.NUMBER_RAW}}function forceNormalizeString(i){return normalizeString(i.toLowerCase(),"nfd").replace(/[\u0300-\u036f]/g,"")}function coerceRangeToScalar(i,e){var t;if(i.isAdHoc())return(t=i.data[0])===null||t===void 0?void 0:t[0];const r=i.range;if(e.formulaAddress.sheet===r.sheet){if(r.width()===1){const a=e.formulaAddress.row-r.start.row;if(a>=0&&a<r.height())return i.data[a][0]}else if(r.height()===1){const a=e.formulaAddress.col-r.start.col;if(a>=0&&a<r.width())return i.data[0][a]}}}function normalizeString(i,e){return i.normalize(e.toUpperCase())}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */var FunctionArgumentType;(function(i){i.STRING="STRING",i.NUMBER="NUMBER",i.BOOLEAN="BOOLEAN",i.SCALAR="SCALAR",i.NOERROR="NOERROR",i.RANGE="RANGE",i.INTEGER="INTEGER",i.COMPLEX="COMPLEX",i.ANY="ANY"})(FunctionArgumentType||(FunctionArgumentType={}));class FunctionPlugin{constructor(e){this.coerceScalarToNumberOrError=t=>this.arithmeticHelper.coerceScalarToNumberOrError(t),this.runFunction=(t,r,a,o)=>{const u=this.evaluateArguments(t,r,a),c=u.map(([y,T])=>y),h=u.map(([y,T])=>T),d=this.buildMetadataForEachArgumentValue(c.length,a),p=r.arraysFlag&&!a.vectorizationForbidden;if(!this.isNumberOfArgumentValuesValid(d,c.length))return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);const[m,f]=p?this.calculateSizeOfVectorizedResultArray(c,d):[1,1];if(m===1&&f===1){const y=this.vectorizeAndBroadcastArgumentsIfNecessary(p,c,d,0,0);return this.calculateSingleCellOfResultArray(r,y,d,h,o,a.returnNumberType)}const g=[...Array(m).keys()].map(y=>[...Array(f).keys()].map(T=>{const A=this.vectorizeAndBroadcastArgumentsIfNecessary(p,c,d,y,T),R=this.calculateSingleCellOfResultArray(r,A,d,h,o,a.returnNumberType);if(R instanceof SimpleRangeValue)throw new Error("Function returning array cannot be vectorized.");return R}));return SimpleRangeValue.onlyValues(g)},this.runFunctionWithReferenceArgument=(t,r,a,o,u,c=()=>new CellError(ErrorType.NA,ErrorMessage.CellRefExpected))=>{if(t.length===0)return this.returnNumberWrapper(o(),a.returnNumberType);if(t.length>1)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);let h=t[0];for(;h.type===AstNodeType.PARENTHESIS;)h=h.expression;let d;if(h.type===AstNodeType.CELL_REFERENCE)d=h.reference.toSimpleCellAddress(r.formulaAddress);else if(h.type===AstNodeType.CELL_RANGE||h.type===AstNodeType.COLUMN_RANGE||h.type===AstNodeType.ROW_RANGE)try{d=AbsoluteCellRange.fromAst(h,r.formulaAddress).start}catch{return new CellError(ErrorType.REF,ErrorMessage.CellRefExpected)}return d!==void 0?this.returnNumberWrapper(u(d),a.returnNumberType):this.runFunction(t,r,a,c)},this.interpreter=e,this.dependencyGraph=e.dependencyGraph,this.columnSearch=e.columnSearch,this.config=e.config,this.serialization=e.serialization,this.arraySizePredictor=e.arraySizePredictor,this.dateTimeHelper=e.dateTimeHelper,this.arithmeticHelper=e.arithmeticHelper}evaluateAst(e,t){return this.interpreter.evaluateAst(e,t)}arraySizeForAst(e,t){return this.arraySizePredictor.checkArraySizeForAst(e,t)}listOfScalarValues(e,t){const r=[];for(const a of e){const o=this.evaluateAst(a,t);if(o instanceof SimpleRangeValue)for(const u of o.valuesFromTopLeftCorner())r.push([u,!0]);else r.push([o,!1])}return r}coerceToType(e,t,r){let a;if(e instanceof SimpleRangeValue)switch(t.argumentType){case FunctionArgumentType.RANGE:case FunctionArgumentType.ANY:a=e;break;default:{const o=coerceRangeToScalar(e,r);if(o===void 0)return;e=o}}if(!(e instanceof SimpleRangeValue))switch(t.argumentType){case FunctionArgumentType.INTEGER:case FunctionArgumentType.NUMBER:const o=this.coerceScalarToNumberOrError(e);if(!isExtendedNumber(o)){a=o;break}const u=getRawValue(o);if(t.maxValue!==void 0&&u>t.maxValue)return new CellError(ErrorType.NUM,ErrorMessage.ValueLarge);if(t.minValue!==void 0&&u<t.minValue)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);if(t.lessThan!==void 0&&u>=t.lessThan)return new CellError(ErrorType.NUM,ErrorMessage.ValueLarge);if(t.greaterThan!==void 0&&u<=t.greaterThan)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);if(t.argumentType===FunctionArgumentType.INTEGER&&!Number.isInteger(u))return new CellError(ErrorType.NUM,ErrorMessage.IntegerExpected);a=o;break;case FunctionArgumentType.STRING:a=coerceScalarToString(e);break;case FunctionArgumentType.BOOLEAN:a=coerceScalarToBoolean(e);break;case FunctionArgumentType.SCALAR:case FunctionArgumentType.NOERROR:case FunctionArgumentType.ANY:a=e;break;case FunctionArgumentType.RANGE:if(e instanceof CellError)return e;a=coerceToRange(e);break;case FunctionArgumentType.COMPLEX:return this.arithmeticHelper.coerceScalarToComplex(getRawValue(e))}return t.passSubtype||a===void 0?a:getRawValue(a)}calculateSingleCellOfResultArray(e,t,r,a,o,u){const c=this.coerceArgumentsToRequiredTypes(e,t,r,a);if(c instanceof CellError)return c;const h=o(...c);return this.returnNumberWrapper(h,u)}coerceArgumentsToRequiredTypes(e,t,r,a){const o=[];for(let u=0;u<r.length;u++){const c=r[u],h=t[u]!==void 0?t[u]:c==null?void 0:c.defaultValue;if(h===void 0){o.push(void 0);continue}const d=this.coerceToType(h,c,e);if(d===void 0&&!a[u])return new CellError(ErrorType.VALUE,ErrorMessage.WrongType);if(d instanceof CellError&&c.argumentType!==FunctionArgumentType.SCALAR)return d;o.push(d)}return o}vectorizeAndBroadcastArgumentsIfNecessary(e,t,r,a,o){return t.map((u,c)=>e&&this.isRangePassedAsAScalarArgument(u,r[c])?this.vectorizeAndBroadcastRangeArgument(u,a,o):u)}vectorizeAndBroadcastRangeArgument(e,t,r){var a;const o=e.height()===1?0:t,u=e.width()===1?0:r;return(a=e.data[o])===null||a===void 0?void 0:a[u]}evaluateArguments(e,t,r){return r.expandRanges?this.listOfScalarValues(e,t):e.map(a=>[this.evaluateAst(a,t),!1])}buildMetadataForEachArgumentValue(e,t){const r=t.parameters?[...t.parameters]:[];if(t.repeatLastArgs!==void 0&&Number.isInteger(t.repeatLastArgs)&&t.repeatLastArgs>0)for(;e>r.length;)r.push(...r.slice(r.length-t.repeatLastArgs));return r}isNumberOfArgumentValuesValid(e,t){return t>e.length?!1:t<e.length?e.slice(t).every(o=>(o==null?void 0:o.optionalArg)||(o==null?void 0:o.defaultValue)!==void 0):!0}calculateSizeOfVectorizedResultArray(e,t){const r=e.filter((u,c)=>this.isRangePassedAsAScalarArgument(u,t[c])),a=Math.max(1,...r.map(u=>u.height())),o=Math.max(1,...r.map(u=>u.width()));return[a,o]}isRangePassedAsAScalarArgument(e,t){return e==null||t==null?!1:e instanceof SimpleRangeValue&&![FunctionArgumentType.RANGE,FunctionArgumentType.ANY].includes(t.argumentType)}metadata(e){const t=this.constructor.implementedFunctions[e];if(t!==void 0)return t;throw new Error(`No metadata for function ${e}.`)}returnNumberWrapper(e,t,r){return t!==void 0&&isExtendedNumber(e)?this.arithmeticHelper.ExtendedNumberFactory(getRawValue(e),{type:t,format:r}):e}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ArraySize{constructor(e,t,r=!1){this.width=e,this.height=t,this.isRef=r}static error(){return new ArraySize(1,1,!0)}static scalar(){return new ArraySize(1,1,!1)}isScalar(){return this.width===1&&this.height===1||this.isRef}}function arraySizeForBinaryOp(i,e){return new ArraySize(Math.max(i.width,e.width),Math.max(i.height,e.height))}function arraySizeForUnaryOp(i){return new ArraySize(i.width,i.height)}class ArraySizePredictor{constructor(e,t){this.config=e,this.functionRegistry=t}checkArraySize(e,t){return this.checkArraySizeForAst(e,{formulaAddress:t,arraysFlag:this.config.useArrayArithmetic})}checkArraySizeForAst(e,t){switch(e.type){case AstNodeType.FUNCTION_CALL:return this.checkArraySizeForFunction(e,t);case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:case AstNodeType.CELL_RANGE:{const r=AbsoluteCellRange.fromAstOrUndef(e,t.formulaAddress);return r===void 0?ArraySize.error():new ArraySize(r.width(),r.height(),!0)}case AstNodeType.ARRAY:{const r=[],a=[];for(const c of e.args){const h=c.map(m=>this.checkArraySizeForAst(m,t)),d=Math.min(...h.map(m=>m.height)),p=h.reduce((m,f)=>m+f.width,0);r.push(d),a.push(p)}const o=r.reduce((c,h)=>c+h,0),u=Math.min(...a);return new ArraySize(u,o)}case AstNodeType.STRING:case AstNodeType.NUMBER:return ArraySize.scalar();case AstNodeType.CELL_REFERENCE:return new ArraySize(1,1,!0);case AstNodeType.DIV_OP:case AstNodeType.CONCATENATE_OP:case AstNodeType.EQUALS_OP:case AstNodeType.GREATER_THAN_OP:case AstNodeType.GREATER_THAN_OR_EQUAL_OP:case AstNodeType.LESS_THAN_OP:case AstNodeType.LESS_THAN_OR_EQUAL_OP:case AstNodeType.MINUS_OP:case AstNodeType.NOT_EQUAL_OP:case AstNodeType.PLUS_OP:case AstNodeType.POWER_OP:case AstNodeType.TIMES_OP:{const r=this.checkArraySizeForAst(e.left,t),a=this.checkArraySizeForAst(e.right,t);return!t.arraysFlag&&(r.height>1||r.width>1||a.height>1||a.width>1)?ArraySize.error():arraySizeForBinaryOp(r,a)}case AstNodeType.MINUS_UNARY_OP:case AstNodeType.PLUS_UNARY_OP:case AstNodeType.PERCENT_OP:{const r=this.checkArraySizeForAst(e.value,t);return!t.arraysFlag&&(r.height>1||r.width>1)?ArraySize.error():arraySizeForUnaryOp(r)}case AstNodeType.PARENTHESIS:return this.checkArraySizeForAst(e.expression,t);case AstNodeType.EMPTY:return ArraySize.error();default:return ArraySize.error()}}checkArraySizeForFunction(e,t){const r=this.functionRegistry.getArraySizeFunction(e.procedureName);if(r!==void 0)return r(e,t);const a=this.functionRegistry.getMetadata(e.procedureName);if(a===void 0||a.expandRanges||!t.arraysFlag||a.vectorizationForbidden||a.parameters===void 0)return new ArraySize(1,1);const o=e.args.map(d=>{var p;return this.checkArraySizeForAst(d,new InterpreterState(t.formulaAddress,t.arraysFlag||((p=a==null?void 0:a.arrayFunction)!==null&&p!==void 0?p:!1)))}),u=[...a.parameters];if(a.repeatLastArgs!==void 0&&u.length<o.length&&(o.length-u.length)%a.repeatLastArgs!==0)return ArraySize.error();for(;u.length<o.length;){if(a.repeatLastArgs===void 0)return ArraySize.error();u.push(...u.slice(u.length-a.repeatLastArgs))}let c=1,h=1;for(let d=0;d<o.length;d++)u[d].argumentType!==FunctionArgumentType.RANGE&&u[d].argumentType!==FunctionArgumentType.ANY&&(h=Math.max(h,o[d].height),c=Math.max(c,o[d].width));return new ArraySize(c,h)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class DetailedCellError{constructor(e,t,r){var a;this.value=t,this.address=r,this.type=e.type,this.message=(a=e.message)!==null&&a!==void 0?a:""}toString(){return this.value}valueOf(){return this.value}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */function configValueFromParam(i,e,t){if(typeof i>"u")return Config.defaultConfig[t];if(typeof e=="string"){if(typeof i===e)return i;throw new ExpectedValueOfTypeError(e,t)}else{if(e.includes(i))return i;throw new ExpectedOneOfValuesError(e.map(r=>`'${r}'`).join(" "),t)}}function validateNumberToBeAtLeast(i,e,t){if(i<t)throw new ConfigValueTooSmallError(e,t)}function validateNumberToBeAtMost(i,e,t){if(i>t)throw new ConfigValueTooBigError(e,t)}function configValueFromParamCheck(i,e,t,r){if(e(i))return i;if(typeof i>"u")return Config.defaultConfig[r];throw new ExpectedValueOfTypeError(t,r)}function configCheckIfParametersNotInConflict(...i){const e=new Map;i.forEach(r=>{const a=e.get(r.value)||[];a.push(r.name),e.set(r.value,a)});const t=[];for(const r of e.values())r.length>1&&t.push(r);if(t.length>0){t.forEach(a=>a.sort());const r=t.map(a=>`[${a}]`).join("; ");throw new Error(`Config initialization failed. Parameters in conflict: ${r}`)}}function validateArgToType(i,e,t){if(typeof i!==e)throw new ExpectedValueOfTypeError(e,t)}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const TIME_FORMAT_SECONDS_ITEM_REGEXP=new RegExp("^ss(\\.(s+|0+))?$"),QUICK_CHECK_REGEXP=new RegExp("^[0-9/.\\-: ]+[ap]?m?$"),WHITESPACE_REGEXP=new RegExp("\\s+"),DATE_SEPARATOR_REGEXP=new RegExp("[ /.-]"),TIME_SEPARATOR=":",SECONDS_PRECISION=1e3,memoizedParseTimeFormat=memoize(parseTimeFormat),memoizedParseDateFormat=memoize(parseDateFormat);function defaultParseToDateTime(i,e,t){if(e===void 0&&t===void 0)return;let r=i.replace(WHITESPACE_REGEXP," ").trim().toLowerCase();if(!doesItLookLikeADateTimeQuickCheck(r))return;let a=r.substring(r.length-2);a==="am"||a==="pm"?r=r.substring(0,r.length-2).trim():(a=r.substring(r.length-1),a==="a"||a==="p"?r=r.substring(0,r.length-1).trim():a=void 0);const o=r.split(DATE_SEPARATOR_REGEXP);o.length>=2&&o[o.length-2].includes(TIME_SEPARATOR)&&(o[o.length-2]=o[o.length-2]+"."+o[o.length-1],o.pop());const u=o[o.length-1].split(TIME_SEPARATOR);if(a!==void 0&&u.push(a),o.length===1)return defaultParseToTime(u,t);if(u.length===1)return defaultParseToDate(o,e);const c=defaultParseToDate(o.slice(0,o.length-1),e),h=defaultParseToTime(u,t);if(c!==void 0)return h===void 0?void 0:Object.assign(Object.assign({},c),h)}function defaultParseToTime(i,e){var t,r,a;if(e===void 0)return;const{itemsCount:o,hourItem:u,minuteItem:c,secondItem:h}=memoizedParseTimeFormat(e);let d;if(i[i.length-1]==="am"||i[i.length-1]==="a"?(d=!1,i.pop()):(i[i.length-1]==="pm"||i[i.length-1]==="p")&&(d=!0,i.pop()),i.length!==o)return;const p=Number((t=i[h])!==null&&t!==void 0?t:"0");if(!Number.isFinite(p))return;const m=Math.round(p*SECONDS_PRECISION)/SECONDS_PRECISION,f=Number((r=i[c])!==null&&r!==void 0?r:"0");if(!(Number.isFinite(f)&&Number.isInteger(f)))return;const g=Number((a=i[u])!==null&&a!==void 0?a:"0");return!(Number.isFinite(g)&&Number.isInteger(g))||d!==void 0&&(g<0||g>12)?void 0:{hours:d!==void 0?g%12+(d?12:0):g,minutes:f,seconds:m}}function defaultParseToDate(i,e){var t;if(e===void 0)return;const{itemsCount:r,dayItem:a,monthItem:o,shortYearItem:u,longYearItem:c}=memoizedParseDateFormat(e);if(i.length!==r)return;const h=Number(i[a]);if(!(Number.isFinite(h)&&Number.isInteger(h)))return;const d=Number(i[o]);if(!(Number.isFinite(d)&&Number.isInteger(d))||i[c]&&i[u])return;const p=Number((t=i[c])!==null&&t!==void 0?t:i[u]);if(Number.isFinite(p)&&Number.isInteger(p)&&!(i[c]&&(p<1e3||p>9999))&&!(i[u]&&(p<0||p>99)))return{year:p,month:d,day:h}}function parseTimeFormat(i){const e=i.toLowerCase().trim(),r=(e.endsWith("am/pm")?e.substring(0,e.length-5):e.endsWith("a/p")?e.substring(0,i.length-3):e).trim().split(TIME_SEPARATOR);return{itemsCount:r.length,hourItem:r.indexOf("hh"),minuteItem:r.indexOf("mm"),secondItem:r.findIndex(a=>TIME_FORMAT_SECONDS_ITEM_REGEXP.test(a))}}function parseDateFormat(i){const e=i.toLowerCase().trim().split(DATE_SEPARATOR_REGEXP);return{itemsCount:e.length,dayItem:e.indexOf("dd"),monthItem:e.indexOf("mm"),shortYearItem:e.indexOf("yy"),longYearItem:e.indexOf("yyyy")}}function doesItLookLikeADateTimeQuickCheck(i){return QUICK_CHECK_REGEXP.test(i)}function memoize(i){const e={};return t=>{const r=e[t];if(r!==void 0)return r;const a=i(t);return e[t]=a,a}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const numDays=[31,28,31,30,31,30,31,31,30,31,30,31],prefSumDays=[0,31,59,90,120,151,181,212,243,273,304,334],SECONDS_PER_MINUTE=60,MINUTES_PER_HOUR=60,HOURS_PER_DAY=24;function instanceOfSimpleDate(i){return i&&(typeof i=="object"||typeof i=="function")?"year"in i&&typeof i.year=="number"&&"month"in i&&typeof i.month=="number"&&"day"in i&&typeof i.day=="number":!1}function instanceOfSimpleTime(i){return i&&(typeof i=="object"||typeof i=="function")?"hours"in i&&typeof i.hours=="number"&&"minutes"in i&&typeof i.minutes=="number"&&"seconds"in i&&typeof i.seconds=="number":!1}const maxDate={year:9999,month:12,day:31};class DateTimeHelper{constructor(e){this.config=e,this.minDateAbsoluteValue=this.dateToNumberFromZero(e.nullDate),this.maxDateValue=this.dateToNumber(maxDate),this.leapYear1900=e.leapYear1900,!this.leapYear1900&&0<=this.dateToNumber({year:1900,month:2,day:28})?this.epochYearZero=this.numberToSimpleDate(2).year:this.epochYearZero=this.numberToSimpleDate(1).year,this.parseDateTime=e.parseDateTime}getWithinBounds(e){return e<=this.maxDateValue&&e>=0?e:void 0}dateStringToDateNumber(e){const{dateTime:t,dateFormat:r="",timeFormat:a=""}=this.parseDateTimeFromConfigFormats(e);if(t!==void 0)return instanceOfSimpleTime(t)?instanceOfSimpleDate(t)?new DateTimeNumber(timeToNumber(t)+this.dateToNumber(t),r+" "+a):new TimeNumber(timeToNumber(t),a):instanceOfSimpleDate(t)?new DateNumber(this.dateToNumber(t),r):0}parseDateTimeFromConfigFormats(e){return this.parseDateTimeFromFormats(e,this.config.dateFormats,this.config.timeFormats)}getNullYear(){return this.config.nullYear}getEpochYearZero(){return this.epochYearZero}isValidDate(e){return isNaN(e.year)||isNaN(e.month)||isNaN(e.day)||e.day!==Math.round(e.day)||e.month!==Math.round(e.month)||e.year!==Math.round(e.year)||e.year<1582||e.month<1||e.month>12||e.day<1?!1:this.isLeapYear(e.year)&&e.month===2?e.day<=29:e.day<=numDays[e.month-1]}dateToNumber(e){return this.dateToNumberFromZero(e)-this.minDateAbsoluteValue}relativeNumberToAbsoluteNumber(e){return e+this.minDateAbsoluteValue-(this.leapYear1900?1:0)}numberToSimpleDate(e){const t=Math.floor(e)+this.minDateAbsoluteValue;let r=Math.floor(t/365.2425);this.dateToNumberFromZero({year:r+1,month:1,day:1})<=t?r++:this.dateToNumberFromZero({year:r-1,month:1,day:1})>t&&r--;const a=t-this.dateToNumberFromZero({year:r,month:1,day:1}),o=dayToMonth(a-(this.isLeapYear(r)&&a>=59?1:0)),u=a-prefSumDays[o]-(this.isLeapYear(r)&&o>1?1:0);return{year:r,month:o+1,day:u+1}}numberToSimpleDateTime(e){const t=numberToSimpleTime(e%1),r=Math.floor(t.hours/HOURS_PER_DAY);t.hours=t.hours%HOURS_PER_DAY;const a=this.numberToSimpleDate(Math.floor(e)+r);return Object.assign(Object.assign({},a),t)}leapYearsCount(e){return Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400)+(this.config.leapYear1900&&e>=1900?1:0)}daysInMonth(e,t){return this.isLeapYear(e)&&t===2?29:numDays[t-1]}endOfMonth(e){return{year:e.year,month:e.month,day:this.daysInMonth(e.year,e.month)}}toBasisUS(e,t){return e.day===31&&(e.day=30),e.day===30&&t.day===31&&(t.day=30),e.month===2&&e.day===this.daysInMonth(e.year,e.month)&&(e.day=30,t.month===2&&t.day===this.daysInMonth(t.year,t.month)&&(t.day=30)),[e,t]}yearLengthForBasis(e,t){return e.year!==t.year?e.year+1!==t.year||e.month<t.month||e.month===t.month&&e.day<t.day?(this.leapYearsCount(t.year)-this.leapYearsCount(e.year-1))/(t.year-e.year+1)+365:this.countLeapDays(t)!==this.countLeapDays({year:e.year,month:e.month,day:e.day-1})?366:365:this.isLeapYear(e.year)?366:365}parseSingleFormat(e,t,r){const a=this.parseDateTime(e,t,r);if(!(instanceOfSimpleDate(a)&&(a.year>=0&&a.year<100&&(a.year<this.getNullYear()?a.year+=2e3:a.year+=1900),!this.isValidDate(a))))return a}parseDateTimeFromFormats(e,t,r){const a=t.length===0?[void 0]:t,o=r.length===0?[void 0]:r;for(const u of a)for(const c of o){const h=this.parseSingleFormat(e,u,c);if(h!==void 0)return{dateTime:h,timeFormat:c,dateFormat:u}}return{}}countLeapDays(e){return e.month>2||e.month===2&&e.day>=29?this.leapYearsCount(e.year):this.leapYearsCount(e.year-1)}dateToNumberFromZero(e){return 365*e.year+prefSumDays[e.month-1]+e.day-1+(e.month<=2?this.leapYearsCount(e.year-1):this.leapYearsCount(e.year))}isLeapYear(e){return e%4?!1:e%100?!0:e%400?e===1900&&this.config.leapYear1900:!0}}function dayToMonth(i){let e=0;return prefSumDays[e+6]<=i&&(e+=6),prefSumDays[e+3]<=i&&(e+=3),prefSumDays[e+2]<=i?e+=2:prefSumDays[e+1]<=i&&(e+=1),e}function offsetMonth(i,e){const t=12*i.year+i.month-1+e;return{year:Math.floor(t/12),month:t%12+1,day:i.day}}function truncateDayInMonth(i){return{year:i.year,month:i.month,day:Math.min(i.day,numDays[i.month-1])}}function roundToNearestSecond(i){return Math.round(i*3600*24)/(3600*24)}function roundToEpsilon(i,e=1){return Math.round(i*e)/e}function numberToSimpleTime(i){const e=i*HOURS_PER_DAY*MINUTES_PER_HOUR*SECONDS_PER_MINUTE,t=roundToEpsilon(e%SECONDS_PER_MINUTE,1e5)%SECONDS_PER_MINUTE,r=(e-t)/SECONDS_PER_MINUTE,a=Math.round(r%MINUTES_PER_HOUR)%MINUTES_PER_HOUR,o=(r-a)/MINUTES_PER_HOUR;return{hours:Math.round(o),minutes:a,seconds:t}}function timeToNumber(i){return((i.seconds/60+i.minutes)/60+i.hours)/24}function toBasisEU(i){return{year:i.year,month:i.month,day:Math.min(30,i.day)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class AlwaysDense{call(){return DenseStrategy}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const dateFormatRegex=/(\\.|dd|DD|d|D|mm|MM|m|M|YYYY|YY|yyyy|yy|HH|hh|H|h|ss(\.(0+|s+))?|s|AM\/PM|am\/pm|A\/P|a\/p|\[mm]|\[MM]|\[hh]|\[HH])/g,numberFormatRegex=/(\\.|[#0]+(\.[#0]*)?)/g;var TokenType;(function(i){i.FORMAT="FORMAT",i.FREE_TEXT="FREE_TEXT"})(TokenType||(TokenType={}));function formatToken(i,e){return{type:i,value:e}}var FormatExpressionType;(function(i){i.DATE="DATE",i.NUMBER="NUMBER",i.STRING="STRING"})(FormatExpressionType||(FormatExpressionType={}));function matchDateFormat(i){dateFormatRegex.lastIndex=0;const e=[];let t;do t=dateFormatRegex.exec(i),t!==null&&e.push(t);while(t);return e}function matchNumberFormat(i){numberFormatRegex.lastIndex=0;const e=numberFormatRegex.exec(i);return e!==null?[e]:[]}function createTokens(i,e){const t=[];let r=0;for(let o=0;o<i.length;++o){const u=i[o];if(u.index!==r){const c=e.substr(r,u.index-r);t.push(formatToken(TokenType.FREE_TEXT,c))}u[0].startsWith("\\")?t.push(formatToken(TokenType.FREE_TEXT,u[0])):t.push(formatToken(TokenType.FORMAT,u[0])),r=u.index+u[0].length}const a=i[i.length-1];if(a.index+a[0].length<e.length){const o=e.substr(a.index+a[0].length,e.length);t.push(formatToken(TokenType.FREE_TEXT,o))}return t}function parseForDateTimeFormat(i){const e=matchDateFormat(i);if(!e.every(t=>isEscapeToken(t)))return{type:FormatExpressionType.DATE,tokens:createTokens(e,i)}}function parseForNumberFormat(i){const e=matchNumberFormat(i);if(!e.every(t=>isEscapeToken(t)))return{type:FormatExpressionType.NUMBER,tokens:createTokens(e,i)}}function isEscapeToken(i){return i[0].startsWith("\\")}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */function format(i,e,t,r){const a=t.stringifyDateTime(r.numberToSimpleDateTime(i),e);if(a!==void 0)return a;const o=t.stringifyDuration(numberToSimpleTime(i),e);if(o!==void 0)return o;const u=parseForNumberFormat(e);return u!==void 0?numberFormat(u.tokens,i):e}function padLeft(i,e){let t=`${i}`;for(;t.length<e;)t="0"+t;return t}function padRight(i,e){let t=`${i}`;for(;t.length<e;)t=t+"0";return t}function countChars(i,e){return i.split(e).length-1}function numberFormat(i,e){let t="";for(let r=0;r<i.length;++r){const a=i[r];if(a.type===TokenType.FREE_TEXT){t+=a.value;continue}const o=a.value.split("."),u=o[0],c=o[1]||"",h=o[1]?".":"",d=Number(e.toFixed(c.length)).toString().split(".");let p=d[0]||"",m=d[1]||"";if(u.length>p.length){const g=countChars(u.substr(0,u.length-p.length),"0");p=padLeft(p,g+p.length)}const f=countChars(c.substr(m.length,c.length-m.length),"0");m=padRight(m,f+m.length),t+=p+h+m}return t}function defaultStringifyDuration(i,e){const t=parseForDateTimeFormat(e);if(t===void 0)return;const r=t.tokens;let a="";for(const o of r){if(o.type===TokenType.FREE_TEXT){a+=o.value;continue}switch(o.value.toLowerCase()){case"h":case"hh":{a+=padLeft(i.hours,o.value.length),i.hours=0;break}case"[hh]":{a+=padLeft(i.hours,o.value.length-2),i.hours=0;break}case"m":case"mm":{a+=padLeft(i.minutes,o.value.length),i.minutes=0;break}case"[mm]":{a+=padLeft(i.minutes+60*i.hours,o.value.length-2),i.minutes=0,i.hours=0;break}case"s":case"ss":{a+=padLeft(Math.floor(i.seconds),o.value.length);break}default:{if(TIME_FORMAT_SECONDS_ITEM_REGEXP.test(o.value)){const u=Math.max(o.value.length-3,0);a+=`${i.seconds<10?"0":""}${Math.floor(i.seconds*Math.pow(10,u))/Math.pow(10,u)}`;continue}return}}}return a}function defaultStringifyDateTime(i,e){const t=parseForDateTimeFormat(e);if(t===void 0)return;const r=t.tokens;let a="",o=!1;const u=r.some(c=>c.type===TokenType.FORMAT&&(c.value==="a/p"||c.value==="A/P"||c.value==="am/pm"||c.value==="AM/PM"));for(let c=0;c<r.length;c++){const h=r[c];if(h.type===TokenType.FREE_TEXT){a+=h.value;continue}switch(h.value.toLowerCase()){case"h":case"hh":{o=!0,a+=padLeft(u?(i.hours+11)%12+1:i.hours,h.value.length);break}case"d":case"dd":{a+=padLeft(i.day,h.value.length);break}case"s":case"ss":{a+=padLeft(Math.floor(i.seconds),h.value.length);break}case"m":case"mm":{c+1<r.length&&r[c+1].value.startsWith(":")&&(o=!0),o?a+=padLeft(i.minutes,h.value.length):a+=padLeft(i.month,h.value.length),o=!0;break}case"yy":{a+=padLeft(i.year%100,h.value.length);break}case"yyyy":{a+=i.year;break}case"am/pm":case"a/p":{const[d,p]=h.value.split("/");a+=i.hours<12?d:p;break}default:{if(TIME_FORMAT_SECONDS_ITEM_REGEXP.test(h.value)){const d=h.value.length-3;a+=`${i.seconds<10?"0":""}${Math.floor(i.seconds*Math.pow(10,d))/Math.pow(10,d)}`;continue}return}}}return a}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const _rl="length",_hd=i=>parseInt(i,16),_pi=i=>parseInt(i,10),_nm=i=>(i+"").replace(/\-/g,""),_ss=(i,e,t)=>i.substr(e,t),_cp=i=>i.codePointAt(0)-65;function extractTime(i){return _nm(i)[_rl]===25?_hd(_ss(_nm(i),_hd("12"),_cp("F")))/(_hd(_ss(_nm(i),_cp("C"),_cp("Y")>>4))||(~~![][_rl]<<3)+1):0}function checkKeySchema(i){if(i=(i+"").replace(/\-/g,""),i[_rl]!==_cp("Z"))return!1;let e=0;return[[0,_cp("G")+1],[_cp("H"),_cp("H")-1],[_cp("G")+_cp("H"),_cp("G")]].reduce((t,[r,a],o)=>(t|=(_pi(`${_pi(_hd(_ss(i,e+r-(o===0?0:2),a+(o?2:0)))+(_hd(_ss(i,e+r+a,2))+[]).padStart(2,"0"))}`)%97||2)>>1,e+=2,t),_cp("A"))==="1">>1}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const consoleMessages={invalid:()=>"The license key for HyperFormula is invalid.",expired:({keyValidityDate:i})=>`The license key for HyperFormula expired on ${i}, and is not valid for the installed version.`,missing:()=>"The license key for HyperFormula is missing."};let _notified=!1;function checkLicenseKeyValidity(i){const e={template:"missing",vars:{}};if(i==="gpl-v3"||i==="internal-use-in-handsontable")e.template="valid";else if(typeof i=="string"&&checkKeySchema(i)){const[t,r,a]="15/02/2024".split("/"),o=Math.floor(new Date(`${r}/${t}/${a}`).getTime()/864e5),u=extractTime(i);e.vars.keyValidityDate=formatDate(new Date((u+1)*864e5)),o>u?e.template="expired":e.template="valid"}else i!==""&&(e.template="invalid");return!_notified&&e.template!=="valid"&&(console.warn(consoleMessages[e.template](e.vars)),_notified=!0),e.template}function formatDate(i){const t=["January","February","March","April","May","June","July","August","September","October","November","December"][i.getMonth()],r=i.getDate(),a=i.getFullYear();return`${t} ${r}, ${a}`}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */var CellContent;(function(i){class e{constructor(h){this.value=h,this.value=cloneNumber(this.value,fixNegativeZero(getRawValue(this.value)))}}i.Number=e;class t{constructor(h){this.value=h}}i.String=t;class r{constructor(h){this.value=h}}i.Boolean=r;class a{static getSingletonInstance(){return a.instance||(a.instance=new a),a.instance}}i.Empty=a;class o{constructor(h){this.formula=h}}i.Formula=o;class u{constructor(h,d){this.value=new CellError(h,d)}}i.Error=u})(CellContent||(CellContent={}));function isFormula(i){return i.startsWith("=")}function isBoolean(i){const e=i.toLowerCase();return e==="true"||e==="false"}function isError(i,e){const t=i.toUpperCase();return/#[A-Za-z0-9\/]+[?!]?/.test(t)&&Object.prototype.hasOwnProperty.call(e,t)}class CellContentParser{constructor(e,t,r){this.config=e,this.dateHelper=t,this.numberLiteralsHelper=r}parse(e){if(e==null)return CellContent.Empty.getSingletonInstance();if(typeof e=="number")return isNumberOverflow(e)?new CellContent.Error(ErrorType.NUM,ErrorMessage.ValueLarge):new CellContent.Number(e);if(typeof e=="boolean")return new CellContent.Boolean(e);if(e instanceof Date){const t=this.dateHelper.dateToNumber({day:e.getDate(),month:e.getMonth()+1,year:e.getFullYear()}),r=timeToNumber({hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()+e.getMilliseconds()/1e3}),a=t+r;return a<0?new CellContent.Error(ErrorType.NUM,ErrorMessage.DateBounds):a%1===0?new CellContent.Number(new DateNumber(a,"Date()")):a<1?new CellContent.Number(new TimeNumber(a,"Date()")):new CellContent.Number(new DateTimeNumber(a,"Date()"))}else if(typeof e=="string"){if(isBoolean(e))return new CellContent.Boolean(e.toLowerCase()==="true");if(isFormula(e))return new CellContent.Formula(e);if(isError(e,this.config.errorMapping))return new CellContent.Error(this.config.errorMapping[e.toUpperCase()]);{let t=e.trim(),r=0,a;if(t.endsWith("%"))r=1,t=t.slice(0,t.length-1);else{const c=this.currencyMatcher(t);c!==void 0&&(r=2,[a,t]=c)}const o=this.numberLiteralsHelper.numericStringToMaybeNumber(t);if(o!==void 0){let c;return r===1?c=new PercentNumber(o/100):r===2?c=new CurrencyNumber(o,a):c=o,new CellContent.Number(c)}const u=this.dateHelper.dateStringToDateNumber(t);return u!==void 0?new CellContent.Number(u):new CellContent.String(e.startsWith("'")?e.slice(1):e)}}else throw new UnableToParseError(e)}currencyMatcher(e){for(const t of this.config.currencySymbol){if(e.startsWith(t))return[t,e.slice(t.length)];if(e.endsWith(t))return[t,e.slice(0,e.length-t.length)]}}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */var ClipboardOperationType;(function(i){i[i.COPY=0]="COPY",i[i.CUT=1]="CUT"})(ClipboardOperationType||(ClipboardOperationType={}));var ClipboardCellType;(function(i){i[i.VALUE=0]="VALUE",i[i.EMPTY=1]="EMPTY",i[i.FORMULA=2]="FORMULA",i[i.PARSING_ERROR=3]="PARSING_ERROR"})(ClipboardCellType||(ClipboardCellType={}));class Clipboard{constructor(e,t,r,a,o){this.sourceLeftCorner=e,this.width=t,this.height=r,this.type=a,this.content=o}*getContent(e){if(this.content!==void 0)for(let t=0;t<this.height;++t)for(let r=0;r<this.width;++r)yield[simpleCellAddress(e.sheet,e.col+r,e.row+t),this.content[t][r]]}}class ClipboardOperations{constructor(e,t,r){this.dependencyGraph=t,this.operations=r,this.maxRows=e.maxRows,this.maxColumns=e.maxColumns}cut(e,t,r){this.clipboard=new Clipboard(e,t,r,ClipboardOperationType.CUT)}copy(e,t,r){const a=[];for(let o=0;o<r;++o){a[o]=[];for(let u=0;u<t;++u){const c=this.operations.getClipboardCell(simpleCellAddress(e.sheet,e.col+u,e.row+o));a[o].push(c)}}this.clipboard=new Clipboard(e,t,r,ClipboardOperationType.COPY,a)}abortCut(){this.clipboard&&this.clipboard.type===ClipboardOperationType.CUT&&this.clear()}clear(){this.clipboard=void 0}ensureItIsPossibleToCopyPaste(e){if(this.clipboard===void 0)return;if(invalidSimpleCellAddress(e)||!this.dependencyGraph.sheetMapping.hasSheetWithId(e.sheet))throw new InvalidArgumentsError("a valid target address.");const t=AbsoluteCellRange.spanFrom(e,this.clipboard.width,this.clipboard.height);if(t.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new SheetSizeLimitExceededError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(t))throw new Error("It is not possible to paste onto an array")}isCutClipboard(){return this.clipboard!==void 0&&this.clipboard.type===ClipboardOperationType.CUT}isCopyClipboard(){return this.clipboard!==void 0&&this.clipboard.type===ClipboardOperationType.COPY}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class InternalNamedExpression{constructor(e,t,r,a){this.displayName=e,this.address=t,this.added=r,this.options=a}normalizeExpressionName(){return this.displayName.toLowerCase()}copy(){return new InternalNamedExpression(this.displayName,this.address,this.added,this.options)}}class WorkbookStore{constructor(){this.mapping=new Map}has(e){return this.mapping.has(this.normalizeExpressionName(e))}isNameAvailable(e){const t=this.normalizeExpressionName(e),r=this.mapping.get(t);return!(r&&r.added)}add(e){this.mapping.set(e.normalizeExpressionName(),e)}get(e){return this.mapping.get(this.normalizeExpressionName(e))}getExisting(e){const t=this.mapping.get(this.normalizeExpressionName(e));if(t&&t.added)return t}remove(e){const t=this.normalizeExpressionName(e),r=this.mapping.get(t);r&&(r.added=!1)}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter(e=>e.added)}normalizeExpressionName(e){return e.toLowerCase()}}class WorksheetStore{constructor(){this.mapping=new Map}add(e){this.mapping.set(this.normalizeExpressionName(e.displayName),e)}get(e){return this.mapping.get(this.normalizeExpressionName(e))}has(e){return this.mapping.has(this.normalizeExpressionName(e))}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter(e=>e.added)}isNameAvailable(e){const t=this.normalizeExpressionName(e);return!this.mapping.has(t)}remove(e){const t=this.normalizeExpressionName(e);this.mapping.get(t)&&this.mapping.delete(t)}normalizeExpressionName(e){return e.toLowerCase()}}class NamedExpressions{constructor(){this.nextNamedExpressionRow=0,this.workbookStore=new WorkbookStore,this.worksheetStores=new Map,this.addressCache=new Map}isNameAvailable(e,t){var r,a;return t===void 0?this.workbookStore.isNameAvailable(e):(a=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.isNameAvailable(e))!==null&&a!==void 0?a:!0}namedExpressionInAddress(e){const t=this.addressCache.get(e);if(t&&t.added)return t}namedExpressionForScope(e,t){var r;return t===void 0?this.workbookStore.getExisting(e):(r=this.worksheetStore(t))===null||r===void 0?void 0:r.get(e)}nearestNamedExpression(e,t){var r,a;return(a=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.get(e))!==null&&a!==void 0?a:this.workbookStore.getExisting(e)}isExpressionInScope(e,t){var r,a;return(a=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.has(e))!==null&&a!==void 0?a:!1}isNameValid(e){const t=new RegExp(`^${CELL_REFERENCE_PATTERN}$`),r=new RegExp(`^${R1C1_CELL_REFERENCE_PATTERN}$`),a=new RegExp(`^${NAMED_EXPRESSION_PATTERN}$`);return t.test(e)||r.test(e)?!1:a.test(e)}addNamedExpression(e,t,r){const a=t===void 0?this.workbookStore:this.worksheetStoreOrCreate(t);let o=a.get(e);return o!==void 0?(o.added=!0,o.displayName=e,o.options=r):(o=new InternalNamedExpression(e,this.nextAddress(),!0,r),a.add(o)),this.addressCache.set(o.address.row,o),o}restoreNamedExpression(e,t){const r=t===void 0?this.workbookStore:this.worksheetStoreOrCreate(t);return e.added=!0,r.add(e),this.addressCache.set(e.address.row,e),e}namedExpressionOrPlaceholder(e,t){var r;return(r=this.worksheetStoreOrCreate(t).get(e))!==null&&r!==void 0?r:this.workbookNamedExpressionOrPlaceholder(e)}workbookNamedExpressionOrPlaceholder(e){let t=this.workbookStore.get(e);return t===void 0&&(t=new InternalNamedExpression(e,this.nextAddress(),!1),this.workbookStore.add(t)),t}remove(e,t){let r;t===void 0?r=this.workbookStore:r=this.worksheetStore(t);const a=r==null?void 0:r.get(e);if(r===void 0||a===void 0||!a.added)throw Error("Named expression does not exist");r.remove(e),r instanceof WorksheetStore&&r.mapping.size===0&&this.worksheetStores.delete(t),this.addressCache.delete(a.address.row)}getAllNamedExpressionsNamesInScope(e){return this.getAllNamedExpressions().filter(({scope:t})=>t===e).map(t=>t.expression.displayName)}getAllNamedExpressionsNames(){return this.getAllNamedExpressions().map(e=>e.expression.displayName)}getAllNamedExpressions(){const e=[];return this.workbookStore.getAllNamedExpressions().forEach(t=>{e.push({expression:t,scope:void 0})}),this.worksheetStores.forEach((t,r)=>{t.getAllNamedExpressions().forEach(a=>{e.push({expression:a,scope:r})})}),e}getAllNamedExpressionsForScope(e){var t,r;return e===void 0?this.workbookStore.getAllNamedExpressions():(r=(t=this.worksheetStores.get(e))===null||t===void 0?void 0:t.getAllNamedExpressions())!==null&&r!==void 0?r:[]}worksheetStoreOrCreate(e){let t=this.worksheetStores.get(e);return t||(t=new WorksheetStore,this.worksheetStores.set(e,t)),t}worksheetStore(e){return this.worksheetStores.get(e)}nextAddress(){return simpleCellAddress(NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS,0,this.nextNamedExpressionRow++)}}NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS=-1;const doesContainRelativeReferences=i=>{switch(i.type){case AstNodeType.EMPTY:case AstNodeType.NUMBER:case AstNodeType.STRING:case AstNodeType.ERROR:case AstNodeType.ERROR_WITH_RAW_INPUT:return!1;case AstNodeType.CELL_REFERENCE:return!i.reference.isAbsolute();case AstNodeType.CELL_RANGE:case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:return!i.start.isAbsolute();case AstNodeType.NAMED_EXPRESSION:return!1;case AstNodeType.PERCENT_OP:case AstNodeType.PLUS_UNARY_OP:case AstNodeType.MINUS_UNARY_OP:return doesContainRelativeReferences(i.value);case AstNodeType.CONCATENATE_OP:case AstNodeType.EQUALS_OP:case AstNodeType.NOT_EQUAL_OP:case AstNodeType.LESS_THAN_OP:case AstNodeType.GREATER_THAN_OP:case AstNodeType.LESS_THAN_OR_EQUAL_OP:case AstNodeType.GREATER_THAN_OR_EQUAL_OP:case AstNodeType.MINUS_OP:case AstNodeType.PLUS_OP:case AstNodeType.TIMES_OP:case AstNodeType.DIV_OP:case AstNodeType.POWER_OP:return doesContainRelativeReferences(i.left)||doesContainRelativeReferences(i.right);case AstNodeType.PARENTHESIS:return doesContainRelativeReferences(i.expression);case AstNodeType.FUNCTION_CALL:return i.args.some(e=>doesContainRelativeReferences(e));case AstNodeType.ARRAY:return i.args.some(e=>e.some(t=>doesContainRelativeReferences(t)))}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class Transformer{performEagerTransformations(e,t){for(const r of e.arrayFormulaNodes()){const[a,o]=this.transformSingleAst(r.getFormula(e.lazilyTransformingAstService),r.getAddress(e.lazilyTransformingAstService)),u=t.rememberNewAst(a);r.setFormula(u),r.setAddress(o)}}transformSingleAst(e,t){const r=this.transformAst(e,t),a=this.fixNodeAddress(t);return[r,a]}transformAst(e,t){switch(e.type){case AstNodeType.CELL_REFERENCE:return this.transformCellReferenceAst(e,t);case AstNodeType.CELL_RANGE:return this.transformCellRangeAst(e,t);case AstNodeType.COLUMN_RANGE:return this.transformColumnRangeAst(e,t);case AstNodeType.ROW_RANGE:return this.transformRowRangeAst(e,t);case AstNodeType.EMPTY:case AstNodeType.ERROR:case AstNodeType.NUMBER:case AstNodeType.NAMED_EXPRESSION:case AstNodeType.ERROR_WITH_RAW_INPUT:case AstNodeType.STRING:return e;case AstNodeType.PERCENT_OP:case AstNodeType.MINUS_UNARY_OP:case AstNodeType.PLUS_UNARY_OP:return Object.assign(Object.assign({},e),{value:this.transformAst(e.value,t)});case AstNodeType.FUNCTION_CALL:return Object.assign(Object.assign({},e),{procedureName:e.procedureName,args:e.args.map(r=>this.transformAst(r,t))});case AstNodeType.PARENTHESIS:return Object.assign(Object.assign({},e),{expression:this.transformAst(e.expression,t)});case AstNodeType.ARRAY:return Object.assign(Object.assign({},e),{args:e.args.map(r=>r.map(a=>this.transformAst(a,t)))});default:return Object.assign(Object.assign({},e),{left:this.transformAst(e.left,t),right:this.transformAst(e.right,t)})}}transformCellReferenceAst(e,t){const r=this.transformCellAddress(e.reference,t);return r instanceof CellAddress?Object.assign(Object.assign({},e),{reference:r}):r===ErrorType.REF?buildCellErrorAst(new CellError(ErrorType.REF)):e}transformCellRangeAst(e,t){const r=this.transformCellRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===ErrorType.REF?buildCellErrorAst(new CellError(ErrorType.REF)):e}transformColumnRangeAst(e,t){const r=this.transformColumnRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===ErrorType.REF?buildCellErrorAst(new CellError(ErrorType.REF)):e}transformRowRangeAst(e,t){const r=this.transformRowRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===ErrorType.REF?buildCellErrorAst(new CellError(ErrorType.REF)):e}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class AddColumnsTransformer extends Transformer{constructor(e){super(),this.columnsSpan=e}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!1}transformRowRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){throw Error("Not implemented")}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformCellAddress(e,t){const r=absoluteSheetReference(e,t);if(r!==this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet)return!1;const a=e.toSimpleColumnAddress(t);return r===this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet?this.columnsSpan.columnStart<=a.col?e.shiftedByColumns(this.columnsSpan.numberOfColumns):!1:t.sheet===this.columnsSpan.sheet&&r!==this.columnsSpan.sheet?e.isColumnAbsolute()||t.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(-this.columnsSpan.numberOfColumns):e.isColumnAbsolute()?e.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(this.columnsSpan.numberOfColumns):e.toSimpleColumnAddress(t).col<this.columnsSpan.columnStart?t.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(-this.columnsSpan.numberOfColumns):t.col<this.columnsSpan.columnStart?e.shiftedByColumns(this.columnsSpan.numberOfColumns):!1}fixNodeAddress(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col+this.columnsSpan.numberOfColumns}):e}transformRange(e,t,r){const a=this.transformCellAddress(e,r),o=this.transformCellAddress(t,r);return a===ErrorType.REF||o===ErrorType.REF?ErrorType.REF:a||o?[a||e,o||t]:!1}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class AddRowsTransformer extends Transformer{constructor(e){super(),this.rowsSpan=e}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!1}transformColumnRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){throw Error("Not implemented")}transformCellAddress(e,t){const r=absoluteSheetReference(e,t);if(r!==this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet)return!1;const a=e.toSimpleRowAddress(t);return r===this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet?this.rowsSpan.rowStart<=a.row?e.shiftedByRows(this.rowsSpan.numberOfRows):!1:t.sheet===this.rowsSpan.sheet&&r!==this.rowsSpan.sheet?e.isRowAbsolute()||t.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(-this.rowsSpan.numberOfRows):e.isRowAbsolute()?e.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(this.rowsSpan.numberOfRows):a.row<this.rowsSpan.rowStart?t.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(-this.rowsSpan.numberOfRows):t.row<this.rowsSpan.rowStart?e.shiftedByRows(this.rowsSpan.numberOfRows):!1}fixNodeAddress(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row+this.rowsSpan.numberOfRows}):e}transformRange(e,t,r){const a=this.transformCellAddress(e,r),o=this.transformCellAddress(t,r);return a===ErrorType.REF||o===ErrorType.REF?ErrorType.REF:a||o?[a||e,o||t]:!1}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class CleanOutOfScopeDependenciesTransformer extends Transformer{constructor(e){super(),this.sheet=e}isIrreversible(){return!0}fixNodeAddress(e){return e}transformCellAddress(e,t){return e.isInvalid(t)?ErrorType.REF:!1}transformCellRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?ErrorType.REF:!1}transformColumnRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?ErrorType.REF:!1}transformRowRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?ErrorType.REF:!1}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class MoveCellsTransformer extends Transformer{constructor(e,t,r,a){super(),this.sourceRange=e,this.toRight=t,this.toBottom=r,this.toSheet=a,this.dependentFormulaTransformer=new DependentFormulaTransformer(e,t,r,a)}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}transformSingleAst(e,t){return this.sourceRange.addressInRange(t)?[this.transformAst(e,t),this.fixNodeAddress(t)]:this.dependentFormulaTransformer.transformSingleAst(e,t)}fixNodeAddress(e){return simpleCellAddress(this.toSheet,e.col+this.toRight,e.row+this.toBottom)}transformCellAddress(e,t){return this.transformAddress(e,t)}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformAddress(e,t){const r=this.sourceRange;if(e instanceof CellAddress){const a=e.toSimpleCellAddress(t);if(r.addressInRange(a))return e.shiftAbsoluteDimensions(this.toRight,this.toBottom)}return e.shiftRelativeDimensions(-this.toRight,-this.toBottom)}transformRange(e,t,r){const a=this.sourceRange;if(e instanceof CellAddress&&t instanceof CellAddress){const o=e.toSimpleCellAddress(r),u=t.toSimpleCellAddress(r);if(a.addressInRange(o)&&a.addressInRange(u))return[e.shiftAbsoluteDimensions(this.toRight,this.toBottom),t.shiftAbsoluteDimensions(this.toRight,this.toBottom)]}return[e.shiftRelativeDimensions(-this.toRight,-this.toBottom),t.shiftRelativeDimensions(-this.toRight,-this.toBottom)]}}class DependentFormulaTransformer extends Transformer{constructor(e,t,r,a){super(),this.sourceRange=e,this.toRight=t,this.toBottom=r,this.toSheet=a}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}fixNodeAddress(e){return e}transformCellAddress(e,t){return this.shouldMove(e,t)?e.moved(this.toSheet,this.toRight,this.toBottom):!1}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}shouldMove(e,t){return e instanceof CellAddress?this.sourceRange.addressInRange(e.toSimpleCellAddress(t)):e instanceof RowAddress?this.sourceRange.rowInRange(e.toSimpleRowAddress(t))&&!this.sourceRange.isFinite():this.sourceRange.columnInRange(e.toSimpleColumnAddress(t))&&!this.sourceRange.isFinite()}transformRange(e,t,r){const a=this.transformCellAddress(e,r),o=this.transformCellAddress(t,r);return a&&o?[a,o]:!1}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class RemoveColumnsTransformer extends Transformer{constructor(e){super(),this.columnsSpan=e}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!0}transformRowRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){throw Error("Not implemented")}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformCellAddress(e,t){const r=absoluteSheetReference(e,t);if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet!==r)return!1;if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet===r){const a=e.toSimpleColumnAddress(t);if(a.col<this.columnsSpan.columnStart)return!1;if(a.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet!==r){if(e.isColumnAbsolute())return!1;if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet===r)if(e.isColumnAbsolute()){if(e.col<this.columnsSpan.columnStart)return!1;if(e.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}else{const a=e.toSimpleColumnAddress(t);if(a.col<this.columnsSpan.columnStart){if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}else if(a.col>this.columnsSpan.columnEnd){if(t.col<this.columnsSpan.columnStart)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns);if(t.col>this.columnsSpan.columnEnd)return!1}}return ErrorType.REF}fixNodeAddress(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col-this.columnsSpan.numberOfColumns}):e}transformRange(e,t,r){const a=absoluteSheetReference(e,r);let o=e,u=t;if(this.columnsSpan.sheet===a){const d=e.toSimpleColumnAddress(r),p=t.toSimpleColumnAddress(r);if(this.columnsSpan.columnStart<=d.col&&this.columnsSpan.columnEnd>=p.col)return ErrorType.REF;d.col>=this.columnsSpan.columnStart&&d.col<=this.columnsSpan.columnEnd&&(o=e.shiftedByColumns(this.columnsSpan.columnEnd-d.col+1)),p.col>=this.columnsSpan.columnStart&&p.col<=this.columnsSpan.columnEnd&&(u=t.shiftedByColumns(-(p.col-this.columnsSpan.columnStart+1)))}const c=this.transformCellAddress(o,r),h=this.transformCellAddress(u,r);if(c===!1&&h===!1)return[o,u];if(c===ErrorType.REF||h===ErrorType.REF)throw Error("Cannot happen");return[c||o,h||u]}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class RemoveRowsTransformer extends Transformer{constructor(e){super(),this.rowsSpan=e}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!0}transformColumnRangeAst(e,t){return e}transformCellAddress(e,t){const r=absoluteSheetReference(e,t);if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet!==r)return!1;if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet===r){const a=e.toSimpleRowAddress(t);if(a.row<this.rowsSpan.rowStart)return!1;if(a.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet!==r){if(e.isRowAbsolute())return!1;if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet===r)if(e.isRowAbsolute()){if(e.row<this.rowsSpan.rowStart)return!1;if(e.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}else{const a=e.toSimpleRowAddress(t);if(a.row<this.rowsSpan.rowStart){if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}else if(a.row>this.rowsSpan.rowEnd){if(t.row<this.rowsSpan.rowStart)return e.shiftedByRows(-this.rowsSpan.numberOfRows);if(t.row>this.rowsSpan.rowEnd)return!1}}return ErrorType.REF}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){throw Error("Not implemented")}fixNodeAddress(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row-this.rowsSpan.numberOfRows}):e}transformRange(e,t,r){const a=absoluteSheetReference(e,r);let o=e,u=t;if(this.rowsSpan.sheet===a){const d=e.toSimpleRowAddress(r),p=t.toSimpleRowAddress(r);if(this.rowsSpan.rowStart<=d.row&&this.rowsSpan.rowEnd>=p.row)return ErrorType.REF;d.row>=this.rowsSpan.rowStart&&d.row<=this.rowsSpan.rowEnd&&(o=e.shiftedByRows(this.rowsSpan.rowEnd-d.row+1)),p.row>=this.rowsSpan.rowStart&&p.row<=this.rowsSpan.rowEnd&&(u=t.shiftedByRows(-(p.row-this.rowsSpan.rowStart+1)))}const c=this.transformCellAddress(o,r),h=this.transformCellAddress(u,r);return c===!1&&h===!1?[o,u]:c===ErrorType.REF||h===ErrorType.REF?ErrorType.REF:[c||o,h||u]}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class RemoveSheetTransformer extends Transformer{constructor(e){super(),this.sheet=e}isIrreversible(){return!0}performEagerTransformations(e,t){for(const r of e.arrayFormulaNodes()){const[a]=this.transformSingleAst(r.getFormula(e.lazilyTransformingAstService),r.getAddress(e.lazilyTransformingAstService));r.setFormula(a)}}fixNodeAddress(e){return e}transformCellAddress(e,t){return this.transformAddress(e)}transformCellRange(e,t,r){return this.transformAddress(e)}transformColumnRange(e,t,r){return this.transformAddress(e)}transformRowRange(e,t,r){return this.transformAddress(e)}transformAddress(e){return e.sheet===this.sheet?ErrorType.REF:!1}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */function validateAsSheet(i){if(!Array.isArray(i))throw new InvalidArgumentsError("an array of arrays.");for(let e=0;e<i.length;e++)if(!Array.isArray(i[e]))throw new InvalidArgumentsError("an array of arrays.")}function findBoundaries(i){let e=0,t=0,r=0;for(let o=0;o<i.length;o++){let u=0;for(let c=0;c<i[o].length;c++){const h=i[o][c];h!=null&&(u=c+1,++r)}e=Math.max(e,u),u>0&&(t=o+1)}const a=e*t;return{height:t,width:e,fill:a===0?0:r/a}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class RemoveRowsCommand{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return normalizeRemovedIndexes(this.indexes)}rowsSpans(){return this.normalizedIndexes().map(e=>RowsSpan.fromNumberOfRows(this.sheet,e[0],e[1]))}}class AddRowsCommand{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return normalizeAddedIndexes(this.indexes)}rowsSpans(){return this.normalizedIndexes().map(e=>RowsSpan.fromNumberOfRows(this.sheet,e[0],e[1]))}}class AddColumnsCommand{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return normalizeAddedIndexes(this.indexes)}columnsSpans(){return this.normalizedIndexes().map(e=>ColumnsSpan.fromNumberOfColumns(this.sheet,e[0],e[1]))}}class RemoveColumnsCommand{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return normalizeRemovedIndexes(this.indexes)}columnsSpans(){return this.normalizedIndexes().map(e=>ColumnsSpan.fromNumberOfColumns(this.sheet,e[0],e[1]))}}class Operations{constructor(e,t,r,a,o,u,c,h,d){this.dependencyGraph=t,this.columnSearch=r,this.cellContentParser=a,this.parser=o,this.stats=u,this.lazilyTransformingAstService=c,this.namedExpressions=h,this.arraySizePredictor=d,this.changes=ContentChanges.empty(),this.allocateNamedExpressionAddressSpace(),this.maxColumns=e.maxColumns,this.maxRows=e.maxRows}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}removeRows(e){const t=[];for(const r of e.rowsSpans()){const a=this.doRemoveRows(r);a&&t.push(a)}return t}addRows(e){for(const t of e.rowsSpans())this.doAddRows(t)}addColumns(e){for(const t of e.columnsSpans())this.doAddColumns(t)}removeColumns(e){const t=[];for(const r of e.columnsSpans()){const a=this.doRemoveColumns(r);a&&t.push(a)}return t}removeSheet(e){this.dependencyGraph.removeSheet(e);let t=0;this.stats.measure(StatType.TRANSFORM_ASTS,()=>{const a=new RemoveSheetTransformer(e);a.performEagerTransformations(this.dependencyGraph,this.parser),t=this.lazilyTransformingAstService.addTransformation(a)}),this.sheetMapping.removeSheet(e),this.columnSearch.removeSheet(e);const r=this.namedExpressions.getAllNamedExpressionsForScope(e).map(a=>this.removeNamedExpression(a.normalizeExpressionName(),e));return{version:t,scopedNamedExpressions:r}}removeSheetByName(e){const t=this.sheetMapping.fetch(e);return this.removeSheet(t)}clearSheet(e){this.dependencyGraph.clearSheet(e),this.columnSearch.removeSheet(e)}addSheet(e){const t=this.sheetMapping.addSheet(e),r=[];return this.dependencyGraph.addressMapping.autoAddSheet(t,findBoundaries(r)),this.sheetMapping.fetchDisplayName(t)}renameSheet(e,t){return this.sheetMapping.renameSheet(e,t)}moveRows(e,t,r,a){const o=RowsSpan.fromNumberOfRows(e,a,r);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddRows(o),a<t&&(t+=r);const u=simpleCellAddress(e,0,t),c=simpleCellAddress(e,0,a);this.moveCells(u,Number.POSITIVE_INFINITY,r,c);const h=RowsSpan.fromNumberOfRows(e,t,r);return this.doRemoveRows(h),this.lazilyTransformingAstService.commitCombinedMode()}moveColumns(e,t,r,a){const o=ColumnsSpan.fromNumberOfColumns(e,a,r);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddColumns(o),a<t&&(t+=r);const u=simpleCellAddress(e,t,0),c=simpleCellAddress(e,a,0);this.moveCells(u,r,Number.POSITIVE_INFINITY,c);const h=ColumnsSpan.fromNumberOfColumns(e,t,r);return this.doRemoveColumns(h),this.lazilyTransformingAstService.commitCombinedMode()}moveCells(e,t,r,a){this.ensureItIsPossibleToMoveCells(e,t,r,a);const o=AbsoluteCellRange.spanFrom(e,t,r),u=AbsoluteCellRange.spanFrom(a,t,r),c=a.col-e.col,h=a.row-e.row,d=a.sheet,p=this.getRangeClipboardCells(u),m=this.dependencyGraph.rawValuesFromRange(u);this.columnSearch.removeValues(m);const f=this.dependencyGraph.rawValuesFromRange(o);this.columnSearch.moveValues(f,c,h,d);let g=0;this.stats.measure(StatType.TRANSFORM_ASTS,()=>{const T=new MoveCellsTransformer(o,c,h,d);T.performEagerTransformations(this.dependencyGraph,this.parser),g=this.lazilyTransformingAstService.addTransformation(T)}),this.dependencyGraph.moveCells(o,c,h,d);const y=this.updateNamedExpressionsForMovedCells(e,t,r,a);return{version:g,overwrittenCellsData:p,addedGlobalNamedExpressions:y}}setRowOrder(e,t){const r=[];let a=[];for(const[o,u]of t)if(o!==u){const c=AbsoluteCellRange.spanFrom({sheet:e,col:0,row:o},1/0,1),h=this.getRangeClipboardCells(c);a=a.concat(h),r.push(h.map(([{sheet:d,col:p},m])=>[{sheet:d,col:p,row:u},m]))}return r.forEach(o=>this.restoreClipboardCells(e,o.values())),a}setColumnOrder(e,t){const r=[];let a=[];for(const[o,u]of t)if(o!==u){const c=AbsoluteCellRange.spanFrom({sheet:e,col:o,row:0},1,1/0),h=this.getRangeClipboardCells(c);a=a.concat(h),r.push(h.map(([{sheet:d,col:p,row:m},f])=>[{sheet:d,col:u,row:m},f]))}return r.forEach(o=>this.restoreClipboardCells(e,o.values())),a}addNamedExpression(e,t,r,a){const o=this.namedExpressions.addNamedExpression(e,r,a);this.storeNamedExpressionInCell(o.address,t),this.adjustNamedExpressionEdges(o,e,r)}restoreNamedExpression(e,t,r){const a=e.displayName;this.restoreCell(e.address,t);const o=this.namedExpressions.restoreNamedExpression(e,r);this.adjustNamedExpressionEdges(o,a,r)}changeNamedExpressionExpression(e,t,r,a){const o=this.namedExpressions.namedExpressionForScope(e,r);if(!o)throw new NamedExpressionDoesNotExistError(e);const u=o.copy();o.options=a;const c=this.getClipboardCell(o.address);return this.storeNamedExpressionInCell(o.address,t),[u,c]}removeNamedExpression(e,t){const r=this.namedExpressions.namedExpressionForScope(e,t);if(!r)throw new NamedExpressionDoesNotExistError(e);this.namedExpressions.remove(r.displayName,t);const a=this.getClipboardCell(r.address);if(t!==void 0){const o=this.namedExpressions.workbookNamedExpressionOrPlaceholder(e);this.dependencyGraph.exchangeNode(r.address,o.address)}else this.dependencyGraph.setCellEmpty(r.address);return[r,a]}ensureItIsPossibleToMoveCells(e,t,r,a){if(invalidSimpleCellAddress(e)||!(isPositiveInteger$1(t)&&isPositiveInteger$1(r)||isRowOrColumnRange(e,t,r))||invalidSimpleCellAddress(a)||!this.sheetMapping.hasSheetWithId(e.sheet)||!this.sheetMapping.hasSheetWithId(a.sheet))throw new InvalidArgumentsError("a valid range of cells to move.");const o=AbsoluteCellRange.spanFrom(e,t,r),u=AbsoluteCellRange.spanFrom(a,t,r);if(u.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new SheetSizeLimitExceededError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(o))throw new SourceLocationHasArrayError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(u))throw new TargetLocationHasArrayError}restoreClipboardCells(e,t){const r=[];for(const[a,o]of t)if(this.restoreCell(a,o),o.type===ClipboardCellType.FORMULA){const{dependencies:u}=this.parser.fetchCachedResult(o.hash);r.push(...this.updateNamedExpressionsForTargetAddress(e,a,u))}return r}restoreCell(e,t){switch(t.type){case ClipboardCellType.VALUE:{this.setValueToCell(t,e);break}case ClipboardCellType.FORMULA:{this.setFormulaToCellFromCache(t.hash,e);break}case ClipboardCellType.EMPTY:{this.setCellEmpty(e);break}case ClipboardCellType.PARSING_ERROR:{this.setParsingErrorToCell(t.rawInput,t.errors,e);break}}}getOldContent(e){const t=this.dependencyGraph.getCell(e);if(t===void 0||t instanceof EmptyCellVertex)return[e,{type:ClipboardCellType.EMPTY}];if(t instanceof ValueCellVertex)return[e,Object.assign({type:ClipboardCellType.VALUE},t.getValues())];if(t instanceof FormulaVertex)return[t.getAddress(this.lazilyTransformingAstService),{type:ClipboardCellType.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))}];if(t instanceof ParsingErrorVertex)return[e,{type:ClipboardCellType.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors}];throw Error("Trying to copy unsupported type")}getClipboardCell(e){const t=this.dependencyGraph.getCell(e);if(t===void 0||t instanceof EmptyCellVertex)return{type:ClipboardCellType.EMPTY};if(t instanceof ValueCellVertex)return Object.assign({type:ClipboardCellType.VALUE},t.getValues());if(t instanceof ArrayVertex){const r=t.getArrayCellValue(e);return r===EmptyValue?{type:ClipboardCellType.EMPTY}:{type:ClipboardCellType.VALUE,parsedValue:r,rawValue:t.getArrayCellRawValue(e)}}else{if(t instanceof FormulaCellVertex)return{type:ClipboardCellType.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))};if(t instanceof ParsingErrorVertex)return{type:ClipboardCellType.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors}}throw Error("Trying to copy unsupported type")}getSheetClipboardCells(e){const t=this.dependencyGraph.getSheetHeight(e),r=this.dependencyGraph.getSheetWidth(e),a=new Array(t);for(let o=0;o<t;o++){a[o]=new Array(r);for(let u=0;u<r;u++){const c=simpleCellAddress(e,u,o);a[o][u]=this.getClipboardCell(c)}}return a}getRangeClipboardCells(e){const t=[];for(const r of e.addresses(this.dependencyGraph))t.push([r,this.getClipboardCell(r)]);return t}setCellContent(e,t){const r=this.cellContentParser.parse(t),a=this.getOldContent(e);if(r instanceof CellContent.Formula){const o=this.parser.parse(r.formula,e),{ast:u,errors:c}=o;if(c.length>0)this.setParsingErrorToCell(r.formula,c,e);else try{const h=this.arraySizePredictor.checkArraySize(u,e);if(h.width<=0||h.height<=0)throw Error("Incorrect array size");this.setFormulaToCell(e,h,o)}catch(h){if(!h.message)throw h;const d={type:ParsingErrorType.InvalidRangeSize,message:"Invalid range size."};this.setParsingErrorToCell(r.formula,[d],e)}}else r instanceof CellContent.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:r.value,rawValue:t},e);return a}setSheetContent(e,t){this.clearSheet(e);for(let r=0;r<t.length;r++)for(let a=0;a<t[r].length;a++){const o=simpleCellAddress(e,a,r);this.setCellContent(o,t[r][a])}}setParsingErrorToCell(e,t,r){const a=this.dependencyGraph.getCellValue(r),o=new ParsingErrorVertex(t,e),u=this.dependencyGraph.setParsingErrorToCell(r,o);this.columnSearch.remove(getRawValue(a),r),this.columnSearch.applyChanges(u.getChanges()),this.changes.addAll(u),this.changes.addChange(o.getCellValue(),r)}setFormulaToCell(e,t,{ast:r,hasVolatileFunction:a,hasStructuralChangeFunction:o,dependencies:u}){const c=this.dependencyGraph.getCellValue(e),h=this.dependencyGraph.setFormulaToCell(e,r,absolutizeDependencies(u,e),t,a,o);this.columnSearch.remove(getRawValue(c),e),this.columnSearch.applyChanges(h.getChanges()),this.changes.addAll(h)}setValueToCell(e,t){const r=this.dependencyGraph.getCellValue(t),a=this.dependencyGraph.setValueToCell(t,e);this.columnSearch.change(getRawValue(r),getRawValue(e.parsedValue),t),this.columnSearch.applyChanges(a.getChanges().filter(o=>!equalSimpleCellAddress(o.address,t))),this.changes.addAll(a),this.changes.addChange(e.parsedValue,t)}setCellEmpty(e){if(this.dependencyGraph.isArrayInternalCell(e))return;const t=this.dependencyGraph.getCellValue(e),r=this.dependencyGraph.setCellEmpty(e);this.columnSearch.remove(getRawValue(t),e),this.columnSearch.applyChanges(r.getChanges()),this.changes.addAll(r),this.changes.addChange(EmptyValue,e)}setFormulaToCellFromCache(e,t){const{ast:r,hasVolatileFunction:a,hasStructuralChangeFunction:o,dependencies:u}=this.parser.fetchCachedResult(e),c=absolutizeDependencies(u,t),[h]=new CleanOutOfScopeDependenciesTransformer(t.sheet).transformSingleAst(r,t);this.parser.rememberNewAst(h);const d=filterDependenciesOutOfScope(c),p=this.arraySizePredictor.checkArraySize(r,t);this.dependencyGraph.setFormulaToCell(t,h,d,p,a,o)}rowEffectivelyNotInSheet(e,t){const r=this.dependencyGraph.addressMapping.getHeight(t);return e>=r}getAndClearContentChanges(){const e=this.changes;return this.changes=ContentChanges.empty(),e}forceApplyPostponedTransformations(){this.dependencyGraph.forceApplyPostponedTransformations()}doRemoveRows(e){if(this.rowEffectivelyNotInSheet(e.rowStart,e.sheet))return;const t=[];for(const[u]of this.dependencyGraph.entriesFromRowsSpan(e))t.push({address:u,cellType:this.getClipboardCell(u)});const{affectedArrays:r,contentChanges:a}=this.dependencyGraph.removeRows(e);this.columnSearch.applyChanges(a.getChanges());let o=0;return this.stats.measure(StatType.TRANSFORM_ASTS,()=>{const u=new RemoveRowsTransformer(e);u.performEagerTransformations(this.dependencyGraph,this.parser),o=this.lazilyTransformingAstService.addTransformation(u)}),this.rewriteAffectedArrays(r),{version:o,removedCells:t,rowFrom:e.rowStart,rowCount:e.numberOfRows}}doRemoveColumns(e){if(this.columnEffectivelyNotInSheet(e.columnStart,e.sheet))return;const t=[];for(const[u]of this.dependencyGraph.entriesFromColumnsSpan(e))t.push({address:u,cellType:this.getClipboardCell(u)});const{affectedArrays:r,contentChanges:a}=this.dependencyGraph.removeColumns(e);this.columnSearch.applyChanges(a.getChanges()),this.columnSearch.removeColumns(e);let o=0;return this.stats.measure(StatType.TRANSFORM_ASTS,()=>{const u=new RemoveColumnsTransformer(e);u.performEagerTransformations(this.dependencyGraph,this.parser),o=this.lazilyTransformingAstService.addTransformation(u)}),this.rewriteAffectedArrays(r),{version:o,removedCells:t,columnFrom:e.columnStart,columnCount:e.numberOfColumns}}doAddRows(e){if(this.rowEffectivelyNotInSheet(e.rowStart,e.sheet))return;const{affectedArrays:t}=this.dependencyGraph.addRows(e);this.stats.measure(StatType.TRANSFORM_ASTS,()=>{const r=new AddRowsTransformer(e);r.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(r)}),this.rewriteAffectedArrays(t)}rewriteAffectedArrays(e){for(const t of e.values()){if(t.array.size.isRef)continue;const r=t.getFormula(this.lazilyTransformingAstService),a=t.getAddress(this.lazilyTransformingAstService),o=this.parser.computeHashFromAst(r);this.setFormulaToCellFromCache(o,a)}}doAddColumns(e){if(this.columnEffectivelyNotInSheet(e.columnStart,e.sheet))return;const{affectedArrays:t,contentChanges:r}=this.dependencyGraph.addColumns(e);this.columnSearch.addColumns(e),this.columnSearch.applyChanges(r.getChanges()),this.stats.measure(StatType.TRANSFORM_ASTS,()=>{const a=new AddColumnsTransformer(e);a.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(a)}),this.rewriteAffectedArrays(t)}columnEffectivelyNotInSheet(e,t){const r=this.dependencyGraph.addressMapping.getWidth(t);return e>=r}adjustNamedExpressionEdges(e,t,r){if(r===void 0)return;const{vertex:a,id:o}=this.dependencyGraph.fetchCellOrCreateEmpty(e.address),u=o??this.dependencyGraph.graph.getNodeId(a),c=this.namedExpressions.workbookNamedExpressionOrPlaceholder(t),{vertex:h,id:d}=this.dependencyGraph.fetchCellOrCreateEmpty(c.address),p=d??this.dependencyGraph.graph.getNodeId(h);for(const m of this.dependencyGraph.graph.adjacentNodes(h))if(m instanceof FormulaCellVertex&&m.getAddress(this.lazilyTransformingAstService).sheet===r){const f=m.getFormula(this.lazilyTransformingAstService),g=m.getAddress(this.lazilyTransformingAstService),{dependencies:y}=this.parser.fetchCachedResultForAst(f);for(const T of absolutizeDependencies(y,g))T instanceof NamedExpressionDependency&&T.name.toLowerCase()===e.displayName.toLowerCase()&&(this.dependencyGraph.graph.removeEdge(p,m),this.dependencyGraph.graph.addEdge(u,m))}}storeNamedExpressionInCell(e,t){const r=this.cellContentParser.parse(t);if(r instanceof CellContent.Formula){const a=this.parser.parse(r.formula,simpleCellAddress(-1,0,0));if(doesContainRelativeReferences(a.ast))throw new NoRelativeAddressesAllowedError;const{ast:o,hasVolatileFunction:u,hasStructuralChangeFunction:c,dependencies:h}=a;this.dependencyGraph.setFormulaToCell(e,o,absolutizeDependencies(h,e),ArraySize.scalar(),u,c)}else r instanceof CellContent.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:r.value,rawValue:t},e)}updateNamedExpressionsForMovedCells(e,t,r,a){if(e.sheet===a.sheet)return[];const o=[],u=AbsoluteCellRange.spanFrom(a,t,r);for(const c of u.addresses(this.dependencyGraph)){const h=this.addressMapping.fetchCell(c);if(h instanceof FormulaCellVertex&&c.sheet!==e.sheet){const d=h.getFormula(this.lazilyTransformingAstService),{dependencies:p}=this.parser.fetchCachedResultForAst(d);o.push(...this.updateNamedExpressionsForTargetAddress(e.sheet,c,p))}}return o}updateNamedExpressionsForTargetAddress(e,t,r){if(e===t.sheet)return[];const a=[],o=this.addressMapping.fetchCell(t);for(const u of absolutizeDependencies(r,t)){if(!(u instanceof NamedExpressionDependency))continue;const c=u.name,h=this.dependencyGraph.fetchNamedExpressionVertex(c,e).vertex,p=this.namedExpressions.isExpressionInScope(c,t.sheet)?this.dependencyGraph.fetchNamedExpressionVertex(c,t.sheet).vertex:this.copyOrFetchGlobalNamedExpressionVertex(c,h,a);p!==h&&(this.dependencyGraph.graph.removeEdgeIfExists(h,o),this.dependencyGraph.graph.addEdge(p,o))}return a}allocateNamedExpressionAddressSpace(){this.dependencyGraph.addressMapping.addSheet(NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS,new SparseStrategy(0,0))}copyOrFetchGlobalNamedExpressionVertex(e,t,r){let a=this.namedExpressions.namedExpressionForScope(e);if(a===void 0)if(a=this.namedExpressions.addNamedExpression(e),r.push(a.normalizeExpressionName()),t instanceof FormulaCellVertex){const o=this.parser.fetchCachedResultForAst(t.getFormula(this.lazilyTransformingAstService)),{ast:u,hasVolatileFunction:c,hasStructuralChangeFunction:h,dependencies:d}=o;this.dependencyGraph.setFormulaToCell(a.address,u,absolutizeDependencies(d,a.address),ArraySize.scalar(),c,h)}else t instanceof EmptyCellVertex?this.setCellEmpty(a.address):t instanceof ValueCellVertex&&this.setValueToCell(t.getValues(),a.address);return this.dependencyGraph.fetchCellOrCreateEmpty(a.address).vertex}}function normalizeRemovedIndexes(i){if(i.length<=1)return i;const e=[...i].sort(([a],[o])=>a-o),t=e.reduce((a,[o,u])=>{const c=a[a.length-1],h=c[0]+c[1];return o<=h?c[1]+=Math.max(0,u-(h-o)):a.push([o,u]),a},[e[0]]);let r=0;for(let a=0;a<t.length;++a)t[a][0]-=r,r+=t[a][1];return t}function normalizeAddedIndexes(i){if(i.length<=1)return i;const e=[...i].sort(([a],[o])=>a-o),t=e.reduce((a,[o,u])=>{const c=a[a.length-1];return o===c[0]?c[1]=Math.max(c[1],u):a.push([o,u]),a},[e[0]]);let r=0;for(let a=0;a<t.length;++a)t[a][0]+=r,r+=t[a][1];return t}function isPositiveInteger$1(i){return Number.isInteger(i)&&i>0}function isRowOrColumnRange(i,e,t){return i.row===0&&isPositiveInteger$1(e)&&t===Number.POSITIVE_INFINITY||i.col===0&&isPositiveInteger$1(t)&&e===Number.POSITIVE_INFINITY}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class BaseUndoEntry{}class RemoveRowsUndoEntry extends BaseUndoEntry{constructor(e,t){super(),this.command=e,this.rowsRemovals=t}doUndo(e){e.undoRemoveRows(this)}doRedo(e){e.redoRemoveRows(this)}}class MoveCellsUndoEntry extends BaseUndoEntry{constructor(e,t,r,a,o,u,c){super(),this.sourceLeftCorner=e,this.width=t,this.height=r,this.destinationLeftCorner=a,this.overwrittenCellsData=o,this.addedGlobalNamedExpressions=u,this.version=c}doUndo(e){e.undoMoveCells(this)}doRedo(e){e.redoMoveCells(this)}}class AddRowsUndoEntry extends BaseUndoEntry{constructor(e){super(),this.command=e}doUndo(e){e.undoAddRows(this)}doRedo(e){e.redoAddRows(this)}}class SetRowOrderUndoEntry extends BaseUndoEntry{constructor(e,t,r){super(),this.sheetId=e,this.rowMapping=t,this.oldContent=r}doUndo(e){e.undoSetRowOrder(this)}doRedo(e){e.redoSetRowOrder(this)}}class SetColumnOrderUndoEntry extends BaseUndoEntry{constructor(e,t,r){super(),this.sheetId=e,this.columnMapping=t,this.oldContent=r}doUndo(e){e.undoSetColumnOrder(this)}doRedo(e){e.redoSetColumnOrder(this)}}class SetSheetContentUndoEntry extends BaseUndoEntry{constructor(e,t,r){super(),this.sheetId=e,this.oldSheetContent=t,this.newSheetContent=r}doUndo(e){e.undoSetSheetContent(this)}doRedo(e){e.redoSetSheetContent(this)}}class MoveRowsUndoEntry extends BaseUndoEntry{constructor(e,t,r,a,o){super(),this.sheet=e,this.startRow=t,this.numberOfRows=r,this.targetRow=a,this.version=o,this.undoStart=this.startRow<this.targetRow?this.targetRow-this.numberOfRows:this.targetRow,this.undoEnd=this.startRow>this.targetRow?this.startRow+this.numberOfRows:this.startRow}doUndo(e){e.undoMoveRows(this)}doRedo(e){e.redoMoveRows(this)}}class MoveColumnsUndoEntry extends BaseUndoEntry{constructor(e,t,r,a,o){super(),this.sheet=e,this.startColumn=t,this.numberOfColumns=r,this.targetColumn=a,this.version=o,this.undoStart=this.startColumn<this.targetColumn?this.targetColumn-this.numberOfColumns:this.targetColumn,this.undoEnd=this.startColumn>this.targetColumn?this.startColumn+this.numberOfColumns:this.startColumn}doUndo(e){e.undoMoveColumns(this)}doRedo(e){e.redoMoveColumns(this)}}class AddColumnsUndoEntry extends BaseUndoEntry{constructor(e){super(),this.command=e}doUndo(e){e.undoAddColumns(this)}doRedo(e){e.redoAddColumns(this)}}class RemoveColumnsUndoEntry extends BaseUndoEntry{constructor(e,t){super(),this.command=e,this.columnsRemovals=t}doUndo(e){e.undoRemoveColumns(this)}doRedo(e){e.redoRemoveColumns(this)}}class AddSheetUndoEntry extends BaseUndoEntry{constructor(e){super(),this.sheetName=e}doUndo(e){e.undoAddSheet(this)}doRedo(e){e.redoAddSheet(this)}}class RemoveSheetUndoEntry extends BaseUndoEntry{constructor(e,t,r,a,o){super(),this.sheetName=e,this.sheetId=t,this.oldSheetContent=r,this.scopedNamedExpressions=a,this.version=o}doUndo(e){e.undoRemoveSheet(this)}doRedo(e){e.redoRemoveSheet(this)}}class RenameSheetUndoEntry extends BaseUndoEntry{constructor(e,t,r){super(),this.sheetId=e,this.oldName=t,this.newName=r}doUndo(e){e.undoRenameSheet(this)}doRedo(e){e.redoRenameSheet(this)}}class ClearSheetUndoEntry extends BaseUndoEntry{constructor(e,t){super(),this.sheetId=e,this.oldSheetContent=t}doUndo(e){e.undoClearSheet(this)}doRedo(e){e.redoClearSheet(this)}}class SetCellContentsUndoEntry extends BaseUndoEntry{constructor(e){super(),this.cellContents=e}doUndo(e){e.undoSetCellContents(this)}doRedo(e){e.redoSetCellContents(this)}}class PasteUndoEntry extends BaseUndoEntry{constructor(e,t,r,a){super(),this.targetLeftCorner=e,this.oldContent=t,this.newContent=r,this.addedGlobalNamedExpressions=a}doUndo(e){e.undoPaste(this)}doRedo(e){e.redoPaste(this)}}class AddNamedExpressionUndoEntry extends BaseUndoEntry{constructor(e,t,r,a){super(),this.name=e,this.newContent=t,this.scope=r,this.options=a}doUndo(e){e.undoAddNamedExpression(this)}doRedo(e){e.redoAddNamedExpression(this)}}class RemoveNamedExpressionUndoEntry extends BaseUndoEntry{constructor(e,t,r){super(),this.namedExpression=e,this.content=t,this.scope=r}doUndo(e){e.undoRemoveNamedExpression(this)}doRedo(e){e.redoRemoveNamedExpression(this)}}class ChangeNamedExpressionUndoEntry extends BaseUndoEntry{constructor(e,t,r,a,o){super(),this.namedExpression=e,this.newContent=t,this.oldContent=r,this.scope=a,this.options=o}doUndo(e){e.undoChangeNamedExpression(this)}doRedo(e){e.redoChangeNamedExpression(this)}}class BatchUndoEntry extends BaseUndoEntry{constructor(){super(...arguments),this.operations=[]}add(e){this.operations.push(e)}*reversedOperations(){for(let e=this.operations.length-1;e>=0;e--)yield this.operations[e]}doUndo(e){e.undoBatch(this)}doRedo(e){e.redoBatch(this)}}class UndoRedo{constructor(e,t){this.operations=t,this.oldData=new Map,this.undoStack=[],this.redoStack=[],this.undoLimit=e.undoLimit}saveOperation(e){this.batchUndoEntry!==void 0?this.batchUndoEntry.add(e):this.addUndoEntry(e)}beginBatchMode(){this.batchUndoEntry=new BatchUndoEntry}commitBatchMode(){if(this.batchUndoEntry===void 0)throw Error("Batch mode wasn't started");this.addUndoEntry(this.batchUndoEntry),this.batchUndoEntry=void 0}storeDataForVersion(e,t,r){this.oldData.has(e)||this.oldData.set(e,[]),this.oldData.get(e).push([t,r])}clearRedoStack(){this.redoStack=[]}clearUndoStack(){this.undoStack=[]}isUndoStackEmpty(){return this.undoStack.length===0}isRedoStackEmpty(){return this.redoStack.length===0}undo(){const e=this.undoStack.pop();if(!e)throw Error("Attempted to undo without operation on stack");this.undoEntry(e),this.redoStack.push(e)}undoBatch(e){for(const t of e.reversedOperations())this.undoEntry(t)}undoRemoveRows(e){this.operations.forceApplyPostponedTransformations();const{command:{sheet:t},rowsRemovals:r}=e;for(let a=r.length-1;a>=0;--a){const o=r[a];this.operations.addRows(new AddRowsCommand(t,[[o.rowFrom,o.rowCount]]));for(const{address:u,cellType:c}of o.removedCells)this.operations.restoreCell(u,c);this.restoreOldDataFromVersion(o.version-1)}}undoRemoveColumns(e){this.operations.forceApplyPostponedTransformations();const{command:{sheet:t},columnsRemovals:r}=e;for(let a=r.length-1;a>=0;--a){const o=r[a];this.operations.addColumns(new AddColumnsCommand(t,[[o.columnFrom,o.columnCount]]));for(const{address:u,cellType:c}of o.removedCells)this.operations.restoreCell(u,c);this.restoreOldDataFromVersion(o.version-1)}}undoAddRows(e){const t=e.command.rowsSpans();for(let r=t.length-1;r>=0;--r){const a=t[r];this.operations.removeRows(new RemoveRowsCommand(e.command.sheet,[[a.rowStart,a.numberOfRows]]))}}undoAddColumns(e){const t=e.command.columnsSpans();for(let r=t.length-1;r>=0;--r){const a=t[r];this.operations.removeColumns(new RemoveColumnsCommand(e.command.sheet,[[a.columnStart,a.numberOfColumns]]))}}undoSetCellContents(e){for(const t of e.cellContents){const r=t.address,[a,o]=t.oldContent;equalSimpleCellAddress(r,a)||this.operations.setCellEmpty(r),this.operations.restoreCell(a,o)}}undoPaste(e){this.restoreOperationOldContent(e.oldContent);for(const t of e.addedGlobalNamedExpressions)this.operations.removeNamedExpression(t)}undoMoveRows(e){const{sheet:t}=e;this.operations.moveRows(t,e.undoStart,e.numberOfRows,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}undoMoveColumns(e){const{sheet:t}=e;this.operations.moveColumns(t,e.undoStart,e.numberOfColumns,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}undoMoveCells(e){this.operations.forceApplyPostponedTransformations(),this.operations.moveCells(e.destinationLeftCorner,e.width,e.height,e.sourceLeftCorner),this.restoreOperationOldContent(e.overwrittenCellsData),this.restoreOldDataFromVersion(e.version-1);for(const t of e.addedGlobalNamedExpressions)this.operations.removeNamedExpression(t)}undoAddSheet(e){const{sheetName:t}=e;this.operations.removeSheetByName(t)}undoRemoveSheet(e){this.operations.forceApplyPostponedTransformations();const{oldSheetContent:t,sheetId:r}=e;this.operations.addSheet(e.sheetName);for(let a=0;a<t.length;a++){const o=t[a];for(let u=0;u<o.length;u++){const c=o[u],h=simpleCellAddress(r,u,a);this.operations.restoreCell(h,c)}}for(const[a,o]of e.scopedNamedExpressions)this.operations.restoreNamedExpression(a,o,r);this.restoreOldDataFromVersion(e.version-1)}undoRenameSheet(e){this.operations.renameSheet(e.sheetId,e.oldName)}undoClearSheet(e){const{oldSheetContent:t,sheetId:r}=e;for(let a=0;a<t.length;a++){const o=t[a];for(let u=0;u<o.length;u++){const c=o[u],h=simpleCellAddress(r,u,a);this.operations.restoreCell(h,c)}}}undoSetSheetContent(e){const{oldSheetContent:t,sheetId:r}=e;this.operations.clearSheet(r);for(let a=0;a<t.length;a++){const o=t[a];for(let u=0;u<o.length;u++){const c=o[u],h=simpleCellAddress(r,u,a);this.operations.restoreCell(h,c)}}}undoAddNamedExpression(e){this.operations.removeNamedExpression(e.name,e.scope)}undoRemoveNamedExpression(e){this.operations.restoreNamedExpression(e.namedExpression,e.content,e.scope)}undoChangeNamedExpression(e){this.operations.restoreNamedExpression(e.namedExpression,e.oldContent,e.scope)}undoSetRowOrder(e){this.restoreOperationOldContent(e.oldContent)}undoSetColumnOrder(e){this.restoreOperationOldContent(e.oldContent)}redo(){const e=this.redoStack.pop();if(!e)throw Error("Attempted to redo without operation on stack");this.redoEntry(e),this.undoStack.push(e)}redoBatch(e){for(const t of e.operations)this.redoEntry(t)}redoRemoveRows(e){this.operations.removeRows(e.command)}redoMoveCells(e){this.operations.moveCells(e.sourceLeftCorner,e.width,e.height,e.destinationLeftCorner)}redoRemoveColumns(e){this.operations.removeColumns(e.command)}redoPaste(e){const{targetLeftCorner:t,newContent:r}=e,a=r.length,o=r[0].length;for(let u=0;u<a;++u)for(let c=0;c<o;++c){const h=simpleCellAddress(t.sheet,t.col+c,t.row+u);this.operations.restoreCell(h,r[u][c])}}redoSetCellContents(e){for(const t of e.cellContents)this.operations.setCellContent(t.address,t.newContent)}redoAddRows(e){this.operations.addRows(e.command)}redoAddColumns(e){this.operations.addColumns(e.command)}redoRemoveSheet(e){this.operations.removeSheetByName(e.sheetName)}redoAddSheet(e){this.operations.addSheet(e.sheetName)}redoRenameSheet(e){this.operations.renameSheet(e.sheetId,e.newName)}redoMoveRows(e){this.operations.moveRows(e.sheet,e.startRow,e.numberOfRows,e.targetRow)}redoMoveColumns(e){this.operations.moveColumns(e.sheet,e.startColumn,e.numberOfColumns,e.targetColumn)}redoClearSheet(e){this.operations.clearSheet(e.sheetId)}redoSetSheetContent(e){const{sheetId:t,newSheetContent:r}=e;this.operations.setSheetContent(t,r)}redoAddNamedExpression(e){this.operations.addNamedExpression(e.name,e.newContent,e.scope,e.options)}redoRemoveNamedExpression(e){this.operations.removeNamedExpression(e.namedExpression.displayName,e.scope)}redoChangeNamedExpression(e){this.operations.changeNamedExpressionExpression(e.namedExpression.displayName,e.newContent,e.scope,e.options)}redoSetRowOrder(e){this.operations.setRowOrder(e.sheetId,e.rowMapping)}redoSetColumnOrder(e){this.operations.setColumnOrder(e.sheetId,e.columnMapping)}addUndoEntry(e){this.undoStack.push(e),this.undoStack.splice(0,Math.max(0,this.undoStack.length-this.undoLimit))}undoEntry(e){e.doUndo(this)}restoreOperationOldContent(e){for(const[t,r]of e)this.operations.restoreCell(t,r)}redoEntry(e){e.doRedo(this)}restoreOldDataFromVersion(e){const t=this.oldData.get(e)||[];for(const r of t){const[a,o]=r;this.operations.setFormulaToCellFromCache(o,a)}}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class CrudOperations{constructor(e,t,r,a,o,u,c,h,d,p){this.operations=t,this.undoRedo=r,this.clipboardOperations=a,this.dependencyGraph=o,this.columnSearch=u,this.parser=c,this.cellContentParser=h,this.lazilyTransformingAstService=d,this.namedExpressions=p,this.maxRows=e.maxRows,this.maxColumns=e.maxColumns}get sheetMapping(){return this.dependencyGraph.sheetMapping}addRows(e,...t){const r=new AddRowsCommand(e,t);this.ensureItIsPossibleToAddRows(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addRows(r),this.undoRedo.saveOperation(new AddRowsUndoEntry(r))}removeRows(e,...t){const r=new RemoveRowsCommand(e,t);this.ensureItIsPossibleToRemoveRows(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const a=this.operations.removeRows(r);this.undoRedo.saveOperation(new RemoveRowsUndoEntry(r,a))}addColumns(e,...t){const r=new AddColumnsCommand(e,t);this.ensureItIsPossibleToAddColumns(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addColumns(r),this.undoRedo.saveOperation(new AddColumnsUndoEntry(r))}removeColumns(e,...t){const r=new RemoveColumnsCommand(e,t);this.ensureItIsPossibleToRemoveColumns(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const a=this.operations.removeColumns(r);this.undoRedo.saveOperation(new RemoveColumnsUndoEntry(r,a))}moveCells(e,t,r,a){this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const{version:o,overwrittenCellsData:u,addedGlobalNamedExpressions:c}=this.operations.moveCells(e,t,r,a);this.undoRedo.saveOperation(new MoveCellsUndoEntry(e,t,r,a,u,c,o))}moveRows(e,t,r,a){this.ensureItIsPossibleToMoveRows(e,t,r,a),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const o=this.operations.moveRows(e,t,r,a);this.undoRedo.saveOperation(new MoveRowsUndoEntry(e,t,r,a,o))}moveColumns(e,t,r,a){this.ensureItIsPossibleToMoveColumns(e,t,r,a),this.undoRedo.clearRedoStack();const o=this.operations.moveColumns(e,t,r,a);this.undoRedo.saveOperation(new MoveColumnsUndoEntry(e,t,r,a,o))}cut(e,t,r){this.clipboardOperations.cut(e,t,r)}ensureItIsPossibleToCopy(e,t,r){if(!isPositiveInteger(t))throw new InvalidArgumentsError("width to be positive integer.");if(!isPositiveInteger(r))throw new InvalidArgumentsError("height to be positive integer.")}copy(e,t,r){this.ensureItIsPossibleToCopy(e,t,r),this.clipboardOperations.copy(e,t,r)}paste(e){const t=this.clipboardOperations.clipboard;if(t===void 0)throw new NothingToPasteError;if(this.clipboardOperations.isCutClipboard())this.moveCells(t.sourceLeftCorner,t.width,t.height,e);else if(this.clipboardOperations.isCopyClipboard()){this.clipboardOperations.ensureItIsPossibleToCopyPaste(e);const r=AbsoluteCellRange.spanFrom(e,t.width,t.height),a=this.operations.getRangeClipboardCells(r);this.undoRedo.clearRedoStack();const o=this.operations.restoreClipboardCells(t.sourceLeftCorner.sheet,t.getContent(e));this.undoRedo.saveOperation(new PasteUndoEntry(e,a,t.content,o))}}beginUndoRedoBatchMode(){this.undoRedo.beginBatchMode()}commitUndoRedoBatchMode(){this.undoRedo.commitBatchMode()}isClipboardEmpty(){return this.clipboardOperations.clipboard===void 0}clearClipboard(){this.clipboardOperations.clear()}addSheet(e){e!==void 0&&this.ensureItIsPossibleToAddSheet(e),this.undoRedo.clearRedoStack();const t=this.operations.addSheet(e);return this.undoRedo.saveOperation(new AddSheetUndoEntry(t)),t}removeSheet(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const t=this.sheetMapping.fetchDisplayName(e),r=this.operations.getSheetClipboardCells(e),{version:a,scopedNamedExpressions:o}=this.operations.removeSheet(e);this.undoRedo.saveOperation(new RemoveSheetUndoEntry(t,e,r,o,a))}renameSheet(e,t){this.ensureItIsPossibleToRenameSheet(e,t);const r=this.operations.renameSheet(e,t);return r!==void 0&&(this.undoRedo.clearRedoStack(),this.undoRedo.saveOperation(new RenameSheetUndoEntry(e,r,t))),r}clearSheet(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const t=this.operations.getSheetClipboardCells(e);this.operations.clearSheet(e),this.undoRedo.saveOperation(new ClearSheetUndoEntry(e,t))}setCellContents(e,t){if(!(t instanceof Array))t=[[t]];else for(let a=0;a<t.length;a++)if(!(t[a]instanceof Array))throw new InvalidArgumentsError("an array of arrays or a raw cell value.");this.ensureItIsPossibleToChangeCellContents(e,t),this.undoRedo.clearRedoStack();const r=[];for(let a=0;a<t.length;a++)for(let o=0;o<t[a].length;o++){const u={sheet:e.sheet,row:e.row+a,col:e.col+o},c=t[a][o];this.clipboardOperations.abortCut();const h=this.operations.setCellContent(u,c);r.push({address:u,newContent:c,oldContent:h})}this.undoRedo.saveOperation(new SetCellContentsUndoEntry(r))}setSheetContent(e,t){this.ensureScopeIdIsValid(e),this.ensureItIsPossibleToChangeSheetContents(e,t),validateAsSheet(t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.getSheetClipboardCells(e);this.operations.setSheetContent(e,t),this.undoRedo.saveOperation(new SetSheetContentUndoEntry(e,r,t))}setRowOrder(e,t){this.validateSwapRowIndexes(e,t),this.testRowOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.setRowOrder(e,t);this.undoRedo.saveOperation(new SetRowOrderUndoEntry(e,t,r))}validateSwapRowIndexes(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);this.validateRowOrColumnMapping(e,t,"row")}testColumnOrderForArrays(e,t){for(const[r,a]of t)if(r!==a){const o=AbsoluteCellRange.spanFrom({sheet:e,col:r,row:0},1,1/0);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(o))throw new SourceLocationHasArrayError}}setColumnOrder(e,t){this.validateSwapColumnIndexes(e,t),this.testColumnOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.setColumnOrder(e,t);this.undoRedo.saveOperation(new SetColumnOrderUndoEntry(e,t,r))}validateSwapColumnIndexes(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);this.validateRowOrColumnMapping(e,t,"column")}testRowOrderForArrays(e,t){for(const[r,a]of t)if(r!==a){const o=AbsoluteCellRange.spanFrom({sheet:e,col:0,row:r},1/0,1);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(o))throw new SourceLocationHasArrayError}}mappingFromOrder(e,t,r){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);const a=r==="row"?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e);if(t.length!==a)throw new InvalidArgumentsError(`number of ${r}s provided to be sheet ${r==="row"?"height":"width"}.`);const o=[];for(let u=0;u<a;u++)t[u]!==u&&o.push([u,t[u]]);return o}undo(){if(this.undoRedo.isUndoStackEmpty())throw new NoOperationToUndoError;this.clipboardOperations.abortCut(),this.undoRedo.undo()}redo(){if(this.undoRedo.isRedoStackEmpty())throw new NoOperationToRedoError;this.clipboardOperations.abortCut(),this.undoRedo.redo()}addNamedExpression(e,t,r,a){this.ensureItIsPossibleToAddNamedExpression(e,t,r),this.operations.addNamedExpression(e,t,r,a),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new AddNamedExpressionUndoEntry(e,t,r,a))}changeNamedExpressionExpression(e,t,r,a){this.ensureItIsPossibleToChangeNamedExpression(e,r,t);const[o,u]=this.operations.changeNamedExpressionExpression(e,r,t,a);this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new ChangeNamedExpressionUndoEntry(o,r,u,t,a))}removeNamedExpression(e,t){this.ensureScopeIdIsValid(t);const[r,a]=this.operations.removeNamedExpression(e,t);return this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new RemoveNamedExpressionUndoEntry(r,a,t)),r}ensureItIsPossibleToAddNamedExpression(e,t,r){this.ensureScopeIdIsValid(r),this.ensureNamedExpressionNameIsValid(e,r),this.ensureNamedExpressionIsValid(t)}ensureItIsPossibleToChangeNamedExpression(e,t,r){if(this.ensureScopeIdIsValid(r),this.namedExpressions.namedExpressionForScope(e,r)===void 0)throw new NamedExpressionDoesNotExistError(e);this.ensureNamedExpressionIsValid(t)}isItPossibleToRemoveNamedExpression(e,t){if(this.ensureScopeIdIsValid(t),this.namedExpressions.namedExpressionForScope(e,t)===void 0)throw new NamedExpressionDoesNotExistError(e)}ensureItIsPossibleToAddRows(e,...t){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);const r=this.dependencyGraph.getSheetHeight(e),a=t.map(o=>o[1]).reduce((o,u)=>o+u,0);if(r+a>this.maxRows)throw new SheetSizeLimitExceededError;for(const[o,u]of t)if(!isNonnegativeInteger(o)||!isPositiveInteger(u))throw new InvalidArgumentsError("row number to be nonnegative and number of rows to add to be positive.")}ensureItIsPossibleToRemoveRows(e,...t){for(const[r,a]of t){const o=r+a-1;if(!isNonnegativeInteger(r)||!isNonnegativeInteger(o))throw new InvalidArgumentsError("starting and ending row to be nonnegative.");if(o<r)throw new InvalidArgumentsError("starting row to be smaller than the ending row.");if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e)}}ensureItIsPossibleToAddColumns(e,...t){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);const r=this.dependencyGraph.getSheetWidth(e),a=t.map(o=>o[1]).reduce((o,u)=>o+u,0);if(r+a>this.maxColumns)throw new SheetSizeLimitExceededError;for(const[o,u]of t)if(!isNonnegativeInteger(o)||!isPositiveInteger(u))throw new InvalidArgumentsError("column number to be nonnegative and number of columns to add to be positive.")}ensureItIsPossibleToRemoveColumns(e,...t){for(const[r,a]of t){const o=r+a-1;if(!isNonnegativeInteger(r)||!isNonnegativeInteger(o))throw new InvalidArgumentsError("starting and ending column to be nonnegative.");if(o<r)throw new InvalidArgumentsError("starting column to be smaller than the ending column.");if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e)}}ensureItIsPossibleToMoveRows(e,t,r,a){this.ensureItIsPossibleToAddRows(e,[a,r]);const o=simpleCellAddress(e,0,t),u=simpleCellAddress(e,0,a);if(!this.sheetMapping.hasSheetWithId(e)||invalidSimpleCellAddress(o)||invalidSimpleCellAddress(u)||!isPositiveInteger(r)||a<=t+r&&a>=t)throw new InvalidArgumentsError("a valid range of rows to move.");const c=this.dependencyGraph.getSheetWidth(e),h=AbsoluteCellRange.spanFrom(o,c,r);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(h))throw new SourceLocationHasArrayError;if(a>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllRows(RowsSpan.fromNumberOfRows(e,a-1,2)))throw new TargetLocationHasArrayError}ensureItIsPossibleToMoveColumns(e,t,r,a){this.ensureItIsPossibleToAddColumns(e,[a,r]);const o=simpleCellAddress(e,t,0),u=simpleCellAddress(e,a,0);if(!this.sheetMapping.hasSheetWithId(e)||invalidSimpleCellAddress(o)||invalidSimpleCellAddress(u)||!isPositiveInteger(r)||a<=t+r&&a>=t)throw new InvalidArgumentsError("a valid range of columns to move.");const c=this.dependencyGraph.getSheetHeight(e),h=AbsoluteCellRange.spanFrom(o,r,c);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(h))throw new SourceLocationHasArrayError;if(a>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllColumns(ColumnsSpan.fromNumberOfColumns(e,a-1,2)))throw new TargetLocationHasArrayError}ensureItIsPossibleToAddSheet(e){if(this.sheetMapping.hasSheetWithName(e))throw new SheetNameAlreadyTakenError(e)}ensureItIsPossibleToRenameSheet(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);const r=this.sheetMapping.get(t);if(r!==void 0&&r!==e)throw new SheetNameAlreadyTakenError(t)}ensureItIsPossibleToChangeContent(e){if(invalidSimpleCellAddress(e))throw new InvalidAddressError(e);if(!this.sheetMapping.hasSheetWithId(e.sheet))throw new NoSheetWithIdError(e.sheet)}ensureItIsPossibleToChangeCellContents(e,t){const r=findBoundaries(t),a=AbsoluteCellRange.spanFrom(e,r.width,r.height);this.ensureRangeInSizeLimits(a);for(const o of a.addresses(this.dependencyGraph))this.ensureItIsPossibleToChangeContent(o)}ensureItIsPossibleToChangeSheetContents(e,t){const r=findBoundaries(t),a=AbsoluteCellRange.spanFrom(simpleCellAddress(e,0,0),r.width,r.height);this.ensureRangeInSizeLimits(a)}ensureRangeInSizeLimits(e){if(e.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new SheetSizeLimitExceededError}isThereSomethingToUndo(){return!this.undoRedo.isUndoStackEmpty()}isThereSomethingToRedo(){return!this.undoRedo.isRedoStackEmpty()}getAndClearContentChanges(){return this.operations.getAndClearContentChanges()}ensureScopeIdIsValid(e){if(e!==void 0&&!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e)}validateRowOrColumnMapping(e,t,r){const a=r==="row"?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e),o=t.map(([c,h])=>c).sort((c,h)=>c-h),u=t.map(([c,h])=>h).sort((c,h)=>c-h);for(let c=0;c<o.length;c++){if(!isNonnegativeInteger(o[c])||o[c]>=a)throw new InvalidArgumentsError(`${r} numbers to be nonnegative integers and less than sheet ${r==="row"?"height":"width"}.`);if(o[c]===o[c+1])throw new InvalidArgumentsError(`source ${r} numbers to be unique.`);if(o[c]!==u[c])throw new InvalidArgumentsError(`target ${r} numbers to be permutation of source ${r} numbers.`)}}ensureNamedExpressionNameIsValid(e,t){if(!this.namedExpressions.isNameValid(e))throw new NamedExpressionNameIsInvalidError(e);if(!this.namedExpressions.isNameAvailable(e,t))throw new NamedExpressionNameIsAlreadyTakenError(e)}ensureNamedExpressionIsValid(e){const t=this.cellContentParser.parse(e);if(t instanceof CellContent.Formula){const r=this.parser.parse(t.formula,simpleCellAddress(-1,0,0));if(doesContainRelativeReferences(r.ast))throw new NoRelativeAddressesAllowedError}}}function isPositiveInteger(i){return Number.isInteger(i)&&i>0}function isNonnegativeInteger(i){return Number.isInteger(i)&&i>=0}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class Evaluator{constructor(e,t,r,a,o,u){this.config=e,this.stats=t,this.interpreter=r,this.lazilyTransformingAstService=a,this.dependencyGraph=o,this.columnSearch=u}run(){this.stats.start(StatType.TOP_SORT);const{sorted:e,cycled:t}=this.dependencyGraph.topSortWithScc();this.stats.end(StatType.TOP_SORT),this.stats.measure(StatType.EVALUATION,()=>{this.recomputeFormulas(t,e)})}partialRun(e){const t=ContentChanges.empty();return this.stats.measure(StatType.EVALUATION,()=>{this.dependencyGraph.graph.getTopSortedWithSccSubgraphFrom(e,r=>{if(r instanceof FormulaVertex){const a=r.isComputed()?r.getCellValue():void 0,o=this.recomputeFormulaVertexValue(r);if(o!==a){const u=r.getAddress(this.lazilyTransformingAstService);return t.addChange(o,u),this.columnSearch.change(getRawValue(a),getRawValue(o),u),!0}return!1}else return r instanceof RangeVertex&&r.clearCache(),!0},r=>{if(r instanceof RangeVertex)r.clearCache();else if(r instanceof FormulaVertex){const a=r.getAddress(this.lazilyTransformingAstService);this.columnSearch.remove(getRawValue(r.valueOrUndef()),a);const o=new CellError(ErrorType.CYCLE,void 0,r);r.setCellValue(o),t.addChange(o,a)}})}),t}runAndForget(e,t,r){const a=[];for(const u of absolutizeDependencies(r,t))if(u instanceof AbsoluteCellRange){const c=u;if(this.dependencyGraph.getRange(c.start,c.end)===void 0){const h=new RangeVertex(c);this.dependencyGraph.rangeMapping.setRange(h),a.push(h)}}const o=this.evaluateAstToCellValue(e,new InterpreterState(t,this.config.useArrayArithmetic));return a.forEach(u=>{this.dependencyGraph.rangeMapping.removeRange(u)}),o}recomputeFormulas(e,t){e.forEach(r=>{r instanceof FormulaVertex&&r.setCellValue(new CellError(ErrorType.CYCLE,void 0,r))}),t.forEach(r=>{if(r instanceof FormulaVertex){const a=this.recomputeFormulaVertexValue(r),o=r.getAddress(this.lazilyTransformingAstService);this.columnSearch.add(getRawValue(a),o)}else r instanceof RangeVertex&&r.clearCache()})}recomputeFormulaVertexValue(e){const t=e.getAddress(this.lazilyTransformingAstService);if(e instanceof ArrayVertex&&(e.array.size.isRef||!this.dependencyGraph.isThereSpaceForArray(e)))return e.setNoSpace();{const r=e.getFormula(this.lazilyTransformingAstService),a=this.evaluateAstToCellValue(r,new InterpreterState(t,this.config.useArrayArithmetic,e));return e.setCellValue(a)}}evaluateAstToCellValue(e,t){const r=this.interpreter.evaluateAst(e,t);return r instanceof SimpleRangeValue?r:r===EmptyValue&&this.config.evaluateNullToZero?0:r}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ExportedCellChange{constructor(e,t){this.address=e,this.newValue=t}get col(){return this.address.col}get row(){return this.address.row}get sheet(){return this.address.sheet}get value(){return this.newValue}}class ExportedNamedExpressionChange{constructor(e,t){this.name=e,this.newValue=t}}class Exporter{constructor(e,t,r,a){this.config=e,this.namedExpressions=t,this.sheetIndexMapping=r,this.lazilyTransformingService=a}exportChange(e){const t=e.value,r=e.address;if(r.sheet===NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS){const a=this.namedExpressions.namedExpressionInAddress(r.row);if(!a)throw new Error("Missing named expression");return new ExportedNamedExpressionChange(a.displayName,this.exportScalarOrRange(t))}else if(t instanceof SimpleRangeValue){const a=[];for(const[o,u]of t.entriesFromTopLeftCorner(r))a.push(new ExportedCellChange(u,this.exportValue(o)));return a}else return new ExportedCellChange(r,this.exportValue(t))}exportValue(e){return e instanceof SimpleRangeValue?this.detailedError(new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)):this.config.smartRounding&&isExtendedNumber(e)?this.cellValueRounding(getRawValue(e)):e instanceof CellError?this.detailedError(e):e===EmptyValue?null:getRawValue(e)}exportScalarOrRange(e){return e instanceof SimpleRangeValue?e.rawData().map(t=>t.map(r=>this.exportValue(r))):this.exportValue(e)}detailedError(e){var t,r;let a;const o=(t=e.root)===null||t===void 0?void 0:t.getAddress(this.lazilyTransformingService);return o!==void 0&&(o.sheet===NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS?a=(r=this.namedExpressions.namedExpressionInAddress(o.row))===null||r===void 0?void 0:r.displayName:a=simpleCellAddressToString(this.sheetIndexMapping,o,-1)),new DetailedCellError(e,this.config.translationPackage.getErrorTranslation(e.type),a)}cellValueRounding(e){if(e===0)return e;const t=Math.floor(Math.log10(Math.abs(e))),r=Math.pow(10,this.config.precisionRounding-t);return e<0?-Math.round(-e*r)/r:Math.round(e*r)/r}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class GraphBuilder{constructor(e,t,r,a,o,u){this.dependencyGraph=e,this.columnSearch=t,this.parser=r,this.cellContentParser=a,this.stats=o,this.arraySizePredictor=u,this.buildStrategy=new SimpleStrategy(e,t,r,o,a,u)}buildGraph(e,t){const r=t.measure(StatType.COLLECT_DEPENDENCIES,()=>this.buildStrategy.run(e));this.dependencyGraph.getAndClearContentChanges(),t.measure(StatType.PROCESS_DEPENDENCIES,()=>this.processDependencies(r))}processDependencies(e){e.forEach((t,r)=>{this.dependencyGraph.processCellDependencies(t,r)})}}class SimpleStrategy{constructor(e,t,r,a,o,u){this.dependencyGraph=e,this.columnIndex=t,this.parser=r,this.stats=a,this.cellContentParser=o,this.arraySizePredictor=u}run(e){const t=new Map;for(const r in e){const a=this.dependencyGraph.getSheetId(r),o=e[r];for(let u=0;u<o.length;++u){const c=o[u];for(let h=0;h<c.length;++h){const d=c[h],p=simpleCellAddress(a,h,u),m=this.cellContentParser.parse(d);if(m instanceof CellContent.Formula){const f=this.stats.measure(StatType.PARSER,()=>this.parser.parse(m.formula,p));if(f.errors.length>0){this.shrinkArrayIfNeeded(p);const g=new ParsingErrorVertex(f.errors,m.formula);this.dependencyGraph.addVertex(p,g)}else{this.shrinkArrayIfNeeded(p);const g=this.arraySizePredictor.checkArraySize(f.ast,p);if(g.isScalar()){const y=new FormulaCellVertex(f.ast,p,0);t.set(y,absolutizeDependencies(f.dependencies,p)),this.dependencyGraph.addVertex(p,y),f.hasVolatileFunction&&this.dependencyGraph.markAsVolatile(y),f.hasStructuralChangeFunction&&this.dependencyGraph.markAsDependentOnStructureChange(y)}else{const y=new ArrayVertex(f.ast,p,new ArraySize(g.width,g.height));t.set(y,absolutizeDependencies(f.dependencies,p)),this.dependencyGraph.addArrayVertex(p,y)}}}else if(!(m instanceof CellContent.Empty)){this.shrinkArrayIfNeeded(p);const f=new ValueCellVertex(m.value,d);this.columnIndex.add(getRawValue(m.value),p),this.dependencyGraph.addVertex(p,f)}}}}return t}shrinkArrayIfNeeded(e){const t=this.dependencyGraph.getCell(e);t instanceof ArrayVertex&&this.dependencyGraph.shrinkArrayToCorner(t)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const LICENSE_STATUS_MAP=new Map([["gpl-v3",1],["missing",2],["invalid",3],["expired",4]]);class VersionPlugin extends FunctionPlugin{version(e,t){return this.runFunction(e.args,t,this.metadata("VERSION"),()=>{const{licenseKeyValidityState:r,licenseKey:a}=this.config;let o;return LICENSE_STATUS_MAP.has(a)?o=LICENSE_STATUS_MAP.get(a):LICENSE_STATUS_MAP.has(r)?o=LICENSE_STATUS_MAP.get(r):r==="valid"&&(o=a.slice(-5)),`HyperFormula v${HyperFormula.version}, ${o}`})}}VersionPlugin.implementedFunctions={VERSION:{method:"version",parameters:[]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */function validateAndReturnMetadataFromName(i,e){var t;let r=e.implementedFunctions[i];const a=(t=e.aliases)===null||t===void 0?void 0:t[i];if(a!==void 0){if(r!==void 0)throw new AliasAlreadyExisting(i,e.name);r=e.implementedFunctions[a]}if(r===void 0)throw FunctionPluginValidationError.functionNotDeclaredInPlugin(i,e.name);return r}class FunctionRegistry{constructor(e){if(this.config=e,this.functions=new Map,this.arraySizeFunctions=new Map,this.volatileFunctions=new Set,this.arrayFunctions=new Set,this.structuralChangeFunctions=new Set,this.functionsWhichDoesNotNeedArgumentsToBeComputed=new Set,this.functionsMetadata=new Map,this.doesFunctionNeedArgumentToBeComputed=t=>this.functionsWhichDoesNotNeedArgumentsToBeComputed.has(t),this.isFunctionVolatile=t=>this.volatileFunctions.has(t),this.isArrayFunction=t=>this.arrayFunctions.has(t),this.isFunctionDependentOnSheetStructureChange=t=>this.structuralChangeFunctions.has(t),e.functionPlugins.length>0){this.instancePlugins=new Map;for(const t of e.functionPlugins)FunctionRegistry.loadPluginFunctions(t,this.instancePlugins)}else this.instancePlugins=new Map(FunctionRegistry.plugins);for(const[t,r]of FunctionRegistry.protectedFunctions())FunctionRegistry.loadFunctionUnprotected(r,t,this.instancePlugins);for(const[t,r]of this.instancePlugins.entries())this.categorizeFunction(t,validateAndReturnMetadataFromName(t,r))}static registerFunctionPlugin(e,t){this.loadPluginFunctions(e,this.plugins),t!==void 0&&this.loadTranslations(t)}static registerFunction(e,t,r){this.loadPluginFunction(t,e,this.plugins),r!==void 0&&this.loadTranslations(r)}static unregisterFunction(e){if(this.functionIsProtected(e))throw ProtectedFunctionError.cannotUnregisterFunctionWithId(e);this.plugins.delete(e)}static unregisterFunctionPlugin(e){for(const t of this.protectedPlugins())if(t===e)throw ProtectedFunctionError.cannotUnregisterProtectedPlugin();for(const[t,r]of this.plugins.entries())r===e&&this.plugins.delete(t)}static unregisterAll(){this.plugins.clear()}static getRegisteredFunctionIds(){return[...Array.from(this.plugins.keys()),...Array.from(this._protectedPlugins.keys())]}static getPlugins(){return Array.from(new Set(this.plugins.values()).values())}static getFunctionPlugin(e){if(!this.functionIsProtected(e))return this.plugins.get(e)}static functionIsProtected(e){return this._protectedPlugins.has(e)}static loadTranslations(e){const t=new Set(HyperFormula.getRegisteredLanguagesCodes());Object.keys(e).forEach(r=>{t.has(r)&&HyperFormula.getLanguage(r).extendFunctions(e[r])})}static loadPluginFunctions(e,t){Object.keys(e.implementedFunctions).forEach(r=>{this.loadPluginFunction(e,r,t)}),e.aliases!==void 0&&Object.keys(e.aliases).forEach(r=>{this.loadPluginFunction(e,r,t)})}static loadPluginFunction(e,t,r){if(this.functionIsProtected(t))throw ProtectedFunctionError.cannotRegisterFunctionWithId(t);this.loadFunctionUnprotected(e,t,r)}static loadFunctionUnprotected(e,t,r){const a=validateAndReturnMetadataFromName(t,e).method;if(Object.prototype.hasOwnProperty.call(e.prototype,a))r.set(t,e);else throw FunctionPluginValidationError.functionMethodNotFound(a,e.name)}static*protectedFunctions(){for(const[e,t]of this._protectedPlugins)t!==void 0&&(yield[e,t])}static*protectedPlugins(){for(const[,e]of this._protectedPlugins)e!==void 0&&(yield e)}initializePlugins(e){const t=[];for(const[r,a]of this.instancePlugins.entries()){let o=t.find(d=>d instanceof a);o===void 0&&(o=new a(e),t.push(o));const u=validateAndReturnMetadataFromName(r,a),c=u.method;this.functions.set(r,[c,o]);const h=u.arraySizeMethod;h!==void 0&&this.arraySizeFunctions.set(r,[h,o])}}getFunctionPlugin(e){if(!FunctionRegistry.functionIsProtected(e))return this.instancePlugins.get(e)}getFunction(e){const t=this.functions.get(e);if(t!==void 0&&this.config.translationPackage.isFunctionTranslated(e)){const[r,a]=t;return(o,u)=>a[r](o,u)}else return}getArraySizeFunction(e){const t=this.arraySizeFunctions.get(e);if(t!==void 0&&this.config.translationPackage.isFunctionTranslated(e)){const[r,a]=t;return(o,u)=>a[r](o,u)}else return}getMetadata(e){return this.functionsMetadata.get(e)}getPlugins(){const e=new Set;for(const[t,r]of this.instancePlugins)FunctionRegistry.functionIsProtected(t)||e.add(r);return Array.from(e)}getRegisteredFunctionIds(){return Array.from(this.functions.keys())}categorizeFunction(e,t){t.isVolatile&&this.volatileFunctions.add(e),t.arrayFunction&&this.arrayFunctions.add(e),t.doesNotNeedArgumentsToBeComputed&&this.functionsWhichDoesNotNeedArgumentsToBeComputed.add(e),t.isDependentOnSheetStructureChange&&this.structuralChangeFunctions.add(e),this.functionsMetadata.set(e,t)}}FunctionRegistry.plugins=new Map;FunctionRegistry._protectedPlugins=new Map([["VERSION",VersionPlugin],["OFFSET",void 0]]);/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */var CriterionType;(function(i){i.GREATER_THAN="GREATER_THAN",i.GREATER_THAN_OR_EQUAL="GREATER_THAN_OR_EQUAL",i.LESS_THAN="LESS_THAN",i.LESS_THAN_OR_EQUAL="LESS_THAN_OR_EQUAL",i.NOT_EQUAL="NOT_EQUAL",i.EQUAL="EQUAL"})(CriterionType||(CriterionType={}));const buildCriterion=(i,e)=>({operator:i,value:e});class CriterionBuilder{constructor(e){var t,r,a,o;this.trueString=(r=(t=e.translationPackage.getMaybeFunctionTranslation("TRUE"))===null||t===void 0?void 0:t.toLowerCase())!==null&&r!==void 0?r:"true",this.falseString=(o=(a=e.translationPackage.getMaybeFunctionTranslation("FALSE"))===null||a===void 0?void 0:a.toLowerCase())!==null&&o!==void 0?o:"false"}fromCellValue(e,t){if(typeof e!="string"&&typeof e!="boolean"&&typeof e!="number")return;const r=this.parseCriterion(e,t);if(r!==void 0)return{raw:e,lambda:buildCriterionLambda(r,t)}}parseCriterion(e,t){if(typeof e=="number"||typeof e=="boolean")return buildCriterion(CriterionType.EQUAL,e);if(typeof e=="string"){const r=ANY_CRITERION_REGEX.exec(e);let a,o;r?(o=StrToCriterionType(r[1]),a=r[2]):(o=CriterionType.EQUAL,a=e);const u=t.coerceToMaybeNumber(a),c=a.toLowerCase()===this.trueString?!0:a.toLowerCase()===this.falseString?!1:void 0;if(o===void 0)return;if(a==="")return buildCriterion(o,null);if(u===void 0){if(o===CriterionType.EQUAL||o===CriterionType.NOT_EQUAL)return buildCriterion(o,c??a)}else return buildCriterion(o,getRawValue(u))}}}const ANY_CRITERION_REGEX=/([<>=]+)(.*)/;function StrToCriterionType(i){switch(i){case">":return CriterionType.GREATER_THAN;case">=":return CriterionType.GREATER_THAN_OR_EQUAL;case"<":return CriterionType.LESS_THAN;case"<=":return CriterionType.LESS_THAN_OR_EQUAL;case"<>":return CriterionType.NOT_EQUAL;case"=":return CriterionType.EQUAL;default:return}}const buildCriterionLambda=(i,e)=>{switch(i.operator){case CriterionType.GREATER_THAN:return typeof i.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,i.value)>0:t=>!1;case CriterionType.GREATER_THAN_OR_EQUAL:return typeof i.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,i.value)>=0:t=>!1;case CriterionType.LESS_THAN:return typeof i.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,i.value)<0:t=>!1;case CriterionType.LESS_THAN_OR_EQUAL:return typeof i.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,i.value)<=0:t=>!1;case CriterionType.EQUAL:return typeof i.value=="number"?t=>{if(typeof t=="number")return e.floatCmp(t,i.value)===0;if(typeof t=="string"){if(t==="")return!1;const r=e.coerceToMaybeNumber(t);return r===void 0?!1:e.floatCmp(r,i.value)===0}else return!1}:typeof i.value=="string"?e.eqMatcherFunction(i.value):typeof i.value=="boolean"?t=>typeof t=="boolean"&&t===i.value:t=>t===EmptyValue;case CriterionType.NOT_EQUAL:return typeof i.value=="number"?t=>{if(typeof t=="number")return e.floatCmp(t,i.value)!==0;if(typeof t=="string"){if(t==="")return!0;const r=e.coerceToMaybeNumber(t);return r===void 0?!0:e.floatCmp(r,i.value)!==0}else return!0}:typeof i.value=="string"?e.neqMatcherFunction(i.value):typeof i.value=="boolean"?t=>typeof t!="boolean"||t!==i.value:t=>t!==EmptyValue}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class Interpreter{constructor(e,t,r,a,o,u,c,h,d,p){this.config=e,this.dependencyGraph=t,this.columnSearch=r,this.stats=a,this.arithmeticHelper=o,this.functionRegistry=u,this.namedExpressions=c,this.serialization=h,this.arraySizePredictor=d,this.dateTimeHelper=p,this.equalOp=(m,f)=>binaryErrorWrapper(this.arithmeticHelper.eq,m,f),this.notEqualOp=(m,f)=>binaryErrorWrapper(this.arithmeticHelper.neq,m,f),this.greaterThanOp=(m,f)=>binaryErrorWrapper(this.arithmeticHelper.gt,m,f),this.lessThanOp=(m,f)=>binaryErrorWrapper(this.arithmeticHelper.lt,m,f),this.greaterThanOrEqualOp=(m,f)=>binaryErrorWrapper(this.arithmeticHelper.geq,m,f),this.lessThanOrEqualOp=(m,f)=>binaryErrorWrapper(this.arithmeticHelper.leq,m,f),this.concatOp=(m,f)=>binaryErrorWrapper(this.arithmeticHelper.concat,coerceScalarToString(m),coerceScalarToString(f)),this.plusOp=(m,f)=>binaryErrorWrapper(this.arithmeticHelper.addWithEpsilon,this.arithmeticHelper.coerceScalarToNumberOrError(m),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.minusOp=(m,f)=>binaryErrorWrapper(this.arithmeticHelper.subtract,this.arithmeticHelper.coerceScalarToNumberOrError(m),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.timesOp=(m,f)=>binaryErrorWrapper(this.arithmeticHelper.multiply,this.arithmeticHelper.coerceScalarToNumberOrError(m),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.powerOp=(m,f)=>binaryErrorWrapper(this.arithmeticHelper.pow,this.arithmeticHelper.coerceScalarToNumberOrError(m),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.divOp=(m,f)=>binaryErrorWrapper(this.arithmeticHelper.divide,this.arithmeticHelper.coerceScalarToNumberOrError(m),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.unaryMinusOp=m=>unaryErrorWrapper(this.arithmeticHelper.unaryMinus,this.arithmeticHelper.coerceScalarToNumberOrError(m)),this.percentOp=m=>unaryErrorWrapper(this.arithmeticHelper.unaryPercent,this.arithmeticHelper.coerceScalarToNumberOrError(m)),this.unaryPlusOp=m=>this.arithmeticHelper.unaryPlus(m),this.functionRegistry.initializePlugins(this),this.criterionBuilder=new CriterionBuilder(e)}evaluateAst(e,t){let r=this.evaluateAstWithoutPostprocessing(e,t);if(isExtendedNumber(r)){if(isNumberOverflow(getRawValue(r)))return new CellError(ErrorType.NUM,ErrorMessage.NaN);r=cloneNumber(r,fixNegativeZero(getRawValue(r)))}return r instanceof SimpleRangeValue&&r.height()===1&&r.width()===1&&([[r]]=r.data),wrapperForRootVertex(r,t.formulaVertex)}evaluateAstWithoutPostprocessing(e,t){switch(e.type){case AstNodeType.EMPTY:return EmptyValue;case AstNodeType.CELL_REFERENCE:{const r=e.reference.toSimpleCellAddress(t.formulaAddress);return invalidSimpleCellAddress(r)?new CellError(ErrorType.REF,ErrorMessage.BadRef):this.dependencyGraph.getCellValue(r)}case AstNodeType.NUMBER:case AstNodeType.STRING:return e.value;case AstNodeType.CONCATENATE_OP:{const r=this.evaluateAst(e.left,t),a=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.concatOp,r,a,t)}case AstNodeType.EQUALS_OP:{const r=this.evaluateAst(e.left,t),a=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.equalOp,r,a,t)}case AstNodeType.NOT_EQUAL_OP:{const r=this.evaluateAst(e.left,t),a=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.notEqualOp,r,a,t)}case AstNodeType.GREATER_THAN_OP:{const r=this.evaluateAst(e.left,t),a=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOp,r,a,t)}case AstNodeType.LESS_THAN_OP:{const r=this.evaluateAst(e.left,t),a=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOp,r,a,t)}case AstNodeType.GREATER_THAN_OR_EQUAL_OP:{const r=this.evaluateAst(e.left,t),a=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOrEqualOp,r,a,t)}case AstNodeType.LESS_THAN_OR_EQUAL_OP:{const r=this.evaluateAst(e.left,t),a=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOrEqualOp,r,a,t)}case AstNodeType.PLUS_OP:{const r=this.evaluateAst(e.left,t),a=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.plusOp,r,a,t)}case AstNodeType.MINUS_OP:{const r=this.evaluateAst(e.left,t),a=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.minusOp,r,a,t)}case AstNodeType.TIMES_OP:{const r=this.evaluateAst(e.left,t),a=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.timesOp,r,a,t)}case AstNodeType.POWER_OP:{const r=this.evaluateAst(e.left,t),a=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.powerOp,r,a,t)}case AstNodeType.DIV_OP:{const r=this.evaluateAst(e.left,t),a=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.divOp,r,a,t)}case AstNodeType.PLUS_UNARY_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryPlusOp,r,t)}case AstNodeType.MINUS_UNARY_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryMinusOp,r,t)}case AstNodeType.PERCENT_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.percentOp,r,t)}case AstNodeType.FUNCTION_CALL:{if(this.config.licenseKeyValidityState!=="valid"&&!FunctionRegistry.functionIsProtected(e.procedureName))return new CellError(ErrorType.LIC,ErrorMessage.LicenseKey(this.config.licenseKeyValidityState));const r=this.functionRegistry.getFunction(e.procedureName);return r!==void 0?r(e,new InterpreterState(t.formulaAddress,t.arraysFlag||this.functionRegistry.isArrayFunction(e.procedureName),t.formulaVertex)):new CellError(ErrorType.NAME,ErrorMessage.FunctionName(e.procedureName))}case AstNodeType.NAMED_EXPRESSION:{const r=this.namedExpressions.nearestNamedExpression(e.expressionName,t.formulaAddress.sheet);return r?this.dependencyGraph.getCellValue(r.address):new CellError(ErrorType.NAME,ErrorMessage.NamedExpressionName(e.expressionName))}case AstNodeType.CELL_RANGE:{if(!this.rangeSpansOneSheet(e))return new CellError(ErrorType.REF,ErrorMessage.RangeManySheets);const r=AbsoluteCellRange.fromCellRange(e,t.formulaAddress),a=this.dependencyGraph.getArray(r);if(a){const o=a.array;if(o instanceof NotComputedArray)throw new Error("Array should be already computed");if(o instanceof CellError)return o;if(o instanceof ArrayValue)return SimpleRangeValue.fromRange(o.raw(),r,this.dependencyGraph);throw new Error("Unknown array")}else return SimpleRangeValue.onlyRange(r,this.dependencyGraph)}case AstNodeType.COLUMN_RANGE:{if(!this.rangeSpansOneSheet(e))return new CellError(ErrorType.REF,ErrorMessage.RangeManySheets);const r=AbsoluteColumnRange.fromColumnRange(e,t.formulaAddress);return SimpleRangeValue.onlyRange(r,this.dependencyGraph)}case AstNodeType.ROW_RANGE:{if(!this.rangeSpansOneSheet(e))return new CellError(ErrorType.REF,ErrorMessage.RangeManySheets);const r=AbsoluteRowRange.fromRowRangeAst(e,t.formulaAddress);return SimpleRangeValue.onlyRange(r,this.dependencyGraph)}case AstNodeType.PARENTHESIS:return this.evaluateAst(e.expression,t);case AstNodeType.ARRAY:{let r;const a=[];for(const o of e.args){let u;const c=[];for(const d of o){const p=coerceToRange(this.evaluateAst(d,t)),m=p.height();if(u===void 0)u=m,c.push(...p.data);else if(u===m)for(let f=0;f<m;f++)c[f].push(...p.data[f]);else return new CellError(ErrorType.REF,ErrorMessage.SizeMismatch)}const h=c[0].length;if(r===void 0)r=h,a.push(...c);else if(r===h)a.push(...c);else return new CellError(ErrorType.REF,ErrorMessage.SizeMismatch)}return SimpleRangeValue.onlyValues(a)}case AstNodeType.ERROR_WITH_RAW_INPUT:case AstNodeType.ERROR:return e.error}}rangeSpansOneSheet(e){return e.start.sheet===e.end.sheet}unaryRangeWrapper(e,t,r){var a;if(t instanceof SimpleRangeValue&&!r.arraysFlag&&(t=(a=coerceRangeToScalar(t,r))!==null&&a!==void 0?a:new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)),t instanceof CellError)return t;if(t instanceof SimpleRangeValue){const o=t.data.map(u=>u.map(e));return SimpleRangeValue.onlyValues(o)}return e(t)}binaryRangeWrapper(e,t,r,a){var o,u;if(t instanceof SimpleRangeValue&&!a.arraysFlag&&(t=(o=coerceRangeToScalar(t,a))!==null&&o!==void 0?o:new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)),t instanceof CellError)return t;if(r instanceof SimpleRangeValue&&!a.arraysFlag&&(r=(u=coerceRangeToScalar(r,a))!==null&&u!==void 0?u:new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)),r instanceof CellError)return r;if(t instanceof SimpleRangeValue||r instanceof SimpleRangeValue){if(!(t instanceof SimpleRangeValue))if(r.isAdHoc()){const p=r.data;for(let m=0;m<p.length;m++)for(let f=0;f<p[0].length;f++)p[m][f]=e(t,p[m][f]);return SimpleRangeValue.onlyValues(p)}else t=SimpleRangeValue.fromScalar(t);if(!(r instanceof SimpleRangeValue))if(t.isAdHoc()){const p=t.data;for(let m=0;m<p.length;m++)for(let f=0;f<p[0].length;f++)p[m][f]=e(p[m][f],r);return SimpleRangeValue.onlyValues(p)}else r=SimpleRangeValue.fromScalar(r);if(t.width()===r.width()&&t.height()===r.height()){if(t.isAdHoc()){const p=t.data,m=r.data;for(let f=0;f<p.length;f++)for(let g=0;g<p[0].length;g++)p[f][g]=e(p[f][g],m[f][g]);return SimpleRangeValue.onlyValues(p)}if(r.isAdHoc()){const p=t.data,m=r.data;for(let f=0;f<p.length;f++)for(let g=0;g<p[0].length;g++)m[f][g]=e(p[f][g],m[f][g]);return SimpleRangeValue.onlyValues(m)}}const c=Math.max(t.width(),r.width()),h=Math.max(t.height(),r.height()),d=Array(h);for(let p=0;p<h;p++)d[p]=Array(c);for(let p=0;p<h;p++){const m=t.height()!==1?p:0,f=r.height()!==1?p:0;for(let g=0;g<c;g++){const y=t.width()!==1?g:0,T=r.width()!==1?g:0;m<t.height()&&f<r.height()&&y<t.width()&&T<r.width()?d[p][g]=e(t.data[m][y],r.data[f][T]):d[p][g]=new CellError(ErrorType.NA)}}return SimpleRangeValue.onlyValues(d)}return e(t,r)}}function unaryErrorWrapper(i,e){return e instanceof CellError?e:i(e)}function binaryErrorWrapper(i,e,t){return e instanceof CellError?e:t instanceof CellError?t:i(e,t)}function wrapperForRootVertex(i,e){return i instanceof CellError&&e!==void 0?i.attachRootVertex(e):i}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class CombinedTransformer{constructor(e){this.sheet=e,this.transformations=[]}add(e){this.transformations.push(e)}performEagerTransformations(e,t){this.transformations.forEach(r=>r.performEagerTransformations(e,t))}transformSingleAst(e,t){let[r,a]=[e,t];return this.transformations.forEach(o=>{[r,a]=o.transformSingleAst(r,a)}),[r,a]}isIrreversible(){return!0}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class LazilyTransformingAstService{constructor(e){this.stats=e,this.transformations=[]}version(){return this.transformations.length}addTransformation(e){return this.combinedTransformer!==void 0?this.combinedTransformer.add(e):this.transformations.push(e),this.version()}beginCombinedMode(e){this.combinedTransformer=new CombinedTransformer(e)}commitCombinedMode(){if(this.combinedTransformer===void 0)throw Error("Combined mode wasn't started");return this.transformations.push(this.combinedTransformer),this.combinedTransformer=void 0,this.version()}applyTransformations(e,t,r){this.stats.start(StatType.TRANSFORM_ASTS_POSTPONED);for(let o=r;o<this.transformations.length;o++){const u=this.transformations[o];u.isIrreversible()&&(this.undoRedo.storeDataForVersion(o,t,this.parser.computeHashFromAst(e)),this.parser.rememberNewAst(e));const[c,h]=u.transformSingleAst(e,t);e=c,t=h}const a=this.parser.rememberNewAst(e);return this.stats.end(StatType.TRANSFORM_ASTS_POSTPONED),[a,t,this.transformations.length]}*getTransformationsFrom(e,t){for(let r=e;r<this.transformations.length;r++){const a=this.transformations[r];(!t||t(a))&&(yield a)}}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const NOT_FOUND=-1;function findLastOccurrenceInOrderedRange(i,e,{searchCoordinate:t,orderingDirection:r,matchExactly:a},o){const u=e.start[t],c=t==="col"?e.effectiveEndColumn(o):e.effectiveEndRow(o),h=t==="col"?f=>getRawValue(o.getCellValue(simpleCellAddress(e.sheet,f,e.start.row))):f=>getRawValue(o.getCellValue(simpleCellAddress(e.sheet,e.start.col,f))),d=r==="asc"?(f,g)=>compare(f,g):(f,g)=>-compare(f,g),p=findLastMatchingIndex(f=>d(i,h(f))>=0,u,c),m=h(p);return p===NOT_FOUND||typeof m!=typeof i||a&&m!==i?NOT_FOUND:p-u}function findLastMatchingIndex(i,e,t){let r=e,a=t;for(;r<a;){const o=Math.ceil((r+a)/2);i(o)?r=o:a=o-1}return r===a&&i(r)?r:NOT_FOUND}function compare(i,e){return typeof i==typeof e?i===EmptyValue?0:i<e?-1:i>e?1:0:i===EmptyValue?-1:e===EmptyValue?1:e instanceof CellError||typeof i=="number"&&typeof e=="string"||typeof i=="number"&&typeof e=="boolean"?-1:typeof i=="string"&&typeof e=="number"?1:typeof i=="string"&&typeof e=="boolean"?-1:1}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class AdvancedFind{constructor(e){this.dependencyGraph=e}advancedFind(e,t){let r;const a=t.range;a===void 0?r=t.valuesFromTopLeftCorner():r=this.dependencyGraph.computeListOfValuesInRange(a);for(let o=0;o<r.length;o++)if(e(getRawValue(r[o])))return o;return-1}basicFind(e,t,r,{ordering:a,matchExactly:o}){const u=typeof e=="string"?forceNormalizeString(e):e,c=t.range;return c===void 0?this.findNormalizedValue(u,t.valuesFromTopLeftCorner()):a==="none"?this.findNormalizedValue(u,this.dependencyGraph.computeListOfValuesInRange(c)):findLastOccurrenceInOrderedRange(u,c,{searchCoordinate:r,orderingDirection:a,matchExactly:o},this.dependencyGraph)}findNormalizedValue(e,t){return t.map(getRawValue).map(r=>typeof r=="string"?forceNormalizeString(r):r).indexOf(e)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ColumnBinarySearch extends AdvancedFind{constructor(e){super(e),this.dependencyGraph=e}add(e,t){}remove(e,t){}change(e,t,r){}applyChanges(e){}addColumns(e){}removeColumns(e){}removeSheet(e){}moveValues(e,t,r,a){}removeValues(e){}find(e,t,r){return this.basicFind(e,t,"row",r)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ColumnIndex{constructor(e,t,r){this.dependencyGraph=e,this.config=t,this.stats=r,this.index=new Map,this.transformingService=this.dependencyGraph.lazilyTransformingAstService,this.binarySearchStrategy=new ColumnBinarySearch(e)}add(e,t){if(!(e===EmptyValue||e instanceof CellError))if(e instanceof SimpleRangeValue)for(const[r,a]of e.entriesFromTopLeftCorner(t))this.addSingleCellValue(getRawValue(r),a);else this.addSingleCellValue(e,t)}remove(e,t){if(e!==void 0)if(e instanceof SimpleRangeValue)for(const[r,a]of e.entriesFromTopLeftCorner(t))this.removeSingleValue(getRawValue(r),a);else this.removeSingleValue(e,t)}change(e,t,r){e!==t&&(this.remove(e,r),this.add(t,r))}applyChanges(e){for(const t of e)t.oldValue!==void 0&&this.change(getRawValue(t.oldValue),getRawValue(t.value),t.address)}moveValues(e,t,r,a){for(const[o,u]of e){const c=movedSimpleCellAddress(u,a,t,r);this.remove(o,u),this.add(o,c)}}removeValues(e){for(const[t,r]of e)this.remove(t,r)}find(e,t,{ordering:r,matchExactly:a}){const o=a===!0?"findFirst":"findLast",u=this.findUsingColumnIndex(e,t,o);return u!==void 0?u:this.binarySearchStrategy.find(e,t,{ordering:r,matchExactly:a})}findUsingColumnIndex(e,t,r){const a=t.range;if(a===void 0)return;this.ensureRecentData(a.sheet,a.start.col,e);const o=this.getColumnMap(a.sheet,a.start.col);if(!o)return-1;const u=typeof e=="string"?forceNormalizeString(e):e,c=o.get(u);if(!c||!c.index||c.index.length===0)return;const h=ColumnIndex.findRowBelongingToRange(c,a,r);return h!==void 0?h-a.start.row:void 0}static findRowBelongingToRange(e,t,r){const a=t.start.row,o=t.end.row,u=r==="findFirst"?findInOrderedArray(a,e.index,"upperBound"):findInOrderedArray(o,e.index,"lowerBound");if(u===-1)return;const c=e.index[u];return c>=a&&c<=o?c:void 0}advancedFind(e,t){return this.binarySearchStrategy.advancedFind(e,t)}addColumns(e){const t=this.index.get(e.sheet);t&&t.splice(e.columnStart,0,...Array(e.numberOfColumns))}removeColumns(e){const t=this.index.get(e.sheet);t&&t.splice(e.columnStart,e.numberOfColumns)}removeSheet(e){this.index.delete(e)}getColumnMap(e,t){this.index.has(e)||this.index.set(e,[]);const r=this.index.get(e);let a=r[t];return a||(a=new Map,r[t]=a),a}getValueIndex(e,t,r){const a=this.getColumnMap(e,t);let o=this.getColumnMap(e,t).get(r);return o||(o={version:this.transformingService.version(),index:[]},a.set(r,o)),o}ensureRecentData(e,t,r){const a=this.getValueIndex(e,t,r),o=this.transformingService.version();if(a.version===o)return;const u=this.transformingService.getTransformationsFrom(a.version,c=>c.sheet===e&&(c instanceof AddRowsTransformer||c instanceof RemoveRowsTransformer));for(const c of u)c instanceof AddRowsTransformer?this.addRows(t,c.rowsSpan,r):c instanceof RemoveRowsTransformer&&this.removeRows(t,c.rowsSpan,r);a.version=o}addSingleCellValue(e,t){this.stats.measure(StatType.BUILD_COLUMN_INDEX,()=>{this.ensureRecentData(t.sheet,t.col,e),typeof e=="string"&&(e=forceNormalizeString(e));const r=this.getValueIndex(t.sheet,t.col,e);ColumnIndex.addValue(r,t.row)})}removeSingleValue(e,t){this.stats.measure(StatType.BUILD_COLUMN_INDEX,()=>{this.ensureRecentData(t.sheet,t.col,e);const r=this.getColumnMap(t.sheet,t.col);typeof e=="string"&&(e=forceNormalizeString(e));const a=r.get(e);if(!a)return;const o=findInOrderedArray(t.row,a.index);o>-1&&a.index.splice(o,1),a.index.length===0&&r.delete(e),r.size===0&&delete this.index.get(t.sheet)[t.col]})}addRows(e,t,r){const a=this.getValueIndex(t.sheet,e,r);ColumnIndex.shiftRows(a,t.rowStart,t.numberOfRows)}removeRows(e,t,r){const a=this.getValueIndex(t.sheet,e,r);ColumnIndex.removeRowsFromValues(a,t),ColumnIndex.shiftRows(a,t.rowEnd+1,-t.numberOfRows)}static addValue(e,t){const r=findInOrderedArray(t,e.index,"lowerBound");e.index[r]===t||e.index.splice(r+1,0,t)}static removeRowsFromValues(e,t){const r=findInOrderedArray(t.rowStart,e.index,"upperBound"),a=findInOrderedArray(t.rowEnd,e.index,"lowerBound");r>-1&&a>-1&&r<=a&&e.index[r]<=t.rowEnd&&e.index.splice(r,a-r+1)}static shiftRows(e,t,r){const a=findInOrderedArray(t,e.index,"upperBound");if(a!==-1)for(let o=a;o<e.index.length;++o)e.index[o]+=r}}function findInOrderedArray(i,e,t="upperBound"){let r=0,a=e.length-1;for(;r<=a;){const c=Math.floor((r+a)/2);if(i>e[c])r=c+1;else if(i<e[c])a=c-1;else return c}const o=t==="lowerBound"?a:r;return o>=0&&o<=e.length?o:-1}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */function buildColumnSearchStrategy(i,e,t){return e.useColumnIndex?new ColumnIndex(i,e,t):new ColumnBinarySearch(i)}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class NumberLiteralHelper{constructor(e){this.config=e;const t=this.config.thousandSeparator==="."?`\\${this.config.thousandSeparator}`:this.config.thousandSeparator,r=this.config.decimalSeparator==="."?`\\${this.config.decimalSeparator}`:this.config.decimalSeparator;this.numberPattern=new RegExp(`^([+-]?((${r}\\d+)|(\\d+(${t}\\d{3,})*(${r}\\d*)?)))(e[+-]?\\d+)?$`),this.allThousandSeparatorsRegex=new RegExp(`${t}`,"g")}numericStringToMaybeNumber(e){if(this.numberPattern.test(e)){const t=this.numericStringToNumber(e);return isNaN(t)?void 0:t}}numericStringToNumber(e){const t=e.replace(this.allThousandSeparatorsRegex,"").replace(this.config.decimalSeparator,".");return Number(t)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class Serialization{constructor(e,t,r){this.dependencyGraph=e,this.unparser=t,this.exporter=r}getCellHyperlink(e){const t=this.dependencyGraph.getCell(e);if(t instanceof FormulaCellVertex){const r=t.getFormula(this.dependencyGraph.lazilyTransformingAstService);if(r.procedureName==="HYPERLINK")return r.hyperlink}}getCellFormula(e,t){const r=this.dependencyGraph.getCell(e);if(r instanceof FormulaCellVertex){const a=r.getFormula(this.dependencyGraph.lazilyTransformingAstService);return t=t??e,this.unparser.unparse(a,t)}else if(r instanceof ArrayVertex){const a=r.getAddress(this.dependencyGraph.lazilyTransformingAstService);if(a.row!==e.row||a.col!==e.col||a.sheet!==e.sheet)return;t=t??e;const o=r.getFormula(this.dependencyGraph.lazilyTransformingAstService);if(o!==void 0)return this.unparser.unparse(o,t)}else if(r instanceof ParsingErrorVertex)return r.getFormula()}getCellSerialized(e,t){var r;return(r=this.getCellFormula(e,t))!==null&&r!==void 0?r:this.getRawValue(e)}getCellValue(e){return this.exporter.exportValue(this.dependencyGraph.getScalarValue(e))}getRawValue(e){return this.dependencyGraph.getRawValue(e)}getSheetValues(e){return this.genericSheetGetter(e,t=>this.getCellValue(t))}getSheetFormulas(e){return this.genericSheetGetter(e,t=>this.getCellFormula(t))}genericSheetGetter(e,t){const r=this.dependencyGraph.getSheetHeight(e),a=this.dependencyGraph.getSheetWidth(e),o=new Array(r);for(let u=0;u<r;u++){o[u]=new Array(a);for(let c=0;c<a;c++){const h=simpleCellAddress(e,c,u);o[u][c]=t(h)}for(let c=a-1;c>=0&&(o[u][c]===null||o[u][c]===void 0);c--)o[u].pop()}for(let u=r-1;u>=0&&o[u].length===0;u--)o.pop();return o}genericAllSheetsGetter(e){const t={};for(const r of this.dependencyGraph.sheetMapping.displayNames()){const a=this.dependencyGraph.sheetMapping.fetch(r);t[r]=e(a)}return t}getSheetSerialized(e){return this.genericSheetGetter(e,t=>this.getCellSerialized(t))}getAllSheetsValues(){return this.genericAllSheetsGetter(e=>this.getSheetValues(e))}getAllSheetsFormulas(){return this.genericAllSheetsGetter(e=>this.getSheetFormulas(e))}getAllSheetsSerialized(){return this.genericAllSheetsGetter(e=>this.getSheetSerialized(e))}getAllNamedExpressionsSerialized(){const e=[];let t=0;for(const r of this.dependencyGraph.sheetMapping.displayNames()){const a=this.dependencyGraph.sheetMapping.fetch(r);e[a]=t,t++}return this.dependencyGraph.namedExpressions.getAllNamedExpressions().map(r=>({name:r.expression.displayName,expression:this.getCellSerialized(r.expression.address),scope:r.scope!==void 0?e[r.scope]:void 0,options:r.expression.options}))}withNewConfig(e,t){const r=new Unparser(e,buildLexerConfig(e),this.dependencyGraph.sheetMapping.fetchDisplayName,t);return new Serialization(this.dependencyGraph,r,this.exporter)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class BuildEngineFactory{static buildFromSheets(e,t={},r=[]){const a=new Config(t);return this.buildEngine(a,e,r)}static buildFromSheet(e,t={},r=[]){const a=new Config(t),o=a.translationPackage.getUITranslation(UIElement.NEW_SHEET_PREFIX)+"1";return this.buildEngine(a,{[o]:e},r)}static buildEmpty(e={},t=[]){return this.buildEngine(new Config(e),{},t)}static rebuildWithConfig(e,t,r,a){return this.buildEngine(e,t,r,a)}static buildEngine(e,t={},r=[],a=e.useStats?new Statistics:new EmptyStatistics){a.start(StatType.BUILD_ENGINE_TOTAL);const o=new NamedExpressions,u=new FunctionRegistry(e),c=new LazilyTransformingAstService(a),h=DependencyGraph.buildEmpty(c,e,u,o,a),d=buildColumnSearchStrategy(h,e,a),p=h.sheetMapping,m=h.addressMapping;for(const F in t)if(Object.prototype.hasOwnProperty.call(t,F)){const P=t[F];validateAsSheet(P);const x=findBoundaries(P);if(x.height>e.maxRows||x.width>e.maxColumns)throw new SheetSizeLimitExceededError;const B=p.addSheet(F);m.autoAddSheet(B,x)}const f=new ParserWithCaching(e,u,p.get);c.parser=f;const g=new Unparser(e,buildLexerConfig(e),p.fetchDisplayName,o),y=new DateTimeHelper(e),T=new NumberLiteralHelper(e),A=new ArithmeticHelper(e,y,T),R=new CellContentParser(e,y,T),C=new ArraySizePredictor(e,u),N=new Operations(e,h,d,R,f,a,c,o,C),S=new UndoRedo(e,N);c.undoRedo=S;const _=new ClipboardOperations(e,h,N),O=new CrudOperations(e,N,S,_,h,d,f,R,c,o);r.forEach(F=>{O.ensureItIsPossibleToAddNamedExpression(F.name,F.expression,F.scope),O.operations.addNamedExpression(F.name,F.expression,F.scope,F.options)});const I=new Exporter(e,o,p.fetchDisplayName,c),L=new Serialization(h,g,I),b=new Interpreter(e,h,d,a,A,u,o,L,C,y);a.measure(StatType.GRAPH_BUILD,()=>{new GraphBuilder(h,d,f,R,a,C).buildGraph(t,a)});const w=new Evaluator(e,a,b,c,h,d);return w.run(),a.end(StatType.BUILD_ENGINE_TOTAL),{config:e,stats:a,dependencyGraph:h,columnSearch:d,parser:f,unparser:g,cellContentParser:R,evaluator:w,lazilyTransformingAstService:c,crudOperations:O,exporter:I,namedExpressions:o,serialization:L,functionRegistry:u}}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */function objectDestroy(i){for(const[e,t]of Object.entries(i))t instanceof Function?i[e]=postMortem(t):delete i[e]}function postMortem(i){return()=>{throw new Error(`The "${i}" method cannot be called because this HyperFormula instance has been destroyed`)}}var tinyEmitter={exports:{}};function E(){}E.prototype={on:function(i,e,t){var r=this.e||(this.e={});return(r[i]||(r[i]=[])).push({fn:e,ctx:t}),this},once:function(i,e,t){var r=this;function a(){r.off(i,a),e.apply(t,arguments)}return a._=e,this.on(i,a,t)},emit:function(i){var e=[].slice.call(arguments,1),t=((this.e||(this.e={}))[i]||[]).slice(),r=0,a=t.length;for(r;r<a;r++)t[r].fn.apply(t[r].ctx,e);return this},off:function(i,e){var t=this.e||(this.e={}),r=t[i],a=[];if(r&&e)for(var o=0,u=r.length;o<u;o++)r[o].fn!==e&&r[o].fn._!==e&&a.push(r[o]);return a.length?t[i]=a:delete t[i],this}};tinyEmitter.exports=E;var TinyEmitter=tinyEmitter.exports.TinyEmitter=E;/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */var Events;(function(i){i.SheetAdded="sheetAdded",i.SheetRemoved="sheetRemoved",i.SheetRenamed="sheetRenamed",i.NamedExpressionAdded="namedExpressionAdded",i.NamedExpressionRemoved="namedExpressionRemoved",i.ValuesUpdated="valuesUpdated",i.EvaluationSuspended="evaluationSuspended",i.EvaluationResumed="evaluationResumed"})(Events||(Events={}));class Emitter extends TinyEmitter{emit(e,...t){return super.emit(e,...t),this}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class HyperFormula{constructor(e,t,r,a,o,u,c,h,d,p,m,f,g,y){this._config=e,this._stats=t,this._dependencyGraph=r,this._columnSearch=a,this._parser=o,this._unparser=u,this._cellContentParser=c,this._evaluator=h,this._lazilyTransformingAstService=d,this._crudOperations=p,this._exporter=m,this._namedExpressions=f,this._serialization=g,this._functionRegistry=y,this._emitter=new Emitter,this._evaluationSuspended=!1}static get defaultConfig(){return getDefaultConfig()}get graph(){return this.dependencyGraph.graph}get rangeMapping(){return this.dependencyGraph.rangeMapping}get arrayMapping(){return this.dependencyGraph.arrayMapping}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}get dependencyGraph(){return this._dependencyGraph}get evaluator(){return this._evaluator}get columnSearch(){return this._columnSearch}get lazilyTransformingAstService(){return this._lazilyTransformingAstService}get licenseKeyValidityState(){return this._config.licenseKeyValidityState}static buildFromArray(e,t={},r=[]){return this.buildFromEngineState(BuildEngineFactory.buildFromSheet(e,t,r))}static buildFromSheets(e,t={},r=[]){return this.buildFromEngineState(BuildEngineFactory.buildFromSheets(e,t,r))}static buildEmpty(e={},t=[]){return this.buildFromEngineState(BuildEngineFactory.buildEmpty(e,t))}static getLanguage(e){validateArgToType(e,"string","languageCode");const t=this.registeredLanguages.get(e);if(t===void 0)throw new LanguageNotRegisteredError;return t}static registerLanguage(e,t){if(validateArgToType(e,"string","languageCode"),this.registeredLanguages.has(e))throw new LanguageAlreadyRegisteredError;this.registeredLanguages.set(e,buildTranslationPackage(t))}static unregisterLanguage(e){if(validateArgToType(e,"string","languageCode"),this.registeredLanguages.has(e))this.registeredLanguages.delete(e);else throw new LanguageNotRegisteredError}static getRegisteredLanguagesCodes(){return Array.from(this.registeredLanguages.keys())}static registerFunctionPlugin(e,t){FunctionRegistry.registerFunctionPlugin(e,t)}static unregisterFunctionPlugin(e){FunctionRegistry.unregisterFunctionPlugin(e)}static registerFunction(e,t,r){validateArgToType(e,"string","functionId"),FunctionRegistry.registerFunction(e,t,r)}static unregisterFunction(e){validateArgToType(e,"string","functionId"),FunctionRegistry.unregisterFunction(e)}static unregisterAllFunctions(){FunctionRegistry.unregisterAll()}static getRegisteredFunctionNames(e){validateArgToType(e,"string","code");const t=FunctionRegistry.getRegisteredFunctionIds();return this.getLanguage(e).getFunctionTranslations(t)}static getFunctionPlugin(e){return validateArgToType(e,"string","functionId"),FunctionRegistry.getFunctionPlugin(e)}static getAllFunctionPlugins(){return FunctionRegistry.getPlugins()}static buildFromEngineState(e){return new HyperFormula(e.config,e.stats,e.dependencyGraph,e.columnSearch,e.parser,e.unparser,e.cellContentParser,e.evaluator,e.lazilyTransformingAstService,e.crudOperations,e.exporter,e.namedExpressions,e.serialization,e.functionRegistry)}getCellValue(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellValue(e)}getCellFormula(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this._serialization.getCellFormula(e)}getCellHyperlink(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellHyperlink(e)}getCellSerialized(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellSerialized(e)}getSheetValues(e){return validateArgToType(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetValues(e)}getSheetFormulas(e){return validateArgToType(e,"number","sheetId"),this._serialization.getSheetFormulas(e)}getSheetSerialized(e){return validateArgToType(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetSerialized(e)}getAllSheetsDimensions(){return this._serialization.genericAllSheetsGetter(e=>this.getSheetDimensions(e))}getSheetDimensions(e){return validateArgToType(e,"number","sheetId"),{width:this.dependencyGraph.getSheetWidth(e),height:this.dependencyGraph.getSheetHeight(e)}}getAllSheetsValues(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsValues()}getAllSheetsFormulas(){return this._serialization.getAllSheetsFormulas()}getAllSheetsSerialized(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsSerialized()}updateConfig(e){Object.entries(e).every(([r,a])=>this._config[r]===a)||this.rebuildWithConfig(e)}getConfig(){return this._config.getConfig()}rebuildAndRecalculate(){this.rebuildWithConfig({})}getStats(){return this._stats.snapshot()}undo(){return this._crudOperations.undo(),this.recomputeIfDependencyGraphNeedsIt()}redo(){return this._crudOperations.redo(),this.recomputeIfDependencyGraphNeedsIt()}isThereSomethingToUndo(){return this._crudOperations.isThereSomethingToUndo()}isThereSomethingToRedo(){return this._crudOperations.isThereSomethingToRedo()}isItPossibleToSetCellContents(e){let t;if(isSimpleCellAddress(e))t=new AbsoluteCellRange(e,e);else if(isSimpleCellRange(e))t=new AbsoluteCellRange(e.start,e.end);else throw new ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange","address");try{this._crudOperations.ensureRangeInSizeLimits(t);for(const r of t.addresses(this._dependencyGraph))this._crudOperations.ensureItIsPossibleToChangeContent(r)}catch{return!1}return!0}setCellContents(e,t){return this._crudOperations.setCellContents(e,t),this.recomputeIfDependencyGraphNeedsIt()}swapRowIndexes(e,t){return validateArgToType(e,"number","sheetId"),this._crudOperations.setRowOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapRowIndexes(e,t){validateArgToType(e,"number","sheetId");try{return this._crudOperations.validateSwapRowIndexes(e,t),this._crudOperations.testRowOrderForArrays(e,t),!0}catch{return!1}}setRowOrder(e,t){validateArgToType(e,"number","sheetId");const r=this._crudOperations.mappingFromOrder(e,t,"row");return this.swapRowIndexes(e,r)}isItPossibleToSetRowOrder(e,t){validateArgToType(e,"number","sheetId");try{const r=this._crudOperations.mappingFromOrder(e,t,"row");return this._crudOperations.validateSwapRowIndexes(e,r),this._crudOperations.testRowOrderForArrays(e,r),!0}catch{return!1}}swapColumnIndexes(e,t){return validateArgToType(e,"number","sheetId"),this._crudOperations.setColumnOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapColumnIndexes(e,t){validateArgToType(e,"number","sheetId");try{return this._crudOperations.validateSwapColumnIndexes(e,t),this._crudOperations.testColumnOrderForArrays(e,t),!0}catch{return!1}}setColumnOrder(e,t){validateArgToType(e,"number","sheetId");const r=this._crudOperations.mappingFromOrder(e,t,"column");return this.swapColumnIndexes(e,r)}isItPossibleToSetColumnOrder(e,t){validateArgToType(e,"number","sheetId");try{const r=this._crudOperations.mappingFromOrder(e,t,"column");return this._crudOperations.validateSwapColumnIndexes(e,r),this._crudOperations.testColumnOrderForArrays(e,r),!0}catch{return!1}}isItPossibleToAddRows(e,...t){validateArgToType(e,"number","sheetId");const r=normalizeAddedIndexes(t);try{return this._crudOperations.ensureItIsPossibleToAddRows(e,...r),!0}catch{return!1}}addRows(e,...t){return validateArgToType(e,"number","sheetId"),this._crudOperations.addRows(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveRows(e,...t){validateArgToType(e,"number","sheetId");const r=normalizeRemovedIndexes(t);try{return this._crudOperations.ensureItIsPossibleToRemoveRows(e,...r),!0}catch{return!1}}removeRows(e,...t){return validateArgToType(e,"number","sheetId"),this._crudOperations.removeRows(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToAddColumns(e,...t){validateArgToType(e,"number","sheetId");const r=normalizeAddedIndexes(t);try{return this._crudOperations.ensureItIsPossibleToAddColumns(e,...r),!0}catch{return!1}}addColumns(e,...t){return validateArgToType(e,"number","sheetId"),this._crudOperations.addColumns(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveColumns(e,...t){validateArgToType(e,"number","sheetId");const r=normalizeRemovedIndexes(t);try{return this._crudOperations.ensureItIsPossibleToRemoveColumns(e,...r),!0}catch{return!1}}removeColumns(e,...t){return validateArgToType(e,"number","sheetId"),this._crudOperations.removeColumns(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveCells(e,t){if(!isSimpleCellAddress(t))throw new ExpectedValueOfTypeError("SimpleCellAddress","destinationLeftCorner");if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");try{const r=new AbsoluteCellRange(e.start,e.end);return this._crudOperations.operations.ensureItIsPossibleToMoveCells(r.start,r.width(),r.height(),t),!0}catch{return!1}}moveCells(e,t){if(!isSimpleCellAddress(t))throw new ExpectedValueOfTypeError("SimpleCellAddress","destinationLeftCorner");if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");const r=new AbsoluteCellRange(e.start,e.end);return this._crudOperations.moveCells(r.start,r.width(),r.height(),t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveRows(e,t,r,a){validateArgToType(e,"number","sheetId"),validateArgToType(t,"number","startRow"),validateArgToType(r,"number","numberOfRows"),validateArgToType(a,"number","targetRow");try{return this._crudOperations.ensureItIsPossibleToMoveRows(e,t,r,a),!0}catch{return!1}}moveRows(e,t,r,a){return validateArgToType(e,"number","sheetId"),validateArgToType(t,"number","startRow"),validateArgToType(r,"number","numberOfRows"),validateArgToType(a,"number","targetRow"),this._crudOperations.moveRows(e,t,r,a),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveColumns(e,t,r,a){validateArgToType(e,"number","sheetId"),validateArgToType(t,"number","startColumn"),validateArgToType(r,"number","numberOfColumns"),validateArgToType(a,"number","targetColumn");try{return this._crudOperations.ensureItIsPossibleToMoveColumns(e,t,r,a),!0}catch{return!1}}moveColumns(e,t,r,a){return validateArgToType(e,"number","sheetId"),validateArgToType(t,"number","startColumn"),validateArgToType(r,"number","numberOfColumns"),validateArgToType(a,"number","targetColumn"),this._crudOperations.moveColumns(e,t,r,a),this.recomputeIfDependencyGraphNeedsIt()}copy(e){if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");const t=new AbsoluteCellRange(e.start,e.end);return this._crudOperations.copy(t.start,t.width(),t.height()),this.getRangeValues(e)}cut(e){if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");const t=new AbsoluteCellRange(e.start,e.end);return this._crudOperations.cut(t.start,t.width(),t.height()),this.getRangeValues(e)}paste(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","targetLeftCorner");return this.ensureEvaluationIsNotSuspended(),this._crudOperations.paste(e),this.recomputeIfDependencyGraphNeedsIt()}isClipboardEmpty(){return this._crudOperations.isClipboardEmpty()}clearClipboard(){this._crudOperations.clearClipboard()}clearRedoStack(){this._crudOperations.undoRedo.clearRedoStack()}clearUndoStack(){this._crudOperations.undoRedo.clearUndoStack()}getRangeValues(e){if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");return new AbsoluteCellRange(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(a=>this.getCellValue(a)))}getRangeFormulas(e){if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");return new AbsoluteCellRange(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(a=>this.getCellFormula(a)))}getRangeSerialized(e){if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");return new AbsoluteCellRange(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(a=>this.getCellSerialized(a)))}getFillRangeData(e,t,r=!1){if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");if(!isSimpleCellRange(t))throw new ExpectedValueOfTypeError("SimpleCellRange","target");const a=new AbsoluteCellRange(e.start,e.end),o=new AbsoluteCellRange(t.start,t.end);return this.ensureEvaluationIsNotSuspended(),o.arrayOfAddressesInRange().map(u=>u.map(c=>{const h=((c.row-(r?t:e).start.row)%a.height()+a.height())%a.height()+e.start.row,d=((c.col-(r?t:e).start.col)%a.width()+a.width())%a.width()+e.start.col;return this._serialization.getCellSerialized({row:h,col:d,sheet:a.sheet},c)}))}isItPossibleToAddSheet(e){validateArgToType(e,"string","sheetName");try{return this._crudOperations.ensureItIsPossibleToAddSheet(e),!0}catch{return!1}}addSheet(e){e!==void 0&&validateArgToType(e,"string","sheetName");const t=this._crudOperations.addSheet(e);return this._emitter.emit(Events.SheetAdded,t),t}isItPossibleToRemoveSheet(e){validateArgToType(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch{return!1}}removeSheet(e){validateArgToType(e,"number","sheetId");const t=this.sheetMapping.getDisplayName(e);this._crudOperations.removeSheet(e);const r=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Events.SheetRemoved,t,r),r}isItPossibleToClearSheet(e){validateArgToType(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch{return!1}}clearSheet(e){return validateArgToType(e,"number","sheetId"),this._crudOperations.clearSheet(e),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToReplaceSheetContent(e,t){validateArgToType(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),this._crudOperations.ensureItIsPossibleToChangeSheetContents(e,t),!0}catch{return!1}}setSheetContent(e,t){return validateArgToType(e,"number","sheetId"),this._crudOperations.setSheetContent(e,t),this.recomputeIfDependencyGraphNeedsIt()}simpleCellAddressFromString(e,t){return validateArgToType(e,"string","cellAddress"),validateArgToType(t,"number","sheetId"),simpleCellAddressFromString(this.sheetMapping.get,e,t)}simpleCellRangeFromString(e,t){return validateArgToType(e,"string","cellRange"),validateArgToType(t,"number","sheetId"),simpleCellRangeFromString(this.sheetMapping.get,e,t)}simpleCellAddressToString(e,t){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return validateArgToType(t,"number","sheetId"),simpleCellAddressToString(this.sheetMapping.fetchDisplayName,e,t)}simpleCellRangeToString(e,t){if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","cellRange");return validateArgToType(t,"number","sheetId"),simpleCellRangeToString(this.sheetMapping.fetchDisplayName,e,t)}getCellDependents(e){let t;if(isSimpleCellAddress(e))t=this._dependencyGraph.addressMapping.getCell(e);else if(isSimpleCellRange(e))t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end);else throw new ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange",e);return t===void 0?[]:this._dependencyGraph.getAdjacentNodesAddresses(t)}getCellPrecedents(e){let t;if(isSimpleCellAddress(e))t=this._dependencyGraph.addressMapping.getCell(e);else if(isSimpleCellRange(e))t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end);else throw new ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange",e);return t===void 0?[]:this._dependencyGraph.dependencyQueryAddresses(t)}getSheetName(e){return validateArgToType(e,"number","sheetId"),this.sheetMapping.getDisplayName(e)}getSheetNames(){return this.sheetMapping.sheetNames()}getSheetId(e){return validateArgToType(e,"string","sheetName"),this.sheetMapping.get(e)}doesSheetExist(e){return validateArgToType(e,"string","sheetName"),this.sheetMapping.hasSheetWithName(e)}getCellType(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");const t=this.dependencyGraph.getCell(e);return getCellType(t,e)}doesCellHaveSimpleValue(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.getCellType(e)===CellType.VALUE}doesCellHaveFormula(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");const t=this.getCellType(e);return t===CellType.FORMULA||t===CellType.ARRAYFORMULA}isCellEmpty(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.getCellType(e)===CellType.EMPTY}isCellPartOfArray(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");const t=this.getCellType(e);return t===CellType.ARRAY||t===CellType.ARRAYFORMULA}getCellValueType(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return getCellValueType(t)}getCellValueDetailedType(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return getCellValueDetailedType(t)}getCellValueFormat(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return getCellValueFormat(t)}countSheets(){return this.sheetMapping.numberOfSheets()}isItPossibleToRenameSheet(e,t){validateArgToType(e,"number","sheetId"),validateArgToType(t,"string","newName");try{return this._crudOperations.ensureItIsPossibleToRenameSheet(e,t),!0}catch{return!1}}renameSheet(e,t){validateArgToType(e,"number","sheetId"),validateArgToType(t,"string","newName");const r=this._crudOperations.renameSheet(e,t);r!==void 0&&this._emitter.emit(Events.SheetRenamed,r,t)}batch(e){this.suspendEvaluation(),this._crudOperations.beginUndoRedoBatchMode();try{e()}catch(t){throw this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation(),t}return this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation()}suspendEvaluation(){this._evaluationSuspended=!0,this._emitter.emit(Events.EvaluationSuspended)}resumeEvaluation(){this._evaluationSuspended=!1;const e=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Events.EvaluationResumed,e),e}isEvaluationSuspended(){return this._evaluationSuspended}isItPossibleToAddNamedExpression(e,t,r){validateArgToType(e,"string","expressionName"),r!==void 0&&validateArgToType(r,"number","scope");try{return this._crudOperations.ensureItIsPossibleToAddNamedExpression(e,t,r),!0}catch{return!1}}addNamedExpression(e,t,r,a){validateArgToType(e,"string","expressionName"),r!==void 0&&validateArgToType(r,"number","scope"),this._crudOperations.addNamedExpression(e,t,r,a);const o=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Events.NamedExpressionAdded,e,o),o}getNamedExpressionValue(e,t){validateArgToType(e,"string","expressionName"),t!==void 0&&validateArgToType(t,"number","scope"),this.ensureEvaluationIsNotSuspended(),this._crudOperations.ensureScopeIdIsValid(t);const r=this._namedExpressions.namedExpressionForScope(e,t);if(r)return this._serialization.getCellValue(r.address)}getNamedExpressionFormula(e,t){validateArgToType(e,"string","expressionName"),t!==void 0&&validateArgToType(t,"number","scope"),this._crudOperations.ensureScopeIdIsValid(t);const r=this._namedExpressions.namedExpressionForScope(e,t);if(r!==void 0)return this._serialization.getCellFormula(r.address)}getNamedExpression(e,t){validateArgToType(e,"string","expressionName"),t!==void 0&&validateArgToType(t,"number","scope");const r=this._namedExpressions.namedExpressionForScope(e,t);if(r===void 0)return;const a=this._serialization.getCellFormula(r.address);return{name:e,scope:t,expression:a,options:r.options}}isItPossibleToChangeNamedExpression(e,t,r){validateArgToType(e,"string","expressionName"),r!==void 0&&validateArgToType(r,"number","scope");try{return this._crudOperations.ensureItIsPossibleToChangeNamedExpression(e,t,r),!0}catch{return!1}}changeNamedExpression(e,t,r,a){return validateArgToType(e,"string","expressionName"),r!==void 0&&validateArgToType(r,"number","scope"),this._crudOperations.changeNamedExpressionExpression(e,r,t,a),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveNamedExpression(e,t){validateArgToType(e,"string","expressionName"),t!==void 0&&validateArgToType(t,"number","scope");try{return this._crudOperations.isItPossibleToRemoveNamedExpression(e,t),!0}catch{return!1}}removeNamedExpression(e,t){validateArgToType(e,"string","expressionName"),t!==void 0&&validateArgToType(t,"number","scope");const r=this._crudOperations.removeNamedExpression(e,t);if(r){const a=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Events.NamedExpressionRemoved,r.displayName,a),a}else return[]}listNamedExpressions(e){return e!==void 0&&validateArgToType(e,"number","scope"),this._crudOperations.ensureScopeIdIsValid(e),this._namedExpressions.getAllNamedExpressionsNamesInScope(e)}getAllNamedExpressionsSerialized(){return this._serialization.getAllNamedExpressionsSerialized()}normalizeFormula(e){validateArgToType(e,"string","formulaString");const{ast:t,address:r}=this.extractTemporaryFormula(e);if(t===void 0)throw new NotAFormulaError;return this._unparser.unparse(t,r)}calculateFormula(e,t){validateArgToType(e,"string","formulaString"),validateArgToType(t,"number","sheetId"),this._crudOperations.ensureScopeIdIsValid(t);const{ast:r,address:a,dependencies:o}=this.extractTemporaryFormula(e,t);if(r===void 0)throw new NotAFormulaError;const u=this.evaluator.runAndForget(r,a,o);return this._exporter.exportScalarOrRange(u)}validateFormula(e){validateArgToType(e,"string","formulaString");const{ast:t}=this.extractTemporaryFormula(e);return!(t===void 0||t.type===AstNodeType.ERROR&&!t.error)}getRegisteredFunctionNames(){return HyperFormula.getLanguage(this._config.language).getFunctionTranslations(this._functionRegistry.getRegisteredFunctionIds())}getFunctionPlugin(e){return validateArgToType(e,"string","functionId"),this._functionRegistry.getFunctionPlugin(e)}getAllFunctionPlugins(){return this._functionRegistry.getPlugins()}numberToDateTime(e){return validateArgToType(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDateTime(e)}numberToDate(e){return validateArgToType(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDate(e)}numberToTime(e){return validateArgToType(e,"number","val"),numberToSimpleTime(e)}on(e,t){this._emitter.on(e,t)}once(e,t){this._emitter.once(e,t)}off(e,t){this._emitter.off(e,t)}destroy(){objectDestroy(this)}ensureEvaluationIsNotSuspended(){if(this._evaluationSuspended)throw new EvaluationSuspendedError}extractTemporaryFormula(e,t=1){const r=this._cellContentParser.parse(e),a={sheet:t,col:0,row:0};if(!(r instanceof CellContent.Formula))return{address:a,dependencies:[]};const{ast:o,errors:u,dependencies:c}=this._parser.parse(r.formula,a);return u.length>0?{address:a,dependencies:[]}:{ast:o,address:a,dependencies:c}}rebuildWithConfig(e){const t=this._config.mergeConfig(e),r=this._config.mergeConfig({language:e.language}),a=this._serialization.withNewConfig(r,this._namedExpressions).getAllSheetsSerialized(),o=this._serialization.getAllNamedExpressionsSerialized(),u=BuildEngineFactory.rebuildWithConfig(t,a,o,this._stats);this._config=u.config,this._stats=u.stats,this._dependencyGraph=u.dependencyGraph,this._columnSearch=u.columnSearch,this._parser=u.parser,this._unparser=u.unparser,this._cellContentParser=u.cellContentParser,this._evaluator=u.evaluator,this._lazilyTransformingAstService=u.lazilyTransformingAstService,this._crudOperations=u.crudOperations,this._exporter=u.exporter,this._namedExpressions=u.namedExpressions,this._serialization=u.serialization,this._functionRegistry=u.functionRegistry}recomputeIfDependencyGraphNeedsIt(){if(this._evaluationSuspended)return[];{const e=this._crudOperations.getAndClearContentChanges(),t=this.dependencyGraph.verticesToRecompute();this.dependencyGraph.clearDirtyVertices(),t.length>0&&e.addAll(this.evaluator.partialRun(t));const r=e.exportChanges(this._exporter);return e.isEmpty()||this._emitter.emit(Events.ValuesUpdated,r),r}}}HyperFormula.version="2.6.2";HyperFormula.buildDate="15/02/2024 12:03:19";HyperFormula.releaseDate="15/02/2024";HyperFormula.languages={};HyperFormula.registeredLanguages=new Map;/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const privatePool=new WeakMap;class Config{constructor(e={},t=!0){const{accentSensitive:r,binarySearchThreshold:a,caseSensitive:o,caseFirst:u,chooseAddressMappingPolicy:c,currencySymbol:h,dateFormats:d,decimalSeparator:p,evaluateNullToZero:m,functionArgSeparator:f,functionPlugins:g,ignorePunctuation:y,leapYear1900:T,localeLang:A,language:R,ignoreWhiteSpace:C,licenseKey:N,matchWholeCell:S,arrayColumnSeparator:_,arrayRowSeparator:O,maxRows:I,maxColumns:L,nullYear:b,nullDate:w,parseDateTime:F,precisionEpsilon:P,precisionRounding:x,stringifyDateTime:B,stringifyDuration:k,smartRounding:V,timeFormats:H,thousandSeparator:Y,useArrayArithmetic:G,useStats:D,undoLimit:X,useColumnIndex:z,useRegularExpressions:q,useWildcards:W}=e;t&&Config.warnDeprecatedOptions(e),this.useArrayArithmetic=configValueFromParam(G,"boolean","useArrayArithmetic"),this.accentSensitive=configValueFromParam(r,"boolean","accentSensitive"),this.caseSensitive=configValueFromParam(o,"boolean","caseSensitive"),this.caseFirst=configValueFromParam(u,["upper","lower","false"],"caseFirst"),this.ignorePunctuation=configValueFromParam(y,"boolean","ignorePunctuation"),this.chooseAddressMappingPolicy=c??Config.defaultConfig.chooseAddressMappingPolicy,this.dateFormats=[...configValueFromParamCheck(d,Array.isArray,"array","dateFormats")],this.timeFormats=[...configValueFromParamCheck(H,Array.isArray,"array","timeFormats")],this.functionArgSeparator=configValueFromParam(f,"string","functionArgSeparator"),this.decimalSeparator=configValueFromParam(p,[".",","],"decimalSeparator"),this.language=configValueFromParam(R,"string","language"),this.ignoreWhiteSpace=configValueFromParam(C,["standard","any"],"ignoreWhiteSpace"),this.licenseKey=configValueFromParam(N,"string","licenseKey"),this.thousandSeparator=configValueFromParam(Y,["",","," ","."],"thousandSeparator"),this.arrayColumnSeparator=configValueFromParam(_,[",",";"],"arrayColumnSeparator"),this.arrayRowSeparator=configValueFromParam(O,[";","|"],"arrayRowSeparator"),this.localeLang=configValueFromParam(A,"string","localeLang"),this.functionPlugins=[...g??Config.defaultConfig.functionPlugins],this.smartRounding=configValueFromParam(V,"boolean","smartRounding"),this.evaluateNullToZero=configValueFromParam(m,"boolean","evaluateNullToZero"),this.nullYear=configValueFromParam(b,"number","nullYear"),validateNumberToBeAtLeast(this.nullYear,"nullYear",0),validateNumberToBeAtMost(this.nullYear,"nullYear",100),this.precisionRounding=configValueFromParam(x,"number","precisionRounding"),validateNumberToBeAtLeast(this.precisionRounding,"precisionRounding",0),this.precisionEpsilon=configValueFromParam(P,"number","precisionEpsilon"),validateNumberToBeAtLeast(this.precisionEpsilon,"precisionEpsilon",0),this.useColumnIndex=configValueFromParam(z,"boolean","useColumnIndex"),this.useStats=configValueFromParam(D,"boolean","useStats"),this.binarySearchThreshold=a??Config.defaultConfig.binarySearchThreshold,this.parseDateTime=configValueFromParam(F,"function","parseDateTime"),this.stringifyDateTime=configValueFromParam(B,"function","stringifyDateTime"),this.stringifyDuration=configValueFromParam(k,"function","stringifyDuration"),this.translationPackage=HyperFormula.getLanguage(this.language),this.errorMapping=this.translationPackage.buildErrorMapping(),this.nullDate=configValueFromParamCheck(w,instanceOfSimpleDate,"IDate","nullDate"),this.leapYear1900=configValueFromParam(T,"boolean","leapYear1900"),this.undoLimit=configValueFromParam(X,"number","undoLimit"),this.useRegularExpressions=configValueFromParam(q,"boolean","useRegularExpressions"),this.useWildcards=configValueFromParam(W,"boolean","useWildcards"),this.matchWholeCell=configValueFromParam(S,"boolean","matchWholeCell"),validateNumberToBeAtLeast(this.undoLimit,"undoLimit",0),this.maxRows=configValueFromParam(I,"number","maxRows"),validateNumberToBeAtLeast(this.maxRows,"maxRows",1),this.maxColumns=configValueFromParam(L,"number","maxColumns"),this.currencySymbol=this.setupCurrencySymbol(h),validateNumberToBeAtLeast(this.maxColumns,"maxColumns",1),privatePool.set(this,{licenseKeyValidityState:checkLicenseKeyValidity(this.licenseKey)}),configCheckIfParametersNotInConflict({value:this.decimalSeparator,name:"decimalSeparator"},{value:this.functionArgSeparator,name:"functionArgSeparator"},{value:this.thousandSeparator,name:"thousandSeparator"}),configCheckIfParametersNotInConflict({value:this.arrayRowSeparator,name:"arrayRowSeparator"},{value:this.arrayColumnSeparator,name:"arrayColumnSeparator"})}setupCurrencySymbol(e){const t=[...configValueFromParamCheck(e,Array.isArray,"array","currencySymbol")];return t.forEach(r=>{if(typeof r!="string")throw new ExpectedValueOfTypeError("string[]","currencySymbol");if(r==="")throw new ConfigValueEmpty("currencySymbol")}),t}get licenseKeyValidityState(){return privatePool.get(this).licenseKeyValidityState}getConfig(){return getFullConfigFromPartial(this)}mergeConfig(e){const t=Object.assign({},this.getConfig(),e);return Config.warnDeprecatedOptions(e),new Config(t,!1)}static warnDeprecatedOptions(e){Config.warnDeprecatedIfUsed(e.binarySearchThreshold,"binarySearchThreshold","1.1")}static warnDeprecatedIfUsed(e,t,r,a){e!==void 0&&console.warn(a===void 0?`${t} option is deprecated since ${r}`:`${t} option is deprecated since ${r}, please use ${a}`)}}Config.defaultConfig={accentSensitive:!1,binarySearchThreshold:20,currencySymbol:["$"],caseSensitive:!1,caseFirst:"lower",chooseAddressMappingPolicy:new AlwaysDense,dateFormats:["DD/MM/YYYY","DD/MM/YY"],decimalSeparator:".",evaluateNullToZero:!1,functionArgSeparator:",",functionPlugins:[],ignorePunctuation:!1,language:"enGB",ignoreWhiteSpace:"standard",licenseKey:"",leapYear1900:!1,localeLang:"en",matchWholeCell:!0,arrayColumnSeparator:",",arrayRowSeparator:";",maxRows:4e4,maxColumns:18278,nullYear:30,nullDate:{year:1899,month:12,day:30},parseDateTime:defaultParseToDateTime,precisionEpsilon:1e-13,precisionRounding:14,smartRounding:!0,stringifyDateTime:defaultStringifyDateTime,stringifyDuration:defaultStringifyDuration,timeFormats:["hh:mm","hh:mm:ss.sss"],thousandSeparator:"",undoLimit:20,useRegularExpressions:!1,useWildcards:!0,useColumnIndex:!1,useStats:!1,useArrayArithmetic:!1};function getFullConfigFromPartial(i){var e;const t={};for(const r in Config.defaultConfig){const a=(e=i[r])!==null&&e!==void 0?e:Config.defaultConfig[r];Array.isArray(a)?t[r]=[...a]:t[r]=a}return t}function getDefaultConfig(){return getFullConfigFromPartial({})}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const dictionary={errors:{CYCLE:"#CYCLE!",DIV_BY_ZERO:"#DIV/0!",ERROR:"#ERROR!",NA:"#N/A",NAME:"#NAME?",NUM:"#NUM!",REF:"#REF!",SPILL:"#SPILL!",VALUE:"#VALUE!"},functions:{FILTER:"FILTER",ADDRESS:"ADDRESS",ARRAY_CONSTRAIN:"ARRAY_CONSTRAIN",ARRAYFORMULA:"ARRAYFORMULA",ABS:"ABS",ACOS:"ACOS",ACOSH:"ACOSH",ACOT:"ACOT",ACOTH:"ACOTH",AND:"AND",ARABIC:"ARABIC",ASIN:"ASIN",ASINH:"ASINH",ATAN2:"ATAN2",ATAN:"ATAN",ATANH:"ATANH",AVERAGE:"AVERAGE",AVERAGEA:"AVERAGEA",AVERAGEIF:"AVERAGEIF",BASE:"BASE",BIN2DEC:"BIN2DEC",BIN2HEX:"BIN2HEX",BIN2OCT:"BIN2OCT",BITAND:"BITAND",BITLSHIFT:"BITLSHIFT",BITOR:"BITOR",BITRSHIFT:"BITRSHIFT",BITXOR:"BITXOR",CEILING:"CEILING",CHAR:"CHAR",CHOOSE:"CHOOSE",CLEAN:"CLEAN",CODE:"CODE",COLUMN:"COLUMN",COLUMNS:"COLUMNS",CONCATENATE:"CONCATENATE",CORREL:"CORREL",COS:"COS",COSH:"COSH",COT:"COT",COTH:"COTH",COUNT:"COUNT",COUNTA:"COUNTA",COUNTBLANK:"COUNTBLANK",COUNTIF:"COUNTIF",COUNTIFS:"COUNTIFS",COUNTUNIQUE:"COUNTUNIQUE",CSC:"CSC",CSCH:"CSCH",CUMIPMT:"CUMIPMT",CUMPRINC:"CUMPRINC",DATE:"DATE",DATEDIF:"DATEDIF",DATEVALUE:"DATEVALUE",DAY:"DAY",DAYS360:"DAYS360",DAYS:"DAYS",DB:"DB",DDB:"DDB",DEC2BIN:"DEC2BIN",DEC2HEX:"DEC2HEX",DEC2OCT:"DEC2OCT",DECIMAL:"DECIMAL",DEGREES:"DEGREES",DELTA:"DELTA",DOLLARDE:"DOLLARDE",DOLLARFR:"DOLLARFR",EDATE:"EDATE",EFFECT:"EFFECT",EOMONTH:"EOMONTH",ERF:"ERF",ERFC:"ERFC",EVEN:"EVEN",EXACT:"EXACT",EXP:"EXP",FALSE:"FALSE",FIND:"FIND",FORMULATEXT:"FORMULATEXT",FV:"FV",FVSCHEDULE:"FVSCHEDULE",HEX2BIN:"HEX2BIN",HEX2DEC:"HEX2DEC",HEX2OCT:"HEX2OCT",HLOOKUP:"HLOOKUP",HOUR:"HOUR",HYPERLINK:"HYPERLINK",IF:"IF",IFERROR:"IFERROR",IFNA:"IFNA",IFS:"IFS",INDEX:"INDEX",INT:"INT",INTERVAL:"INTERVAL",IPMT:"IPMT",ISBINARY:"ISBINARY",ISBLANK:"ISBLANK",ISERR:"ISERR",ISERROR:"ISERROR",ISEVEN:"ISEVEN",ISFORMULA:"ISFORMULA",ISLOGICAL:"ISLOGICAL",ISNA:"ISNA",ISNONTEXT:"ISNONTEXT",ISNUMBER:"ISNUMBER",ISODD:"ISODD",ISOWEEKNUM:"ISOWEEKNUM",ISPMT:"ISPMT",ISREF:"ISREF",ISTEXT:"ISTEXT",LEFT:"LEFT",LEN:"LEN",LN:"LN",LOG10:"LOG10",LOG:"LOG",LOWER:"LOWER",MATCH:"MATCH",MAX:"MAX",MAXA:"MAXA",MAXIFS:"MAXIFS",MAXPOOL:"MAXPOOL",MEDIAN:"MEDIAN",MEDIANPOOL:"MEDIANPOOL",MID:"MID",MIN:"MIN",MINA:"MINA",MINIFS:"MINIFS",MINUTE:"MINUTE",MIRR:"MIRR",MMULT:"MMULT",MOD:"MOD",MONTH:"MONTH",NA:"NA",NETWORKDAYS:"NETWORKDAYS","NETWORKDAYS.INTL":"NETWORKDAYS.INTL",NOMINAL:"NOMINAL",NOT:"NOT",NOW:"NOW",NPER:"NPER",NPV:"NPV",OCT2BIN:"OCT2BIN",OCT2DEC:"OCT2DEC",OCT2HEX:"OCT2HEX",ODD:"ODD",OFFSET:"OFFSET",OR:"OR",PI:"PI",PMT:"PMT",PDURATION:"PDURATION",PRODUCT:"PRODUCT",POWER:"POWER",PPMT:"PPMT",PROPER:"PROPER",PV:"PV",RADIANS:"RADIANS",RAND:"RAND",RATE:"RATE",REPLACE:"REPLACE",REPT:"REPT",RIGHT:"RIGHT",ROMAN:"ROMAN",ROUND:"ROUND",ROUNDDOWN:"ROUNDDOWN",ROUNDUP:"ROUNDUP",ROW:"ROW",ROWS:"ROWS",RRI:"RRI",SEARCH:"SEARCH",SEC:"SEC",SECH:"SECH",SECOND:"SECOND",SHEET:"SHEET",SHEETS:"SHEETS",SIN:"SIN",SINH:"SINH",SLN:"SLN",SPLIT:"SPLIT",SQRT:"SQRT",STDEVA:"STDEVA","STDEV.P":"STDEV.P",STDEVPA:"STDEVPA","STDEV.S":"STDEV.S",SUBSTITUTE:"SUBSTITUTE",SUBTOTAL:"SUBTOTAL",SUM:"SUM",SUMIF:"SUMIF",SUMIFS:"SUMIFS",SUMPRODUCT:"SUMPRODUCT",SUMSQ:"SUMSQ",SWITCH:"SWITCH",SYD:"SYD",T:"T",TAN:"TAN",TANH:"TANH",TBILLEQ:"TBILLEQ",TBILLPRICE:"TBILLPRICE",TBILLYIELD:"TBILLYIELD",TEXT:"TEXT",TIME:"TIME",TIMEVALUE:"TIMEVALUE",TODAY:"TODAY",TRANSPOSE:"TRANSPOSE",TRIM:"TRIM",TRUE:"TRUE",TRUNC:"TRUNC",UNICHAR:"UNICHAR",UNICODE:"UNICODE",UPPER:"UPPER",VARA:"VARA","VAR.P":"VAR.P",VARPA:"VARPA","VAR.S":"VAR.S",VLOOKUP:"VLOOKUP",WEEKDAY:"WEEKDAY",WEEKNUM:"WEEKNUM",WORKDAY:"WORKDAY","WORKDAY.INTL":"WORKDAY.INTL",XNPV:"XNPV",XOR:"XOR",YEAR:"YEAR",YEARFRAC:"YEARFRAC","HF.ADD":"HF.ADD","HF.CONCAT":"HF.CONCAT","HF.DIVIDE":"HF.DIVIDE","HF.EQ":"HF.EQ","HF.GT":"HF.GT","HF.GTE":"HF.GTE","HF.LT":"HF.LT","HF.LTE":"HF.LTE","HF.MINUS":"HF.MINUS","HF.MULTIPLY":"HF.MULTIPLY","HF.NE":"HF.NE","HF.POW":"HF.POW","HF.UMINUS":"HF.UMINUS","HF.UNARY_PERCENT":"HF.UNARY_PERCENT","HF.UPLUS":"HF.UPLUS",VARP:"VARP",VAR:"VAR",STDEVP:"STDEVP",STDEV:"STDEV","EXPON.DIST":"EXPON.DIST",FISHER:"FISHER",FISHERINV:"FISHERINV",GAMMA:"GAMMA","GAMMA.DIST":"GAMMA.DIST",GAMMALN:"GAMMALN","GAMMALN.PRECISE":"GAMMALN.PRECISE","GAMMA.INV":"GAMMA.INV",GAUSS:"GAUSS",FACT:"FACT",FACTDOUBLE:"FACTDOUBLE",COMBIN:"COMBIN",COMBINA:"COMBINA",GCD:"GCD",LCM:"LCM",MROUND:"MROUND",MULTINOMIAL:"MULTINOMIAL",QUOTIENT:"QUOTIENT",RANDBETWEEN:"RANDBETWEEN",SERIESSUM:"SERIESSUM",SIGN:"SIGN",SQRTPI:"SQRTPI",SUMX2MY2:"SUMX2MY2",SUMX2PY2:"SUMX2PY2",SUMXMY2:"SUMXMY2",EXPONDIST:"EXPONDIST",GAMMADIST:"GAMMADIST",GAMMAINV:"GAMMAINV","BETA.DIST":"BETA.DIST",BETADIST:"BETADIST","BETA.INV":"BETA.INV",BETAINV:"BETAINV","BINOM.DIST":"BINOM.DIST",BINOMDIST:"BINOMDIST","BINOM.INV":"BINOM.INV",BESSELI:"BESSELI",BESSELJ:"BESSELJ",BESSELK:"BESSELK",BESSELY:"BESSELY","CHISQ.DIST":"CHISQ.DIST","CHISQ.DIST.RT":"CHISQ.DIST.RT","CHISQ.INV":"CHISQ.INV","CHISQ.INV.RT":"CHISQ.INV.RT",CHIDIST:"CHIDIST",CHIINV:"CHIINV","F.DIST":"F.DIST","F.DIST.RT":"F.DIST.RT","F.INV":"F.INV","F.INV.RT":"F.INV.RT",FDIST:"FDIST",FINV:"FINV",WEIBULL:"WEIBULL","WEIBULL.DIST":"WEIBULL.DIST",POISSON:"POISSON","POISSON.DIST":"POISSON.DIST","HYPGEOM.DIST":"HYPGEOM.DIST",HYPGEOMDIST:"HYPGEOMDIST","T.DIST":"T.DIST","T.DIST.2T":"T.DIST.2T","T.DIST.RT":"T.DIST.RT","T.INV":"T.INV","T.INV.2T":"T.INV.2T",TDIST:"TDIST",TINV:"TINV",LOGINV:"LOGINV","LOGNORM.DIST":"LOGNORM.DIST","LOGNORM.INV":"LOGNORM.INV",LOGNORMDIST:"LOGNORMDIST","NORM.DIST":"NORM.DIST","NORM.INV":"NORM.INV","NORM.S.DIST":"NORM.S.DIST","NORM.S.INV":"NORM.S.INV",NORMDIST:"NORMDIST",NORMINV:"NORMINV",NORMSDIST:"NORMSDIST",NORMSINV:"NORMSINV",PHI:"PHI","NEGBINOM.DIST":"NEGBINOM.DIST",NEGBINOMDIST:"NEGBINOMDIST",COMPLEX:"COMPLEX",IMABS:"IMABS",IMAGINARY:"IMAGINARY",IMARGUMENT:"IMARGUMENT",IMCONJUGATE:"IMCONJUGATE",IMCOS:"IMCOS",IMCOSH:"IMCOSH",IMCOT:"IMCOT",IMCSC:"IMCSC",IMCSCH:"IMCSCH",IMDIV:"IMDIV",IMEXP:"IMEXP",IMLN:"IMLN",IMLOG10:"IMLOG10",IMLOG2:"IMLOG2",IMPOWER:"IMPOWER",IMPRODUCT:"IMPRODUCT",IMREAL:"IMREAL",IMSEC:"IMSEC",IMSECH:"IMSECH",IMSIN:"IMSIN",IMSINH:"IMSINH",IMSQRT:"IMSQRT",IMSUB:"IMSUB",IMSUM:"IMSUM",IMTAN:"IMTAN",LARGE:"LARGE",SMALL:"SMALL",AVEDEV:"AVEDEV",CONFIDENCE:"CONFIDENCE","CONFIDENCE.NORM":"CONFIDENCE.NORM","CONFIDENCE.T":"CONFIDENCE.T",DEVSQ:"DEVSQ",GEOMEAN:"GEOMEAN",HARMEAN:"HARMEAN",CRITBINOM:"CRITBINOM","COVARIANCE.P":"COVARIANCE.P","COVARIANCE.S":"COVARIANCE.S",COVAR:"COVAR",PEARSON:"PEARSON",RSQ:"RSQ",STANDARDIZE:"STANDARDIZE","Z.TEST":"Z.TEST",ZTEST:"ZTEST","F.TEST":"F.TEST",FTEST:"FTEST",STEYX:"STEYX",SLOPE:"SLOPE","CHISQ.TEST":"CHISQ.TEST",CHITEST:"CHITEST","T.TEST":"T.TEST",TTEST:"TTEST",SKEW:"SKEW","SKEW.P":"SKEW.P",WEIBULLDIST:"WEIBULLDIST",VARS:"VARS",TINV2T:"TINV2T",TDISTRT:"TDISTRT",TDIST2T:"TDIST2T",STDEVS:"STDEVS",FINVRT:"FINVRT",FDISTRT:"FDISTRT",CHIDISTRT:"CHIDISTRT",CHIINVRT:"CHIINVRT",COVARIANCEP:"COVARIANCEP",COVARIANCES:"COVARIANCES",LOGNORMINV:"LOGNORMINV",POISSONDIST:"POISSONDIST",SKEWP:"SKEWP","CEILING.MATH":"CEILING.MATH",FLOOR:"FLOOR","FLOOR.MATH":"FLOOR.MATH","CEILING.PRECISE":"CEILING.PRECISE","FLOOR.PRECISE":"FLOOR.PRECISE","ISO.CEILING":"ISO.CEILING"},langCode:"enGB",ui:{NEW_SHEET_PREFIX:"Sheet"}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */var AbsStyle;(function(i){i[i.FullyAbsolute=1]="FullyAbsolute",i[i.RowAbsoluteColRelative=2]="RowAbsoluteColRelative",i[i.RowRelativeColAbsolute=3]="RowRelativeColAbsolute",i[i.FullyRelative=4]="FullyRelative"})(AbsStyle||(AbsStyle={}));class AddressPlugin extends FunctionPlugin{verifyAddressArguments(e,t,r,a){if(a){if(e<1||t<1)return new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne)}else if(AbsStyle.FullyAbsolute==r){if(e<1||t<1)return new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne)}else if(AbsStyle.RowAbsoluteColRelative==r){if(e<1)return new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne)}else if(AbsStyle.RowRelativeColAbsolute==r&&t<1)return new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne)}address(e,t){return this.runFunction(e.args,t,this.metadata("ADDRESS"),(r,a,o,u,c)=>{const h=this.verifyAddressArguments(r,a,o,u);if(h!==void 0)return h;const d=columnIndexToLabel(a-1);let p="";c!=null&&(p=`${c}!`);const m=a==0?"C":`C[${a}]`,f=r==0?"R":`R[${r}]`;return AbsStyle.FullyRelative==o?u?`${p}${d}${r}`:`${p}${f}${m}`:AbsStyle.RowRelativeColAbsolute==o?u?`${p}$${d}${r}`:`${p}${f}C${a}`:AbsStyle.RowAbsoluteColRelative==o?u?`${p}${d}$${r}`:`${p}R${r}${m}`:u?`${p}$${d}$${r}`:`${p}R${r}C${a}`})}}AddressPlugin.implementedFunctions={ADDRESS:{method:"address",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0,defaultValue:1,minValue:1,maxValue:4},{argumentType:FunctionArgumentType.BOOLEAN,optionalArg:!0,defaultValue:!0},{argumentType:FunctionArgumentType.STRING,optionalArg:!0}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ArrayPlugin extends FunctionPlugin{arrayformula(e,t){return this.runFunction(e.args,t,this.metadata("ARRAYFORMULA"),r=>r)}arrayformulaArraySize(e,t){if(e.args.length!==1)return ArraySize.error();const r=this.metadata("ARRAYFORMULA");return e.args.map(o=>{var u;return this.arraySizeForAst(o,new InterpreterState(t.formulaAddress,t.arraysFlag||((u=r==null?void 0:r.arrayFunction)!==null&&u!==void 0?u:!1)))})[0]}arrayconstrain(e,t){return this.runFunction(e.args,t,this.metadata("ARRAY_CONSTRAIN"),(r,a,o)=>{a=Math.min(a,r.height()),o=Math.min(o,r.width());const u=r.data,c=[];for(let h=0;h<a;h++)c.push(u[h].slice(0,o));return SimpleRangeValue.onlyValues(c)})}arrayconstrainArraySize(e,t){if(e.args.length!==3)return ArraySize.error();const r=this.metadata("ARRAY_CONSTRAIN"),a=e.args.map(c=>{var h;return this.arraySizeForAst(c,new InterpreterState(t.formulaAddress,t.arraysFlag||((h=r==null?void 0:r.arrayFunction)!==null&&h!==void 0?h:!1)))});let{height:o,width:u}=a[0];return e.args[1].type===AstNodeType.NUMBER&&(o=Math.min(o,e.args[1].value)),e.args[2].type===AstNodeType.NUMBER&&(u=Math.min(u,e.args[2].value)),o<1||u<1||!Number.isInteger(o)||!Number.isInteger(u)?ArraySize.error():new ArraySize(u,o)}filter(e,t){return this.runFunction(e.args,t,this.metadata("FILTER"),(r,...a)=>{for(const c of a)if(r.width()!==c.width()||r.height()!==c.height())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);if(r.width()>1&&r.height()>1)return new CellError(ErrorType.NA,ErrorMessage.WrongDimension);const o=r.data,u=[];for(let c=0;c<r.height();c++){const h=[];for(let d=0;d<r.width();d++){let p=!0;for(const m of a)if(coerceScalarToBoolean(m.data[c][d])!==!0){p=!1;break}p&&h.push(o[c][d])}h.length>0&&u.push(h)}return u.length>0?SimpleRangeValue.onlyValues(u):new CellError(ErrorType.NA,ErrorMessage.EmptyRange)})}filterArraySize(e,t){if(e.args.length<=1)return ArraySize.error();const r=this.metadata("FILTER"),a=e.args.map(c=>{var h;return this.arraySizeForAst(c,new InterpreterState(t.formulaAddress,t.arraysFlag||((h=r==null?void 0:r.arrayFunction)!==null&&h!==void 0?h:!1)))}),o=Math.max(...a.map(c=>c.width)),u=Math.max(...a.map(c=>c.height));return new ArraySize(o,u)}}ArrayPlugin.implementedFunctions={ARRAYFORMULA:{method:"arrayformula",arraySizeMethod:"arrayformulaArraySize",arrayFunction:!0,parameters:[{argumentType:FunctionArgumentType.ANY}]},ARRAY_CONSTRAIN:{method:"arrayconstrain",arraySizeMethod:"arrayconstrainArraySize",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.INTEGER,minValue:1},{argumentType:FunctionArgumentType.INTEGER,minValue:1}],vectorizationForbidden:!0},FILTER:{method:"filter",arraySizeMethod:"filterArraySize",arrayFunction:!0,parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class AbsPlugin extends FunctionPlugin{abs(e,t){return this.runFunction(e.args,t,this.metadata("ABS"),Math.abs)}}AbsPlugin.implementedFunctions={ABS:{method:"abs",parameters:[{argumentType:FunctionArgumentType.NUMBER}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const MAX_48BIT_INTEGER=0xffffffffffff,SHIFT_MIN_POSITIONS=-53,SHIFT_MAX_POSITIONS=53;class BitShiftPlugin extends FunctionPlugin{bitlshift(e,t){return this.runFunction(e.args,t,this.metadata("BITLSHIFT"),shiftLeft)}bitrshift(e,t){return this.runFunction(e.args,t,this.metadata("BITRSHIFT"),shiftRight)}}BitShiftPlugin.implementedFunctions={BITLSHIFT:{method:"bitlshift",parameters:[{argumentType:FunctionArgumentType.INTEGER,minValue:0},{argumentType:FunctionArgumentType.INTEGER,minValue:SHIFT_MIN_POSITIONS,maxValue:SHIFT_MAX_POSITIONS}]},BITRSHIFT:{method:"bitrshift",parameters:[{argumentType:FunctionArgumentType.INTEGER,minValue:0},{argumentType:FunctionArgumentType.INTEGER,minValue:SHIFT_MIN_POSITIONS,maxValue:SHIFT_MAX_POSITIONS}]}};function shiftLeft(i,e){return e<0?shiftRight(i,-e):validate(i*Math.pow(2,e))}function shiftRight(i,e){return e<0?shiftLeft(i,-e):validate(Math.floor(i/Math.pow(2,e)))}function validate(i){return i>MAX_48BIT_INTEGER?new CellError(ErrorType.NUM,ErrorMessage.BitshiftLong):i}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class BitwiseLogicOperationsPlugin extends FunctionPlugin{bitand(e,t){return this.runFunction(e.args,t,this.metadata("BITAND"),(r,a)=>r&a)}bitor(e,t){return this.runFunction(e.args,t,this.metadata("BITOR"),(r,a)=>r|a)}bitxor(e,t){return this.runFunction(e.args,t,this.metadata("BITXOR"),(r,a)=>r^a)}}BitwiseLogicOperationsPlugin.implementedFunctions={BITAND:{method:"bitand",parameters:[{argumentType:FunctionArgumentType.INTEGER,minValue:0},{argumentType:FunctionArgumentType.INTEGER,minValue:0}]},BITOR:{method:"bitor",parameters:[{argumentType:FunctionArgumentType.INTEGER,minValue:0},{argumentType:FunctionArgumentType.INTEGER,minValue:0}]},BITXOR:{method:"bitxor",parameters:[{argumentType:FunctionArgumentType.INTEGER,minValue:0},{argumentType:FunctionArgumentType.INTEGER,minValue:0}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class BooleanPlugin extends FunctionPlugin{literalTrue(e,t){return this.runFunction(e.args,t,this.metadata("TRUE"),()=>!0)}literalFalse(e,t){return this.runFunction(e.args,t,this.metadata("FALSE"),()=>!1)}conditionalIf(e,t){return this.runFunction(e.args,t,this.metadata("IF"),(r,a,o)=>r?a:o)}ifs(e,t){return this.runFunction(e.args,t,this.metadata("IFS"),(...r)=>{for(let a=0;a<r.length;a+=2)if(r[a])return r[a+1];return new CellError(ErrorType.NA,ErrorMessage.NoConditionMet)})}and(e,t){return this.runFunction(e.args,t,this.metadata("AND"),(...r)=>r.filter(a=>a!==void 0).every(a=>!!a))}or(e,t){return this.runFunction(e.args,t,this.metadata("OR"),(...r)=>r.filter(a=>a!==void 0).some(a=>a))}not(e,t){return this.runFunction(e.args,t,this.metadata("NOT"),r=>!r)}xor(e,t){return this.runFunction(e.args,t,this.metadata("XOR"),(...r)=>{let a=0;return r.filter(o=>o!==void 0).forEach(o=>{o&&a++}),a%2===1})}switch(e,t){return this.runFunction(e.args,t,this.metadata("SWITCH"),(r,...a)=>{const o=a.length;let u=0;for(;u+1<o;u+=2)if(!(a[u]instanceof CellError)&&this.arithmeticHelper.eq(r,a[u]))return a[u+1];return u<o?a[u]:new CellError(ErrorType.NA,ErrorMessage.NoDefault)})}iferror(e,t){return this.runFunction(e.args,t,this.metadata("IFERROR"),(r,a)=>r instanceof CellError?a:r)}ifna(e,t){return this.runFunction(e.args,t,this.metadata("IFNA"),(r,a)=>r instanceof CellError&&r.type===ErrorType.NA?a:r)}choose(e,t){return this.runFunction(e.args,t,this.metadata("CHOOSE"),(r,...a)=>r>a.length?new CellError(ErrorType.NUM,ErrorMessage.Selector):a[r-1])}}BooleanPlugin.implementedFunctions={TRUE:{method:"literalTrue",parameters:[]},FALSE:{method:"literalFalse",parameters:[]},IF:{method:"conditionalIf",parameters:[{argumentType:FunctionArgumentType.BOOLEAN},{argumentType:FunctionArgumentType.SCALAR,passSubtype:!0},{argumentType:FunctionArgumentType.SCALAR,defaultValue:!1,passSubtype:!0}]},IFS:{method:"ifs",parameters:[{argumentType:FunctionArgumentType.BOOLEAN},{argumentType:FunctionArgumentType.SCALAR,passSubtype:!0}],repeatLastArgs:2},AND:{method:"and",parameters:[{argumentType:FunctionArgumentType.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},OR:{method:"or",parameters:[{argumentType:FunctionArgumentType.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},XOR:{method:"xor",parameters:[{argumentType:FunctionArgumentType.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},NOT:{method:"not",parameters:[{argumentType:FunctionArgumentType.BOOLEAN}]},SWITCH:{method:"switch",parameters:[{argumentType:FunctionArgumentType.NOERROR},{argumentType:FunctionArgumentType.SCALAR,passSubtype:!0},{argumentType:FunctionArgumentType.SCALAR,passSubtype:!0}],repeatLastArgs:1},IFERROR:{method:"iferror",parameters:[{argumentType:FunctionArgumentType.SCALAR,passSubtype:!0},{argumentType:FunctionArgumentType.SCALAR,passSubtype:!0}]},IFNA:{method:"ifna",parameters:[{argumentType:FunctionArgumentType.SCALAR,passSubtype:!0},{argumentType:FunctionArgumentType.SCALAR,passSubtype:!0}]},CHOOSE:{method:"choose",parameters:[{argumentType:FunctionArgumentType.INTEGER,minValue:1},{argumentType:FunctionArgumentType.SCALAR,passSubtype:!0}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class CharPlugin extends FunctionPlugin{char(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),r=>r<1||r>=256?new CellError(ErrorType.VALUE,ErrorMessage.CharacterCodeBounds):String.fromCharCode(Math.trunc(r)))}unichar(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),r=>r<1||r>=1114112?new CellError(ErrorType.VALUE,ErrorMessage.CharacterCodeBounds):String.fromCodePoint(Math.trunc(r)))}}CharPlugin.implementedFunctions={CHAR:{method:"char",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},UNICHAR:{method:"unichar",parameters:[{argumentType:FunctionArgumentType.NUMBER}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class CodePlugin extends FunctionPlugin{code(e,t){return this.runFunction(e.args,t,this.metadata("CODE"),r=>r.length===0?new CellError(ErrorType.VALUE,ErrorMessage.EmptyString):r.charCodeAt(0))}unicode(e,t){return this.runFunction(e.args,t,this.metadata("UNICODE"),r=>{var a;return(a=r.codePointAt(0))!==null&&a!==void 0?a:new CellError(ErrorType.VALUE,ErrorMessage.EmptyString)})}}CodePlugin.implementedFunctions={CODE:{method:"code",parameters:[{argumentType:FunctionArgumentType.STRING}]},UNICODE:{method:"unicode",parameters:[{argumentType:FunctionArgumentType.STRING}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class CountBlankPlugin extends FunctionPlugin{countblank(e,t){return this.runFunction(e.args,t,this.metadata("COUNTBLANK"),(...r)=>{let a=0;return r.forEach(o=>{o===EmptyValue&&a++}),a})}}CountBlankPlugin.implementedFunctions={COUNTBLANK:{method:"countblank",parameters:[{argumentType:FunctionArgumentType.SCALAR}],repeatLastArgs:1,expandRanges:!0}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class CountUniquePlugin extends FunctionPlugin{countunique(e,t){return this.runFunction(e.args,t,this.metadata("COUNTUNIQUE"),(...r)=>{const a=new Set,o=new Set;for(const u of r)u instanceof CellError?o.add(u.type):u!==""&&a.add(u);return a.size+o.size})}}CountUniquePlugin.implementedFunctions={COUNTUNIQUE:{method:"countunique",parameters:[{argumentType:FunctionArgumentType.SCALAR}],repeatLastArgs:1,expandRanges:!0}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class DateTimePlugin extends FunctionPlugin{constructor(){super(...arguments),this.isoweeknumCore=e=>{const t=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e)),r=this.dateTimeHelper.numberToSimpleDate(e),a=this.dateTimeHelper.dateToNumber({year:r.year,month:1,day:1}),o=this.dateTimeHelper.relativeNumberToAbsoluteNumber(a),u=o+((4-o)%7+7)%7,c=Math.floor((t-1)/7)-Math.floor((u-1)/7)+1;return c===0?this.isoweeknumCore(e-7)+1:c},this.days360Core=(e,t,r)=>{const a=this.dateTimeHelper.numberToSimpleDate(e),o=this.dateTimeHelper.numberToSimpleDate(t);let u,c;return r?(u=toBasisEU(a),c=toBasisEU(o)):[u,c]=this.dateTimeHelper.toBasisUS(a,o),360*(c.year-u.year)+30*(c.month-u.month)+c.day-u.day}}date(e,t){return this.runFunction(e.args,t,this.metadata("DATE"),(r,a,o)=>{const u=Math.trunc(o);let c=Math.trunc(a),h=Math.trunc(r);h<this.dateTimeHelper.getEpochYearZero()&&(h+=this.dateTimeHelper.getEpochYearZero());const d=Math.floor((c-1)/12);h+=d,c-=d*12;const p={year:h,month:c,day:1};if(this.dateTimeHelper.isValidDate(p)){let m=this.dateTimeHelper.dateToNumber(p)+(u-1);return m=this.dateTimeHelper.getWithinBounds(m),m===void 0?new CellError(ErrorType.NUM,ErrorMessage.DateBounds):m}return new CellError(ErrorType.VALUE,ErrorMessage.InvalidDate)})}time(e,t){return this.runFunction(e.args,t,this.metadata("TIME"),(r,a,o)=>{const u=timeToNumber({hours:Math.trunc(r),minutes:Math.trunc(a),seconds:Math.trunc(o)});return u<0?new CellError(ErrorType.NUM,ErrorMessage.NegativeTime):u%1})}eomonth(e,t){return this.runFunction(e.args,t,this.metadata("EOMONTH"),(r,a)=>{const o=this.dateTimeHelper.numberToSimpleDate(r);let u=this.dateTimeHelper.dateToNumber(this.dateTimeHelper.endOfMonth(offsetMonth(o,a)));return u=this.dateTimeHelper.getWithinBounds(u),u===void 0?new CellError(ErrorType.NUM,ErrorMessage.DateBounds):u})}day(e,t){return this.runFunction(e.args,t,this.metadata("DAY"),r=>this.dateTimeHelper.numberToSimpleDate(r).day)}days(e,t){return this.runFunction(e.args,t,this.metadata("DAYS"),(r,a)=>Math.trunc(r)-Math.trunc(a))}month(e,t){return this.runFunction(e.args,t,this.metadata("MONTH"),r=>this.dateTimeHelper.numberToSimpleDate(r).month)}year(e,t){return this.runFunction(e.args,t,this.metadata("YEAR"),r=>this.dateTimeHelper.numberToSimpleDate(r).year)}hour(e,t){return this.runFunction(e.args,t,this.metadata("HOUR"),r=>numberToSimpleTime(roundToNearestSecond(r)%1).hours)}minute(e,t){return this.runFunction(e.args,t,this.metadata("MINUTE"),r=>numberToSimpleTime(roundToNearestSecond(r)%1).minutes)}second(e,t){return this.runFunction(e.args,t,this.metadata("SECOND"),r=>numberToSimpleTime(roundToNearestSecond(r)%1).seconds)}text(e,t){return this.runFunction(e.args,t,this.metadata("TEXT"),(r,a)=>format(r,a,this.config,this.dateTimeHelper))}weekday(e,t){return this.runFunction(e.args,t,this.metadata("WEEKDAY"),(r,a)=>{const o=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(r));if(a===3)return(o-1)%7;const u=weekdayOffsets.get(a);return u===void 0?new CellError(ErrorType.NUM,ErrorMessage.BadMode):(o-u)%7+1})}weeknum(e,t){return this.runFunction(e.args,t,this.metadata("WEEKNUM"),(r,a)=>{const o=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(r)),u=this.dateTimeHelper.numberToSimpleDate(r),c=this.dateTimeHelper.dateToNumber({year:u.year,month:1,day:1}),h=this.dateTimeHelper.relativeNumberToAbsoluteNumber(c);if(a===21)return this.isoweeknumCore(r);const d=weekdayOffsets.get(a);return d===void 0?new CellError(ErrorType.NUM,ErrorMessage.BadMode):Math.floor((o-d)/7)-Math.floor((h-d)/7)+1})}isoweeknum(e,t){return this.runFunction(e.args,t,this.metadata("ISOWEEKNUM"),this.isoweeknumCore)}datevalue(e,t){return this.runFunction(e.args,t,this.metadata("DATEVALUE"),r=>{const{dateTime:a}=this.dateTimeHelper.parseDateTimeFromConfigFormats(r);return a===void 0?new CellError(ErrorType.VALUE,ErrorMessage.IncorrectDateTime):instanceOfSimpleDate(a)?(instanceOfSimpleTime(a)?Math.trunc(timeToNumber(a)):0)+this.dateTimeHelper.dateToNumber(a):0})}timevalue(e,t){return this.runFunction(e.args,t,this.metadata("TIMEVALUE"),r=>{const a=this.dateTimeHelper.dateStringToDateNumber(r);return a===void 0?new CellError(ErrorType.VALUE,ErrorMessage.IncorrectDateTime):getRawValue(a)%1})}now(e,t){return this.runFunction(e.args,t,this.metadata("NOW"),()=>{const r=new Date(Date.now());return timeToNumber({hours:r.getHours(),minutes:r.getMinutes(),seconds:r.getSeconds()})+this.dateTimeHelper.dateToNumber({year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()})})}today(e,t){return this.runFunction(e.args,t,this.metadata("TODAY"),()=>{const r=new Date(Date.now());return this.dateTimeHelper.dateToNumber({year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()})})}edate(e,t){return this.runFunction(e.args,t,this.metadata("EDATE"),(r,a)=>{const o=this.dateTimeHelper.numberToSimpleDate(r),u=truncateDayInMonth(offsetMonth(o,a));let c=this.dateTimeHelper.dateToNumber(u);return c=this.dateTimeHelper.getWithinBounds(c),c===void 0?new CellError(ErrorType.NUM,ErrorMessage.DateBounds):c})}datedif(e,t){return this.runFunction(e.args,t,this.metadata("DATEDIF"),(r,a,o)=>{if(r>a)return new CellError(ErrorType.NUM,ErrorMessage.StartEndDate);if(o==="D")return Math.floor(a)-Math.floor(r);const u=this.dateTimeHelper.numberToSimpleDate(r),c=this.dateTimeHelper.numberToSimpleDate(a);switch(o){case"M":return(c.year-u.year)*12+(c.month-u.month)-(c.day<u.day?1:0);case"YM":return(12+(c.month-u.month)-(c.day<u.day?1:0))%12;case"Y":return c.month>u.month||c.month===u.month&&c.day>=u.day?c.year-u.year:c.year-u.year-1;case"MD":if(c.day>=u.day)return c.day-u.day;{const h=c.month===1?12:c.month-1,d=c.month===1?c.year-1:c.year;return this.dateTimeHelper.daysInMonth(d,h)+c.day-u.day}case"YD":return c.month>u.month||c.month===u.month&&c.day>=u.day?Math.floor(a)-this.dateTimeHelper.dateToNumber({year:c.year,month:u.month,day:u.day}):Math.floor(a)-Math.floor(r)-365*(c.year-u.year-1)-this.dateTimeHelper.leapYearsCount(c.year-1)+this.dateTimeHelper.leapYearsCount(u.year);default:return new CellError(ErrorType.NUM,ErrorMessage.BadMode)}})}days360(e,t){return this.runFunction(e.args,t,this.metadata("DAYS360"),this.days360Core)}yearfrac(e,t){return this.runFunction(e.args,t,this.metadata("YEARFRAC"),(r,a,o)=>{switch(r=Math.trunc(r),a=Math.trunc(a),r>a&&([r,a]=[a,r]),o){case 0:return this.days360Core(r,a,!1)/360;case 1:return(a-r)/this.dateTimeHelper.yearLengthForBasis(this.dateTimeHelper.numberToSimpleDate(r),this.dateTimeHelper.numberToSimpleDate(a));case 2:return(a-r)/360;case 3:return(a-r)/365;case 4:return this.days360Core(r,a,!0)/360}throw new Error("Should not be reachable.")})}interval(e,t){return this.runFunction(e.args,t,this.metadata("INTERVAL"),r=>{r=Math.trunc(r);const a=r%60;r=Math.trunc(r/60);const o=r%60;r=Math.trunc(r/60);const u=r%24;r=Math.trunc(r/24);const c=r%30;r=Math.trunc(r/30);const h=r%12,d=Math.trunc(r/12);return"P"+(d>0?`${d}Y`:"")+(h>0?`${h}M`:"")+(c>0?`${c}D`:"")+"T"+(u>0?`${u}H`:"")+(o>0?`${o}M`:"")+(a>0?`${a}S`:"")})}networkdays(e,t){return this.runFunction(e.args,t,this.metadata("NETWORKDAYS"),(r,a,o)=>this.networkdayscore(r,a,1,o))}networkdaysintl(e,t){return this.runFunction(e.args,t,this.metadata("NETWORKDAYS.INTL"),(r,a,o,u)=>this.networkdayscore(r,a,o,u))}workday(e,t){return this.runFunction(e.args,t,this.metadata("WORKDAY"),(r,a,o)=>this.workdaycore(r,a,1,o))}workdayintl(e,t){return this.runFunction(e.args,t,this.metadata("WORKDAY.INTL"),(r,a,o,u)=>this.workdaycore(r,a,o,u))}networkdayscore(e,t,r,a){e=Math.trunc(e),t=Math.trunc(t);let o=1;e>t&&([e,t]=[t,e],o=-1);const u=computeWeekendPattern(r);if(u instanceof CellError)return u;const c=this.simpleRangeToFilteredHolidays(u,a);return c instanceof CellError?c:o*this.countWorkdays(e,t,u,c)}workdaycore(e,t,r,a){e=Math.trunc(e),t=Math.trunc(t);const o=computeWeekendPattern(r);if(o instanceof CellError)return o;const u=this.simpleRangeToFilteredHolidays(o,a);if(u instanceof CellError)return u;if(t>0){let c=1;for(;this.countWorkdays(e+1,e+c,o,u)<t;)c*=2;let h=1;for(;h+1<c;){const d=Math.trunc((h+c)/2);this.countWorkdays(e+1,e+d,o,u)<t?h=d:c=d}return e+c}else if(t<0){t*=-1;let c=1;for(;this.countWorkdays(e-c,e-1,o,u)<t;)c*=2;let h=1;for(;h+1<c;){const d=Math.trunc((h+c)/2);this.countWorkdays(e-d,e-1,o,u)<t?h=d:c=d}return e-c}else return e}countWorkdays(e,t,r,a){const o=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(t)),u=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e));let c=0;for(let h=0;h<7;h++)r.charAt(h)==="0"&&(c+=Math.floor((o+6-h)/7),c-=Math.floor((u-1+6-h)/7));return c-=lowerBound(t+1,a)-lowerBound(e,a),c}simpleRangeToFilteredHolidays(e,t){var r;const a=(r=t==null?void 0:t.valuesFromTopLeftCorner())!==null&&r!==void 0?r:[];for(const u of a)if(u instanceof CellError)return u;const o=[];for(const u of a)if(u!==EmptyValue)if(isExtendedNumber(u))o.push(Math.trunc(getRawValue(u)));else return new CellError(ErrorType.VALUE,ErrorMessage.WrongType);return[...new Set(o)].sort((u,c)=>u-c).filter(u=>{const h=(this.dateTimeHelper.relativeNumberToAbsoluteNumber(u)-1)%7;return e.charAt(h)==="0"})}}DateTimePlugin.implementedFunctions={DATE:{method:"date",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}],returnNumberType:NumberType.NUMBER_DATE},TIME:{method:"time",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}],returnNumberType:NumberType.NUMBER_TIME},MONTH:{method:"month",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},YEAR:{method:"year",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},HOUR:{method:"hour",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},MINUTE:{method:"minute",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},SECOND:{method:"second",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},TEXT:{method:"text",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.STRING}]},EOMONTH:{method:"eomonth",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER}],returnNumberType:NumberType.NUMBER_DATE},DAY:{method:"day",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},DAYS:{method:"days",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},WEEKDAY:{method:"weekday",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,defaultValue:1}]},WEEKNUM:{method:"weeknum",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,defaultValue:1}]},ISOWEEKNUM:{method:"isoweeknum",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},DATEVALUE:{method:"datevalue",parameters:[{argumentType:FunctionArgumentType.STRING}],returnNumberType:NumberType.NUMBER_DATE},TIMEVALUE:{method:"timevalue",parameters:[{argumentType:FunctionArgumentType.STRING}],returnNumberType:NumberType.NUMBER_TIME},NOW:{method:"now",parameters:[],isVolatile:!0,returnNumberType:NumberType.NUMBER_DATETIME},TODAY:{method:"today",parameters:[],isVolatile:!0,returnNumberType:NumberType.NUMBER_DATE},EDATE:{method:"edate",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER}],returnNumberType:NumberType.NUMBER_DATE},DAYS360:{method:"days360",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.BOOLEAN,defaultValue:!1}]},DATEDIF:{method:"datedif",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.STRING}]},YEARFRAC:{method:"yearfrac",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.INTEGER,defaultValue:0,minValue:0,maxValue:4}]},INTERVAL:{method:"interval",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},NETWORKDAYS:{method:"networkdays",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.RANGE,optionalArg:!0}]},"NETWORKDAYS.INTL":{method:"networkdaysintl",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NOERROR,defaultValue:1},{argumentType:FunctionArgumentType.RANGE,optionalArg:!0}]},WORKDAY:{method:"workday",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.RANGE,optionalArg:!0}]},"WORKDAY.INTL":{method:"workdayintl",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NOERROR,defaultValue:1},{argumentType:FunctionArgumentType.RANGE,optionalArg:!0}]}};function lowerBound(i,e){if(e.length===0||i<=e[0])return 0;if(e[e.length-1]<i)return e.length;let t=0,r=e.length-1;for(;t+1<r;){const a=Math.floor((r+t)/2);e[a]>=i?r=a:t=a}return r}function computeWeekendPattern(i){var e;return typeof i!="number"&&typeof i!="string"?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):typeof i=="string"?i.length!==7||!/^(0|1)*$/.test(i)||i==="1111111"?new CellError(ErrorType.NUM,ErrorMessage.WeekendString):i:(e=workdayPatterns.get(i))!==null&&e!==void 0?e:new CellError(ErrorType.NUM,ErrorMessage.BadMode)}const weekdayOffsets=new Map([[1,0],[2,1],[11,1],[12,2],[13,3],[14,4],[15,5],[16,6],[17,0]]),workdayPatterns=new Map([[1,"0000011"],[2,"1000001"],[3,"1100000"],[4,"0110000"],[5,"0011000"],[6,"0001100"],[7,"0000110"],[11,"0000001"],[12,"1000000"],[13,"0100000"],[14,"0010000"],[15,"0001000"],[16,"0000100"],[17,"0000010"]]);/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class DegreesPlugin extends FunctionPlugin{degrees(e,t){return this.runFunction(e.args,t,this.metadata("DEGREES"),r=>r*(180/Math.PI))}}DegreesPlugin.implementedFunctions={DEGREES:{method:"degrees",parameters:[{argumentType:FunctionArgumentType.NUMBER}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class DeltaPlugin extends FunctionPlugin{delta(e,t){return this.runFunction(e.args,t,this.metadata("DELTA"),(r,a)=>r===a?1:0)}}DeltaPlugin.implementedFunctions={DELTA:{method:"delta",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ExpPlugin extends FunctionPlugin{exp(e,t){return this.runFunction(e.args,t,this.metadata("EXP"),Math.exp)}}ExpPlugin.implementedFunctions={EXP:{method:"exp",parameters:[{argumentType:FunctionArgumentType.NUMBER}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class FinancialPlugin extends FunctionPlugin{pmt(e,t){return this.runFunction(e.args,t,this.metadata("PMT"),pmtCore)}ipmt(e,t){return this.runFunction(e.args,t,this.metadata("IPMT"),ipmtCore)}ppmt(e,t){return this.runFunction(e.args,t,this.metadata("PPMT"),ppmtCore)}fv(e,t){return this.runFunction(e.args,t,this.metadata("FV"),fvCore)}cumipmt(e,t){return this.runFunction(e.args,t,this.metadata("CUMIPMT"),(r,a,o,u,c,h)=>{if(u>c)return new CellError(ErrorType.NUM,ErrorMessage.EndStartPeriod);let d=0;for(let p=u;p<=c;p++)d+=ipmtCore(r,p,a,o,0,h);return d})}cumprinc(e,t){return this.runFunction(e.args,t,this.metadata("CUMPRINC"),(r,a,o,u,c,h)=>{if(u>c)return new CellError(ErrorType.NUM,ErrorMessage.EndStartPeriod);let d=0;for(let p=u;p<=c;p++)d+=ppmtCore(r,p,a,o,0,h);return d})}db(e,t){return this.runFunction(e.args,t,this.metadata("DB"),(r,a,o,u,c)=>{if(c===12&&u>o||u>o+1)return new CellError(ErrorType.NUM,ErrorMessage.PeriodLong);if(a>=r)return 0;const h=Math.round((1-Math.pow(a/r,1/o))*1e3)/1e3,d=r*h*c/12;if(u===1)return d;let p=d;for(let m=0;m<u-2;m++)p+=(r-p)*h;return u===o+1?(r-p)*h*(12-c)/12:(r-p)*h})}ddb(e,t){return this.runFunction(e.args,t,this.metadata("DDB"),(r,a,o,u,c)=>{if(u>o)return new CellError(ErrorType.NUM);let h=c/o,d;h>=1?(h=1,u===1?d=r:d=0):d=r*Math.pow(1-h,u-1);const p=r*Math.pow(1-h,u);return Math.max(d-Math.max(a,p),0)})}dollarde(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARDE"),(r,a)=>{if(a<1)return new CellError(ErrorType.DIV_BY_ZERO);for(a=Math.trunc(a);a>10;)a/=10;return Math.trunc(r)+(r-Math.trunc(r))*10/a})}dollarfr(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARFR"),(r,a)=>{if(a<1)return new CellError(ErrorType.DIV_BY_ZERO);for(a=Math.trunc(a);a>10;)a/=10;return Math.trunc(r)+(r-Math.trunc(r))*a/10})}effect(e,t){return this.runFunction(e.args,t,this.metadata("EFFECT"),(r,a)=>(a=Math.trunc(a),Math.pow(1+r/a,a)-1))}ispmt(e,t){return this.runFunction(e.args,t,this.metadata("ISPMT"),(r,a,o,u)=>o===0?new CellError(ErrorType.DIV_BY_ZERO):u*r*(a/o-1))}nominal(e,t){return this.runFunction(e.args,t,this.metadata("NOMINAL"),(r,a)=>(a=Math.trunc(a),(Math.pow(r+1,1/a)-1)*a))}nper(e,t){return this.runFunction(e.args,t,this.metadata("NPER"),(r,a,o,u,c)=>r===0?a===0?new CellError(ErrorType.DIV_BY_ZERO):(-o-u)/a:(c&&(a*=1+r),Math.log((a-u*r)/(o*r+a))/Math.log(1+r)))}rate(e,t){return this.runFunction(e.args,t,this.metadata("RATE"),(r,a,o,u,c,h)=>{if(h<=-1)return new CellError(ErrorType.VALUE);const d=1e-7,p=50;let m=h;c=c?1:0;for(let f=0;f<p;f++){if(m<=-1)return new CellError(ErrorType.NUM);let g;if(Math.abs(m)<d)g=o*(1+r*m)+a*(1+m*c)*r+u;else{const T=Math.pow(1+m,r);g=o*T+a*(1/m+c)*(T-1)+u}if(Math.abs(g)<d)return m;let y;if(Math.abs(m)<d)y=o*r+a*c*r;else{const T=Math.pow(1+m,r),A=r*Math.pow(1+m,r-1);y=o*A+a*(1/m+c)*A+a*(-1/(m*m))*(T-1)}m-=g/y}return new CellError(ErrorType.NUM)})}pv(e,t){return this.runFunction(e.args,t,this.metadata("PV"),(r,a,o,u,c)=>(c=c?1:0,r===-1?a===0?new CellError(ErrorType.NUM):new CellError(ErrorType.DIV_BY_ZERO):r===0?-o*a-u:((1-Math.pow(1+r,a))*o*(1+r*c)/r-u)/Math.pow(1+r,a)))}rri(e,t){return this.runFunction(e.args,t,this.metadata("RRI"),(r,a,o)=>a===0||o<0&&a>0||o>0&&a<0?new CellError(ErrorType.NUM):Math.pow(o/a,1/r)-1)}sln(e,t){return this.runFunction(e.args,t,this.metadata("SLN"),(r,a,o)=>o===0?new CellError(ErrorType.DIV_BY_ZERO):(r-a)/o)}syd(e,t){return this.runFunction(e.args,t,this.metadata("SYD"),(r,a,o,u)=>u>o?new CellError(ErrorType.NUM):(r-a)*(o-u+1)*2/(o*(o+1)))}tbilleq(e,t){return this.runFunction(e.args,t,this.metadata("TBILLEQ"),(r,a,o)=>{if(r=Math.round(r),a=Math.round(a),r>=a)return new CellError(ErrorType.NUM);const u=this.dateTimeHelper.numberToSimpleDate(r),c=this.dateTimeHelper.numberToSimpleDate(a);if(c.year>u.year+1||c.year===u.year+1&&(c.month>u.month||c.month===u.month&&c.day>u.day))return new CellError(ErrorType.NUM);const h=360-o*(a-r);return h===0?0:h<0?new CellError(ErrorType.NUM):365*o/h})}tbillprice(e,t){return this.runFunction(e.args,t,this.metadata("TBILLPRICE"),(r,a,o)=>{if(r=Math.round(r),a=Math.round(a),r>=a)return new CellError(ErrorType.NUM);const u=this.dateTimeHelper.numberToSimpleDate(r),c=this.dateTimeHelper.numberToSimpleDate(a);if(c.year>u.year+1||c.year===u.year+1&&(c.month>u.month||c.month===u.month&&c.day>u.day))return new CellError(ErrorType.NUM);const h=360-o*(a-r);return h===0?0:h<0?new CellError(ErrorType.NUM):100*(1-o*(a-r)/360)})}tbillyield(e,t){return this.runFunction(e.args,t,this.metadata("TBILLYIELD"),(r,a,o)=>{if(r=Math.round(r),a=Math.round(a),r>=a)return new CellError(ErrorType.NUM);const u=this.dateTimeHelper.numberToSimpleDate(r),c=this.dateTimeHelper.numberToSimpleDate(a);return c.year>u.year+1||c.year===u.year+1&&(c.month>u.month||c.month===u.month&&c.day>u.day)?new CellError(ErrorType.NUM):(100-o)*360/(o*(a-r))})}fvschedule(e,t){return this.runFunction(e.args,t,this.metadata("FVSCHEDULE"),(r,a)=>{const o=a.valuesFromTopLeftCorner();for(const u of o)if(u instanceof CellError)return u;for(const u of o)if(isExtendedNumber(u))r*=1+getRawValue(u);else if(u!==EmptyValue)return new CellError(ErrorType.VALUE,ErrorMessage.NumberExpected);return r})}npv(e,t){return this.runFunction(e.args,t,this.metadata("NPV"),(r,...a)=>{const o=this.arithmeticHelper.coerceNumbersExactRanges(a);return o instanceof CellError?o:npvCore(r,o)})}mirr(e,t){return this.runFunction(e.args,t,this.metadata("MIRR"),(r,a,o)=>{const u=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());if(u instanceof CellError)return u;let c=!1,h=!1;const d=[],p=[];for(const y of u)y>0?(c=!0,d.push(y),p.push(0)):y<0?(h=!0,p.push(y),d.push(0)):(p.push(0),d.push(0));if(!c||!h)return new CellError(ErrorType.DIV_BY_ZERO);const m=u.length,f=npvCore(o,d);if(f instanceof CellError)return f;const g=npvCore(a,p);return g instanceof CellError?g:Math.pow(-f*Math.pow(1+o,m)/g/(1+a),1/(m-1))-1})}pduration(e,t){return this.runFunction(e.args,t,this.metadata("PDURATION"),(r,a,o)=>(Math.log(o)-Math.log(a))/Math.log(1+r))}xnpv(e,t){return this.runFunction(e.args,t,this.metadata("XNPV"),(r,a,o)=>{const u=a.valuesFromTopLeftCorner();for(const f of u)if(typeof f!="number")return new CellError(ErrorType.VALUE,ErrorMessage.NumberExpected);const c=u,h=o.valuesFromTopLeftCorner();for(const f of h)if(typeof f!="number")return new CellError(ErrorType.VALUE,ErrorMessage.NumberExpected);const d=h;if(d.length!==c.length)return new CellError(ErrorType.NUM,ErrorMessage.EqualLength);const p=d.length;let m=0;if(d[0]<0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);for(let f=0;f<p;f++){if(d[f]=Math.floor(d[f]),d[f]<d[0])return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);m+=c[f]/Math.pow(1+r,(d[f]-d[0])/365)}return m})}}FinancialPlugin.implementedFunctions={PMT:{method:"pmt",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},IPMT:{method:"ipmt",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},PPMT:{method:"ppmt",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},FV:{method:"fv",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},CUMIPMT:{method:"cumipmt",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.INTEGER,minValue:1},{argumentType:FunctionArgumentType.INTEGER,minValue:1},{argumentType:FunctionArgumentType.INTEGER,minValue:0,maxValue:1}],returnNumberType:NumberType.NUMBER_CURRENCY},CUMPRINC:{method:"cumprinc",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.INTEGER,minValue:1},{argumentType:FunctionArgumentType.INTEGER,minValue:1},{argumentType:FunctionArgumentType.INTEGER,minValue:0,maxValue:1}],returnNumberType:NumberType.NUMBER_CURRENCY},DB:{method:"db",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.INTEGER,minValue:0},{argumentType:FunctionArgumentType.INTEGER,minValue:0},{argumentType:FunctionArgumentType.INTEGER,minValue:1,maxValue:12,defaultValue:12}],returnNumberType:NumberType.NUMBER_CURRENCY},DDB:{method:"ddb",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.INTEGER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0,defaultValue:2}],returnNumberType:NumberType.NUMBER_CURRENCY},DOLLARDE:{method:"dollarde",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},DOLLARFR:{method:"dollarfr",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},EFFECT:{method:"effect",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:1}],returnNumberType:NumberType.NUMBER_PERCENT},ISPMT:{method:"ispmt",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}]},NOMINAL:{method:"nominal",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:1}],returnNumberType:NumberType.NUMBER_PERCENT},NPER:{method:"nper",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0}]},PV:{method:"pv",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},RATE:{method:"rate",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:FunctionArgumentType.NUMBER,defaultValue:.1}],returnNumberType:NumberType.NUMBER_PERCENT},RRI:{method:"rri",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}],returnNumberType:NumberType.NUMBER_PERCENT},SLN:{method:"sln",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}],returnNumberType:NumberType.NUMBER_CURRENCY},SYD:{method:"syd",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0}],returnNumberType:NumberType.NUMBER_CURRENCY},TBILLEQ:{method:"tbilleq",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0}],returnNumberType:NumberType.NUMBER_PERCENT},TBILLPRICE:{method:"tbillprice",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0}],returnNumberType:NumberType.NUMBER_CURRENCY},TBILLYIELD:{method:"tbillyield",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0}],returnNumberType:NumberType.NUMBER_PERCENT},FVSCHEDULE:{method:"fvschedule",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.RANGE}],returnNumberType:NumberType.NUMBER_CURRENCY},NPV:{method:"npv",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1,returnNumberType:NumberType.NUMBER_CURRENCY},MIRR:{method:"mirr",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}],returnNumberType:NumberType.NUMBER_PERCENT},PDURATION:{method:"pduration",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0}]},XNPV:{method:"xnpv",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:-1},{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE}]}};function pmtCore(i,e,t,r,a){if(i===0)return(-t-r)/e;{const o=Math.pow(1+i,e);return(r*i+t*i*o)*(a?1/(1+i):1)/(1-o)}}function ipmtCore(i,e,t,r,a,o){const u=pmtCore(i,t,r,a,o);return e===1?i*(o?0:-r):i*(o?fvCore(i,e-2,u,r,o)-u:fvCore(i,e-1,u,r,o))}function fvCore(i,e,t,r,a){if(i===0)return-r-t*e;{const o=Math.pow(1+i,e);return t*(a?1+i:1)*(1-o)/i-r*o}}function ppmtCore(i,e,t,r,a,o){return pmtCore(i,t,r,a,o)-ipmtCore(i,e,t,r,a,o)}function npvCore(i,e){let t=0;for(let r=e.length-1;r>=0;r--){if(t+=e[r],i===-1){if(t===0)continue;return new CellError(ErrorType.DIV_BY_ZERO)}t/=1+i}return t}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class FormulaTextPlugin extends FunctionPlugin{formulatext(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("FORMULATEXT"),()=>new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber),r=>{var a;return(a=this.serialization.getCellFormula(r))!==null&&a!==void 0?a:new CellError(ErrorType.NA,ErrorMessage.Formula)})}}FormulaTextPlugin.implementedFunctions={FORMULATEXT:{method:"formulatext",parameters:[{argumentType:FunctionArgumentType.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,isDependentOnSheetStructureChange:!0,vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class HyperlinkPlugin extends FunctionPlugin{hyperlink(e,t){return this.runFunction(e.args,t,this.metadata("HYPERLINK"),(r,a)=>(e.hyperlink=r,a??r))}}HyperlinkPlugin.implementedFunctions={HYPERLINK:{method:"hyperlink",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.STRING,optionalArg:!0}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class InformationPlugin extends FunctionPlugin{isbinary(e,t){return this.runFunction(e.args,t,this.metadata("ISBINARY"),r=>/^[01]{1,10}$/.test(r))}iserr(e,t){return this.runFunction(e.args,t,this.metadata("ISERR"),r=>r instanceof CellError&&r.type!==ErrorType.NA)}iserror(e,t){return this.runFunction(e.args,t,this.metadata("ISERROR"),r=>r instanceof CellError)}isformula(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ISFORMULA"),()=>new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber),r=>this.dependencyGraph.addressMapping.getCell(r)instanceof FormulaVertex)}isblank(e,t){return this.runFunction(e.args,t,this.metadata("ISBLANK"),r=>r===EmptyValue)}isna(e,t){return this.runFunction(e.args,t,this.metadata("ISNA"),r=>r instanceof CellError&&r.type==ErrorType.NA)}isnumber(e,t){return this.runFunction(e.args,t,this.metadata("ISNUMBER"),isExtendedNumber)}islogical(e,t){return this.runFunction(e.args,t,this.metadata("ISLOGICAL"),r=>typeof r=="boolean")}isref(e,t){return this.runFunction(e.args,t,this.metadata("ISREF"),r=>r instanceof CellError&&(r.type==ErrorType.REF||r.type==ErrorType.CYCLE))}istext(e,t){return this.runFunction(e.args,t,this.metadata("ISTEXT"),r=>typeof r=="string")}isnontext(e,t){return this.runFunction(e.args,t,this.metadata("ISNONTEXT"),r=>typeof r!="string")}column(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("COLUMN"),()=>t.formulaAddress.col+1,r=>r.col+1)}columns(e,t){if(e.args.length!==1)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);if(e.args.some(a=>a.type===AstNodeType.EMPTY))return new CellError(ErrorType.NUM,ErrorMessage.EmptyArg);let r=e.args[0];for(;r.type===AstNodeType.PARENTHESIS;)r=r.expression;if(r.type===AstNodeType.CELL_RANGE||r.type===AstNodeType.COLUMN_RANGE)return r.end.col-r.start.col+1;if(r.type===AstNodeType.CELL_REFERENCE)return 1;if(r.type===AstNodeType.ROW_RANGE)return this.config.maxColumns;{const a=this.evaluateAst(r,t);return a instanceof SimpleRangeValue?a.width():a instanceof CellError?a:1}}row(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ROW"),()=>t.formulaAddress.row+1,r=>r.row+1)}rows(e,t){if(e.args.length!==1)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);if(e.args.some(a=>a.type===AstNodeType.EMPTY))return new CellError(ErrorType.NUM,ErrorMessage.EmptyArg);let r=e.args[0];for(;r.type===AstNodeType.PARENTHESIS;)r=r.expression;if(r.type===AstNodeType.CELL_RANGE||r.type===AstNodeType.ROW_RANGE)return r.end.row-r.start.row+1;if(r.type===AstNodeType.CELL_REFERENCE)return 1;if(r.type===AstNodeType.COLUMN_RANGE)return this.config.maxRows;{const a=this.evaluateAst(r,t);return a instanceof SimpleRangeValue?a.height():a instanceof CellError?a:1}}index(e,t){return this.runFunction(e.args,t,this.metadata("INDEX"),(r,a,o)=>{var u,c,h,d,p,m;return o<1||a<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):o>r.width()||a>r.height()?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):(m=(h=(c=(u=r==null?void 0:r.data)===null||u===void 0?void 0:u[a-1])===null||c===void 0?void 0:c[o-1])!==null&&h!==void 0?h:(p=(d=r==null?void 0:r.data)===null||d===void 0?void 0:d[0])===null||p===void 0?void 0:p[0])!==null&&m!==void 0?m:new CellError(ErrorType.VALUE,ErrorMessage.CellRangeExpected)})}na(e,t){return new CellError(ErrorType.NA)}sheet(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEET"),()=>t.formulaAddress.sheet+1,r=>r.sheet+1,r=>{const a=this.dependencyGraph.sheetMapping.get(r);return a!==void 0?a+1:new CellError(ErrorType.NA,ErrorMessage.SheetRef)})}sheets(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEETS"),()=>this.dependencyGraph.sheetMapping.numberOfSheets(),()=>1,()=>new CellError(ErrorType.VALUE,ErrorMessage.CellRefExpected))}}InformationPlugin.implementedFunctions={COLUMN:{method:"column",parameters:[{argumentType:FunctionArgumentType.NOERROR,optionalArg:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},COLUMNS:{method:"columns",parameters:[{argumentType:FunctionArgumentType.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISBINARY:{method:"isbinary",parameters:[{argumentType:FunctionArgumentType.STRING}]},ISERR:{method:"iserr",parameters:[{argumentType:FunctionArgumentType.SCALAR}]},ISFORMULA:{method:"isformula",parameters:[{argumentType:FunctionArgumentType.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISNA:{method:"isna",parameters:[{argumentType:FunctionArgumentType.SCALAR}]},ISREF:{method:"isref",parameters:[{argumentType:FunctionArgumentType.SCALAR}],vectorizationForbidden:!0},ISERROR:{method:"iserror",parameters:[{argumentType:FunctionArgumentType.SCALAR}]},ISBLANK:{method:"isblank",parameters:[{argumentType:FunctionArgumentType.SCALAR}]},ISNUMBER:{method:"isnumber",parameters:[{argumentType:FunctionArgumentType.SCALAR}]},ISLOGICAL:{method:"islogical",parameters:[{argumentType:FunctionArgumentType.SCALAR}]},ISTEXT:{method:"istext",parameters:[{argumentType:FunctionArgumentType.SCALAR}]},ISNONTEXT:{method:"isnontext",parameters:[{argumentType:FunctionArgumentType.SCALAR}]},INDEX:{method:"index",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:1}]},NA:{method:"na",parameters:[]},ROW:{method:"row",parameters:[{argumentType:FunctionArgumentType.NOERROR,optionalArg:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ROWS:{method:"rows",parameters:[{argumentType:FunctionArgumentType.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEET:{method:"sheet",parameters:[{argumentType:FunctionArgumentType.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEETS:{method:"sheets",parameters:[{argumentType:FunctionArgumentType.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class IsEvenPlugin extends FunctionPlugin{iseven(e,t){return this.runFunction(e.args,t,this.metadata("ISEVEN"),r=>r%2===0)}}IsEvenPlugin.implementedFunctions={ISEVEN:{method:"iseven",parameters:[{argumentType:FunctionArgumentType.NUMBER}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class IsOddPlugin extends FunctionPlugin{isodd(e,t){return this.runFunction(e.args,t,this.metadata("ISODD"),r=>r%2===1)}}IsOddPlugin.implementedFunctions={ISODD:{method:"isodd",parameters:[{argumentType:FunctionArgumentType.NUMBER}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class LogarithmPlugin extends FunctionPlugin{log10(e,t){return this.runFunction(e.args,t,this.metadata("LOG10"),Math.log10)}log(e,t){return this.runFunction(e.args,t,this.metadata("LOG"),(r,a)=>Math.log(r)/Math.log(a))}ln(e,t){return this.runFunction(e.args,t,this.metadata("LN"),Math.log)}}LogarithmPlugin.implementedFunctions={LOG10:{method:"log10",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},LOG:{method:"log",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,defaultValue:10,greaterThan:0}]},LN:{method:"ln",parameters:[{argumentType:FunctionArgumentType.NUMBER}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const PI=parseFloat(Math.PI.toFixed(14));class MathConstantsPlugin extends FunctionPlugin{pi(e,t){return this.runFunction(e.args,t,this.metadata("PI"),()=>PI)}sqrtpi(e,t){return this.runFunction(e.args,t,this.metadata("SQRTPI"),r=>Math.sqrt(PI*r))}}MathConstantsPlugin.implementedFunctions={PI:{method:"pi",parameters:[]},SQRTPI:{method:"sqrtpi",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */function arraySizeForMultiplication(i,e){return new ArraySize(e.width,i.height)}function arraySizeForPoolFunction(i,e,t){return new ArraySize(1+(i.width-e)/t,1+(i.height-e)/t)}class MatrixPlugin extends FunctionPlugin{mmult(e,t){return this.runFunction(e.args,t,this.metadata("MMULT"),(r,a)=>{if(!r.hasOnlyNumbers()||!a.hasOnlyNumbers())return new CellError(ErrorType.VALUE,ErrorMessage.NumberRange);if(a.height()!==r.width())return new CellError(ErrorType.VALUE,ErrorMessage.ArrayDimensions);const o=arraySizeForMultiplication(r.size,a.size),u=this.createKernel(function(c,h,d){let p=0;for(let m=0;m<d;++m)p+=c[this.thread.y][m]*h[m][this.thread.x];return p},o)(r.rawNumbers(),a.rawNumbers(),r.width());return SimpleRangeValue.onlyNumbers(u)})}mmultArraySize(e,t){if(e.args.length!==2)return ArraySize.error();const r=this.metadata("MMULT"),a=e.args.map(c=>{var h;return this.arraySizeForAst(c,new InterpreterState(t.formulaAddress,t.arraysFlag||((h=r==null?void 0:r.arrayFunction)!==null&&h!==void 0?h:!1)))}),[o,u]=a;return arraySizeForMultiplication(o,u)}maxpool(e,t){return this.runFunction(e.args,t,this.metadata("MAXPOOL"),(r,a,o=a)=>{if(!r.hasOnlyNumbers())return new CellError(ErrorType.VALUE,ErrorMessage.NumberRange);const u=arraySizeForPoolFunction(r.size,a,o),c=this.createKernel(function(h,d,p){const m=this.thread.x*p,f=this.thread.y*p;let g=h[f][m];for(let y=0;y<d;y++)for(let T=0;T<d;T++)g=Math.max(g,h[f+y][m+T]);return g},u)(r.rawNumbers(),a,o);return SimpleRangeValue.onlyNumbers(c)})}medianpool(e,t){return this.runFunction(e.args,t,this.metadata("MEDIANPOOL"),(r,a,o=a)=>{if(!r.hasOnlyNumbers())return new CellError(ErrorType.VALUE,ErrorMessage.NumberRange);const u=arraySizeForPoolFunction(r.size,a,o),c=this.createKernel(function(h,d,p){const m=this.thread.x*p,f=this.thread.y*p;let g=h[f][m];for(let N=0;N<d;N++)for(let S=0;S<d;S++)g=Math.max(g,h[f+N][m+S]);let y=h[f][m];for(let N=0;N<d;N++)for(let S=0;S<d;S++)y=Math.min(y,h[f+N][m+S]);const T=d*d;let A=y,R=g,C=42;for(let N=0;N<32;N++){const S=(A+R)/2;let _=0;for(let O=0;O<d;O++)for(let I=0;I<d;I++)h[f+O][m+I]>S&&_++;if(d%2===0)if(_===T/2){C=S;break}else _>T/2?A=S:R=S;else if(_===(T-1)/2){C=S;break}else _>(T-1)/2?A=S:R=S}return C},u)(r.rawNumbers(),a,o);return SimpleRangeValue.onlyNumbers(c)})}maxpoolArraySize(e,t){if(e.args.length<2||e.args.length>3)return ArraySize.error();const r=this.metadata("MAXPOOL"),o=e.args.map(d=>{var p;return this.arraySizeForAst(d,new InterpreterState(t.formulaAddress,t.arraysFlag||((p=r==null?void 0:r.arrayFunction)!==null&&p!==void 0?p:!1)))})[0],u=e.args[1];let c;u.type===AstNodeType.NUMBER?c=u.value:c=1;let h=c;if(e.args.length===3){const d=e.args[2];d.type===AstNodeType.NUMBER?h=d.value:h=1}return c>o.width||c>o.height||h>c||(o.width-c)%h!==0||(o.height-c)%h!==0?ArraySize.error():arraySizeForPoolFunction(o,c,h)}medianpoolArraySize(e,t){return this.maxpoolArraySize(e,t)}transpose(e,t){return this.runFunction(e.args,t,this.metadata("TRANSPOSE"),r=>{const a=r.rawData(),o=r.size,u=[];for(let c=0;c<o.width;++c){u[c]=[];for(let h=0;h<o.height;++h)u[c][h]=a[h][c]}return SimpleRangeValue.onlyValues(u)})}transposeArraySize(e,t){if(e.args.length!==1)return ArraySize.error();const r=this.metadata("TRANSPOSE"),a=e.args.map(u=>{var c;return this.arraySizeForAst(u,new InterpreterState(t.formulaAddress,t.arraysFlag||((c=r==null?void 0:r.arrayFunction)!==null&&c!==void 0?c:!1)))}),[o]=a;return new ArraySize(o.height,o.width)}createKernel(e,t){return function(...r){const a=[];for(let o=0;o<t.height;++o){a.push([]);for(let u=0;u<t.width;++u)a[o][u]=e.apply({thread:{x:u,y:o}},r)}return a}}}MatrixPlugin.implementedFunctions={MMULT:{method:"mmult",arraySizeMethod:"mmultArraySize",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE}],vectorizationForbidden:!0},TRANSPOSE:{method:"transpose",arraySizeMethod:"transposeArraySize",parameters:[{argumentType:FunctionArgumentType.RANGE}],vectorizationForbidden:!0},MAXPOOL:{method:"maxpool",arraySizeMethod:"maxpoolArraySize",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0}],vectorizationForbidden:!0},MEDIANPOOL:{method:"medianpool",arraySizeMethod:"medianpoolArraySize",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0}],vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class MedianPlugin extends FunctionPlugin{median(e,t){return this.runFunction(e.args,t,this.metadata("MEDIAN"),(...r)=>{const a=this.arithmeticHelper.coerceNumbersExactRanges(r);return a instanceof CellError?a:a.length===0?new CellError(ErrorType.NUM,ErrorMessage.OneValue):(a.sort((o,u)=>o-u),a.length%2===0?(a[a.length/2-1]+a[a.length/2])/2:a[Math.floor(a.length/2)])})}large(e,t){return this.runFunction(e.args,t,this.metadata("LARGE"),(r,a)=>{const o=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());return o instanceof CellError?o:(o.sort((u,c)=>u-c),a=Math.trunc(a),a>o.length?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):o[o.length-a])})}small(e,t){return this.runFunction(e.args,t,this.metadata("SMALL"),(r,a)=>{const o=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());return o instanceof CellError?o:(o.sort((u,c)=>u-c),a=Math.trunc(a),a>o.length?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):o[a-1])})}}MedianPlugin.implementedFunctions={MEDIAN:{method:"median",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},LARGE:{method:"large",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NUMBER,minValue:1}]},SMALL:{method:"small",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NUMBER,minValue:1}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ModuloPlugin extends FunctionPlugin{mod(e,t){return this.runFunction(e.args,t,this.metadata("MOD"),(r,a)=>a===0?new CellError(ErrorType.DIV_BY_ZERO):r%a)}}ModuloPlugin.implementedFunctions={MOD:{method:"mod",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */function zeroForInfinite$1(i){return isExtendedNumber(i)&&!Number.isFinite(getRawValue(i))?0:i}class MomentsAggregate{constructor(e,t,r){this.sumsq=e,this.sum=t,this.count=r}static single(e){return new MomentsAggregate(e*e,e,1)}compose(e){return new MomentsAggregate(this.sumsq+e.sumsq,this.sum+e.sum,this.count+e.count)}averageValue(){if(this.count>0)return this.sum/this.count}varSValue(){if(this.count>1)return(this.sumsq-this.sum*this.sum/this.count)/(this.count-1)}varPValue(){if(this.count>0)return(this.sumsq-this.sum*this.sum/this.count)/this.count}}MomentsAggregate.empty=new MomentsAggregate(0,0,0);class NumericAggregationPlugin extends FunctionPlugin{constructor(){super(...arguments),this.addWithEpsilonRaw=(e,t)=>this.arithmeticHelper.addWithEpsilonRaw(e,t)}sum(e,t){return this.doSum(e.args,t)}sumsq(e,t){return this.reduce(e.args,t,0,"SUMSQ",this.addWithEpsilonRaw,r=>Math.pow(getRawValue(r),2),strictlyNumbers)}max(e,t){return this.doMax(e.args,t)}maxa(e,t){const r=this.reduce(e.args,t,Number.NEGATIVE_INFINITY,"MAXA",(a,o)=>Math.max(a,o),getRawValue,numbersBooleans);return zeroForInfinite$1(r)}min(e,t){return this.doMin(e.args,t)}mina(e,t){const r=this.reduce(e.args,t,Number.POSITIVE_INFINITY,"MINA",(a,o)=>Math.min(a,o),getRawValue,numbersBooleans);return zeroForInfinite$1(r)}count(e,t){return this.doCount(e.args,t)}counta(e,t){return this.doCounta(e.args,t)}average(e,t){return this.doAverage(e.args,t)}averagea(e,t){var r;const a=this.reduce(e.args,t,MomentsAggregate.empty,"_AGGREGATE_A",(o,u)=>o.compose(u),o=>MomentsAggregate.single(getRawValue(o)),numbersBooleans);return a instanceof CellError?a:(r=a.averageValue())!==null&&r!==void 0?r:new CellError(ErrorType.DIV_BY_ZERO)}vars(e,t){return this.doVarS(e.args,t)}varp(e,t){return this.doVarP(e.args,t)}vara(e,t){var r;const a=this.reduceAggregateA(e.args,t);return a instanceof CellError?a:(r=a.varSValue())!==null&&r!==void 0?r:new CellError(ErrorType.DIV_BY_ZERO)}varpa(e,t){var r;const a=this.reduceAggregateA(e.args,t);return a instanceof CellError?a:(r=a.varPValue())!==null&&r!==void 0?r:new CellError(ErrorType.DIV_BY_ZERO)}stdevs(e,t){return this.doStdevS(e.args,t)}stdevp(e,t){return this.doStdevP(e.args,t)}stdeva(e,t){const r=this.reduceAggregateA(e.args,t);if(r instanceof CellError)return r;{const a=r.varSValue();return a===void 0?new CellError(ErrorType.DIV_BY_ZERO):Math.sqrt(a)}}stdevpa(e,t){const r=this.reduceAggregateA(e.args,t);if(r instanceof CellError)return r;{const a=r.varPValue();return a===void 0?new CellError(ErrorType.DIV_BY_ZERO):Math.sqrt(a)}}product(e,t){return this.doProduct(e.args,t)}subtotal(e,t){if(e.args.length<2)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);const r=this.coerceToType(this.evaluateAst(e.args[0],t),{argumentType:FunctionArgumentType.NUMBER},t),a=e.args.slice(1);switch(r){case 1:case 101:return this.doAverage(a,t);case 2:case 102:return this.doCount(a,t);case 3:case 103:return this.doCounta(a,t);case 4:case 104:return this.doMax(a,t);case 5:case 105:return this.doMin(a,t);case 6:case 106:return this.doProduct(a,t);case 7:case 107:return this.doStdevS(a,t);case 8:case 108:return this.doStdevP(a,t);case 9:case 109:return this.doSum(a,t);case 10:case 110:return this.doVarS(a,t);case 11:case 111:return this.doVarP(a,t);default:return new CellError(ErrorType.VALUE,ErrorMessage.BadMode)}}reduceAggregate(e,t){return this.reduce(e,t,MomentsAggregate.empty,"_AGGREGATE",(r,a)=>r.compose(a),r=>MomentsAggregate.single(getRawValue(r)),strictlyNumbers)}reduceAggregateA(e,t){return this.reduce(e,t,MomentsAggregate.empty,"_AGGREGATE_A",(r,a)=>r.compose(a),r=>MomentsAggregate.single(getRawValue(r)),numbersBooleans)}doAverage(e,t){var r;const a=this.reduceAggregate(e,t);return a instanceof CellError?a:(r=a.averageValue())!==null&&r!==void 0?r:new CellError(ErrorType.DIV_BY_ZERO)}doVarS(e,t){var r;const a=this.reduceAggregate(e,t);return a instanceof CellError?a:(r=a.varSValue())!==null&&r!==void 0?r:new CellError(ErrorType.DIV_BY_ZERO)}doVarP(e,t){var r;const a=this.reduceAggregate(e,t);return a instanceof CellError?a:(r=a.varPValue())!==null&&r!==void 0?r:new CellError(ErrorType.DIV_BY_ZERO)}doStdevS(e,t){const r=this.reduceAggregate(e,t);if(r instanceof CellError)return r;{const a=r.varSValue();return a===void 0?new CellError(ErrorType.DIV_BY_ZERO):Math.sqrt(a)}}doStdevP(e,t){const r=this.reduceAggregate(e,t);if(r instanceof CellError)return r;{const a=r.varPValue();return a===void 0?new CellError(ErrorType.DIV_BY_ZERO):Math.sqrt(a)}}doCount(e,t){return this.reduce(e,t,0,"COUNT",(r,a)=>r+a,getRawValue,r=>isExtendedNumber(r)?1:0)}doCounta(e,t){return this.reduce(e,t,0,"COUNTA",(r,a)=>r+a,getRawValue,r=>r===EmptyValue?0:1)}doMax(e,t){const r=this.reduce(e,t,Number.NEGATIVE_INFINITY,"MAX",(a,o)=>Math.max(a,o),getRawValue,strictlyNumbers);return zeroForInfinite$1(r)}doMin(e,t){const r=this.reduce(e,t,Number.POSITIVE_INFINITY,"MIN",(a,o)=>Math.min(a,o),getRawValue,strictlyNumbers);return zeroForInfinite$1(r)}doSum(e,t){return this.reduce(e,t,0,"SUM",this.addWithEpsilonRaw,getRawValue,strictlyNumbers)}doProduct(e,t){return this.reduce(e,t,1,"PRODUCT",(r,a)=>r*a,getRawValue,strictlyNumbers)}reduce(e,t,r,a,o,u,c){return e.length<1?new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber):e.reduce((h,d)=>{if(h instanceof CellError)return h;if(d.type===AstNodeType.CELL_RANGE||d.type===AstNodeType.COLUMN_RANGE||d.type===AstNodeType.ROW_RANGE){const m=this.evaluateRange(d,t,r,a,o,u,c);return m instanceof CellError?m:o(m,h)}let p;if(p=this.evaluateAst(d,t),p instanceof SimpleRangeValue)return Array.from(p.valuesFromTopLeftCorner()).map(c).filter(f=>f!==void 0).map(f=>f instanceof CellError?f:u(f)).reduce((f,g)=>f instanceof CellError?f:g instanceof CellError?g:o(f,g),h);if(d.type===AstNodeType.CELL_REFERENCE){if(p=c(p),p===void 0)return h}else if(p=this.coerceScalarToNumberOrError(p),p=c(p),p===void 0)return h;return p instanceof CellError?p:o(h,u(p))},r)}evaluateRange(e,t,r,a,o,u,c){let h;try{h=AbsoluteCellRange.fromAst(e,t.formulaAddress)}catch(m){if(m instanceof SheetsNotEqual)return new CellError(ErrorType.REF,ErrorMessage.RangeManySheets);throw m}const d=this.dependencyGraph.getRange(h.start,h.end);if(d===void 0)throw new Error("Range does not exists in graph");let p=d.getFunctionValue(a);return p===void 0&&(p=this.getRangeValues(a,h,d,u,c).reduce((f,g)=>f instanceof CellError?f:g instanceof CellError?g:o(f,g),r),d.setFunctionValue(a,p)),p}getRangeValues(e,t,r,a,o){const u=[],{smallerRangeVertex:c,restRange:h}=this.dependencyGraph.rangeMapping.findSmallerRange(t);let d;if(c!==void 0&&this.dependencyGraph.existsEdge(c,r)){const p=c.getFunctionValue(e);if(p!==void 0)u.push(p);else for(const m of c.range.addresses(this.dependencyGraph)){const f=o(this.dependencyGraph.getScalarValue(m));f instanceof CellError?u.push(f):f!==void 0&&u.push(a(f))}d=h}else d=t;for(const p of d.addresses(this.dependencyGraph)){const m=o(this.dependencyGraph.getScalarValue(p));m instanceof CellError?u.push(m):m!==void 0&&u.push(a(m))}return u}}NumericAggregationPlugin.implementedFunctions={SUM:{method:"sum",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},SUMSQ:{method:"sumsq",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},MAX:{method:"max",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},MIN:{method:"min",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},MAXA:{method:"maxa",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},MINA:{method:"mina",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},COUNT:{method:"count",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},COUNTA:{method:"counta",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},AVERAGE:{method:"average",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},AVERAGEA:{method:"averagea",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},PRODUCT:{method:"product",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},"VAR.S":{method:"vars",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},"VAR.P":{method:"varp",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},VARA:{method:"vara",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},VARPA:{method:"varpa",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},"STDEV.S":{method:"stdevs",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},"STDEV.P":{method:"stdevp",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},STDEVA:{method:"stdeva",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},STDEVPA:{method:"stdevpa",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},SUBTOTAL:{method:"subtotal",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1}};NumericAggregationPlugin.aliases={VAR:"VAR.S",VARP:"VAR.P",STDEV:"STDEV.S",STDEVP:"STDEV.P",VARS:"VAR.S",STDEVS:"STDEV.S"};function strictlyNumbers(i){if(isExtendedNumber(i)||i instanceof CellError)return i}function numbersBooleans(i){return typeof i=="boolean"?coerceBooleanToNumber(i):isExtendedNumber(i)||i instanceof CellError?i:typeof i=="string"?0:void 0}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class PowerPlugin extends FunctionPlugin{power(e,t){return this.runFunction(e.args,t,this.metadata("POWER"),Math.pow)}}PowerPlugin.implementedFunctions={POWER:{method:"power",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class RadiansPlugin extends FunctionPlugin{radians(e,t){return this.runFunction(e.args,t,this.metadata("RADIANS"),r=>r*(Math.PI/180))}}RadiansPlugin.implementedFunctions={RADIANS:{method:"radians",parameters:[{argumentType:FunctionArgumentType.NUMBER}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const MAX_LENGTH=10,DECIMAL_NUMBER_OF_BITS=255,MIN_BASE=2,MAX_BASE=36,ALPHABET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";class RadixConversionPlugin extends FunctionPlugin{dec2bin(e,t){return this.runFunction(e.args,t,this.metadata("DEC2BIN"),(r,a)=>decimalToBaseWithExactPadding(r,2,a))}dec2oct(e,t){return this.runFunction(e.args,t,this.metadata("DEC2OCT"),(r,a)=>decimalToBaseWithExactPadding(r,8,a))}dec2hex(e,t){return this.runFunction(e.args,t,this.metadata("DEC2HEX"),(r,a)=>decimalToBaseWithExactPadding(r,16,a))}bin2dec(e,t){return this.runFunction(e.args,t,this.metadata("BIN2DEC"),r=>{const a=coerceStringToBase(r,2,MAX_LENGTH);return a===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotBinary):twoComplementToDecimal(a,2)})}bin2oct(e,t){return this.runFunction(e.args,t,this.metadata("BIN2OCT"),(r,a)=>{const o=coerceStringToBase(r,2,MAX_LENGTH);return o===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotBinary):decimalToBaseWithExactPadding(twoComplementToDecimal(o,2),8,a)})}bin2hex(e,t){return this.runFunction(e.args,t,this.metadata("BIN2HEX"),(r,a)=>{const o=coerceStringToBase(r,2,MAX_LENGTH);return o===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotBinary):decimalToBaseWithExactPadding(twoComplementToDecimal(o,2),16,a)})}oct2dec(e,t){return this.runFunction(e.args,t,this.metadata("OCT2DEC"),r=>{const a=coerceStringToBase(r,8,MAX_LENGTH);return a===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotOctal):twoComplementToDecimal(a,8)})}oct2bin(e,t){return this.runFunction(e.args,t,this.metadata("OCT2BIN"),(r,a)=>{const o=coerceStringToBase(r,8,MAX_LENGTH);return o===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotOctal):decimalToBaseWithExactPadding(twoComplementToDecimal(o,8),2,a)})}oct2hex(e,t){return this.runFunction(e.args,t,this.metadata("OCT2HEX"),(r,a)=>{const o=coerceStringToBase(r,8,MAX_LENGTH);return o===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotOctal):decimalToBaseWithExactPadding(twoComplementToDecimal(o,8),16,a)})}hex2dec(e,t){return this.runFunction(e.args,t,this.metadata("HEX2DEC"),r=>{const a=coerceStringToBase(r,16,MAX_LENGTH);return a===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotHex):twoComplementToDecimal(a,16)})}hex2bin(e,t){return this.runFunction(e.args,t,this.metadata("HEX2BIN"),(r,a)=>{const o=coerceStringToBase(r,16,MAX_LENGTH);return o===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotHex):decimalToBaseWithExactPadding(twoComplementToDecimal(o,16),2,a)})}hex2oct(e,t){return this.runFunction(e.args,t,this.metadata("HEX2OCT"),(r,a)=>{const o=coerceStringToBase(r,16,MAX_LENGTH);return o===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotHex):decimalToBaseWithExactPadding(twoComplementToDecimal(o,16),8,a)})}base(e,t){return this.runFunction(e.args,t,this.metadata("BASE"),decimalToBaseWithMinimumPadding)}decimal(e,t){return this.runFunction(e.args,t,this.metadata("DECIMAL"),(r,a)=>{const o=coerceStringToBase(r,a,DECIMAL_NUMBER_OF_BITS);return o===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotHex):parseInt(o,a)})}}RadixConversionPlugin.implementedFunctions={DEC2BIN:{method:"dec2bin",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2OCT:{method:"dec2oct",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2HEX:{method:"dec2hex",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},BIN2DEC:{method:"bin2dec",parameters:[{argumentType:FunctionArgumentType.STRING}]},BIN2OCT:{method:"bin2oct",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},BIN2HEX:{method:"bin2hex",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},OCT2DEC:{method:"oct2dec",parameters:[{argumentType:FunctionArgumentType.STRING}]},OCT2BIN:{method:"oct2bin",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},OCT2HEX:{method:"oct2hex",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},HEX2DEC:{method:"hex2dec",parameters:[{argumentType:FunctionArgumentType.STRING}]},HEX2BIN:{method:"hex2bin",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},HEX2OCT:{method:"hex2oct",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},DECIMAL:{method:"decimal",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER,minValue:MIN_BASE,maxValue:MAX_BASE}]},BASE:{method:"base",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:MIN_BASE,maxValue:MAX_BASE},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0,minValue:0,maxValue:DECIMAL_NUMBER_OF_BITS}]}};function coerceStringToBase(i,e,t){const r=ALPHABET.substr(0,e),a=new RegExp(`^[${r}]+$`);if(!(i.length>t||!a.test(i)))return i}function decimalToBaseWithExactPadding(i,e,t){if(i>maxValFromBase(e))return new CellError(ErrorType.NUM,ErrorMessage.ValueBaseLarge);if(i<minValFromBase(e))return new CellError(ErrorType.NUM,ErrorMessage.ValueBaseSmall);const r=decimalToRadixComplement(i,e);return t===void 0||i<0?r:r.length>t?new CellError(ErrorType.NUM,ErrorMessage.ValueBaseLong):padLeft(r,t)}function minValFromBase(i){return-Math.pow(i,MAX_LENGTH)/2}function maxValFromBase(i){return-minValFromBase(i)-1}function decimalToBaseWithMinimumPadding(i,e,t){const r=decimalToRadixComplement(i,e);return t!==void 0&&t>r.length?padLeft(r,t):r}function decimalToRadixComplement(i,e){const t=i<0?Math.pow(e,MAX_LENGTH):0;return(i+t).toString(e).toUpperCase()}function twoComplementToDecimal(i,e){const t=parseInt(i,e),r=Math.pow(e,MAX_LENGTH);return t>=r/2?t-r:t}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class RandomPlugin extends FunctionPlugin{rand(e,t){return this.runFunction(e.args,t,this.metadata("RAND"),Math.random)}randbetween(e,t){return this.runFunction(e.args,t,this.metadata("RANDBETWEEN"),(r,a)=>a<r?new CellError(ErrorType.NUM,ErrorMessage.WrongOrder):(r=Math.ceil(r),a=Math.floor(a)+1,r===a&&(a+=1),r+Math.floor(Math.random()*(a-r))))}}RandomPlugin.implementedFunctions={RAND:{method:"rand",parameters:[],isVolatile:!0},RANDBETWEEN:{method:"randbetween",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}],isVolatile:!0}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */function findNextOddNumber(i){const e=Math.ceil(i);return e%2===1?e:e+1}function findNextEvenNumber(i){const e=Math.ceil(i);return e%2===0?e:e+1}class RoundingPlugin extends FunctionPlugin{roundup(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),(r,a)=>{const o=Math.pow(10,a);return r<0?-Math.ceil(-r*o)/o:Math.ceil(r*o)/o})}rounddown(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),(r,a)=>{const o=Math.pow(10,a);return r<0?-Math.floor(-r*o)/o:Math.floor(r*o)/o})}round(e,t){return this.runFunction(e.args,t,this.metadata("ROUND"),(r,a)=>{const o=Math.pow(10,a);return r<0?-Math.round(-r*o)/o:Math.round(r*o)/o})}intFunc(e,t){return this.runFunction(e.args,t,this.metadata("INT"),r=>r<0?-Math.floor(-r):Math.floor(r))}even(e,t){return this.runFunction(e.args,t,this.metadata("EVEN"),r=>r<0?-findNextEvenNumber(-r):findNextEvenNumber(r))}odd(e,t){return this.runFunction(e.args,t,this.metadata("ODD"),r=>r<0?-findNextOddNumber(-r):findNextOddNumber(r))}ceilingmath(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.MATH"),(r,a,o)=>a===0||r===0?0:(a=Math.abs(a),o===1&&r<0&&(a=-a),Math.ceil(r/a)*a))}ceiling(e,t){return this.runFunction(e.args,t,this.metadata("CEILING"),(r,a)=>r===0?0:a===0?new CellError(ErrorType.DIV_BY_ZERO):r>0&&a<0?new CellError(ErrorType.NUM,ErrorMessage.DistinctSigns):Math.ceil(r/a)*a)}ceilingprecise(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.PRECISE"),(r,a)=>a===0||r===0?0:(a=Math.abs(a),Math.ceil(r/a)*a))}floormath(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.MATH"),(r,a,o)=>a===0||r===0?0:(a=Math.abs(a),o===1&&r<0&&(a*=-1),Math.floor(r/a)*a))}floor(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR"),(r,a)=>r===0?0:a===0?new CellError(ErrorType.DIV_BY_ZERO):r>0&&a<0?new CellError(ErrorType.NUM,ErrorMessage.DistinctSigns):Math.floor(r/a)*a)}floorprecise(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.PRECISE"),(r,a)=>a===0||r===0?0:(a=Math.abs(a),Math.floor(r/a)*a))}}RoundingPlugin.implementedFunctions={ROUNDUP:{method:"roundup",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0}]},ROUNDDOWN:{method:"rounddown",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0}]},ROUND:{method:"round",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0}]},INT:{method:"intFunc",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},EVEN:{method:"even",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},ODD:{method:"odd",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},"CEILING.MATH":{method:"ceilingmath",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:1},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0}]},CEILING:{method:"ceiling",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}]},"CEILING.PRECISE":{method:"ceilingprecise",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:1}]},"FLOOR.MATH":{method:"floormath",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:1},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0}]},FLOOR:{method:"floor",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}]},"FLOOR.PRECISE":{method:"floorprecise",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,defaultValue:1}]}};RoundingPlugin.aliases={"ISO.CEILING":"CEILING.PRECISE",TRUNC:"ROUNDDOWN"};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class SqrtPlugin extends FunctionPlugin{sqrt(e,t){return this.runFunction(e.args,t,this.metadata("SQRT"),Math.sqrt)}}SqrtPlugin.implementedFunctions={SQRT:{method:"sqrt",parameters:[{argumentType:FunctionArgumentType.NUMBER}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */function*empty(){}function split(i){const e=i[Symbol.iterator](),{done:t,value:r}=e.next();return t?{rest:empty()}:{value:r,rest:e}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const findSmallerRangeForMany=(i,e,t)=>{if(t.end.row>t.start.row){const r=simpleCellAddress(t.end.sheet,t.end.col,t.end.row-1),a=i.getRange(t.start,r);if(a!==void 0)return{smallerRangeVertex:a,restValuesRange:t.withStart(simpleCellAddress(t.start.sheet,t.start.col,t.end.row)),restConditionRanges:e.map(o=>o.withStart(simpleCellAddress(o.start.sheet,o.start.col,o.end.row)))}}return{restValuesRange:t,restConditionRanges:e}};class CriterionFunctionCompute{constructor(e,t,r,a,o){this.interpreter=e,this.cacheKey=t,this.reduceInitialValue=r,this.composeFunction=a,this.mapFunction=o,this.dependencyGraph=this.interpreter.dependencyGraph}compute(e,t){for(const o of t)if(!o.conditionRange.sameDimensionsAs(e))return new CellError(ErrorType.VALUE,ErrorMessage.EqualLength);const r=this.tryToGetRangeVertexForRangeValue(e),a=t.map(o=>this.tryToGetRangeVertexForRangeValue(o.conditionRange));if(r&&a.every(o=>o!==void 0)){const o=t.map(h=>h.criterionPackage.raw).join(","),u=this.findAlreadyComputedValueInCache(r,this.cacheKey(t),o);if(u!==void 0)return this.interpreter.stats.incrementCriterionFunctionFullCacheUsed(),u;const c=this.buildNewCriterionCache(this.cacheKey(t),t.map(h=>h.conditionRange.range),e.range);return c.has(o)||c.set(o,[this.evaluateRangeValue(e,t),t.map(h=>h.criterionPackage.lambda)]),r.setCriterionFunctionValues(this.cacheKey(t),c),a.forEach(h=>{h!==void 0&&h.addDependentCacheRange(r)}),c.get(o)[0]}else return this.evaluateRangeValue(e,t)}tryToGetRangeVertexForRangeValue(e){const t=e.range;if(t!==void 0)return this.dependencyGraph.getRange(t.start,t.end)}reduceFunction(e){let t=this.reduceInitialValue;for(const r of e)t=this.composeFunction(t,r);return t}findAlreadyComputedValueInCache(e,t,r){return e.getCriterionFunctionValue(t,r)}evaluateRangeValue(e,t){const r=t.map(c=>c.criterionPackage.lambda),a=Array.from(e.valuesFromTopLeftCorner()).map(this.mapFunction)[Symbol.iterator](),o=t.map(c=>c.conditionRange.iterateValuesFromTopLeftCorner()),u=ifFilter(r,o,a);return this.reduceFunction(u)}buildNewCriterionCache(e,t,r){const a=this.dependencyGraph.getRange(r.start,r.end),{smallerRangeVertex:o,restConditionRanges:u,restValuesRange:c}=findSmallerRangeForMany(this.dependencyGraph,t,r);let h;o!==void 0&&this.dependencyGraph.existsEdge(o,a)?h=o.getCriterionFunctionValues(e):h=new Map;const d=new Map;return h.forEach(([p,m],f)=>{const g=ifFilter(m,u.map(T=>getRangeValues(this.dependencyGraph,T)),Array.from(getRangeValues(this.dependencyGraph,c)).map(this.mapFunction)[Symbol.iterator]()),y=this.composeFunction(p,this.reduceFunction(g));this.interpreter.stats.incrementCriterionFunctionPartialCacheUsed(),d.set(f,[y,m])}),d}}class Condition{constructor(e,t){this.conditionRange=e,this.criterionPackage=t}}function*getRangeValues(i,e){for(const t of e.addresses(i))yield getRawValue(i.getScalarValue(t))}function*ifFilter(i,e,t){for(const r of t){const a=e.map(u=>split(u));if(!a.every(u=>Object.prototype.hasOwnProperty.call(u,"value")))return;const o=a.map(u=>getRawValue(u.value));zip(o,i).every(([u,c])=>c(u))&&(yield r),e=a.map(u=>u.rest)}}function zip(i,e){const t=[];for(let r=0;r<Math.min(i.length,e.length);r++)t.push([i[r],e[r]]);return t}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class AverageResult{constructor(e,t){this.sum=e,this.count=t}static single(e){return new AverageResult(e,1)}compose(e){return new AverageResult(this.sum+e.sum,this.count+e.count)}averageValue(){if(this.count>0)return this.sum/this.count}}AverageResult.empty=new AverageResult(0,0);function conditionalAggregationFunctionCacheKey(i){return e=>{const t=e.map(r=>`${r.conditionRange.range.sheet},${r.conditionRange.range.start.col},${r.conditionRange.range.start.row}`);return[i,...t].join(",")}}function zeroForInfinite(i){return isExtendedNumber(i)&&!Number.isFinite(getRawValue(i))?0:i}function mapToRawScalarValue(i){if(i instanceof CellError)return i;if(isExtendedNumber(i))return getRawValue(i)}class ConditionalAggregationPlugin extends FunctionPlugin{sumif(e,t){const r="SUMIF",a=(o,u,c)=>this.computeConditionalAggregationFunction(c??o,[o,u],r,0,(h,d)=>this.arithmeticHelper.nonstrictadd(h,d),mapToRawScalarValue);return this.runFunction(e.args,t,this.metadata(r),a)}sumifs(e,t){const r="SUMIFS",a=(o,...u)=>this.computeConditionalAggregationFunction(o,u,r,0,(c,h)=>this.arithmeticHelper.nonstrictadd(c,h),mapToRawScalarValue);return this.runFunction(e.args,t,this.metadata(r),a)}averageif(e,t){const r="AVERAGEIF",a=(o,u,c)=>{const h=this.computeConditionalAggregationFunction(c??o,[o,u],r,AverageResult.empty,(d,p)=>d.compose(p),d=>isExtendedNumber(d)?AverageResult.single(getRawValue(d)):AverageResult.empty);return h instanceof CellError?h:h.averageValue()||new CellError(ErrorType.DIV_BY_ZERO)};return this.runFunction(e.args,t,this.metadata(r),a)}countif(e,t){const r="COUNTIF",a=(o,u)=>this.computeConditionalAggregationFunction(o,[o,u],r,0,(c,h)=>c+h,()=>1);return this.runFunction(e.args,t,this.metadata(r),a)}countifs(e,t){const r="COUNTIFS",a=(...o)=>this.computeConditionalAggregationFunction(o[0],o,r,0,(u,c)=>u+c,()=>1);return this.runFunction(e.args,t,this.metadata(r),a)}minifs(e,t){const r="MINIFS",a=(u,c)=>c===void 0||u===void 0?c===void 0?u:c:Math.min(u,c),o=(u,...c)=>{const h=this.computeConditionalAggregationFunction(u,c,r,Number.POSITIVE_INFINITY,a,mapToRawScalarValue);return zeroForInfinite(h)};return this.runFunction(e.args,t,this.metadata(r),o)}maxifs(e,t){const r="MAXIFS",a=(u,c)=>c===void 0||u===void 0?c===void 0?u:c:Math.max(u,c),o=(u,...c)=>{const h=this.computeConditionalAggregationFunction(u,c,r,Number.NEGATIVE_INFINITY,a,mapToRawScalarValue);return zeroForInfinite(h)};return this.runFunction(e.args,t,this.metadata(r),o)}computeConditionalAggregationFunction(e,t,r,a,o,u){const c=[];for(let h=0;h<t.length;h+=2){const d=t[h],p=this.interpreter.criterionBuilder.fromCellValue(t[h+1],this.arithmeticHelper);if(p===void 0)return new CellError(ErrorType.VALUE,ErrorMessage.BadCriterion);c.push(new Condition(d,p))}return new CriterionFunctionCompute(this.interpreter,conditionalAggregationFunctionCacheKey(r),a,o,u).compute(e,c)}}ConditionalAggregationPlugin.implementedFunctions={SUMIF:{method:"sumif",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NOERROR},{argumentType:FunctionArgumentType.RANGE,optionalArg:!0}]},COUNTIF:{method:"countif",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NOERROR}]},AVERAGEIF:{method:"averageif",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NOERROR},{argumentType:FunctionArgumentType.RANGE,optionalArg:!0}]},SUMIFS:{method:"sumifs",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NOERROR}],repeatLastArgs:2},COUNTIFS:{method:"countifs",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NOERROR}],repeatLastArgs:2},MINIFS:{method:"minifs",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NOERROR}],repeatLastArgs:2},MAXIFS:{method:"maxifs",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NOERROR}],repeatLastArgs:2}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class SumprodPlugin extends FunctionPlugin{sumproduct(e,t){return this.runFunction(e.args,t,this.metadata("SUMPRODUCT"),(...r)=>{const a=r[0].width(),o=r[0].height();for(const h of r)if(h.width()!==a||h.height()!==o)return new CellError(ErrorType.VALUE,ErrorMessage.EqualLength);let u=0;const c=r.map(h=>h.iterateValuesFromTopLeftCorner());for(let h=0;h<a*o;h++){let d=1;for(const p of c){const m=p.next().value;if(m instanceof CellError)return m;const f=this.coerceScalarToNumberOrError(m);isExtendedNumber(f)?d*=getRawValue(f):d=0}u+=d}return u})}}SumprodPlugin.implementedFunctions={SUMPRODUCT:{method:"sumproduct",parameters:[{argumentType:FunctionArgumentType.RANGE}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class TextPlugin extends FunctionPlugin{concatenate(e,t){return this.runFunction(e.args,t,this.metadata("CONCATENATE"),(...r)=>"".concat(...r))}split(e,t){return this.runFunction(e.args,t,this.metadata("SPLIT"),(r,a)=>{const o=r.split(" ");return a>=o.length||a<0?new CellError(ErrorType.VALUE,ErrorMessage.IndexBounds):o[a]})}len(e,t){return this.runFunction(e.args,t,this.metadata("LEN"),r=>r.length)}lower(e,t){return this.runFunction(e.args,t,this.metadata("LOWER"),r=>r.toLowerCase())}trim(e,t){return this.runFunction(e.args,t,this.metadata("TRIM"),r=>r.replace(/^ +| +$/g,"").replace(/ +/g," "))}proper(e,t){return this.runFunction(e.args,t,this.metadata("PROPER"),r=>r.replace(new RegExp("\\p{L}+","gu"),a=>a.charAt(0).toUpperCase()+a.substring(1).toLowerCase()))}clean(e,t){return this.runFunction(e.args,t,this.metadata("CLEAN"),r=>r.replace(/[\u0000-\u001F]/g,""))}exact(e,t){return this.runFunction(e.args,t,this.metadata("EXACT"),(r,a)=>r===a)}rept(e,t){return this.runFunction(e.args,t,this.metadata("REPT"),(r,a)=>a<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeCount):r.repeat(a))}right(e,t){return this.runFunction(e.args,t,this.metadata("RIGHT"),(r,a)=>a<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeLength):a===0?"":r.slice(-a))}left(e,t){return this.runFunction(e.args,t,this.metadata("LEFT"),(r,a)=>a<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeLength):r.slice(0,a))}mid(e,t){return this.runFunction(e.args,t,this.metadata("MID"),(r,a,o)=>a<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):o<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeLength):r.substring(a-1,a+o-1))}replace(e,t){return this.runFunction(e.args,t,this.metadata("REPLACE"),(r,a,o,u)=>a<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):o<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeLength):r.substring(0,a-1)+u+r.substring(a+o-1))}search(e,t){return this.runFunction(e.args,t,this.metadata("SEARCH"),(r,a,o)=>{if(o<1||o>a.length)return new CellError(ErrorType.VALUE,ErrorMessage.LengthBounds);const u=r.toLowerCase(),c=a.substring(o-1).toLowerCase(),h=this.arithmeticHelper.requiresRegex(u)?this.arithmeticHelper.searchString(u,c):c.indexOf(u);return h>-1?h+o:new CellError(ErrorType.VALUE,ErrorMessage.PatternNotFound)})}substitute(e,t){return this.runFunction(e.args,t,this.metadata("SUBSTITUTE"),(r,a,o,u)=>{const c=this.escapeRegExpSpecialCharacters(a),h=new RegExp(c,"g");if(u===void 0)return r.replace(h,o);if(u<1)return new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne);let d,p=0;for(;(d=h.exec(r))!==null;)if(u===++p)return r.substring(0,d.index)+o+r.substring(h.lastIndex);return r})}find(e,t){return this.runFunction(e.args,t,this.metadata("FIND"),(r,a,o)=>{if(o<1||o>a.length)return new CellError(ErrorType.VALUE,ErrorMessage.IndexBounds);const c=a.substring(o-1).indexOf(r)+o;return c>0?c:new CellError(ErrorType.VALUE,ErrorMessage.PatternNotFound)})}t(e,t){return this.runFunction(e.args,t,this.metadata("T"),r=>r instanceof CellError||typeof r=="string"?r:"")}upper(e,t){return this.runFunction(e.args,t,this.metadata("UPPER"),r=>r.toUpperCase())}escapeRegExpSpecialCharacters(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}TextPlugin.implementedFunctions={CONCATENATE:{method:"concatenate",parameters:[{argumentType:FunctionArgumentType.STRING}],repeatLastArgs:1,expandRanges:!0},EXACT:{method:"exact",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.STRING}]},SPLIT:{method:"split",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER}]},LEN:{method:"len",parameters:[{argumentType:FunctionArgumentType.STRING}]},LOWER:{method:"lower",parameters:[{argumentType:FunctionArgumentType.STRING}]},MID:{method:"mid",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}]},TRIM:{method:"trim",parameters:[{argumentType:FunctionArgumentType.STRING}]},T:{method:"t",parameters:[{argumentType:FunctionArgumentType.SCALAR}]},PROPER:{method:"proper",parameters:[{argumentType:FunctionArgumentType.STRING}]},CLEAN:{method:"clean",parameters:[{argumentType:FunctionArgumentType.STRING}]},REPT:{method:"rept",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER}]},RIGHT:{method:"right",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER,defaultValue:1}]},LEFT:{method:"left",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER,defaultValue:1}]},REPLACE:{method:"replace",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.STRING}]},SEARCH:{method:"search",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER,defaultValue:1}]},SUBSTITUTE:{method:"substitute",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0}]},FIND:{method:"find",parameters:[{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.STRING},{argumentType:FunctionArgumentType.NUMBER,defaultValue:1}]},UPPER:{method:"upper",parameters:[{argumentType:FunctionArgumentType.STRING}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class TrigonometryPlugin extends FunctionPlugin{acos(e,t){return this.runFunction(e.args,t,this.metadata("ACOS"),Math.acos)}asin(e,t){return this.runFunction(e.args,t,this.metadata("ASIN"),Math.asin)}cos(e,t){return this.runFunction(e.args,t,this.metadata("COS"),Math.cos)}sin(e,t){return this.runFunction(e.args,t,this.metadata("SIN"),Math.sin)}tan(e,t){return this.runFunction(e.args,t,this.metadata("TAN"),Math.tan)}atan(e,t){return this.runFunction(e.args,t,this.metadata("ATAN"),Math.atan)}atan2(e,t){return this.runFunction(e.args,t,this.metadata("ATAN2"),(r,a)=>r===0&&a===0?new CellError(ErrorType.DIV_BY_ZERO):Math.atan2(a,r))}cot(e,t){return this.runFunction(e.args,t,this.metadata("COT"),r=>r===0?new CellError(ErrorType.DIV_BY_ZERO):1/Math.tan(r))}acot(e,t){return this.runFunction(e.args,t,this.metadata("ACOT"),r=>r===0?PI/2:Math.atan(1/r))}sec(e,t){return this.runFunction(e.args,t,this.metadata("SEC"),r=>1/Math.cos(r))}csc(e,t){return this.runFunction(e.args,t,this.metadata("CSC"),r=>r===0?new CellError(ErrorType.DIV_BY_ZERO):1/Math.sin(r))}sinh(e,t){return this.runFunction(e.args,t,this.metadata("SINH"),Math.sinh)}asinh(e,t){return this.runFunction(e.args,t,this.metadata("ASINH"),Math.asinh)}cosh(e,t){return this.runFunction(e.args,t,this.metadata("COSH"),Math.cosh)}acosh(e,t){return this.runFunction(e.args,t,this.metadata("ACOSH"),Math.acosh)}tanh(e,t){return this.runFunction(e.args,t,this.metadata("TANH"),Math.tanh)}atanh(e,t){return this.runFunction(e.args,t,this.metadata("ATANH"),Math.atanh)}coth(e,t){return this.runFunction(e.args,t,this.metadata("COTH"),r=>r===0?new CellError(ErrorType.DIV_BY_ZERO):1/Math.tanh(r))}acoth(e,t){return this.runFunction(e.args,t,this.metadata("ACOTH"),r=>r===0?new CellError(ErrorType.NUM,ErrorMessage.NonZero):Math.atanh(1/r))}sech(e,t){return this.runFunction(e.args,t,this.metadata("SECH"),r=>1/Math.cosh(r))}csch(e,t){return this.runFunction(e.args,t,this.metadata("CSCH"),r=>r===0?new CellError(ErrorType.DIV_BY_ZERO):1/Math.sinh(r))}}TrigonometryPlugin.implementedFunctions={ACOS:{method:"acos",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},ASIN:{method:"asin",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},COS:{method:"cos",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},SIN:{method:"sin",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},TAN:{method:"tan",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},ATAN:{method:"atan",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},ATAN2:{method:"atan2",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}]},COT:{method:"cot",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},SEC:{method:"sec",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},CSC:{method:"csc",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},SINH:{method:"sinh",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},COSH:{method:"cosh",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},TANH:{method:"tanh",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},COTH:{method:"coth",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},SECH:{method:"sech",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},CSCH:{method:"csch",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},ACOT:{method:"acot",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},ASINH:{method:"asinh",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},ACOSH:{method:"acosh",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},ATANH:{method:"atanh",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},ACOTH:{method:"acoth",parameters:[{argumentType:FunctionArgumentType.NUMBER}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class RowSearchStrategy extends AdvancedFind{constructor(e){super(e),this.dependencyGraph=e}find(e,t,r){return this.basicFind(e,t,"col",r)}}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class LookupPlugin extends FunctionPlugin{constructor(){super(...arguments),this.rowSearch=new RowSearchStrategy(this.dependencyGraph)}vlookup(e,t){return this.runFunction(e.args,t,this.metadata("VLOOKUP"),(r,a,o,u)=>{const c=a.range;return c===void 0?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):o<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):o>c.width()?new CellError(ErrorType.REF,ErrorMessage.IndexLarge):this.doVlookup(zeroIfEmpty(r),a,o-1,u)})}hlookup(e,t){return this.runFunction(e.args,t,this.metadata("HLOOKUP"),(r,a,o,u)=>{const c=a.range;return c===void 0?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):o<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):o>c.height()?new CellError(ErrorType.REF,ErrorMessage.IndexLarge):this.doHlookup(zeroIfEmpty(r),a,o-1,u)})}match(e,t){return this.runFunction(e.args,t,this.metadata("MATCH"),(r,a,o)=>this.doMatch(zeroIfEmpty(r),a,o))}searchInRange(e,t,r,a){if(!r&&typeof e=="string"&&this.arithmeticHelper.requiresRegex(e))return a.advancedFind(this.arithmeticHelper.eqMatcherFunction(e),t);{const o=r?{ordering:"asc"}:{ordering:"none",matchExactly:!0};return a.find(e,t,o)}}doVlookup(e,t,r,a){this.dependencyGraph.stats.start(StatType.VLOOKUP);const o=t.range;let u;o===void 0?u=SimpleRangeValue.onlyValues(t.data.map(d=>[d[0]])):u=SimpleRangeValue.onlyRange(AbsoluteCellRange.spanFrom(o.start,1,o.height()),this.dependencyGraph);const c=this.searchInRange(e,u,a,this.columnSearch);if(this.dependencyGraph.stats.end(StatType.VLOOKUP),c===-1)return new CellError(ErrorType.NA,ErrorMessage.ValueNotFound);let h;if(o===void 0)h=t.data[c][r];else{const d=simpleCellAddress(o.sheet,o.start.col+r,o.start.row+c);h=this.dependencyGraph.getCellValue(d)}return h instanceof SimpleRangeValue?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):h}doHlookup(e,t,r,a){const o=t.range;let u;o===void 0?u=SimpleRangeValue.onlyValues([t.data[0]]):u=SimpleRangeValue.onlyRange(AbsoluteCellRange.spanFrom(o.start,o.width(),1),this.dependencyGraph);const c=this.searchInRange(e,u,a,this.rowSearch);if(c===-1)return new CellError(ErrorType.NA,ErrorMessage.ValueNotFound);let h;if(o===void 0)h=t.data[r][c];else{const d=simpleCellAddress(o.sheet,o.start.col+c,o.start.row+r);h=this.dependencyGraph.getCellValue(d)}return h instanceof SimpleRangeValue?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):h}doMatch(e,t,r){if(![-1,0,1].includes(r))return new CellError(ErrorType.VALUE,ErrorMessage.BadMode);if(t.width()>1&&t.height()>1)return new CellError(ErrorType.NA);const a=t.width()===1?this.columnSearch:this.rowSearch,o=r===0?{ordering:"none",matchExactly:!0}:{ordering:r===-1?"desc":"asc"},u=a.find(e,t,o);return u===-1?new CellError(ErrorType.NA,ErrorMessage.ValueNotFound):u+1}}LookupPlugin.implementedFunctions={VLOOKUP:{method:"vlookup",parameters:[{argumentType:FunctionArgumentType.NOERROR},{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.BOOLEAN,defaultValue:!0}]},HLOOKUP:{method:"hlookup",parameters:[{argumentType:FunctionArgumentType.NOERROR},{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.BOOLEAN,defaultValue:!0}]},MATCH:{method:"match",parameters:[{argumentType:FunctionArgumentType.NOERROR},{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NUMBER,defaultValue:1}]}};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class RomanPlugin extends FunctionPlugin{roman(e,t){return this.runFunction(e.args,t,this.metadata("ROMAN"),(r,a)=>(r=Math.trunc(r),a===!1?a=4:a===!0&&(a=0),a=getRawValue(this.coerceScalarToNumberOrError(a)),a instanceof CellError?a:(a=Math.trunc(a),a<0?new CellError(ErrorType.VALUE,ErrorMessage.ValueSmall):a>4?new CellError(ErrorType.VALUE,ErrorMessage.ValueLarge):romanMode(r,a))))}arabic(e,t){return this.runFunction(e.args,t,this.metadata("ARABIC"),r=>{r=r.trim().toUpperCase();let a=!1;if(r.startsWith("-")&&(r=r.slice(1),a=!0,r===""))return new CellError(ErrorType.VALUE,ErrorMessage.InvalidRoman);const o={input:r,acc:0};return eatToken(o,{token:"MMM",val:3e3},{token:"MM",val:2e3},{token:"M",val:1e3}),eatToken(o,{token:"IM",val:999},{token:"VM",val:995},{token:"XM",val:990},{token:"LM",val:950},{token:"CM",val:900}),eatToken(o,{token:"D",val:500},{token:"ID",val:499},{token:"VD",val:495},{token:"XD",val:490},{token:"LD",val:450},{token:"CD",val:400}),eatToken(o,{token:"CCC",val:300},{token:"CC",val:200},{token:"C",val:100}),eatToken(o,{token:"IC",val:99},{token:"VC",val:95},{token:"XC",val:90}),eatToken(o,{token:"L",val:50},{token:"IL",val:49},{token:"VL",val:45},{token:"XL",val:40}),eatToken(o,{token:"XXX",val:30},{token:"XX",val:20},{token:"X",val:10}),eatToken(o,{token:"IX",val:9}),eatToken(o,{token:"V",val:5},{token:"IV",val:4}),eatToken(o,{token:"III",val:3},{token:"II",val:2},{token:"I",val:1}),o.input!==""?new CellError(ErrorType.VALUE,ErrorMessage.InvalidRoman):a?-o.acc:o.acc})}}RomanPlugin.implementedFunctions={ROMAN:{method:"roman",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:1,lessThan:4e3},{argumentType:FunctionArgumentType.NOERROR,optionalArg:!0,defaultValue:0}]},ARABIC:{method:"arabic",parameters:[{argumentType:FunctionArgumentType.STRING}]}};function eatToken(i,...e){for(const t of e)if(i.input.startsWith(t.token)){i.input=i.input.slice(t.token.length),i.acc+=t.val;break}}function romanMode(i,e){const t={val:i%1e3,acc:"M".repeat(Math.floor(i/1e3))};return e===4&&(absorb(t,"IM",999,1e3),absorb(t,"ID",499,500)),e>=3&&(absorb(t,"VM",995,1e3),absorb(t,"VD",495,500)),e>=2&&(absorb(t,"XM",990,1e3),absorb(t,"XD",490,500)),e>=1&&(absorb(t,"LM",950,1e3),absorb(t,"LD",450,500)),absorb(t,"CM",900,1e3),absorb(t,"CD",400,500),absorb(t,"D",500,900),t.acc+="C".repeat(Math.floor(t.val/100)),t.val%=100,e>=2&&(absorb(t,"IC",99,100),absorb(t,"IL",49,50)),e>=1&&(absorb(t,"VC",95,100),absorb(t,"VL",45,50)),absorb(t,"XC",90,100),absorb(t,"XL",40,50),absorb(t,"L",50,90),t.acc+="X".repeat(Math.floor(t.val/10)),t.val%=10,absorb(t,"IX",9,10),absorb(t,"IV",4,5),absorb(t,"V",5,9),t.acc+="I".repeat(t.val),t.acc}function absorb(i,e,t,r){i.val>=t&&i.val<r&&(i.val-=t,i.acc+=e)}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class SimpleArithmerticPlugin extends FunctionPlugin{add(e,t){return this.runFunction(e.args,t,this.metadata("HF.ADD"),this.arithmeticHelper.addWithEpsilon)}concat(e,t){return this.runFunction(e.args,t,this.metadata("HF.CONCAT"),this.arithmeticHelper.concat)}divide(e,t){return this.runFunction(e.args,t,this.metadata("HF.DIVIDE"),this.arithmeticHelper.divide)}eq(e,t){return this.runFunction(e.args,t,this.metadata("HF.EQ"),this.arithmeticHelper.eq)}gt(e,t){return this.runFunction(e.args,t,this.metadata("HF.GT"),this.arithmeticHelper.gt)}gte(e,t){return this.runFunction(e.args,t,this.metadata("HF.GTE"),this.arithmeticHelper.geq)}lt(e,t){return this.runFunction(e.args,t,this.metadata("HF.LT"),this.arithmeticHelper.lt)}lte(e,t){return this.runFunction(e.args,t,this.metadata("HF.LTE"),this.arithmeticHelper.leq)}minus(e,t){return this.runFunction(e.args,t,this.metadata("HF.MINUS"),this.arithmeticHelper.subtract)}multiply(e,t){return this.runFunction(e.args,t,this.metadata("HF.MULTIPLY"),this.arithmeticHelper.multiply)}ne(e,t){return this.runFunction(e.args,t,this.metadata("HF.NE"),this.arithmeticHelper.neq)}pow(e,t){return this.runFunction(e.args,t,this.metadata("HF.POW"),this.arithmeticHelper.pow)}uminus(e,t){return this.runFunction(e.args,t,this.metadata("HF.UMINUS"),this.arithmeticHelper.unaryMinus)}upercent(e,t){return this.runFunction(e.args,t,this.metadata("HF.UNARY_PERCENT"),this.arithmeticHelper.unaryPercent)}uplus(e,t){return this.runFunction(e.args,t,this.metadata("HF.UPLUS"),this.arithmeticHelper.unaryPlus)}}SimpleArithmerticPlugin.implementedFunctions={"HF.ADD":{method:"add",parameters:[{argumentType:FunctionArgumentType.NUMBER,passSubtype:!0},{argumentType:FunctionArgumentType.NUMBER,passSubtype:!0}]},"HF.CONCAT":{method:"concat",parameters:[{argumentType:FunctionArgumentType.STRING,passSubtype:!0},{argumentType:FunctionArgumentType.STRING,passSubtype:!0}]},"HF.DIVIDE":{method:"divide",parameters:[{argumentType:FunctionArgumentType.NUMBER,passSubtype:!0},{argumentType:FunctionArgumentType.NUMBER,passSubtype:!0}]},"HF.EQ":{method:"eq",parameters:[{argumentType:FunctionArgumentType.NOERROR,passSubtype:!0},{argumentType:FunctionArgumentType.NOERROR,passSubtype:!0}]},"HF.GT":{method:"gt",parameters:[{argumentType:FunctionArgumentType.NOERROR,passSubtype:!0},{argumentType:FunctionArgumentType.NOERROR,passSubtype:!0}]},"HF.GTE":{method:"gte",parameters:[{argumentType:FunctionArgumentType.NOERROR,passSubtype:!0},{argumentType:FunctionArgumentType.NOERROR,passSubtype:!0}]},"HF.LT":{method:"lt",parameters:[{argumentType:FunctionArgumentType.NOERROR,passSubtype:!0},{argumentType:FunctionArgumentType.NOERROR,passSubtype:!0}]},"HF.LTE":{method:"lte",parameters:[{argumentType:FunctionArgumentType.NOERROR,passSubtype:!0},{argumentType:FunctionArgumentType.NOERROR,passSubtype:!0}]},"HF.MINUS":{method:"minus",parameters:[{argumentType:FunctionArgumentType.NUMBER,passSubtype:!0},{argumentType:FunctionArgumentType.NUMBER,passSubtype:!0}]},"HF.MULTIPLY":{method:"multiply",parameters:[{argumentType:FunctionArgumentType.NUMBER,passSubtype:!0},{argumentType:FunctionArgumentType.NUMBER,passSubtype:!0}]},"HF.NE":{method:"ne",parameters:[{argumentType:FunctionArgumentType.NOERROR,passSubtype:!0},{argumentType:FunctionArgumentType.NOERROR,passSubtype:!0}]},"HF.POW":{method:"pow",parameters:[{argumentType:FunctionArgumentType.NUMBER,passSubtype:!0},{argumentType:FunctionArgumentType.NUMBER,passSubtype:!0}]},"HF.UMINUS":{method:"uminus",parameters:[{argumentType:FunctionArgumentType.NUMBER,passSubtype:!0}]},"HF.UNARY_PERCENT":{method:"upercent",parameters:[{argumentType:FunctionArgumentType.NUMBER,passSubtype:!0}]},"HF.UPLUS":{method:"uplus",parameters:[{argumentType:FunctionArgumentType.NUMBER,passSubtype:!0}]}};/**
 * @license
 bessel.js (C) 2013-present SheetJS -- http://sheetjs.com

 Apache License
 Version 2.0, January 2004
 http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

 "License" shall mean the terms and conditions for use, reproduction,
 and distribution as defined by Sections 1 through 9 of this document.

 "Licensor" shall mean the copyright owner or entity authorized by
 the copyright owner that is granting the License.

 "Legal Entity" shall mean the union of the acting entity and all
 other entities that control, are controlled by, or are under common
 control with that entity. For the purposes of this definition,
 "control" means (i) the power, direct or indirect, to cause the
 direction or management of such entity, whether by contract or
 otherwise, or (ii) ownership of fifty percent (50%) or more of the
 outstanding shares, or (iii) beneficial ownership of such entity.

 "You" (or "Your") shall mean an individual or Legal Entity
 exercising permissions granted by this License.

 "Source" form shall mean the preferred form for making modifications,
 including but not limited to software source code, documentation
 source, and configuration files.

 "Object" form shall mean any form resulting from mechanical
 transformation or translation of a Source form, including but
 not limited to compiled object code, generated documentation,
 and conversions to other media types.

 "Work" shall mean the work of authorship, whether in Source or
 Object form, made available under the License, as indicated by a
 copyright notice that is included in or attached to the work
 (an example is provided in the Appendix below).

 "Derivative Works" shall mean any work, whether in Source or Object
 form, that is based on (or derived from) the Work and for which the
 editorial revisions, annotations, elaborations, or other modifications
 represent, as a whole, an original work of authorship. For the purposes
 of this License, Derivative Works shall not include works that remain
 separable from, or merely link (or bind by name) to the interfaces of,
 the Work and Derivative Works thereof.

 "Contribution" shall mean any work of authorship, including
 the original version of the Work and any modifications or additions
 to that Work or Derivative Works thereof, that is intentionally
 submitted to Licensor for inclusion in the Work by the copyright owner
 or by an individual or Legal Entity authorized to submit on behalf of
 the copyright owner. For the purposes of this definition, "submitted"
 means any form of electronic, verbal, or written communication sent
 to the Licensor or its representatives, including but not limited to
 communication on electronic mailing lists, source code control systems,
 and issue tracking systems that are managed by, or on behalf of, the
 Licensor for the purpose of discussing and improving the Work, but
 excluding communication that is conspicuously marked or otherwise
 designated in writing by the copyright owner as "Not a Contribution."

 "Contributor" shall mean Licensor and any individual or Legal Entity
 on behalf of whom a Contribution has been received by Licensor and
 subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
 this License, each Contributor hereby grants to You a perpetual,
 worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 copyright license to reproduce, prepare Derivative Works of,
 publicly display, publicly perform, sublicense, and distribute the
 Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
 this License, each Contributor hereby grants to You a perpetual,
 worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 (except as stated in this section) patent license to make, have made,
 use, offer to sell, sell, import, and otherwise transfer the Work,
 where such license applies only to those patent claims licensable
 by such Contributor that are necessarily infringed by their
 Contribution(s) alone or by combination of their Contribution(s)
 with the Work to which such Contribution(s) was submitted. If You
 institute patent litigation against any entity (including a
 cross-claim or counterclaim in a lawsuit) alleging that the Work
 or a Contribution incorporated within the Work constitutes direct
 or contributory patent infringement, then any patent licenses
 granted to You under this License for that Work shall terminate
 as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
 Work or Derivative Works thereof in any medium, with or without
 modifications, and in Source or Object form, provided that You
 meet the following conditions:

 (a) You must give any other recipients of the Work or
 Derivative Works a copy of this License; and

 (b) You must cause any modified files to carry prominent notices
 stating that You changed the files; and

 (c) You must retain, in the Source form of any Derivative Works
 that You distribute, all copyright, patent, trademark, and
 attribution notices from the Source form of the Work,
 excluding those notices that do not pertain to any part of
 the Derivative Works; and

 (d) If the Work includes a "NOTICE" text file as part of its
 distribution, then any Derivative Works that You distribute must
 include a readable copy of the attribution notices contained
 within such NOTICE file, excluding those notices that do not
 pertain to any part of the Derivative Works, in at least one
 of the following places: within a NOTICE text file distributed
 as part of the Derivative Works; within the Source form or
 documentation, if provided along with the Derivative Works; or,
 within a display generated by the Derivative Works, if and
 wherever such third-party notices normally appear. The contents
 of the NOTICE file are for informational purposes only and
 do not modify the License. You may add Your own attribution
 notices within Derivative Works that You distribute, alongside
 or as an addendum to the NOTICE text from the Work, provided
 that such additional attribution notices cannot be construed
 as modifying the License.

 You may add Your own copyright statement to Your modifications and
 may provide additional or different license terms and conditions
 for use, reproduction, or distribution of Your modifications, or
 for any such Derivative Works as a whole, provided Your use,
 reproduction, and distribution of the Work otherwise complies with
 the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
 any Contribution intentionally submitted for inclusion in the Work
 by You to the Licensor shall be under the terms and conditions of
 this License, without any additional terms or conditions.
 Notwithstanding the above, nothing herein shall supersede or modify
 the terms of any separate license agreement you may have executed
 with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
 names, trademarks, service marks, or product names of the Licensor,
 except as required for reasonable and customary use in describing the
 origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
 agreed to in writing, Licensor provides the Work (and each
 Contributor provides its Contributions) on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
 implied, including, without limitation, any warranties or conditions
 of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
 PARTICULAR PURPOSE. You are solely responsible for determining the
 appropriateness of using or redistributing the Work and assume any
 risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
 whether in tort (including negligence), contract, or otherwise,
 unless required by applicable law (such as deliberate and grossly
 negligent acts) or agreed to in writing, shall any Contributor be
 liable to You for damages, including any direct, indirect, special,
 incidental, or consequential damages of any character arising as a
 result of this License or out of the use or inability to use the
 Work (including but not limited to damages for loss of goodwill,
 work stoppage, computer failure or malfunction, or any and all
 other commercial damages or losses), even if such Contributor
 has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
 the Work or Derivative Works thereof, You may choose to offer,
 and charge a fee for, acceptance of support, warranty, indemnity,
 or other liability obligations and/or rights consistent with this
 License. However, in accepting such obligations, You may act only
 on Your own behalf and on Your sole responsibility, not on behalf
 of any other Contributor, and only if You agree to indemnify,
 defend, and hold each Contributor harmless for any liability
 incurred by, or claims asserted against, such Contributor by reason
 of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

 To apply the Apache License to your work, attach the following
 boilerplate notice, with the fields enclosed by brackets "{}"
 replaced with your own identifying information. (Don't include
 the brackets!)  The text should be enclosed in the appropriate
 comment syntax for the file format. We also recommend that a
 file or class name and description of purpose be included on the
 same "printed page" as the copyright notice for easier
 identification within third-party archives.

 Copyright (C) 2013-present   SheetJS LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 */var M=Math;function _horner(i,e){for(var t=0,r=0;t<i.length;++t)r=e*r+i[t];return r}function _bessel_iter(i,e,t,r,a){if(e===0)return t;if(e===1)return r;for(var o=2/i,u=r,c=1;c<e;++c)u=r*c*o+a*t,t=r,r=u;return u}function _bessel_wrap(i,e,t,r,a){return function(u,c){if(r){if(u===0)return r==1?-1/0:1/0;if(u<0)return NaN}if(c===0)return i(u);if(c===1)return e(u);if(c<0)return NaN;c|=0;var h=i(u),d=e(u);return _bessel_iter(u,c,h,d,a)}}var besselj=function(){var i=.636619772,e=[57568490574,-13362590354,6516196407e-1,-1121442418e-2,77392.33017,-184.9052456].reverse(),t=[57568490411,1029532985,9494680718e-3,59272.64853,267.8532712,1].reverse(),r=[1,-.001098628627,2734510407e-14,-2073370639e-15,2093887211e-16].reverse(),a=[-.01562499995,.0001430488765,-6911147651e-15,7621095161e-16,-934935152e-16].reverse();function o(m){var f=0,g=0,y=0,T=m*m;if(m<8)g=_horner(e,T),y=_horner(t,T),f=g/y;else{var A=m-.785398164;T=64/T,g=_horner(r,T),y=_horner(a,T),f=M.sqrt(i/m)*(M.cos(A)*g-M.sin(A)*y*8/m)}return f}var u=[72362614232,-7895059235,2423968531e-1,-2972611439e-3,15704.4826,-30.16036606].reverse(),c=[144725228442,2300535178,1858330474e-2,99447.43394,376.9991397,1].reverse(),h=[1,.00183105,-3516396496e-14,2457520174e-15,-240337019e-15].reverse(),d=[.04687499995,-.0002002690873,8449199096e-15,-88228987e-14,105787412e-15].reverse();function p(m){var f=0,g=0,y=0,T=m*m,A=M.abs(m)-2.356194491;return Math.abs(m)<8?(g=m*_horner(u,T),y=_horner(c,T),f=g/y):(T=64/T,g=_horner(h,T),y=_horner(d,T),f=M.sqrt(i/M.abs(m))*(M.cos(A)*g-M.sin(A)*y*8/M.abs(m)),m<0&&(f=-f)),f}return function m(f,g){if(g=Math.round(g),!isFinite(f))return isNaN(f)?f:0;if(g<0)return(g%2?-1:1)*m(f,-g);if(f<0)return(g%2?-1:1)*m(-f,g);if(g===0)return o(f);if(g===1)return p(f);if(f===0)return 0;var y=0;if(f>g)y=_bessel_iter(f,g,o(f),p(f),-1);else{for(var T=2*M.floor((g+M.floor(M.sqrt(40*g)))/2),A=!1,R=0,C=0,N=1,S=0,_=2/f,O=T;O>0;O--)S=O*_*N-R,R=N,N=S,M.abs(N)>1e10&&(N*=1e-10,R*=1e-10,y*=1e-10,C*=1e-10),A&&(C+=N),A=!A,O==g&&(y=R);C=2*C-N,y/=C}return y}}(),bessely=function(){var i=.636619772,e=[-2957821389,7062834065,-5123598036e-1,1087988129e-2,-86327.92757,228.4622733].reverse(),t=[40076544269,7452499648e-1,7189466438e-3,47447.2647,226.1030244,1].reverse(),r=[1,-.001098628627,2734510407e-14,-2073370639e-15,2093887211e-16].reverse(),a=[-.01562499995,.0001430488765,-6911147651e-15,7621095161e-16,-934945152e-16].reverse();function o(m){var f=0,g=0,y=0,T=m*m,A=m-.785398164;return m<8?(g=_horner(e,T),y=_horner(t,T),f=g/y+i*besselj(m,0)*M.log(m)):(T=64/T,g=_horner(r,T),y=_horner(a,T),f=M.sqrt(i/m)*(M.sin(A)*g+M.cos(A)*y*8/m)),f}var u=[-4900604943e3,127527439e4,-51534381390,7349264551e-1,-4237922726e-3,8511.937935].reverse(),c=[249958057e5,424441966400,3733650367,2245904002e-2,102042.605,354.9632885,1].reverse(),h=[1,.00183105,-3516396496e-14,2457520174e-15,-240337019e-15].reverse(),d=[.04687499995,-.0002002690873,8449199096e-15,-88228987e-14,105787412e-15].reverse();function p(m){var f=0,g=0,y=0,T=m*m,A=m-2.356194491;return m<8?(g=m*_horner(u,T),y=_horner(c,T),f=g/y+i*(besselj(m,1)*M.log(m)-1/m)):(T=64/T,g=_horner(h,T),y=_horner(d,T),f=M.sqrt(i/m)*(M.sin(A)*g+M.cos(A)*y*8/m)),f}return _bessel_wrap(o,p,"BESSELY",1,-1)}(),besseli=function(){var i=[1,3.5156229,3.0899424,1.2067492,.2659732,.0360768,.0045813].reverse(),e=[.39894228,.01328592,.00225319,-.00157565,.00916281,-.02057706,.02635537,-.01647633,.00392377].reverse();function t(u){return u<=3.75?_horner(i,u*u/(3.75*3.75)):M.exp(M.abs(u))/M.sqrt(M.abs(u))*_horner(e,3.75/M.abs(u))}var r=[.5,.87890594,.51498869,.15084934,.02658733,.00301532,32411e-8].reverse(),a=[.39894228,-.03988024,-.00362018,.00163801,-.01031555,.02282967,-.02895312,.01787654,-.00420059].reverse();function o(u){return u<3.75?u*_horner(r,u*u/(3.75*3.75)):(u<0?-1:1)*M.exp(M.abs(u))/M.sqrt(M.abs(u))*_horner(a,3.75/M.abs(u))}return function u(c,h){if(h=Math.round(h),h===0)return t(c);if(h===1)return o(c);if(h<0)return NaN;if(M.abs(c)===0)return 0;if(c==1/0)return 1/0;var d=0,p,m=2/M.abs(c),f=0,g=1,y=0,T=2*M.round((h+M.round(M.sqrt(40*h)))/2);for(p=T;p>0;p--)y=p*m*g+f,f=g,g=y,M.abs(g)>1e10&&(g*=1e-10,f*=1e-10,d*=1e-10),p==h&&(d=f);return d*=u(c,0)/g,c<0&&h%2?-d:d}}(),besselk=function(){var i=[-.57721566,.4227842,.23069756,.0348859,.00262698,1075e-7,74e-7].reverse(),e=[1.25331414,-.07832358,.02189568,-.01062446,.00587872,-.0025154,53208e-8].reverse();function t(u){return u<=2?-M.log(u/2)*besseli(u,0)+_horner(i,u*u/4):M.exp(-u)/M.sqrt(u)*_horner(e,2/u)}var r=[1,.15443144,-.67278579,-.18156897,-.01919402,-.00110404,-4686e-8].reverse(),a=[1.25331414,.23498619,-.0365562,.01504268,-.00780353,.00325614,-68245e-8].reverse();function o(u){return u<=2?M.log(u/2)*besseli(u,1)+1/u*_horner(r,u*u/4):M.exp(-u)/M.sqrt(u)*_horner(a,2/u)}return _bessel_wrap(t,o,"BESSELK",2,1)}();/**
 * @license
 Copyright (c) 2013 jStat

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 */function erf(i){const e=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];let t=e.length-1,r=!1,a=0,o=0,u,c,h,d;if(i===0)return 0;for(i<0&&(i=-i,r=!0),u=2/(2+i),c=4*u-2;t>0;t--)h=a,a=c*a-o+e[t],o=h;return d=u*Math.exp(-i*i+.5*(e[0]+c*a)-o),r?d-1:1-d}function erfc(i){return 1-erf(i)}function erfcinv(i){let e=0,t,r,a,o;if(i>=2)return-100;if(i<=0)return 100;for(o=i<1?i:2-i,a=Math.sqrt(-2*Math.log(o/2)),t=-.70711*((2.30753+a*.27061)/(1+a*(.99229+a*.04481))-a);e<2;e++)r=erfc(t)-o,t+=r/(1.1283791670955126*Math.exp(-t*t)-t*r);return i<1?t:-t}const exponential={pdf:(i,e)=>i<0?0:e*Math.exp(-e*i),cdf:(i,e)=>i<0?0:1-Math.exp(-e*i)};function gammafn(i){const e=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],t=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535];let r=!1,a=0,o=0,u=0,c=i,h,d,p,m;if(i>171.6243769536076)return 1/0;if(c<=0)if(m=c%1,m)r=(c&1?-1:1)*Math.PI/Math.sin(Math.PI*m),c=1-c;else return 1/0;for(p=c,c<1?d=c++:d=(c-=a=(c|0)-1)-1,h=0;h<8;++h)u=(u+e[h])*d,o=o*d+t[h];if(m=u/o+1,p<c)m/=p;else if(p>c)for(h=0;h<a;++h)m*=c,c++;return r&&(m=r/m),m}const gamma={pdf:function(e,t,r){return e<0?0:e===0&&t===1?1/r:Math.exp((t-1)*Math.log(e)-e/r-gammaln(t)-t*Math.log(r))},cdf:function(e,t,r){return e<0?0:lowRegGamma(t,e/r)},inv:function(i,e,t){return gammapinv(i,e)*t}};function gammaln(i){let e=0;const t=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let r=1.000000000190015,a,o,u;for(u=(o=a=i)+5.5,u-=(a+.5)*Math.log(u);e<6;e++)r+=t[e]/++o;return Math.log(2.5066282746310007*r/a)-u}function lowRegGamma(i,e){const t=gammaln(i);let r=i,a=1/i,o=a,u=e+1-i,c=1/1e-30,h=1/u,d=h,p=1;const m=-~(Math.log(i>=1?i:1/i)*8.5+i*.4+17);let f;if(e<0||i<=0)return NaN;if(e<i+1){for(;p<=m;p++)a+=o*=e/++r;return a*Math.exp(-e+i*Math.log(e)-t)}for(;p<=m;p++)f=-p*(p-i),u+=2,h=f*h+u,c=u+f/c,h=1/h,d*=h*c;return 1-d*Math.exp(-e+i*Math.log(e)-t)}function gammapinv(i,e){let t=0;const r=e-1,a=1e-8,o=gammaln(e);let u,c,h,d,p,m,f;if(i>=1)return Math.max(100,e+100*Math.sqrt(e));if(i<=0)return 0;for(e>1?(m=Math.log(r),f=Math.exp(r*(m-1)-o),p=i<.5?i:1-i,h=Math.sqrt(-2*Math.log(p)),u=(2.30753+h*.27061)/(1+h*(.99229+h*.04481))-h,i<.5&&(u=-u),u=Math.max(.001,e*Math.pow(1-1/(9*e)-u/(3*Math.sqrt(e)),3))):(h=1-e*(.253+e*.12),i<h?u=Math.pow(i/h,1/e):u=1-Math.log(1-(i-h)/(1-h)));t<12;t++){if(u<=0)return 0;if(c=lowRegGamma(e,u)-i,e>1?h=f*Math.exp(-(u-r)+r*(Math.log(u)-m)):h=Math.exp(-u+r*Math.log(u)-o),d=c/h,u-=h=d/(1-.5*Math.min(1,d*((e-1)/u-1))),u<=0&&(u=.5*(u+h)),Math.abs(h)<a*u)break}return u}const normal={pdf:function(e,t,r){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(r)-Math.pow(e-t,2)/(2*r*r))},cdf:function(e,t,r){return .5*(1+erf((e-t)/Math.sqrt(2*r*r)))},inv:function(i,e,t){return-1.4142135623730951*t*erfcinv(2*i)+e}},beta={pdf:function(e,t,r){return e>1||e<0?0:t==1&&r==1?1:t<512&&r<512?Math.pow(e,t-1)*Math.pow(1-e,r-1)/betafn(t,r):Math.exp((t-1)*Math.log(e)+(r-1)*Math.log(1-e)-betaln(t,r))},cdf:function(e,t,r){return e>1||e<0?+(e>1):ibeta(e,t,r)},inv:function(e,t,r){return ibetainv(e,t,r)}};function betafn(i,e){if(!(i<=0||e<=0))return i+e>170?Math.exp(betaln(i,e)):gammafn(i)*gammafn(e)/gammafn(i+e)}function betaln(i,e){return gammaln(i)+gammaln(e)-gammaln(i+e)}function ibetainv(i,e,t){var r=1e-8,a=e-1,o=t-1,u=0,c,h,d,p,m,f,g,y,T,A,R;if(i<=0)return 0;if(i>=1)return 1;for(e>=1&&t>=1?(d=i<.5?i:1-i,p=Math.sqrt(-2*Math.log(d)),g=(2.30753+p*.27061)/(1+p*(.99229+p*.04481))-p,i<.5&&(g=-g),y=(g*g-3)/6,T=2/(1/(2*e-1)+1/(2*t-1)),A=g*Math.sqrt(y+T)/T-(1/(2*t-1)-1/(2*e-1))*(y+5/6-2/(3*T)),g=e/(e+t*Math.exp(2*A))):(c=Math.log(e/(e+t)),h=Math.log(t/(e+t)),p=Math.exp(e*c)/e,m=Math.exp(t*h)/t,A=p+m,i<p/A?g=Math.pow(e*A*i,1/e):g=1-Math.pow(t*A*(1-i),1/t)),R=-gammaln(e)-gammaln(t)+gammaln(e+t);u<10;u++){if(g===0||g===1)return g;if(f=ibeta(g,e,t)-i,p=Math.exp(a*Math.log(g)+o*Math.log(1-g)+R),m=f/p,g-=p=m/(1-.5*Math.min(1,m*(a/g-o/(1-g)))),g<=0&&(g=.5*(g+p)),g>=1&&(g=.5*(g+p+1)),Math.abs(p)<r*g&&u>0)break}return g}function ibeta(i,e,t){var r=i===0||i===1?0:Math.exp(gammaln(e+t)-gammaln(e)-gammaln(t)+e*Math.log(i)+t*Math.log(1-i));return i<0||i>1?!1:i<(e+1)/(e+t+2)?r*betacf(i,e,t)/e:1-r*betacf(1-i,t,e)/t}function betacf(i,e,t){var r=1e-30,a=1,o=e+t,u=e+1,c=e-1,h=1,d=1-o*i/u,p,m,f,g;for(Math.abs(d)<r&&(d=r),d=1/d,g=d;a<=100&&(p=2*a,m=a*(t-a)*i/((c+p)*(e+p)),d=1+m*d,Math.abs(d)<r&&(d=r),h=1+m/h,Math.abs(h)<r&&(h=r),d=1/d,g*=d*h,m=-(e+a)*(o+a)*i/((e+p)*(u+p)),d=1+m*d,Math.abs(d)<r&&(d=r),h=1+m/h,Math.abs(h)<r&&(h=r),d=1/d,f=d*h,g*=f,!(Math.abs(f-1)<3e-7));a++);return g}const binomial={pdf:function(i,e,t){return t===0||t===1?e*t===i?1:0:combination(e,i)*Math.pow(t,i)*Math.pow(1-t,e-i)},cdf:function(i,e,t){var r,a=1e-10;if(i<0)return 0;if(i>=e)return 1;if(t<0||t>1||e<=0)return NaN;i=Math.floor(i);var o=t,u=i+1,c=e-i,h=u+c,d=Math.exp(gammaln(h)-gammaln(c)-gammaln(u)+u*Math.log(o)+c*Math.log(1-o));return o<(u+1)/(h+2)?r=d*betinc(o,u,c,a):r=1-d*betinc(1-o,c,u,a),Math.round((1-r)*(1/a))/(1/a)}};function betinc(i,e,t,r){for(var a=0,o=1,u=1,c=1,h=0,d=0,p;Math.abs((u-d)/u)>r;)d=u,p=-(e+h)*(e+t+h)*i/(e+2*h)/(e+2*h+1),a=u+p*a,o=c+p*o,h=h+1,p=h*(t-h)*i/(e+2*h-1)/(e+2*h),u=a+p*u,c=o+p*c,a=a/c,o=o/c,u=u/c,c=1;return u/e}function combination(i,e){return i>170||e>170?Math.exp(combinationln(i,e)):factorial(i)/factorial(e)/factorial(i-e)}function combinationln(i,e){return factorialln(i)-factorialln(e)-factorialln(i-e)}function factorialln(i){return i<0?NaN:gammaln(i+1)}function factorial(i){return i<0?NaN:gammafn(i+1)}const chisquare={pdf:function(e,t){return e<0?0:e===0&&t===2?.5:Math.exp((t/2-1)*Math.log(e)-e/2-t/2*Math.log(2)-gammaln(t/2))},cdf:function(e,t){return e<0?0:lowRegGamma(t/2,e/2)},inv:function(i,e){return 2*gammapinv(i,.5*e)}},centralF={pdf:function(e,t,r){var a,o,u;return e<0?0:t<=2?e===0&&t<2?1/0:e===0&&t===2?1:1/betafn(t/2,r/2)*Math.pow(t/r,t/2)*Math.pow(e,t/2-1)*Math.pow(1+t/r*e,-(t+r)/2):(a=t*e/(r+e*t),o=r/(r+e*t),u=t*o/2,u*binomial.pdf((t-2)/2,(t+r-2)/2,a))},cdf:function(e,t,r){return e<0?0:ibeta(t*e/(t*e+r),t/2,r/2)},inv:function(e,t,r){return r/(t*(1/ibetainv(e,t/2,r/2)-1))}},weibull={pdf:function(e,t,r){return e<0||t<0||r<0?0:r/t*Math.pow(e/t,r-1)*Math.exp(-Math.pow(e/t,r))},cdf:function(e,t,r){return e<0?0:1-Math.exp(-Math.pow(e/t,r))}},poisson={pdf:function(e,t){return t<0||e%1!==0||e<0?0:Math.pow(t,e)*Math.exp(-t)/factorial(e)},cdf:function(e,t){var r=0;if(e<0)return 0;for(var a=0;r<=e;r++)a+=poisson.pdf(r,t);return a}},hypgeom={pdf:function(e,t,r,a){if(e<0||e<r-(t-a))return 0;if(e>a||e>r)return 0;if(r*2>t)return a*2>t?hypgeom.pdf(t-r-a+e,t,t-r,t-a):hypgeom.pdf(a-e,t,t-r,a);if(a*2>t)return hypgeom.pdf(r-e,t,r,t-a);if(r<a)return hypgeom.pdf(e,t,a,r);for(var o=1,u=0,c=0;c<e;c++){for(;o>1&&u<a;)o*=1-r/(t-u),u++;o*=(a-c)*(r-c)/((c+1)*(t-r-a+c+1))}for(;u<a;u++)o*=1-r/(t-u);return Math.min(1,Math.max(0,o))},cdf:function i(e,t,r,a){if(e<0||e<r-(t-a))return 0;if(e>=a||e>=r)return 1;if(r*2>t)return a*2>t?i(t-r-a+e,t,t-r,t-a):1-hypgeom.cdf(a-e-1,t,t-r,a);if(a*2>t)return 1-hypgeom.cdf(r-e-1,t,r,t-a);if(r<a)return hypgeom.cdf(e,t,a,r);for(var o=1,u=1,c=0,h=0;h<e;h++){for(;o>1&&c<a;){var d=1-r/(t-c);u*=d,o*=d,c++}u*=(a-h)*(r-h)/((h+1)*(t-r-a+h+1)),o+=u}for(;c<a;c++)o*=1-r/(t-c);return Math.min(1,Math.max(0,o))}},studentt={pdf:function(e,t){return t=t>1e100?1e100:t,1/(Math.sqrt(t)*betafn(.5,t/2))*Math.pow(1+e*e/t,-((t+1)/2))},cdf:function(e,t){var r=t/2;return ibeta((e+Math.sqrt(e*e+t))/(2*Math.sqrt(e*e+t)),r,r)},inv:function(i,e){var t=ibetainv(2*Math.min(i,1-i),.5*e,.5);return t=Math.sqrt(e*(1-t)/t),i>.5?t:-t}},lognormal={pdf:function(e,t,r){return e<=0?0:Math.exp(-Math.log(e)-.5*Math.log(2*Math.PI)-Math.log(r)-Math.pow(Math.log(e)-t,2)/(2*r*r))},cdf:function(e,t,r){return e<0?0:.5+.5*erf((Math.log(e)-t)/Math.sqrt(2*r*r))},inv:function(i,e,t){return Math.exp(-1.4142135623730951*t*erfcinv(2*i)+e)}},negbin={pdf:function(e,t,r){return e!==e>>>0?!1:e<0?0:combination(e+t-1,t-1)*Math.pow(1-r,e)*Math.pow(r,t)},cdf:function(e,t,r){var a=0,o=0;if(e<0)return 0;for(;o<=e;o++)a+=negbin.pdf(o,t,r);return a}};function sum(i){for(var e=0,t=i.length;--t>=0;)e+=i[t];return e}function mean(i){return sum(i)/i.length}function sumsqerr(i){for(var e=mean(i),t=0,r=i.length,a;--r>=0;)a=i[r]-e,t+=a*a;return t}function variance(i,e){return sumsqerr(i)/(i.length-(e?1:0))}function stdev(i,e){return Math.sqrt(variance(i,e))}function normalci(){var i=[].slice.call(arguments),e=new Array(2),t;return i.length===4?t=Math.abs(normal.inv(i[1]/2,0,1)*i[2]/Math.sqrt(i[3])):t=Math.abs(normal.inv(i[1]/2,0,1)*stdev(i[2])/Math.sqrt(i[2].length)),e[0]=i[0]-t,e[1]=i[0]+t,e}function tci(){var i=[].slice.call(arguments),e=new Array(2),t;return i.length===4?t=Math.abs(studentt.inv(i[1]/2,i[3]-1)*i[2]/Math.sqrt(i[3])):t=Math.abs(studentt.inv(i[1]/2,i[2].length-1)*stdev(i[2],!0)/Math.sqrt(i[2].length)),e[0]=i[0]-t,e[1]=i[0]+t,e}function product(i){for(var e=1,t=i.length;--t>=0;)e*=i[t];return e}function geomean(i){return Math.pow(product(i),1/i.length)}function covariance(i,e){var t=mean(i),r=mean(e),a=i.length,o=new Array(a),u;for(u=0;u<a;u++)o[u]=(i[u]-t)*(e[u]-r);return sum(o)/(a-1)}function corrcoeff(i,e){return covariance(i,e)/stdev(i,1)/stdev(e,1)}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class StatisticalPlugin extends FunctionPlugin{erf(e,t){return this.runFunction(e.args,t,this.metadata("ERF"),(r,a)=>a===void 0?erf(r):erf(a)-erf(r))}erfc(e,t){return this.runFunction(e.args,t,this.metadata("ERFC"),erfc)}expondist(e,t){return this.runFunction(e.args,t,this.metadata("EXPON.DIST"),(r,a,o)=>o?exponential.cdf(r,a):exponential.pdf(r,a))}fisher(e,t){return this.runFunction(e.args,t,this.metadata("FISHER"),r=>Math.log((1+r)/(1-r))/2)}fisherinv(e,t){return this.runFunction(e.args,t,this.metadata("FISHERINV"),r=>1-2/(Math.exp(2*r)+1))}gamma(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA"),gammafn)}gammadist(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.DIST"),(r,a,o,u)=>u?gamma.cdf(r,a,o):gamma.pdf(r,a,o))}gammaln(e,t){return this.runFunction(e.args,t,this.metadata("GAMMALN"),gammaln)}gammainv(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.INV"),gamma.inv)}gauss(e,t){return this.runFunction(e.args,t,this.metadata("GAUSS"),r=>normal.cdf(r,0,1)-.5)}betadist(e,t){return this.runFunction(e.args,t,this.metadata("BETA.DIST"),(r,a,o,u,c,h)=>r<=c?new CellError(ErrorType.NUM,ErrorMessage.ValueSmall):r>=h?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):(r=(r-c)/(h-c),u?beta.cdf(r,a,o):beta.pdf(r,a,o)))}betainv(e,t){return this.runFunction(e.args,t,this.metadata("BETA.INV"),(r,a,o,u,c)=>u>=c?new CellError(ErrorType.NUM,ErrorMessage.WrongOrder):beta.inv(r,a,o)*(c-u)+u)}binomialdist(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.DIST"),(r,a,o,u)=>r>a?new CellError(ErrorType.NUM,ErrorMessage.WrongOrder):(r=Math.trunc(r),a=Math.trunc(a),u?binomial.cdf(r,a,o):binomial.pdf(r,a,o)))}binomialinv(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.INV"),(r,a,o)=>{r=Math.trunc(r);let u=-1,c=r;for(;c>u+1;){const h=Math.trunc((u+c)/2);binomial.cdf(h,r,a)>=o?c=h:u=h}return c})}besselifn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELI"),(r,a)=>besseli(r,Math.trunc(a)))}besseljfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELJ"),(r,a)=>besselj(r,Math.trunc(a)))}besselkfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELK"),(r,a)=>besselk(r,Math.trunc(a)))}besselyfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELY"),(r,a)=>bessely(r,Math.trunc(a)))}chisqdist(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST"),(r,a,o)=>(a=Math.trunc(a),o?chisquare.cdf(r,a):chisquare.pdf(r,a)))}chisqdistrt(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST.RT"),(r,a)=>1-chisquare.cdf(r,Math.trunc(a)))}chisqinv(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV"),(r,a)=>chisquare.inv(r,Math.trunc(a)))}chisqinvrt(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV.RT"),(r,a)=>chisquare.inv(1-r,Math.trunc(a)))}fdist(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST"),(r,a,o,u)=>(a=Math.trunc(a),o=Math.trunc(o),u?centralF.cdf(r,a,o):centralF.pdf(r,a,o)))}fdistrt(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST.RT"),(r,a,o)=>1-centralF.cdf(r,Math.trunc(a),Math.trunc(o)))}finv(e,t){return this.runFunction(e.args,t,this.metadata("F.INV"),(r,a,o)=>centralF.inv(r,Math.trunc(a),Math.trunc(o)))}finvrt(e,t){return this.runFunction(e.args,t,this.metadata("F.INV.RT"),(r,a,o)=>centralF.inv(1-r,Math.trunc(a),Math.trunc(o)))}weibulldist(e,t){return this.runFunction(e.args,t,this.metadata("WEIBULL.DIST"),(r,a,o,u)=>u?weibull.cdf(r,o,a):weibull.pdf(r,o,a))}poissondist(e,t){return this.runFunction(e.args,t,this.metadata("POISSON.DIST"),(r,a,o)=>(r=Math.trunc(r),o?poisson.cdf(r,a):poisson.pdf(r,a)))}hypgeomdist(e,t){return this.runFunction(e.args,t,this.metadata("HYPGEOM.DIST"),(r,a,o,u,c)=>r>a||r>o||a>u||o>u?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):r+u<o+a?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):(r=Math.trunc(r),a=Math.trunc(a),o=Math.trunc(o),u=Math.trunc(u),c?hypgeom.cdf(r,u,o,a):hypgeom.pdf(r,u,o,a)))}tdist(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST"),(r,a,o)=>(a=Math.trunc(a),o?studentt.cdf(r,a):studentt.pdf(r,a)))}tdist2t(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.2T"),(r,a)=>(1-studentt.cdf(r,Math.trunc(a)))*2)}tdistrt(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.RT"),(r,a)=>1-studentt.cdf(r,Math.trunc(a)))}tdistold(e,t){return this.runFunction(e.args,t,this.metadata("TDIST"),(r,a,o)=>o*(1-studentt.cdf(r,Math.trunc(a))))}tinv(e,t){return this.runFunction(e.args,t,this.metadata("T.INV"),(r,a)=>studentt.inv(r,Math.trunc(a)))}tinv2t(e,t){return this.runFunction(e.args,t,this.metadata("T.INV.2T"),(r,a)=>studentt.inv(1-r/2,Math.trunc(a)))}lognormdist(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.DIST"),(r,a,o,u)=>u?lognormal.cdf(r,a,o):lognormal.pdf(r,a,o))}lognorminv(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.INV"),(r,a,o)=>lognormal.inv(r,a,o))}normdist(e,t){return this.runFunction(e.args,t,this.metadata("NORM.DIST"),(r,a,o,u)=>u?normal.cdf(r,a,o):normal.pdf(r,a,o))}norminv(e,t){return this.runFunction(e.args,t,this.metadata("NORM.INV"),(r,a,o)=>normal.inv(r,a,o))}normsdist(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.DIST"),(r,a)=>a?normal.cdf(r,0,1):normal.pdf(r,0,1))}normsinv(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.INV"),r=>normal.inv(r,0,1))}phi(e,t){return this.runFunction(e.args,t,this.metadata("PHI"),r=>normal.pdf(r,0,1))}negbinomdist(e,t){return this.runFunction(e.args,t,this.metadata("NEGBINOM.DIST"),(r,a,o,u)=>(r=Math.trunc(r),a=Math.trunc(a),u?negbin.cdf(r,a,o):negbin.pdf(r,a,o)))}confidencenorm(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.NORM"),(r,a,o)=>normalci(1,r,a,Math.trunc(o))[1]-1)}confidencet(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.T"),(r,a,o)=>(o=Math.trunc(o),o===1?new CellError(ErrorType.DIV_BY_ZERO):tci(1,r,a,o)[1]-1))}standardize(e,t){return this.runFunction(e.args,t,this.metadata("STANDARDIZE"),(r,a,o)=>(r-a)/o)}}StatisticalPlugin.implementedFunctions={ERF:{method:"erf",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0}]},ERFC:{method:"erfc",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},"EXPON.DIST":{method:"expondist",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.BOOLEAN}]},FISHER:{method:"fisher",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:-1,lessThan:1}]},FISHERINV:{method:"fisherinv",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},GAMMA:{method:"gamma",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},"GAMMA.DIST":{method:"gammadist",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.BOOLEAN}]},GAMMALN:{method:"gammaln",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0}]},"GAMMA.INV":{method:"gammainv",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0,lessThan:1},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0}]},GAUSS:{method:"gauss",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},"BETA.DIST":{method:"betadist",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.BOOLEAN},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:FunctionArgumentType.NUMBER,defaultValue:1}]},"BETA.INV":{method:"betainv",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0,maxValue:1},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:FunctionArgumentType.NUMBER,defaultValue:1}]},"BINOM.DIST":{method:"binomialdist",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0,maxValue:1},{argumentType:FunctionArgumentType.BOOLEAN}]},"BINOM.INV":{method:"binomialinv",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0,maxValue:1},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0,lessThan:1}]},BESSELI:{method:"besselifn",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},BESSELJ:{method:"besseljfn",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},BESSELK:{method:"besselkfn",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},BESSELY:{method:"besselyfn",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},"CHISQ.DIST":{method:"chisqdist",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,minValue:1,maxValue:1e10},{argumentType:FunctionArgumentType.BOOLEAN}]},"CHISQ.DIST.RT":{method:"chisqdistrt",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV":{method:"chisqinv",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0,maxValue:1},{argumentType:FunctionArgumentType.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV.RT":{method:"chisqinvrt",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0,maxValue:1},{argumentType:FunctionArgumentType.NUMBER,minValue:1}]},"F.DIST":{method:"fdist",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:1},{argumentType:FunctionArgumentType.NUMBER,minValue:1},{argumentType:FunctionArgumentType.BOOLEAN}]},"F.DIST.RT":{method:"fdistrt",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:1},{argumentType:FunctionArgumentType.NUMBER,minValue:1}]},"F.INV":{method:"finv",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0,maxValue:1},{argumentType:FunctionArgumentType.NUMBER,minValue:1},{argumentType:FunctionArgumentType.NUMBER,minValue:1}]},"F.INV.RT":{method:"finvrt",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0,maxValue:1},{argumentType:FunctionArgumentType.NUMBER,minValue:1},{argumentType:FunctionArgumentType.NUMBER,minValue:1}]},"WEIBULL.DIST":{method:"weibulldist",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.BOOLEAN}]},"POISSON.DIST":{method:"poissondist",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.BOOLEAN}]},"HYPGEOM.DIST":{method:"hypgeomdist",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.BOOLEAN}]},"T.DIST":{method:"tdist",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,minValue:1},{argumentType:FunctionArgumentType.BOOLEAN}]},"T.DIST.2T":{method:"tdist2t",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:1}]},"T.DIST.RT":{method:"tdistrt",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,minValue:1}]},TDIST:{method:"tdistold",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:1},{argumentType:FunctionArgumentType.INTEGER,minValue:1,maxValue:2}]},"T.INV":{method:"tinv",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0,lessThan:1},{argumentType:FunctionArgumentType.NUMBER,minValue:1}]},"T.INV.2T":{method:"tinv2t",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0,maxValue:1},{argumentType:FunctionArgumentType.NUMBER,minValue:1}]},"LOGNORM.DIST":{method:"lognormdist",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.BOOLEAN}]},"LOGNORM.INV":{method:"lognorminv",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0,lessThan:1},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0}]},"NORM.DIST":{method:"normdist",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.BOOLEAN}]},"NORM.INV":{method:"norminv",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0,lessThan:1},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0}]},"NORM.S.DIST":{method:"normsdist",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.BOOLEAN}]},"NORM.S.INV":{method:"normsinv",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0,lessThan:1}]},PHI:{method:"phi",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},"NEGBINOM.DIST":{method:"negbinomdist",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:1},{argumentType:FunctionArgumentType.NUMBER,minValue:0,maxValue:1},{argumentType:FunctionArgumentType.BOOLEAN}]},"CONFIDENCE.NORM":{method:"confidencenorm",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0,lessThan:1},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,minValue:1}]},"CONFIDENCE.T":{method:"confidencet",parameters:[{argumentType:FunctionArgumentType.NUMBER,greaterThan:0,lessThan:1},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:FunctionArgumentType.NUMBER,minValue:1}]},STANDARDIZE:{method:"standardize",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,greaterThan:0}]}};StatisticalPlugin.aliases={NEGBINOMDIST:"NEGBINOM.DIST",EXPONDIST:"EXPON.DIST",BETADIST:"BETA.DIST",NORMDIST:"NORM.DIST",NORMINV:"NORM.INV",NORMSDIST:"NORM.S.DIST",NORMSINV:"NORM.S.INV",LOGNORMDIST:"LOGNORM.DIST",LOGINV:"LOGNORM.INV",TINV:"T.INV.2T",HYPGEOMDIST:"HYPGEOM.DIST",POISSON:"POISSON.DIST",WEIBULL:"WEIBULL.DIST",FINV:"F.INV.RT",FDIST:"F.DIST.RT",CHIDIST:"CHISQ.DIST.RT",CHIINV:"CHISQ.INV.RT",GAMMADIST:"GAMMA.DIST","GAMMALN.PRECISE":"GAMMALN",GAMMAINV:"GAMMA.INV",BETAINV:"BETA.INV",BINOMDIST:"BINOM.DIST",CONFIDENCE:"CONFIDENCE.NORM",CRITBINOM:"BINOM.INV",WEIBULLDIST:"WEIBULL.DIST",TINV2T:"T.INV.2T",TDISTRT:"T.DIST.RT",TDIST2T:"T.DIST.2T",FINVRT:"F.INV.RT",FDISTRT:"F.DIST.RT",CHIDISTRT:"CHISQ.DIST.RT",CHIINVRT:"CHISQ.INV.RT",LOGNORMINV:"LOGNORM.INV",POISSONDIST:"POISSON.DIST"};/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class MathPlugin extends FunctionPlugin{fact(e,t){return this.runFunction(e.args,t,this.metadata("FACT"),r=>{r=Math.trunc(r);let a=1;for(let o=1;o<=r;o++)a*=o;return a})}factdouble(e,t){return this.runFunction(e.args,t,this.metadata("FACTDOUBLE"),r=>{r=Math.trunc(r);let a=1;for(let o=r;o>=1;o-=2)a*=o;return a})}combin(e,t){return this.runFunction(e.args,t,this.metadata("COMBIN"),(r,a)=>a>r?new CellError(ErrorType.NUM,ErrorMessage.WrongOrder):(r=Math.trunc(r),a=Math.trunc(a),combin(r,a)))}combina(e,t){return this.runFunction(e.args,t,this.metadata("COMBINA"),(r,a)=>(r=Math.trunc(r),a=Math.trunc(a),r+a-1>=1030?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):r===0&&a===0?1:combin(r+a-1,a)))}gcd(e,t){return this.runFunction(e.args,t,this.metadata("GCD"),(...r)=>{const a=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(r);if(a instanceof CellError)return a;let o=0;for(const u of a){if(u<0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);o=binaryGCD(o,Math.trunc(u))}return o>Number.MAX_SAFE_INTEGER?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):o})}lcm(e,t){return this.runFunction(e.args,t,this.metadata("LCM"),(...r)=>{const a=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(r);if(a instanceof CellError)return a;let o=1;for(const u of a){if(u<0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);o=binaryLCM(o,Math.trunc(u))}return o>Number.MAX_SAFE_INTEGER?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):o})}mround(e,t){return this.runFunction(e.args,t,this.metadata("MROUND"),(r,a)=>a===0?0:r>0&&a<0||r<0&&a>0?new CellError(ErrorType.NUM,ErrorMessage.DistinctSigns):Math.round(r/a)*a)}multinomial(e,t){return this.runFunction(e.args,t,this.metadata("MULTINOMIAL"),(...r)=>{let a=0,o=1;for(let u of r){if(u<0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);u=Math.trunc(u);for(let c=1;c<=u;c++)o*=(a+c)/c;a+=u}return Math.round(o)})}quotient(e,t){return this.runFunction(e.args,t,this.metadata("QUOTIENT"),(r,a)=>a===0?new CellError(ErrorType.DIV_BY_ZERO):Math.trunc(r/a))}seriessum(e,t){return this.runFunction(e.args,t,this.metadata("SERIESSUM"),(r,a,o,u)=>{const c=this.arithmeticHelper.manyToOnlyNumbersDropNulls(u.valuesFromTopLeftCorner());if(c instanceof CellError)return c;let h=0;c.reverse();for(const d of c)h*=Math.pow(r,o),h+=d;return h*Math.pow(r,a)})}sign(e,t){return this.runFunction(e.args,t,this.metadata("SIGN"),r=>r>0?1:r<0?-1:0)}sumx2my2(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2MY2"),(r,a)=>{const o=r.valuesFromTopLeftCorner(),u=a.valuesFromTopLeftCorner();if(o.length!==u.length)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const c=o.length;let h=0;for(let d=0;d<c;d++){const p=o[d],m=u[d];if(p instanceof CellError)return p;if(m instanceof CellError)return m;typeof p=="number"&&typeof m=="number"&&(h+=Math.pow(p,2)-Math.pow(m,2))}return h})}sumx2py2(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2PY2"),(r,a)=>{const o=r.valuesFromTopLeftCorner(),u=a.valuesFromTopLeftCorner();if(o.length!==u.length)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const c=o.length;let h=0;for(let d=0;d<c;d++){const p=o[d],m=u[d];if(p instanceof CellError)return p;if(m instanceof CellError)return m;typeof p=="number"&&typeof m=="number"&&(h+=Math.pow(p,2)+Math.pow(m,2))}return h})}sumxmy2(e,t){return this.runFunction(e.args,t,this.metadata("SUMXMY2"),(r,a)=>{const o=r.valuesFromTopLeftCorner(),u=a.valuesFromTopLeftCorner();if(o.length!==u.length)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const c=o.length;let h=0;for(let d=0;d<c;d++){const p=o[d],m=u[d];if(p instanceof CellError)return p;if(m instanceof CellError)return m;typeof p=="number"&&typeof m=="number"&&(h+=Math.pow(p-m,2))}return h})}}MathPlugin.implementedFunctions={FACT:{method:"fact",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0,maxValue:170}]},FACTDOUBLE:{method:"factdouble",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0,maxValue:288}]},COMBIN:{method:"combin",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0,lessThan:1030},{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},COMBINA:{method:"combina",parameters:[{argumentType:FunctionArgumentType.NUMBER,minValue:0},{argumentType:FunctionArgumentType.NUMBER,minValue:0}]},GCD:{method:"gcd",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},LCM:{method:"lcm",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},MROUND:{method:"mround",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}]},MULTINOMIAL:{method:"multinomial",parameters:[{argumentType:FunctionArgumentType.NUMBER}],repeatLastArgs:1,expandRanges:!0},QUOTIENT:{method:"quotient",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER}]},SERIESSUM:{method:"seriessum",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.RANGE}]},SIGN:{method:"sign",parameters:[{argumentType:FunctionArgumentType.NUMBER}]},SUMX2MY2:{method:"sumx2my2",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE}]},SUMX2PY2:{method:"sumx2py2",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE}]},SUMXMY2:{method:"sumxmy2",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE}]}};function combin(i,e){2*e>i&&(e=i-e);let t=1;for(let r=1;r<=e;r++)t*=(i-e+r)/r;return Math.round(t)}function binaryGCD(i,e){for(i<e&&([i,e]=[e,i]);e>0;)[i,e]=[e,i%e];return i}function binaryLCM(i,e){return i===0||e===0?0:i*(e/binaryGCD(i,e))}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class ComplexPlugin extends FunctionPlugin{complex(e,t){return this.runFunction(e.args,t,this.metadata("COMPLEX"),(r,a,o)=>o!=="i"&&o!=="j"?new CellError(ErrorType.VALUE,ErrorMessage.ShouldBeIorJ):coerceComplexToString([r,a],o))}imabs(e,t){return this.runFunction(e.args,t,this.metadata("IMABS"),abs)}imaginary(e,t){return this.runFunction(e.args,t,this.metadata("IMAGINARY"),([r,a])=>a)}imreal(e,t){return this.runFunction(e.args,t,this.metadata("IMREAL"),([r,a])=>r)}imargument(e,t){return this.runFunction(e.args,t,this.metadata("IMARGUMENT"),([r,a])=>r===0&&a===0?new CellError(ErrorType.DIV_BY_ZERO):Math.atan2(a,r))}imconjugate(e,t){return this.runFunction(e.args,t,this.metadata("IMCONJUGATE"),([r,a])=>coerceComplexToString([r,-a]))}imcos(e,t){return this.runFunction(e.args,t,this.metadata("IMCOS"),r=>coerceComplexToString(cos(r)))}imcosh(e,t){return this.runFunction(e.args,t,this.metadata("IMCOSH"),r=>coerceComplexToString(cosh(r)))}imcot(e,t){return this.runFunction(e.args,t,this.metadata("IMCOT"),r=>coerceComplexToString(div(cos(r),sin(r))))}imcsc(e,t){return this.runFunction(e.args,t,this.metadata("IMCSC"),r=>coerceComplexToString(div([1,0],sin(r))))}imcsch(e,t){return this.runFunction(e.args,t,this.metadata("IMCSCH"),r=>coerceComplexToString(div([1,0],sinh(r))))}imsec(e,t){return this.runFunction(e.args,t,this.metadata("IMSEC"),r=>coerceComplexToString(div([1,0],cos(r))))}imsech(e,t){return this.runFunction(e.args,t,this.metadata("IMSECH"),r=>coerceComplexToString(div([1,0],cosh(r))))}imsin(e,t){return this.runFunction(e.args,t,this.metadata("IMSIN"),r=>coerceComplexToString(sin(r)))}imsinh(e,t){return this.runFunction(e.args,t,this.metadata("IMSINH"),r=>coerceComplexToString(sinh(r)))}imtan(e,t){return this.runFunction(e.args,t,this.metadata("IMTAN"),r=>coerceComplexToString(div(sin(r),cos(r))))}imdiv(e,t){return this.runFunction(e.args,t,this.metadata("IMDIV"),(r,a)=>coerceComplexToString(div(r,a)))}improduct(e,t){return this.runFunction(e.args,t,this.metadata("IMPRODUCT"),(...r)=>{const a=this.arithmeticHelper.coerceComplexExactRanges(r);if(a instanceof CellError)return a;let o=[1,0];for(const u of a)o=mul(o,u);return coerceComplexToString(o)})}imsum(e,t){return this.runFunction(e.args,t,this.metadata("IMSUM"),(...r)=>{const a=this.arithmeticHelper.coerceComplexExactRanges(r);if(a instanceof CellError)return a;let o=[0,0];for(const u of a)o=add(o,u);return coerceComplexToString(o)})}imsub(e,t){return this.runFunction(e.args,t,this.metadata("IMSUB"),(r,a)=>coerceComplexToString(sub(r,a)))}imexp(e,t){return this.runFunction(e.args,t,this.metadata("IMEXP"),r=>coerceComplexToString(exp(r)))}imln(e,t){return this.runFunction(e.args,t,this.metadata("IMLN"),r=>coerceComplexToString(ln(r)))}imlog10(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG10"),r=>{const[a,o]=ln(r),u=Math.log(10);return coerceComplexToString([a/u,o/u])})}imlog2(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG2"),r=>{const[a,o]=ln(r),u=Math.log(2);return coerceComplexToString([a/u,o/u])})}impower(e,t){return this.runFunction(e.args,t,this.metadata("IMPOWER"),(r,a)=>coerceComplexToString(power(r,a)))}imsqrt(e,t){return this.runFunction(e.args,t,this.metadata("IMSQRT"),r=>coerceComplexToString(power(r,.5)))}}ComplexPlugin.implementedFunctions={COMPLEX:{method:"complex",parameters:[{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.STRING,defaultValue:"i"}]},IMABS:{method:"imabs",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMAGINARY:{method:"imaginary",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMREAL:{method:"imreal",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMARGUMENT:{method:"imargument",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMCONJUGATE:{method:"imconjugate",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMCOS:{method:"imcos",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMCOSH:{method:"imcosh",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMCOT:{method:"imcot",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMCSC:{method:"imcsc",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMCSCH:{method:"imcsch",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMSEC:{method:"imsec",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMSECH:{method:"imsech",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMSIN:{method:"imsin",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMSINH:{method:"imsinh",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMTAN:{method:"imtan",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMDIV:{method:"imdiv",parameters:[{argumentType:FunctionArgumentType.COMPLEX},{argumentType:FunctionArgumentType.COMPLEX}]},IMPRODUCT:{method:"improduct",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},IMSUM:{method:"imsum",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},IMSUB:{method:"imsub",parameters:[{argumentType:FunctionArgumentType.COMPLEX},{argumentType:FunctionArgumentType.COMPLEX}]},IMEXP:{method:"imexp",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMLN:{method:"imln",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMLOG10:{method:"imlog10",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMLOG2:{method:"imlog2",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]},IMPOWER:{method:"impower",parameters:[{argumentType:FunctionArgumentType.COMPLEX},{argumentType:FunctionArgumentType.NUMBER}]},IMSQRT:{method:"imsqrt",parameters:[{argumentType:FunctionArgumentType.COMPLEX}]}};function add([i,e],[t,r]){return[i+t,e+r]}function sub([i,e],[t,r]){return[i-t,e-r]}function mul([i,e],[t,r]){return[i*t-e*r,i*r+t*e]}function div([i,e],[t,r]){const a=Math.pow(t,2)+Math.pow(r,2),[o,u]=mul([i,e],[t,-r]);return[o/a,u/a]}function cos([i,e]){return[Math.cos(i)*Math.cosh(e),-Math.sin(i)*Math.sinh(e)]}function cosh([i,e]){return[Math.cosh(i)*Math.cos(e),Math.sinh(i)*Math.sin(e)]}function sin([i,e]){return[Math.sin(i)*Math.cosh(e),Math.cos(i)*Math.sinh(e)]}function sinh([i,e]){return[Math.sinh(i)*Math.cos(e),Math.cosh(i)*Math.sin(e)]}function exp([i,e]){return[Math.exp(i)*Math.cos(e),Math.exp(i)*Math.sin(e)]}function abs([i,e]){return Math.sqrt(i*i+e*e)}function ln([i,e]){return[Math.log(abs([i,e])),Math.atan2(e,i)]}function power(i,e){const[t,r]=ln(i);return exp([e*t,e*r])}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class StatisticalAggregationPlugin extends FunctionPlugin{avedev(e,t){return this.runFunction(e.args,t,this.metadata("AVEDEV"),(...r)=>{const a=this.arithmeticHelper.coerceNumbersExactRanges(r);if(a instanceof CellError)return a;if(a.length===0)return new CellError(ErrorType.DIV_BY_ZERO);const o=mean(a);return a.reduce((u,c)=>u+Math.abs(c-o),0)/a.length})}devsq(e,t){return this.runFunction(e.args,t,this.metadata("DEVSQ"),(...r)=>{const a=this.arithmeticHelper.coerceNumbersExactRanges(r);return a instanceof CellError?a:a.length===0?0:sumsqerr(a)})}geomean(e,t){return this.runFunction(e.args,t,this.metadata("GEOMEAN"),(...r)=>{const a=this.arithmeticHelper.coerceNumbersExactRanges(r);if(a instanceof CellError)return a;if(a.length===0)return new CellError(ErrorType.NUM,ErrorMessage.OneValue);for(const o of a)if(o<=0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);return geomean(a)})}harmean(e,t){return this.runFunction(e.args,t,this.metadata("HARMEAN"),(...r)=>{const a=this.arithmeticHelper.coerceNumbersExactRanges(r);if(a instanceof CellError)return a;if(a.length===0)return new CellError(ErrorType.NUM,ErrorMessage.OneValue);for(const o of a)if(o<=0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);return a.length/a.reduce((o,u)=>o+1/u,0)})}correl(e,t){return this.runFunction(e.args,t,this.metadata("CORREL"),(r,a)=>{if(r.numberOfElements()!==a.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const o=parseTwoArrays(r,a);return o instanceof CellError?o:o[0].length<=1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues):corrcoeff(o[0],o[1])})}rsq(e,t){return this.runFunction(e.args,t,this.metadata("RSQ"),(r,a)=>{if(r.numberOfElements()!==a.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const o=parseTwoArrays(r,a);return o instanceof CellError?o:o[0].length<=1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues):Math.pow(corrcoeff(o[0],o[1]),2)})}covariancep(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.P"),(r,a)=>{if(r.numberOfElements()!==a.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const o=parseTwoArrays(r,a);if(o instanceof CellError)return o;const u=o[0].length;return u<1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.OneValue):u===1?0:covariance(o[0],o[1])*(u-1)/u})}covariances(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.S"),(r,a)=>{if(r.numberOfElements()!==a.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const o=parseTwoArrays(r,a);return o instanceof CellError?o:o[0].length<=1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues):covariance(o[0],o[1])})}ztest(e,t){return this.runFunction(e.args,t,this.metadata("Z.TEST"),(r,a,o)=>{const u=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());if(u instanceof CellError)return u;const c=u.length;if(o===void 0){if(c<2)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);o=stdev(u,!0)}return c<1?new CellError(ErrorType.NA,ErrorMessage.OneValue):o===0?new CellError(ErrorType.DIV_BY_ZERO):1-normal.cdf((mean(u)-a)/(o/Math.sqrt(c)),0,1)})}ftest(e,t){return this.runFunction(e.args,t,this.metadata("F.TEST"),(r,a)=>{const o=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner()),u=this.arithmeticHelper.manyToExactNumbers(a.valuesFromTopLeftCorner());if(o instanceof CellError)return o;if(u instanceof CellError)return u;if(o.length<=1||u.length<=1)return new CellError(ErrorType.DIV_BY_ZERO);const c=variance(o,!0),h=variance(u,!0);if(c===0||h===0)return new CellError(ErrorType.DIV_BY_ZERO);const d=c/h,p=centralF.cdf(d,o.length-1,u.length-1);return 2*Math.min(p,1-p)})}steyx(e,t){return this.runFunction(e.args,t,this.metadata("STEYX"),(r,a)=>{if(r.numberOfElements()!==a.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const o=parseTwoArrays(r,a);if(o instanceof CellError)return o;const u=o[0].length;return u<=2?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.ThreeValues):Math.sqrt((sumsqerr(o[0])-Math.pow(covariance(o[0],o[1])*(u-1),2)/sumsqerr(o[1]))/(u-2))})}slope(e,t){return this.runFunction(e.args,t,this.metadata("SLOPE"),(r,a)=>{if(r.numberOfElements()!==a.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const o=parseTwoArrays(r,a);if(o instanceof CellError)return o;const u=o[0].length;return u<=1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues):covariance(o[0],o[1])*(u-1)/sumsqerr(o[1])})}chisqtest(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.TEST"),(r,a)=>{const o=r.height(),u=r.width();if(a.height()!==o||a.width()!==u)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const c=parseTwoArrays(r,a);if(c instanceof CellError)return c;if(c[0].length<=1)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);let h=0;for(let d=0;d<c[0].length;d++){if(c[1][d]===0)return new CellError(ErrorType.DIV_BY_ZERO);h+=Math.pow(c[0][d]-c[1][d],2)/c[1][d]}return h<0?new CellError(ErrorType.NUM,ErrorMessage.NaN):1-chisquare.cdf(h,o>1&&u>1?(o-1)*(u-1):o*u-1)})}ttest(e,t){return this.runFunction(e.args,t,this.metadata("T.TEST"),(r,a,o,u)=>{const c=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner()),h=this.arithmeticHelper.manyToExactNumbers(a.valuesFromTopLeftCorner());if(c instanceof CellError)return c;if(h instanceof CellError)return h;const d=c.length,p=h.length;if(u===1){if(p!==d)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);if(d<=1)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);const m=Array(d);for(let y=0;y<d;y++)m[y]=c[y]-h[y];const f=stdev(m,!0);if(f===0)return new CellError(ErrorType.DIV_BY_ZERO);const g=Math.abs(Math.sqrt(d)*mean(m)/f);return o*(1-studentt.cdf(g,d-1))}else if(u===2){if(d<=1||p<=1)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);const m=(sumsqerr(c)+sumsqerr(h))/(d+p-2);if(m===0)return new CellError(ErrorType.DIV_BY_ZERO);const f=Math.abs((mean(c)-mean(h))/Math.sqrt(m*(1/d+1/p)));return o*(1-studentt.cdf(f,d+p-2))}else{if(d<=1||p<=1)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);const m=variance(c,!0),f=variance(h,!0);if(m===0&&f===0)return new CellError(ErrorType.DIV_BY_ZERO);const g=Math.abs((mean(c)-mean(h))/Math.sqrt(m/d+f/p)),y=Math.pow(m/d+f/p,2)/(Math.pow(m/d,2)/(d-1)+Math.pow(f/p,2)/(p-1));return o*(1-studentt.cdf(g,y))}})}skew(e,t){return this.runFunction(e.args,t,this.metadata("SKEW"),(...r)=>{const a=this.arithmeticHelper.coerceNumbersExactRanges(r);if(a instanceof CellError)return a;const o=a.length;if(o<3)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.ThreeValues);const u=mean(a),c=stdev(a,!0);return c===0?new CellError(ErrorType.DIV_BY_ZERO):a.reduce((h,d)=>h+Math.pow((d-u)/c,3),0)*o/(o-1)/(o-2)})}skewp(e,t){return this.runFunction(e.args,t,this.metadata("SKEW.P"),(...r)=>{const a=this.arithmeticHelper.coerceNumbersExactRanges(r);if(a instanceof CellError)return a;const o=a.length;if(o<3)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.ThreeValues);const u=mean(a),c=stdev(a,!1);return c===0?new CellError(ErrorType.DIV_BY_ZERO):a.reduce((h,d)=>h+Math.pow((d-u)/c,3),0)/o})}}StatisticalAggregationPlugin.implementedFunctions={AVEDEV:{method:"avedev",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},DEVSQ:{method:"devsq",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},GEOMEAN:{method:"geomean",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},HARMEAN:{method:"harmean",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},CORREL:{method:"correl",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE}]},RSQ:{method:"rsq",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE}]},"COVARIANCE.P":{method:"covariancep",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE}]},"COVARIANCE.S":{method:"covariances",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE}]},"Z.TEST":{method:"ztest",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.NUMBER},{argumentType:FunctionArgumentType.NUMBER,optionalArg:!0}]},"F.TEST":{method:"ftest",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE}]},STEYX:{method:"steyx",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE}]},SLOPE:{method:"slope",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE}]},"CHISQ.TEST":{method:"chisqtest",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE}]},"T.TEST":{method:"ttest",parameters:[{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.RANGE},{argumentType:FunctionArgumentType.INTEGER,minValue:1,maxValue:2},{argumentType:FunctionArgumentType.INTEGER,minValue:1,maxValue:3}]},SKEW:{method:"skew",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1},"SKEW.P":{method:"skewp",parameters:[{argumentType:FunctionArgumentType.ANY}],repeatLastArgs:1}};StatisticalAggregationPlugin.aliases={COVAR:"COVARIANCE.P",FTEST:"F.TEST",PEARSON:"CORREL",ZTEST:"Z.TEST",CHITEST:"CHISQ.TEST",TTEST:"T.TEST",COVARIANCEP:"COVARIANCE.P",COVARIANCES:"COVARIANCE.S",SKEWP:"SKEW.P"};function parseTwoArrays(i,e){const t=i.iterateValuesFromTopLeftCorner(),r=e.iterateValuesFromTopLeftCorner();let a,o;const u=[],c=[];for(;a=t.next(),o=r.next(),!a.done&&!o.done;){const h=a.value,d=o.value;if(h instanceof CellError)return h;if(d instanceof CellError)return d;isExtendedNumber(h)&&isExtendedNumber(d)&&(u.push(getRawValue(h)),c.push(getRawValue(d)))}return[u,c]}/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */const plugins=Object.freeze(Object.defineProperty({__proto__:null,AbsPlugin,AddressPlugin,ArrayPlugin,BitShiftPlugin,BitwiseLogicOperationsPlugin,BooleanPlugin,CharPlugin,CodePlugin,ComplexPlugin,ConditionalAggregationPlugin,CountBlankPlugin,CountUniquePlugin,DateTimePlugin,DegreesPlugin,DeltaPlugin,ExpPlugin,FinancialPlugin,FormulaTextPlugin,HyperlinkPlugin,InformationPlugin,IsEvenPlugin,IsOddPlugin,LogarithmPlugin,LookupPlugin,MathConstantsPlugin,MathPlugin,MatrixPlugin,MedianPlugin,ModuloPlugin,NumericAggregationPlugin,PowerPlugin,RadiansPlugin,RadixConversionPlugin,RandomPlugin,RomanPlugin,RoundingPlugin,SimpleArithmerticPlugin,SqrtPlugin,StatisticalAggregationPlugin,StatisticalPlugin,SumprodPlugin,TextPlugin,TrigonometryPlugin},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright (c) 2024 Handsoncode. All rights reserved.
 */class HyperFormulaNS extends HyperFormula{}HyperFormulaNS.HyperFormula=HyperFormula;HyperFormulaNS.ErrorType=ErrorType;HyperFormulaNS.CellError=CellError;HyperFormulaNS.CellType=CellType;HyperFormulaNS.CellValueType=CellValueType;HyperFormulaNS.CellValueDetailedType=CellValueDetailedType;HyperFormulaNS.DetailedCellError=DetailedCellError;HyperFormulaNS.ExportedCellChange=ExportedCellChange;HyperFormulaNS.ExportedNamedExpressionChange=ExportedNamedExpressionChange;HyperFormulaNS.ConfigValueTooBigError=ConfigValueTooBigError;HyperFormulaNS.ConfigValueTooSmallError=ConfigValueTooSmallError;HyperFormulaNS.EvaluationSuspendedError=EvaluationSuspendedError;HyperFormulaNS.ExpectedOneOfValuesError=ExpectedOneOfValuesError;HyperFormulaNS.ExpectedValueOfTypeError=ExpectedValueOfTypeError;HyperFormulaNS.ArraySize=ArraySize;HyperFormulaNS.SimpleRangeValue=SimpleRangeValue;HyperFormulaNS.EmptyValue=EmptyValue;HyperFormulaNS.FunctionPlugin=FunctionPlugin;HyperFormulaNS.FunctionArgumentType=FunctionArgumentType;HyperFormulaNS.FunctionPluginValidationError=FunctionPluginValidationError;HyperFormulaNS.InvalidAddressError=InvalidAddressError;HyperFormulaNS.InvalidArgumentsError=InvalidArgumentsError;HyperFormulaNS.LanguageNotRegisteredError=LanguageNotRegisteredError;HyperFormulaNS.LanguageAlreadyRegisteredError=LanguageAlreadyRegisteredError;HyperFormulaNS.MissingTranslationError=MissingTranslationError;HyperFormulaNS.NamedExpressionDoesNotExistError=NamedExpressionDoesNotExistError;HyperFormulaNS.NamedExpressionNameIsAlreadyTakenError=NamedExpressionNameIsAlreadyTakenError;HyperFormulaNS.NamedExpressionNameIsInvalidError=NamedExpressionNameIsInvalidError;HyperFormulaNS.NoOperationToRedoError=NoOperationToRedoError;HyperFormulaNS.NoOperationToUndoError=NoOperationToUndoError;HyperFormulaNS.NoRelativeAddressesAllowedError=NoRelativeAddressesAllowedError;HyperFormulaNS.NoSheetWithIdError=NoSheetWithIdError;HyperFormulaNS.NoSheetWithNameError=NoSheetWithNameError;HyperFormulaNS.NotAFormulaError=NotAFormulaError;HyperFormulaNS.NothingToPasteError=NothingToPasteError;HyperFormulaNS.ProtectedFunctionTranslationError=ProtectedFunctionTranslationError;HyperFormulaNS.SheetNameAlreadyTakenError=SheetNameAlreadyTakenError;HyperFormulaNS.SheetSizeLimitExceededError=SheetSizeLimitExceededError;HyperFormulaNS.SourceLocationHasArrayError=SourceLocationHasArrayError;HyperFormulaNS.TargetLocationHasArrayError=TargetLocationHasArrayError;HyperFormulaNS.UnableToParseError=UnableToParseError;const defaultLanguage=Config.defaultConfig.language;HyperFormula.registerLanguage(defaultLanguage,dictionary);HyperFormula.languages[dictionary.langCode]=dictionary;for(const i of Object.getOwnPropertyNames(plugins))i.startsWith("_")||HyperFormula.registerFunctionPlugin(plugins[i]);const ROTATION_SPEED_MIN=200,ROTATION_SPEED_MAX=800,CRAZY_PARTICLES_FREQUENCY=.1,CRAZY_PARTICLE_CRAZINESS=.3,BEZIER_MEDIAN=.5,FORCE=.5,SIZE=12,FLOOR_HEIGHT=800,FLOOR_WIDTH=1600,PARTICLE_COUNT=150,DURATION=3500,COLORS=["#FFC700","#FF0000","#2E3191","#41BBC7"];var script={props:{particleCount:{type:Number,default:PARTICLE_COUNT},particleSize:{type:Number,default:SIZE},duration:{type:Number,default:DURATION},colors:{type:Array,default:COLORS},force:{type:Number,default:FORCE},stageHeight:{type:Number,default:FLOOR_HEIGHT},stageWidth:{type:Number,default:FLOOR_WIDTH},shouldDestroyAfterDone:{type:Boolean,default:!0}},setup(i){const e=ref(!0),t=(N,S)=>{C(N,{degree:S})},r=computed(()=>o(i.particleCount,i.colors));watchEffect(()=>{i.particleCount>300&&console.log("[VUE-CONFETTI-EXPLOSION] That's a lot of confetti, you sure about that? A lesser number like 200 will still give off the party vibes while still not bricking the device ")});const a=computed(()=>R(i.particleCount,i.duration,i.colors,i.particleSize,i.force,i.stageHeight,i.stageWidth));onMounted(async()=>{await u(i.duration),i.shouldDestroyAfterDone&&(e.value=!1)});const o=(N,S)=>{const _=360/N;return Array.from({length:N},(O,I)=>({color:S[I%S.length],degree:I*_}))},u=N=>new Promise(S=>setTimeout(S,N));function c(N){let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return Math.round((N+Number.EPSILON)*10**S)/10**S}function h(N,S){if(N===S)return!0;if(N==null||S==null||N.length!==S.length)return!1;for(let _=0;_<N.length;_++)if(N[_]!==S[_])return!1;return!0}const d=(N,S,_,O,I)=>(N-S)*(I-O)/(_-S)+O,p=(N,S)=>{const _=N+S;return _>360?_-360:_},m=()=>Math.random()>.5,f=[0,0,1],g=[[1,1,0],[1,0,1],[0,1,1],[1,0,0],[0,1,0],f],y=N=>!h(g[N],f)&&m(),T=N=>typeof N>"u",A=N=>{console.error(N)};function R(N,S,_,O,I,L,b){const w=Number.isSafeInteger;return!T(N)&&w(N)&&N<0?(A("particleCount must be a positive integer"),!1):!T(S)&&w(S)&&S<0?(A("duration must be a positive integer"),!1):!T(_)&&!Array.isArray(_)?(A("colors must be an array of strings"),!1):!T(O)&&w(O)&&O<0?(A("particleSize must be a positive integer"),!1):!T(I)&&w(I)&&(I<0||I>1)?(A("force must be a positive integer and should be within 0 and 1"),!1):!T(L)&&typeof L=="number"&&w(L)&&L<0?(A("floorHeight must be a positive integer"),!1):!T(b)&&typeof b=="number"&&w(b)&&b<0?(A("floorWidth must be a positive integer"),!1):!0}function C(N,S){let{degree:_}=S;const O=d(Math.abs(p(_,90)-180),0,180,-i.stageWidth/2,i.stageWidth/2),I=Math.random()*(ROTATION_SPEED_MAX-ROTATION_SPEED_MIN)+ROTATION_SPEED_MIN,L=Math.round(Math.random()*(g.length-1)),b=i.duration-Math.round(Math.random()*1e3),w=Math.random()<CRAZY_PARTICLES_FREQUENCY,F=y(L),P=w?c(Math.random()*CRAZY_PARTICLE_CRAZINESS,2):0,x=P*-1,B=P,k=c(Math.abs(d(Math.abs(p(_,90)-180),0,180,-1,1)),4),V=c(Math.random()*BEZIER_MEDIAN,4),H=c(Math.random()*i.force*(m()?1:-1),4),Y=BEZIER_MEDIAN,G=c(Math.max(d(Math.abs(_-180),0,180,i.force,-i.force),0),4),D=(X,z)=>N==null?void 0:N.style.setProperty(X,z+"");D("--x-landing-point",`${O}px`),D("--duration-chaos",`${b}ms`),D("--x1",`${P}`),D("--x2",`${x}`),D("--x3",`${B}`),D("--x4",`${k}`),D("--y1",`${V}`),D("--y2",`${H}`),D("--y3",`${Y}`),D("--y4",`${G}`),D("--width",`${F?i.particleSize:Math.round(Math.random()*4)+i.particleSize/2}px`),D("--height",(F?i.particleSize:Math.round(Math.random()*2)+i.particleSize)+"px"),D("--rotation",`${g[L].join()}`),D("--rotation-duration",`${I}ms`),D("--border-radius",`${F?"50%":"0"}`)}return{isVisible:e,isValid:a,stageHeight:i.stageHeight,particles:r,setItemRef:t}}};function render(i,e,t,r,a,o){return r.isVisible&&r.isValid?(openBlock(),createElementBlock("div",{key:0,class:"confetti-container",style:normalizeStyle(`--floor-height: ${r.stageHeight}px;`)},[(openBlock(!0),createElementBlock(Fragment,null,renderList(r.particles,u=>{let{color:c,degree:h}=u;return openBlock(),createElementBlock("div",{key:h,class:"particle",ref:d=>r.setItemRef(d,h)},[createBaseVNode("div",{style:normalizeStyle(`--bgcolor: ${c};`)},null,4)],512)}),128))],4)):createCommentVNode("",!0)}function styleInject(i,e){e===void 0&&(e={});var t=e.insertAt;if(!(!i||typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",t==="top"&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=i:a.appendChild(document.createTextNode(i))}}var css_248z=`
@keyframes y-axis-4ff796ae {
to {
    transform: translate3d(0, var(--floor-height), 0);
}
}
@keyframes x-axis-4ff796ae {
to {
    transform: translate3d(var(--x-landing-point), 0, 0);
}
}
@keyframes rotation-4ff796ae {
to {
    transform: rotate3d(var(--rotation), 360deg);
}
}
.confetti-container[data-v-4ff796ae] {
  width: 0;
  height: 0;
  overflow: visible;
  position: relative;
  transform: translate3d(var(--x, 0), var(--y, 0), 0);
  z-index: 1200;
}
.confetti-container > .particle[data-v-4ff796ae] {
  animation: x-axis-4ff796ae var(--duration-chaos) forwards cubic-bezier(var(--x1), var(--x2), var(--x3), var(--x4));
}
.confetti-container > .particle div[data-v-4ff796ae] {
  position: absolute;
  top: 0;
  left: 0;
  animation: y-axis-4ff796ae var(--duration-chaos) forwards cubic-bezier(var(--y1), var(--y2), var(--y3), var(--y4));
  width: var(--width);
  height: var(--height);
}
.confetti-container > .particle div[data-v-4ff796ae]:before {
  display: block;
  height: 100%;
  width: 100%;
  content: "";
  background-color: var(--bgcolor);
  animation: rotation-4ff796ae var(--rotation-duration) infinite linear;
  border-radius: var(--border-radius);
}
`;styleInject(css_248z);script.render=render;script.__scopeId="data-v-4ff796ae";var entry_esm=(()=>{const i=script;return i.install=e=>{e.component("ConfettiExplosion",i)},i})();const _withScopeId=i=>(pushScopeId("data-v-0b425b63"),i=i(),popScopeId(),i),_hoisted_1={class:"mt-5 game-stage"},_hoisted_2={class:"d-flex justify-content-center py-2 px-4"},_hoisted_3=_withScopeId(()=>createBaseVNode("hr",{class:"my-2 mx-5"},null,-1)),_hoisted_4={class:"d-flex justify-content-center py-2 px-4"},_hoisted_5={class:"prompt mx-4 px-3 mt-2"},_hoisted_6={class:"row g-2"},_hoisted_7={class:"col col-9 d-flex flex-column align-items-center"},_hoisted_8=["disabled"],_hoisted_9={class:"col"},_hoisted_10=["disabled"],_hoisted_11={class:"modal-dialog"},_hoisted_12={class:"modal-content"},_hoisted_13={class:"modal-body"},_hoisted_14=_withScopeId(()=>createBaseVNode("h3",{class:"text-center"}," YAY ",-1)),_hoisted_15=_withScopeId(()=>createBaseVNode("hr",null,null,-1)),_hoisted_16=_withScopeId(()=>createBaseVNode("a",{class:"btn btn-secondary",href:"#"},"Subscribe and notify me",-1)),_hoisted_17={class:"modal-dialog"},_hoisted_18={class:"modal-content"},_hoisted_19={class:"modal-body"},_hoisted_20=_withScopeId(()=>createBaseVNode("h3",{class:"text-center"}," YAY ",-1)),_hoisted_21=_withScopeId(()=>createBaseVNode("hr",null,null,-1)),_hoisted_22=_withScopeId(()=>createBaseVNode("a",{class:"btn btn-secondary",href:"#"},"Subscribe and notify me",-1)),_hoisted_23=createStaticVNode('<div class="modal-dialog" data-v-0b425b63><div class="modal-content" data-v-0b425b63><div class="modal-body" data-v-0b425b63><h3 class="text-center" data-v-0b425b63>What is Puxxle?</h3><p data-v-0b425b63>Puxxle is a Wordle style game where the aim is to find an array transformation expression.</p><hr data-v-0b425b63><h6 data-v-0b425b63>How to play</h6><p data-v-0b425b63>The aim of Puxxle is to figure out the order and value of a 5 item array.</p><h6 data-v-0b425b63>The hook?</h6><p data-v-0b425b63>The array can only be populated through a transformation. You are given an input array, which you map over to create a new array with different values.</p><p data-v-0b425b63>If you place a value in the correct spot, it will be <span class="text match" data-v-0b425b63>green</span><br data-v-0b425b63> If the value exists in the array, it will be <span class="text partial" data-v-0b425b63>yellow</span><br data-v-0b425b63> If there is an error with your expression, the field will be <span class="text invalid" data-v-0b425b63>grey</span></p><hr data-v-0b425b63><h6 data-v-0b425b63>You can choose!</h6><p data-v-0b425b63>Puxxle will accept either a JavaScript or an Excel expression. By default, Puxxle will assume an entry is written in JavaScript, unless the entry starts with an &quot;=&quot; sign.</p><p data-v-0b425b63> JS example for modulo operation:<br data-v-0b425b63><code data-v-0b425b63>x % 5</code><br data-v-0b425b63> Excel example for modulo operation<br data-v-0b425b63><code data-v-0b425b63>=MOD(x, 5)</code></p></div><div class="modal-footer" data-v-0b425b63><button type="button" class="btn btn-primary" data-bs-dismiss="modal" data-v-0b425b63>Start the game!</button></div></div></div>',1),_hoisted_24=[_hoisted_23],_sfc_main=defineComponent({__name:"game",props:{edition:{}},setup(__props){const props=__props,appStore=useAppStore(),edition=ref(),input=ref(),prompt=ref("x"),attempts=ref([]),hasWon=ref(!1),shareVisible=ref(!0),shareCopied=ref(!1),promptField=ref(),winModal_=ref(),introModal_=ref(),inputChecked=computed(()=>!edition.value||!input.value?null:edition.value.check(input.value.map(i=>i||"")).map((i,e)=>({value:input.value[e]||"",is_match:i=="valid",is_partial:i=="partial",is_invalid:!1}))),attempt=computed(()=>{if(!edition.value||!input.value)return null;const transformed=input.value.map(v=>{try{const value=JSON.stringify(v);let out;if(prompt.value.substring(0,1)=="="){const i=HyperFormula.buildFromArray([[prompt.value]],{licenseKey:"gpl-v3"});i.addNamedExpression("x",`=${value}`),out=i.getCellValue({col:0,row:0,sheet:0}),out instanceof DetailedCellError&&(out=null)}else out=eval(`((x) => {
          return ${prompt.value}
        })
        (${value})`);if(out!=null)return out.toString().substring(0,3)}catch(i){console.log(i)}return null});return edition.value.check(transformed.map(i=>i||"")).map((i,e)=>({value:transformed[e]||"",is_match:i=="valid",is_partial:i=="partial",is_invalid:transformed[e]==null}))}),lines=computed(()=>{if(!attempt.value)return[];if(hasWon.value)return attempts.value;const i={input:prompt.value,output:attempt.value,is_attempt:!1};return[...attempts.value,i]}),countDown=computed(()=>{var e;if(!edition.value||!((e=edition.value)!=null&&e.next_release_at))return null;const i=DateTime.fromJSDate(edition.value.next_release_at);return i<=DateTime.now()?null:{relative:i.toRelative(),display:i.toFormat("dd LLL yy 'at' HH:mm")}}),winModal=computed(()=>winModal_.value?new Modal(winModal_.value):null),introModal=computed(()=>introModal_.value?new Modal(introModal_.value):null);watch(()=>hasWon.value&&shareVisible.value,i=>{var e;return i&&((e=winModal.value)==null?void 0:e.show())}),onBeforeMount(()=>{(props.edition?appStore.universle.edition(props.edition):appStore.universle.latestEdition()).then(e=>{edition.value=e,input.value=e.payload.input,prompt.value=e.payload.prompt})}),onMounted(()=>{var i;console.log((i=introModal.value)==null?void 0:i.show())});function itemClass(i,e){return i!=null&&!i.is_attempt?{"is-invalid":e.is_invalid}:{"is-match":e.is_match,"is-partial":!e.is_match&&e.is_partial,"is-invalid":e.is_invalid}}function add(){var i;(i=promptField.value)==null||i.focus(),attempt.value&&(attempts.value.push({input:prompt.value,output:[...attempt.value],is_attempt:!0}),hasWon.value=attempt.value.reduce((e,t)=>e&&t.is_match,!0),nextTick(()=>{const e=document.querySelector(".game");e==null||e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}))}function shareScore(){var e;let i=`Puzzle (ed. ${(e=edition.value)==null?void 0:e.edition})
${window.location}

`;for(let t of attempts.value){for(let r of t.output)switch(!0){case r.is_invalid:i+="";break;case r.is_match:i+="";break;case r.is_partial:i+="";break;default:i+=""}i+=`
`}i+=`Solved in ${attempts.value.length} guess${attempts.value.length==1?"":"es"}`,navigator.clipboard.writeText(i),shareCopied.value=!0,setTimeout(()=>shareCopied.value=!1,1500)}return(i,e)=>{var t,r;return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",null,[inputChecked.value?(openBlock(),createElementBlock(Fragment,{key:0},[createBaseVNode("div",_hoisted_2,[(openBlock(!0),createElementBlock(Fragment,null,renderList(inputChecked.value,a=>(openBlock(),createElementBlock("div",{class:normalizeClass(["item mx-1",itemClass(null,a)])},toDisplayString(a.value),3))),256))]),_hoisted_3],64)):createCommentVNode("",!0),(openBlock(!0),createElementBlock(Fragment,null,renderList(lines.value,a=>(openBlock(),createElementBlock("div",_hoisted_4,[(openBlock(!0),createElementBlock(Fragment,null,renderList(a.output,o=>(openBlock(),createElementBlock("div",{class:normalizeClass(["item mx-1",itemClass(a,o)])},toDisplayString(o.value),3))),256))]))),256)),createBaseVNode("div",_hoisted_5,[createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,[withDirectives(createBaseVNode("input",{ref_key:"promptField",ref:promptField,"onUpdate:modelValue":e[0]||(e[0]=a=>prompt.value=a),disabled:hasWon.value,class:"form-control form-control-lg",autocorrect:"off",autocapitalize:"none",onKeydown:withKeys(add,["enter"])},null,40,_hoisted_8),[[vModelText,prompt.value]])]),createBaseVNode("div",_hoisted_9,[createBaseVNode("button",{type:"button",disabled:hasWon.value,class:"btn btn-primary btn-lg w-100 h-100",onClick:add},"Go",8,_hoisted_10)])])])])]),createBaseVNode("div",{ref_key:"winModal_",ref:winModal_,class:"modal fade"},[createBaseVNode("div",_hoisted_11,[createBaseVNode("div",_hoisted_12,[createBaseVNode("div",_hoisted_13,[_hoisted_14,createBaseVNode("p",null,"Congrats, you completed Puxxle (edition "+toDisplayString((t=edition.value)==null?void 0:t.edition)+") in "+toDisplayString(attempts.value.length)+" guess"+toDisplayString(attempts.value.length===1?"":"es"),1),createBaseVNode("p",null,[createBaseVNode("a",{href:"#",onClick:withModifiers(a=>null,["prevent"])},"Sign in"),createTextVNode(" to subscribe and track your scores.")]),createBaseVNode("p",null,[hasWon.value?(openBlock(),createBlock(unref(entry_esm),{key:0,force:.7})):createCommentVNode("",!0),shareCopied.value?(openBlock(),createElementBlock("a",{key:1,class:"btn btn-success disabled",href:"#",onClick:withModifiers(a=>null,["prevent"])},"Copied to clipboard")):(openBlock(),createElementBlock("a",{key:2,class:"btn btn-success",href:"#",onClick:withModifiers(shareScore,["prevent"])},"Share your score"))]),countDown.value?(openBlock(),createElementBlock(Fragment,{key:0},[_hoisted_15,createBaseVNode("h5",null,"Next puzzle "+toDisplayString(countDown.value.relative),1),createBaseVNode("p",null,toDisplayString(countDown.value.display),1),_hoisted_16],64)):createCommentVNode("",!0)])])])],512),createBaseVNode("div",{ref_key:"winModal_",ref:winModal_,class:"modal fade"},[createBaseVNode("div",_hoisted_17,[createBaseVNode("div",_hoisted_18,[createBaseVNode("div",_hoisted_19,[_hoisted_20,createBaseVNode("p",null,"Congrats, you completed Puxxle (edition "+toDisplayString((r=edition.value)==null?void 0:r.edition)+") in "+toDisplayString(attempts.value.length)+" guess"+toDisplayString(attempts.value.length===1?"":"es"),1),createBaseVNode("p",null,[createBaseVNode("a",{href:"#",onClick:withModifiers(a=>null,["prevent"])},"Sign in"),createTextVNode(" to subscribe and track your scores.")]),createBaseVNode("p",null,[hasWon.value?(openBlock(),createBlock(unref(entry_esm),{key:0,force:.7})):createCommentVNode("",!0),shareCopied.value?(openBlock(),createElementBlock("a",{key:1,class:"btn btn-success disabled",href:"#",onClick:withModifiers(a=>null,["prevent"])},"Copied to clipboard")):(openBlock(),createElementBlock("a",{key:2,class:"btn btn-success",href:"#",onClick:withModifiers(shareScore,["prevent"])},"Share your score"))]),countDown.value?(openBlock(),createElementBlock(Fragment,{key:0},[_hoisted_21,createBaseVNode("h5",null,"Next puzzle "+toDisplayString(countDown.value.relative),1),createBaseVNode("p",null,toDisplayString(countDown.value.display),1),_hoisted_22],64)):createCommentVNode("",!0)])])])],512),createBaseVNode("div",{ref_key:"introModal_",ref:introModal_,class:"modal fade"},_hoisted_24,512)],64)}}}),_export_sfc=(i,e)=>{const t=i.__vccOpts||i;for(const[r,a]of e)t[r]=a;return t},game=_export_sfc(_sfc_main,[["__scopeId","data-v-0b425b63"]]);export{game as default};
